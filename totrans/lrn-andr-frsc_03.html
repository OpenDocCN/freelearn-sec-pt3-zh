<html><head></head><body><div><h1 class="header-title">Understanding Data Storage on Android Devices</h1>
                
            
            
                
<p>The primary motive of forensic analysis is to extract necessary data from a device. Hence, for effective forensic analysis, it's imperative to know what kind of data is stored on the device, where it is stored, how it is stored, and details of the filesystems on which the data is stored. This knowledge is very important for a forensic analyst to make an informed decision about where to look for data and techniques that can be used to extract it. In this chapter, we are going to learn about the following topics:</p>
<ul>
<li>Android partition layout</li>
<li>Android file hierarchy</li>
<li>Application data storage on the device</li>
<li>Android filesystems overview</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Android partition layout</h1>
                
            
            
                
<p>Partitions are logical storage units made inside the device's persistent storage memory. Partitioning allows you to logically divide the available space into sections that can be accessed independently of one another.</p>
<p class="mce-root"/>


            

            
        
    </div>



  
<div><h1 class="header-title">Common partitions in Android</h1>
                
            
            
                
<p>The partition layout varies between vendors and versions, but a few partitions are present in all Android devices. The following are some of the common partitions found in most Android devices:</p>
<ul>
<li><kbd>BOOT</kbd>:<strong> </strong>As the name suggests, this partition has the information and files required for the phone to boot. It contains the kernel and the RAMDisk and so, without this partition, the phone can't start its processes.</li>
<li><kbd>CACHE</kbd>: This partition is used to store frequently accessed data and various other files such as recovery logs and update packages downloaded over-the-air.</li>
<li><kbd>RECOVERY</kbd>: Recovery partition allows the device to boot into the recovery console through which activities such as phone updates and other maintenance operations are performed. For this purpose, a minimal Android boot image is stored, which serves as a failsafe.</li>
<li><kbd>SYSTEM</kbd>:<strong> </strong>All of the major components other than the kernel and RAMDisk are present here. The Android system image here contains the Android framework, libraries, system binaries, and pre-installed applications. Without this partition, the device cannot boot into normal mode.</li>
<li><kbd>USERDATA</kbd>:<strong> </strong>This partition is usually called the data partition and is the device's internal storage for application data. A bulk of userdata is stored here and this is where most of our forensic evidence will reside. It stores all app data and standard communications as well.</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Identifying partition layout</h1>
                
            
            
                
<p>For a given Android device (Samsung Galaxy J7), the partition layout can be determined in a number of ways. The partitions file under <kbd>/proc</kbd> would give us details about all of the partitions available on the device.</p>
<p>The following screenshot shows the content of the partitions file:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-557 image-border" src="img/5f748e36-1006-4f27-8727-bfddf0cb4a9b.png" style="width:23.17em;height:36.83em;" width="299" height="475"/></p>
<p>Partitions file in Android</p>
<p>The preceding entries show only the block names. To get a mapping of these blocks to their logical functions, check the contents of the directory by name present under <kbd>/dev/block/platform/13540000.dwmmc0</kbd>. The following screenshot shows the content of this directory:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-558 image-border" src="img/1682c75e-6e40-471e-86b1-72f700347529.png" style="width:41.25em;height:27.67em;" width="638" height="428"/></p>
<p>Mapping of blocks to their logical functions</p>
<p>As you can see in the preceding output, various partitions such as <kbd>SYSTEM</kbd> and <kbd>USERDATA</kbd>, are present in the partition layout.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Android file hierarchy</h1>
                
            
            
                
<p>In order to perform forensic analysis on any system (desktop or mobile), it's important to understand the underlying file hierarchy. Basic understanding of how Android organizes its data in files and folders helps a forensic analyst to narrow down his/her research to specific locations. If you are familiar with Unix-like systems, you'll understand the file hierarchy in Android very well. In Linux, the file hierarchy is a single tree with the top of the tree being denoted as <kbd>/</kbd>, called the <em>root</em>. This is different from the concept of organizing files in drives (as with Windows).</p>
<p>Whether the filesystem is local or remote, it will be present under the <em>root</em>. Android file hierarchy is a customized version of this existing Linux hierarchy. Based on the device manufacturer and the underlying Linux version, the structure of this hierarchy, may have a few insignificant changes. To see the complete file hierarchy you need root access. The following screenshot shows the file hierarchy on an Android device:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-559 image-border" src="img/e18fcb98-8316-4ae3-9e89-f90f3591671c.png" style="width:73.50em;height:19.58em;" width="882" height="235"/></p>
<p>Folders present under / (root) in Android</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Overview of directories</h1>
                
            
            
                
<p>The following sections provide an overview of the directories present in the file hierarchy of an Android device.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">The acct directory</h1>
                
            
            
                
<p>This is the mount point for the acct control group (<kbd>cgroup</kbd>), which provides for user accounting.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">The cache directory</h1>
                
            
            
                
<p>This is the directory (<kbd>/cache</kbd>) where Android stores frequently accessed data and app components. Wiping the cache doesn't affect your personal data but simply deletes the existing data there. There is also another directory in this folder called <kbd>lost+found</kbd> that holds recovered files (if any) as a result of filesystem corruption, such as that caused by incorrectly removing the SD card without unmounting it. The cache may contain forensically relevant artifacts such as images, browsing history, and other app data.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">The config directory</h1>
                
            
            
                
<p>This directory contains configuration files for the SDCardFS (an in-kernel FAT32 emulation layer) and USB gadget.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">The data directory</h1>
                
            
            
                
<p>The <kbd>/data/data</kbd> partition contains the private data of all of the applications. Most of the data belonging to the user is stored in this folder. This folder has significant importance from a forensic point of view as it holds valuable data. This partition is covered in detail in the <em>Internal storage </em>section. The following screenshot shows the content of data partition:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-560 image-border" src="img/a9652134-be49-4f9a-bce1-9b7c99e818b2.png" style="width:14.75em;height:38.17em;" width="225" height="581"/></p>
<p>Content of data partition of an Android device</p>


            

            
        
    </div>



  
<div><h1 class="header-title">The dev directory</h1>
                
            
            
                
<p>This directory contains special device files for all devices. This is the mount point for the <kbd>tempfs</kbd> filesystem, which defines the devices available to the applications.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">The mnt directory</h1>
                
            
            
                
<p>This directory serves as a mount point for all of the filesystems, internal and external SD cards, and so on. The following screenshot shows the mount points present in this directory:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-561 image-border" src="img/9d4cf7b3-1c7b-428f-b7ef-811bc9b8a567.png" style="width:16.33em;height:18.00em;" width="224" height="247"/></p>


            

            
        
    </div>



  
<div><h1 class="header-title">The proc directory</h1>
                
            
            
                
<p>This is the mount point for the <kbd>procfs</kbd> filesystem, which provides access to the kernel data structures. Several programs use <kbd>/proc</kbd> as the source for their information. It contains files that have useful information about the processes. For instance, as shown in the following screenshot, <kbd>meminfo</kbd>, present under <kbd>/proc</kbd>, gives information about the memory:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-562 image-border" src="img/75a8d911-494a-4939-a775-b36e4bd62438.png" style="width:18.58em;height:37.08em;" width="291" height="581"/></p>
<p>The meminfo file under the proc folder in Android</p>


            

            
        
    </div>



  
<div><h1 class="header-title">The sbin directory</h1>
                
            
            
                
<p>This contains binaries for several important daemons. It is not of much significance from a forensic perspective.</p>
<p class="mce-root"/>


            

            
        
    </div>



  
<div><h1 class="header-title">The storage directory</h1>
                
            
            
                
<p>Here you can find SD card contents. Please note that this SD card can be either removable storage or non-removable storage. Any app on your phone with the <kbd>WRITE_EXTERNAL_STORAGE</kbd> permission may create files or folders in this location. There are some default folders such as <kbd>Android</kbd>, <kbd>DCIM</kbd>, and <kbd>Downloads</kbd> present in most mobiles. The following screenshot shows the contents of the <kbd>/storage/self/primary</kbd> location:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-563 image-border" src="img/c41838d0-c907-44cc-965a-1f386cd149bb.png" style="width:32.08em;height:13.42em;" width="578" height="242"/></p>
<p>The content of /storage/self/primary (/sdcard is a symlink)</p>
<p><strong>Digital Camera Images</strong> (<strong>DCIM</strong>) is the default directory structure for digital cameras, smartphones, tablets, and related solid state devices. Some tablets have a <kbd>Photos</kbd> folder that points to the same location. Within DCIM, you will find photos you have taken, videos, and thumbnails (cache files). Photos are stored in <kbd>/DCIM/Camera</kbd>.</p>
<p>Android developer's reference explains that there are certain public storage directories that are not tied to a specific program. The following is a quick overview of those folders:</p>
<ul>
<li><kbd>Music</kbd>: Media scanner classifies all media found here as user music</li>
<li><kbd>Podcasts</kbd>: Media scanner classifies all media found here as podcasts</li>
<li><kbd>Ringtones</kbd>: Media files present here are classified as ringtones</li>
<li><kbd>Alarms</kbd>: Media files present here are classified as alarms</li>
<li><kbd>Notifications</kbd>: Media files under this location are used for notification sounds</li>
<li><kbd>Pictures</kbd>: All photos except the ones taken with the camera are stored in this folder</li>
<li><kbd>Movies</kbd>: All movies except the ones taken with the camera are stored in this folder</li>
<li><kbd>Download</kbd>: Miscellaneous downloads</li>
</ul>
<p class="mce-root"/>
<p class="mce-root"/>


            

            
        
    </div>



  
<div><h1 class="header-title">The system directory</h1>
                
            
            
                
<p>This directory contains libraries, system binaries, and other system-related files. The pre-installed applications that come along with the phone are also present in this partition. The following screenshot shows the files present in the system partition on an Android device:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-564 image-border" src="img/0f1e4a09-5574-4129-9c3e-60dba86f615f.png" style="width:13.50em;height:22.00em;" width="202" height="329"/></p>
<p>Contents of system partition of an Android device</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Application data storage on the device</h1>
                
            
            
                
<p>Android devices store lots of sensitive data through the use of apps. Although we have earlier categorized apps as system and user-installed apps, here is a more detailed split:</p>
<ul>
<li>Apps that come along with Android</li>
<li>Apps installed by the manufacturer</li>
<li>Apps installed by the wireless carrier</li>
<li>Apps installed by the user</li>
</ul>
<p>All of these store different types of data on the device. Application data often contains a wealth of information that is relevant to the investigation. Here is a sample list of possible data that can be found on an Android device:</p>
<ul>
<li>SMS</li>
<li>MMS</li>
<li>Chat messages</li>
<li>Backups</li>
<li>Emails</li>
<li>Call logs</li>
<li>Contacts</li>
<li>Pictures</li>
<li>Videos</li>
<li>Browser history</li>
<li>GPS data</li>
<li>Files or documents downloaded</li>
<li>Data that belongs to installed apps (Facebook, Twitter, and other social media apps)</li>
<li>Calendar appointments</li>
</ul>
<p>Data belonging to different applications can be stored either internally or externally. In the case of external storage (SD card), data can be stored in any location. But in the case of internal storage, the location is predefined. To be specific, the internal data of all apps present on the device (either system apps or user-installed apps) is automatically saved in a subdirectory of <kbd>/data/data</kbd> named after the package name. For example, the default Android email app has a package name of <kbd>com.android.email</kbd> and the internal data is stored in <kbd>/data/data/com.android.email</kbd>. We are going to discuss this in detail in the coming sections but, for now, this knowledge is sufficient to understand the following details.</p>
<p class="mce-root"/>
<p class="mceNonEditable"/>
<p>Android provides developers with certain options to store data to the device. The option that can be used depends on the underlying data that is to be stored. Data that belongs to applications can be stored in one of the following locations:</p>
<ul>
<li>Shared preferences</li>
<li>Internal storage</li>
<li>External storage</li>
<li>SQLite database</li>
<li>Network</li>
</ul>
<p>The following sections provide clear explanations regarding each of these options.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Shared preferences</h1>
                
            
            
                
<p>Shared preferences provide a framework to store key-value pairs of primitive data types in XML format. Primitive data types includes Boolean, float, int, long, and string. Strings are stored in the <strong>Unicode Transformation Format</strong> (<strong>UTF</strong>) format. These files are typically stored in an application's <kbd>/data/data/shared_pref</kbd> path. For instance, the <kbd>shared_pref</kbd> folder for Android email app contains the following three XML files:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-565 image-border" src="img/a08196e3-8892-4a87-bf90-f803346e4918.png" style="width:32.08em;height:6.58em;" width="385" height="79"/></p>
<p>Contents of the shared_prefs folder of the Android email app</p>
<p>As explained in <a href="b81853c6-388b-4e15-b8dd-deb5c1b5b36d.xhtml" target="_blank">Chapter 2</a>, <em>Setting up Android Forensic Environment</em>, the content of these files can be viewed using the <kbd>cat</kbd> command. The following screenshot shows the contents of the <kbd>UnifiedEmail.xml</kbd> file:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-566 image-border" src="img/b275c2cf-04e4-4bca-9b95-78449e915b3e.png" style="width:40.75em;height:12.25em;" width="597" height="180"/></p>
<p>The Android email app's shared preferences file content</p>
<p>Different XML files may contain different pieces of information that can be very helpful during forensic examinations, for example, account names or even passwords.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Internal storage</h1>
                
            
            
                
<p>The files here are stored in the internal storage. These are located typically in the application's <kbd>/data/data</kbd> subdirectory. Data stored here is private and cannot be accessed by other applications. Even the device owner is prevented from viewing the files (unless they have root access).</p>
<p>However, based on the requirement, the developer can allow other processes to modify and update these files. The following screenshot shows the details of the apps stored with their package name under the <kbd>/data/data</kbd> directory:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-568 image-border" src="img/d1a636a9-5cca-4f81-a597-d68eec777f9e.png" style="width:41.00em;height:46.75em;" width="648" height="740"/></p>
<p>Contents of the /data/data folder in Android</p>
<p>The internal data of each app is stored in their respective folders. For instance, the following screenshot shows internal storage that belongs to the YouTube app on an Android device:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-569 image-border" src="img/550bd5a7-3f3c-4073-ad51-9b412f1b51f4.png" style="width:26.08em;height:10.42em;" width="378" height="151"/></p>
<p>Internal storage of the Android YouTube app</p>
<p>Usually the <kbd>databases</kbd>, <kbd>lib</kbd>, <kbd>shared_pref</kbd>, <kbd>cache</kbd> folders are created for most of the applications. The following table provides a brief description of these folders:</p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td style="width: 189px">
<p><strong>Sub directory</strong></p>
</td>
<td style="width: 356px">
<p><strong>Description</strong></p>
</td>
</tr>
<tr>
<td style="width: 189px">
<p><kbd>shared_prefs</kbd></p>
</td>
<td style="width: 356px">
<p>XML file of shared preferences</p>
</td>
</tr>
<tr>
<td style="width: 189px">
<p><kbd>lib</kbd></p>
</td>
<td style="width: 356px">
<p>Custom library files required by an app</p>
</td>
</tr>
<tr>
<td style="width: 189px">
<p><kbd>files</kbd></p>
</td>
<td style="width: 356px">
<p>Developer saved files</p>
</td>
</tr>
<tr>
<td style="width: 189px">
<p><kbd>cache</kbd></p>
</td>
<td style="width: 356px">
<p>Files cached by app</p>
</td>
</tr>
<tr>
<td style="width: 189px">
<p><kbd>databases</kbd></p>
</td>
<td style="width: 356px">
<p>SQLite and journal files</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Folders other than these are custom folders created by the app developer. The <kbd>databases</kbd> folder is the one that contains crucial data that helps in forensic investigations. As shown in the following screenshot, data in this folder is stored in SQLite files:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-570 image-border" src="img/3f3d3443-c9b5-4182-b188-87c1b5d27ea3.png" style="width:33.08em;height:7.42em;" width="460" height="103"/></p>
<p>SQLite files present under the databases folder of the Android browser app</p>
<p>This data can be viewed using tools such as DB Browser for SQLite. More details about how to extract data is covered in detail under <a href="b5ab11df-1911-4deb-accd-f92c74650e6d.xhtml" target="_blank"/><a href="b5ab11df-1911-4deb-accd-f92c74650e6d.xhtml" target="_blank">Chapter 4</a>, <em>Extracting Data Logically from Android Devices</em>.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">External storage</h1>
                
            
            
                
<p>Files can also be stored by the apps in external storage. External storage can be a removable media such as a SD card or non-removable storage that comes with the phone. In the case of a removable SD card, data could be used on other devices just by removing the SD card and inserting in any other device. SD cards are usually formatted with the FAT32 filesystem but other filesystems such as EXT3 and EXT4 are also being increasingly used. Unlike internal storage, external storage does not have strict security enforcements. In other words, data stored here is public and can be accessed by other applications provided the requesting apps have the necessary permissions.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">SQLite database</h1>
                
            
            
                
<p>SQLite is a popular database format present in many mobile systems and is used for structured data storage. SQLite is open source and, unlike many other databases, it is compact and offers a lot of functionality. Android supports SQLite through dedicated APIs and hence developers can take advantage of it. SQLite databases are a rich source of forensic data. The SQLite files used by apps are generally stored under <kbd>/data/data/&lt;ApplicationPackageName&gt;/databases</kbd>. For example, in the case of the Android email app, the following screenshot shows the SQLite files present in its databases folder. We will examine these details more in the next sections. From a forensic point of view, they are highly valuable since they often store lot of important data handled by the application.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Network</h1>
                
            
            
                
<p>You can use the network to store and retrieve data on your own web-based services. To do network operations, the classes in the <kbd>java.net.*</kbd> and <kbd>android.net.*</kbd> packages can be used. These packages provide developers with low level APIs necessary to interact with the network, web servers, and so on.</p>
<p class="mce-root"/>


            

            
        
    </div>



  
<div><h1 class="header-title">Android filesystem overview</h1>
                
            
            
                
<p>Understanding the filesystem is very important in Android forensics, as it helps us to gain knowledge on how data is stored and retrieved. This knowledge about properties and the structure of a filesystem proves to be useful during forensic analysis. Filesystem refers to the way data is stored, organized, and retrieved from a volume. A basic installation may be based on one volume split into several partitions; here, each partition can be managed by a different filesystem. Microsoft Windows users are familiar with FAT32 or NTFS filesystems, whereas Linux users are more familiar with EXT2 or EXT4 filesystems. As is true in Linux, Android utilizes mount points and not drives (that is, <kbd>C:</kbd> or <kbd>E:</kbd>). Each filesystem defines its own rules for managing the files on the volume. Depending on these rules, each filesystem offers a different speed for file retrieval, security, size, and so on. Linux uses several filesystems, and so does Android. From a forensic point of view, it's important to understand what filesystems are used by Android and to identify the filesystems that are of significance to the investigation. For example, the filesystem that stores the user's data is of primary concern to us, as opposed to a filesystem used to boot the device.</p>
<p>As mentioned previously, Linux is known to support a large number of filesystems. These filesystems used by the system are not accessed by drive names, but instead are combined into a single hierarchical tree structure that represents the filesystem as a single entity. Each new filesystem is added into this single filesystem tree when it is mounted.</p>
<div><p>In Linux, mounting is an act of attaching an additional filesystem to the currently accessible filesystem of a computer.</p>
</div>
<p>Hence, the filesystems are mounted onto a directory and files present in this filesystem are now the contents of that directory. This directory is called a <em>mount point</em>. It makes no difference whether the filesystem exists on the local device or on a remote device. Everything is integrated into a single file hierarchy that begins with root. Each filesystem has a separate kernel module that registers the operations that it supports with something called <strong>Virtual File System </strong>(<strong>VFS</strong>). VFS allows different applications to access different filesystems in a uniform way. By separating the implementation from the abstraction, adding a new filesystem becomes a matter of writing another kernel module. These modules are either part of the kernel or are dynamically loaded on demand. The Android kernel comes with a subset of the vast collection of filesystems that range from the <strong>Journal File System</strong> (<strong>JFS</strong>) to the Amiga file system. All of the background work is handled by the kernel when a filesystem is mounted.</p>
<p class="mce-root"/>


            

            
        
    </div>



  
<div><h1 class="header-title">Viewing filesystems on an Android device</h1>
                
            
            
                
<p>The filesystems supported by the Android kernel can be determined by checking the content of the <kbd>filesystems</kbd> file present in the <kbd>proc</kbd> folder. The content of this file can be viewed using the following command:</p>
<pre><strong>j7xelte:/ # cat /proc/filesystems</strong><br/><strong> nodev sysfs</strong><br/><strong> nodev rootfs</strong><br/><strong> nodev tmpfs</strong><br/><strong> nodev bdev</strong><br/><strong> nodev proc</strong><br/><strong> nodev cgroup</strong><br/><strong> nodev devtmpfs</strong><br/><strong> nodev debugfs</strong><br/><strong> nodev securityfs</strong><br/><strong> nodev sockfs</strong><br/><strong> nodev pipefs</strong><br/><strong> nodev ramfs</strong><br/><strong> nodev configfs</strong><br/><strong> nodev devpts</strong><br/><strong> ext3</strong><br/><strong> ext2</strong><br/><strong> ext4</strong><br/><strong> nodev sdcardfs</strong><br/><strong> cramfs</strong><br/><strong> vfat</strong><br/><strong> msdos</strong><br/><strong> sdfat</strong><br/><strong> nodev ecryptfs</strong><br/><strong> fuseblk</strong><br/><strong> nodev fuse</strong><br/><strong> nodev fusectl</strong><br/><strong> f2fs</strong><br/><strong> nodev pstore</strong><br/><strong> nodev selinuxfs</strong><br/><strong> nodev functionfs</strong></pre>
<p>In the preceding output, the filesystems preceded by the <kbd>nodev</kbd> property are not mounted on the device.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Common Android filesystems</h1>
                
            
            
                
<p>The filesystems present in Android can be divided into three main categories:</p>
<ul>
<li>Flash memory filesystems</li>
<li>Media-based filesystems</li>
<li>Pseudo filesystems</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">What data can be recovered logically?</h1>
                
            
            
                
<p>For the most part, any and all user data may be recovered logically:</p>
<ul>
<li>Contacts</li>
<li>Call logs</li>
<li>SMS/MMS</li>
<li>Application data</li>
<li>System logs and information</li>
</ul>
<p>The bulk of this data is stored in SQLite databases, so it's even possible to recover large amounts of deleted data through a logical extraction.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Flash memory filesystems</h1>
                
            
            
                
<p>Flash memory is a type of constantly-powered nonvolatile memory that can be erased and reprogrammed in units of memory called blocks. Due to the particular characteristics of flash memories, special filesystems are needed write over the media and deal with the long erase times of certain blocks. While the supported filesystems vary on different Android devices, the common flash memory filesystems are as follows:</p>
<ul>
<li><strong>Extended File Allocation Table</strong> (<strong>exFAT</strong>)<strong> </strong>is a Microsoft proprietary filesystem optimized for flash drives. Because of the license requirements, it isn't part of the standard Linux kernel. But still, a few manufacturers provide support for this filesystem.</li>
<li><strong>Flash Friendly File System</strong> (<strong>F2FS</strong>) was introduced by Samsung as an open source filesystem. The basic intention was to build a filesystem that takes into account the characteristics of NAND flash memory-based storage devices.</li>
<li><strong>Journal Flash File System version 2</strong> (<strong>JFFS2 </strong>) is a log-structured filesystem used in Android. JFFS2 is the default flash filesystem for <strong>Android Open Source Project</strong> (<strong>ASOP</strong>)<strong> </strong>since the Ice Cream Sandwich version. Filesystems such as LogFS, UBIFS, YAFFS, and so on have been developed as a replacement for JFFS2.</li>
<li><strong>Yet Another Flash File System version</strong> <strong>2</strong> (<strong>YAFFS2</strong>) is an open source, single-threaded filesystem released in 2002. It is mainly designed to be fast when dealing with NAND flash. YAFFS2 utilizes <strong>out-of-band</strong> (<strong>OOB</strong>) and that is often not captured or decoded correctly during forensic acquisition, which makes analysis difficult. YAFFS2 was the most popular release at one point and is still widely used in Android devices. YAFFS2 is a log-structured filesystem. Data integrity is guaranteed even in the case of sudden power outage. In 2010, there was an announcement stating that, in releases after Gingerbread, devices were going to move from YAFFS2 to EXT4. Currently, YAFFS2 is not supported in newer kernel versions, but certain mobile manufacturers might still continue to support it.</li>
<li><strong>Robust File System</strong> (<strong>RFS</strong>) supports NAND flash memory on Samsung devices. RFS can be summarized as a FAT16 (or FAT32) filesystem where journaling is enabled through a transaction log. Many users complain that Samsung should stick with EXT4. RFS has been known to have lag times that slow down the features of Android.</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Media-based filesystems</h1>
                
            
            
                
<p>Besides the previously discussed flash memory filesystems, Android devices typically support the following media-based filesystems:</p>
<ul>
<li><strong>EXT2/EXT3/EXT4 (EXTended filesystem)</strong>, which was introduced in 1992 specifically for the Linux kernel, was one of the first filesystems and used the virtual filesystem. EXT2, EXT3, and EXT4 are the subsequent versions. Journaling is the main advantage of EXT3 over EXT2. With EXT3, in the case of an unexpected shutdown, there is no need to verify the filesystem. The EXT4 filesystem, the fourth extended filesystem, has gained significance with mobile devices implementing dual-core processors. The YAFFS2 filesystem is known to have a bottleneck on dual-core systems. With the Gingerbread version of Android, the YAFFS filesystem was swapped for EXT4.</li>
<li><strong>FAT</strong> <strong>(File Allocation Table)</strong> filesystems such as FAT12, FAT16, and FAT32 are supported by the MSDOS driver.</li>
<li><strong>VFAT</strong> <strong>(Virtual File Allocation Table)</strong> is an extension to the FAT16 and FAT32 filesystems. Microsoft's FAT32 filesystem is supported by most Android devices. It is supported by almost all of the major operating systems, including Windows, Linux, and macOS. This enables these systems to easily read, modify, and delete the files present on the FAT32 portion of the Android device. Most of the external SD cards are formatted using the FAT32 filesystem.</li>
</ul>
<p class="mce-root"/>
<p class="mce-root"/>


            

            
        
    </div>



  
<div><h1 class="header-title">Pseudo filesystems</h1>
                
            
            
                
<p>In addition to these, there are also pseudo filesystems, which can be thought of as logical groupings of files. The following are some of the important pseudo filesystems found in Android devices:</p>
<ul>
<li>The <kbd>cgroup</kbd> pseudo filesystem provides a way to access and define several kernel parameters. There are a number of different process control groups present. As shown in the following command-line output, the list of groups can be seen in the <kbd>/proc/cgroups</kbd> file:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-571 image-border" src="img/53bf3334-fa67-4a84-8f78-c0b14b4aaaad.png" style="width:38.08em;height:6.92em;" width="457" height="83"/></p>
<p style="padding-left: 60px">Android devices use this filesystem to track their job. They are responsible for aggregating the tasks and keeping track of them.</p>
<ul>
<li>The <kbd>rootfs</kbd> filesystem is one of the main components of Android and contains all of the information required to boot the device. When the device starts the boot process, it needs access to many core files and hence mounts the root filesystem. This filesystem is mounted at <kbd>/</kbd> (the <kbd>root</kbd> folder). Hence, this is the filesystem on which all other filesystems are slowly mounted. If this filesystem is corrupt, the device cannot be booted.</li>
<li>The <kbd>Procfs</kbd> filesystem contains information about kernel data structures, processes, and other system-related information under the <kbd>/proc</kbd> directory. For instance, the <kbd>/proc/filesystems</kbd> file displays the list of available filesystems on the device. The following command shows all information about the CPU of the device:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-572 image-border" src="img/568f4d57-dd85-4385-9e6a-e88b7840d522.png" style="width:80.00em;height:55.42em;" width="960" height="665"/></p>
<ul>
<li>The <kbd>sysfs</kbd> filesystem mounts the <kbd>/sys</kbd> folder, which contains information about the configuration of the device. The following output shows various folders under the <kbd>sys</kbd> directory in an Android device:</li>
</ul>
<pre style="padding-left: 60px"><strong>j7xelte:/sys # ls -1</strong><br/><strong> bcm-dhd</strong><br/><strong> block</strong><br/><strong> bus</strong><br/><strong> class</strong><br/><strong> dev</strong><br/><strong> devices</strong><br/><strong> firmware</strong><br/><strong> fs</strong><br/><strong> kernel</strong><br/><strong> mms_ts</strong><br/><strong> module</strong><br/><strong> power</strong></pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p style="padding-left: 60px">Since the data present in these folders is mostly related to configuration, this is not usually of much significance to a forensic investigator. But there could be some circumstances where we might want to check whether a particular setting was enabled on the phone, and analyzing this folder could be useful under such conditions. Note that each folder consists of a large number of files. Capturing this data through forensic acquisition is the best method to ensure this data is not changed during examination.</p>
<ul>
<li><kbd>tmpfs</kbd> is a temporary storage facility on the device that stores the files in RAM (volatile memory). This is often mounted on the <kbd>/dev</kbd> directory. The main advantage of using RAM is faster access and retrieval. But, once the device is restarted or switched off, this data won't be accessible anymore. Hence, it's important for a forensic investigator to examine the data in RAM before a device reboot happens or to extract the data.</li>
</ul>
<p>You can use the <kbd>mount</kbd> command to see different partitions and their filesystems available on the device, as follows:</p>
<pre><strong>j7xelte:/ # mount</strong><br/><strong> rootfs on / type rootfs (ro,seclabel,size=850052k,nr_inodes=212513)</strong><br/><strong> tmpfs on /dev type tmpfs (rw,seclabel,nosuid,relatime,mode=755)</strong><br/><strong> devpts on /dev/pts type devpts (rw,seclabel,relatime,mode=600)</strong><br/><strong> proc on /proc type proc (rw,relatime,gid=3009,hidepid=2)</strong><br/><strong> sysfs on /sys type sysfs (rw,seclabel,relatime)</strong><br/><strong> selinuxfs on /sys/fs/selinux type selinuxfs (rw,relatime)</strong><br/><strong> /dev/block/mmcblk0p20 on /system type ext4 (ro,seclabel,relatime,errors=panic,data=ordered)</strong><br/><strong> none on /acct type cgroup (rw,relatime,cpuacct)</strong><br/><strong> tmpfs on /mnt type tmpfs (rw,seclabel,relatime,mode=755,gid=1000)</strong><br/><strong> none on /config type configfs (rw,relatime)</strong><br/><strong> none on /dev/cpuctl type cgroup (rw,relatime,cpu)</strong><br/><strong> pstore on /sys/fs/pstore type pstore (rw,seclabel,relatime)</strong><br/><strong> /dev/block/mmcblk0p3 on /efs type ext4 (rw,seclabel,nosuid,nodev,noatime,discard,journal_checksum,journal_async_commit,noauto_da_alloc,data=ordered)</strong><br/><strong> adb on /dev/usb-ffs/adb type functionfs (rw,relatime)</strong><br/><strong> tmpfs on /storage type tmpfs (rw,seclabel,relatime,mode=755,gid=1000)</strong><br/><strong> /dev/block/mmcblk0p4 on /cpefs type ext4 (rw,seclabel,nosuid,nodev,noatime,data=ordered)</strong><br/><strong> /dev/block/mmcblk0p21 on /cache type ext4 (rw,seclabel,nosuid,nodev,noatime,discard,journal_checksum,journal_async_commit,noauto_da_alloc,errors=panic,data=ordered)</strong><br/><strong> /dev/block/mmcblk0p24 on /data type ext4 (rw,seclabel,nosuid,nodev,noatime,discard,journal_checksum,journal_async_commit,noauto_da_alloc,errors=panic,data=ordered)</strong><br/><strong> tmpfs on /sbin type tmpfs (rw,seclabel,relatime)</strong><br/><strong> /dev/block/mmcblk0p20 on /sbin/.core/mirror/system type ext4 (ro,seclabel,relatime,errors=panic,data=ordered)</strong><br/><strong> /dev/block/mmcblk0p24 on /sbin/.core/mirror/bin type ext4 (rw,seclabel,nosuid,nodev,noatime,discard,journal_checksum,journal_async_commit,noauto_da_alloc,errors=panic,data=ordered)</strong><br/><strong> /sbin/.core/block/loop08 on /sbin/.core/img type ext4 (rw,seclabel,relatime,data=ordered)</strong><br/><strong> /dev/fuse on /mnt/runtime/default/emulated type fuse (rw,nosuid,nodev,noexec,noatime,user_id=1023,group_id=1023,default_permissions,allow_other)</strong><br/><strong> /dev/fuse on /storage/emulated type fuse (rw,nosuid,nodev,noexec,noatime,user_id=1023,group_id=1023,default_permissions,allow_other)</strong><br/><strong> /dev/fuse on /mnt/runtime/read/emulated type fuse (rw,nosuid,nodev,noexec,noatime,user_id=1023,group_id=1023,default_permissions,allow_other)</strong><br/><strong> /dev/fuse on /mnt/runtime/write/emulated type fuse (rw,nosuid,nodev,noexec,noatime,user_id=1023,group_id=1023,default_permissions,allow_other)</strong><br/><strong> /dev/block/mmcblk0p24 on /sbin/.core/db-0/magisk.db type ext4 (rw,seclabel,nosuid,nodev,noatime,discard,journal_checksum,journal_async_commit,noauto_da_alloc,errors=panic,data=ordered)</strong></pre>
<p>As seen in the preceding command-line output, different partitions have different filesystems and they are mounted accordingly.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Summary</h1>
                
            
            
                
<p>Having sound knowledge of Android's partition layout, filesystems, and important locations would help the forensic investigator during the process of extracting data from the device. The userdata location on the Android device contains a bulk of user information that can be crucial for any forensic investigation. However, most of these files may be accessed only on a rooted phone (especially files present under the <kbd>/data/data</kbd> location). We have also seen Android data storage options, various filesystems used by Android, and their significance.</p>
<p>With this knowledge, we will now learn in the upcoming chapters about how to logically and physically extract data from an Android device.</p>


            

            
        
    </div>



  </body></html>