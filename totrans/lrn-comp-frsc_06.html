<html><head></head><body>
  <div><h1 class="chapterNumber">6</h1>
    <h1 id="_idParaDest-119" class="chapterTitle">Windows Artifact Analysis</h1>
    <p class="normal">The world runs on the Microsoft Windows operating system, with Microsoft accounting for nearly 90 percent of the operating system market share (<a href="https://netmarketshare.com/">https://netmarketshare.com/</a>). In my personal experience, I have examined far more Windows operating systems than any other operating system; macOS would be the next most common operating system, with Linux running a distant third. While you have to be prepared to analyze all operating systems, whichever is the most common within the realm you are working in is where you should focus your attention.</p>
    <p class="normal">This chapter will provide you with an understanding of the Windows operating system and the artifacts you may find. There are entire books written about the Windows operating system; this chapter’s goal is to provide you with an understanding of the more common operating system artifacts you may encounter during your investigation. You will start by going through user profiles where an examiner can find most user data. Then, we will look at the Windows Registry to identify the Windows settings. You will also look at artifacts to determine the user’s activities and learn how to identify which USB devices were used on the system. Finally, we will cover all of this in the following topics:</p>
    <ul>
      <li class="bulletList">Understanding user profiles </li>
      <li class="bulletList">Understanding Windows Registry</li>
      <li class="bulletList">Determining account usage</li>
      <li class="bulletList">Determining file knowledge</li>
      <li class="bulletList">Identifying physical locations</li>
      <li class="bulletList">Exploring program execution</li>
      <li class="bulletList">Understanding USB/attached devices</li>
    </ul>
    <p class="normal">An operating system manages the hardware resources and allows the user to run other applications that are essentially programs within the operating system environment. It can be a treasure trove of artifacts to recreate user or system activity at any given moment in time. When we discuss the Windows operating system, this topic could cover multiple versions. At the time of writing, the current version of the Windows operating system is Windows 11, but Windows 10 is still on the majority of systems. That does not mean every system you examine will have Windows 10 installed on it. It is possible that even in a corporate environment, you could still examine a Windows XP client, although Microsoft released it in 2001 and no longer supports it.</p>
    <p class="normal">I will focus on Windows 7, 8, and 10 for the rest of this chapter. First, however, there may be references to Windows XP because of Microsoft’s legacy support for the operating system.</p>
    <p class="normal">The first item I want to discuss is the different types of user profiles and where the operating system will store the user’s data.</p>
    <h1 id="_idParaDest-120" class="heading-1">Understanding user profiles</h1>
    <p class="normal">When the Windows operating system<a id="_idIndexMarker533"/> is installed, it creates a default folder structure to store user and application data. Sometimes, just looking at the folder structure can tell you which version is or isn’t installed.</p>
    <p class="normal">When you are looking for user account profiles, the location can vary depending on the version of the operating system:</p>
    <ul>
      <li class="bulletList">For Windows XP, WinNT, and Win2000<ul>
          <li class="bulletList"><code class="inlineCode">C:\Documents and Settings\%UserName%</code></li>
        </ul>
      </li>
      <li class="bulletList">For Windows Vista, 7, 8, and 10<ul>
          <li class="bulletList"><code class="inlineCode">C:\Users\%UserName%</code></li>
        </ul>
      </li>
    </ul>
    <p class="normal">When the user first logs on to the system, it will create a user profile. That profile will then be used for any subsequent logins and is now the user’s environment for their activity on the system. Microsoft defines the different types of user profiles:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Local user profile</strong>: This profile is created<a id="_idIndexMarker534"/> when the user logs on<a id="_idIndexMarker535"/> to a computer for the first time. You will find the profile stored on the hard disk. When changes are made to the profile, the changes will be specific<a id="_idIndexMarker536"/> to the user and stored<a id="_idIndexMarker537"/> on the local computer.</li>
      <li class="bulletList"><strong class="keyWord">Roaming user profile</strong>: This profile is an administrator-created, network-based profile. The profile<a id="_idIndexMarker538"/> will be downloaded to the localhost<a id="_idIndexMarker539"/> when the user logs in to the system. When any changes are made to the profile on the localhost, changes will also be made to the server copy when the user logs off from the localhost. This profile type removes the requirement on the part of the user to create a profile when they log on to different hosts on the network. (You will only find this type of profile in Enterprise environments.)</li>
      <li class="bulletList"><strong class="keyWord">Mandatory user profile</strong>: This profile is a profile created<a id="_idIndexMarker540"/> by the network administrators<a id="_idIndexMarker541"/> to lock users down to a specific set of settings when they use a host on the network. The user will not be allowed to change the profile without the administrator’s approval. Any changes made by the user to the localhost environment will be lost when the user logs off from the localhost.</li>
      <li class="bulletList"><strong class="keyWord">Temporary user profile</strong>: This profile is created when an error<a id="_idIndexMarker542"/> occurs when the system loads<a id="_idIndexMarker543"/> the user’s profile. When the user logs off, the profile is deleted. You will find the use of temporary profiles on computers running Windows 2000 and later.</li>
    </ul>
    <p class="normal">Each user profile will have a registry hive – <code class="inlineCode">NTUSER.DAT</code> – and is mapped to the system registry key of <strong class="keyWord">HKEY Current User</strong> when the user logs in. This registry<a id="_idIndexMarker544"/> hive contains the user’s preferences and configuration settings.</p>
    <p class="normal">Each user profile contains the following folders:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\Documents</code></li>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\Music</code></li>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\Pictures</code></li>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\Videos</code></li>
    </ul>
    <p class="normal">The <code class="inlineCode">AppData</code> folder is a hidden folder that contains<a id="_idIndexMarker545"/> user-specific preferences and profile configurations and is further divided into three subfolders:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\AppData</code></li>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\AppData\Local</code></li>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\AppData\LocalLow</code></li>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\AppData\Roaming</code></li>
    </ul>
    <p class="normal">The <code class="inlineCode">Roaming</code> folder contains data<a id="_idIndexMarker546"/> that can be synced within the server environment. Data such as web browser favorites or bookmarks will travel with the user as they log on to different workstations:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\AppData\Roaming\Microsoft\Windows\Cookies</code></li>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\AppData\Roaming\Microsoft\Windows\Network Shortcuts</code></li>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\AppData\Roaming\Microsoft\Windows\Printer Shortcuts</code></li>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\AppData\Roaming\Microsoft\Windows\Recent</code></li>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\AppData\Roaming\Microsoft\Windows\SendTo</code></li>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\AppData\Roaming\Microsoft\Windows\Start Menu</code></li>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\AppData\Roaming\Microsoft\Windows\Templates</code></li>
    </ul>
    <p class="normal">The <code class="inlineCode">Local</code> folder contains data related<a id="_idIndexMarker547"/> to the installation of programs. It is workstation specific and will not sync with the server (in a server environment). Temporary files are also stored here:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\AppData\Local</code></li>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\AppData\Local\Microsoft\Windows\History</code></li>
      <li class="bulletList"><code class="inlineCode">\Users\$USER$\AppData\Local\Microsoft\Windows\Temporary Internet Files</code></li>
    </ul>
    <p class="normal">The <code class="inlineCode">LocalLow</code> folder includes low-level access<a id="_idIndexMarker548"/> data, such as the temporary files of your browser when running in protected mode.</p>
    <p class="normal">That completes our discussion on user accounts, so let’s move on to the registry, which is the heart and soul of the Windows operating system.</p>
    <h1 id="_idParaDest-121" class="heading-1">Understanding Windows Registry</h1>
    <p class="normal">The Windows Registry is the very heart of the Windows operating<a id="_idIndexMarker549"/> system and will be the source of many artifacts we will discuss later in the chapter. First, I will provide a high-level view of the registry. Then, suppose you want to dig deeper into the nuts and bolts of the registry. In that case, I highly recommend Harlan Carvey’s book <em class="italic">Windows Registry Forensics – Advanced Digital Forensic Analysis of the Windows Registry</em>. Harlan Carvey is also the developer of the tool RegRipper, which is a tool we will use in this chapter.</p>
    <p class="normal">What is the registry? Microsoft defines the registry as a central hierarchical database. This database is used to store configuration information about users, hardware devices, and applications.</p>
    <p class="normal">But what does that mean<a id="_idIndexMarker550"/> for the forensic investigator? Windows continually references the information in the registry during operations. Information in the registry will contain profiles for each user, installed applications, different document types, and property settings for folders and application icons. The registry will also contain information about the hardware on the system, including networking information such as the ports used.</p>
    <p class="normal">Wow. That was a mouthful, but in simple terms, the registry contains information about… almost everything on the computer system.</p>
    <p class="normal">The components of the registry are found in the <code class="inlineCode">%SystemRoot%\System32\Config</code> folder<a id="_idIndexMarker551"/> and are called hive files. You will find the <code class="inlineCode">SAM</code>, <code class="inlineCode">SECURITY</code>, <code class="inlineCode">SOFTWARE</code>, and <code class="inlineCode">SYSTEM</code> hives. Below is a brief description of the hives:</p>
    <ul>
      <li class="bulletList">The <code class="inlineCode">SAM</code> hive is the Security Accounts Manager<a id="_idIndexMarker552"/> and contains login information about the users.</li>
      <li class="bulletList">The <code class="inlineCode">SECURITY</code> hive contains security information<a id="_idIndexMarker553"/> and, potentially, password information.</li>
      <li class="bulletList">The <code class="inlineCode">SOFTWARE</code> hive contains information<a id="_idIndexMarker554"/> about application information and the default Windows settings.</li>
      <li class="bulletList">The <code class="inlineCode">SYSTEM</code> hive includes information<a id="_idIndexMarker555"/> on the hardware and system configuration.</li>
    </ul>
    <p class="normal">There is an additional hive, <code class="inlineCode">NTUser.dat</code>, which is stored in the root of the user profile. This hive contains information about user behavior and their settings.</p>
    <p class="normal">Another file in the hive format is the <code class="inlineCode">UsrClass.dat</code> file, which is found in the <code class="inlineCode">\AppData\Local\Microsoft\Windows</code> folder of the user<a id="_idIndexMarker556"/> account. You will find information concerning <strong class="keyWord">user access control</strong> (<strong class="keyWord">UAC</strong>) configuration and information about the <strong class="keyWord">graphical user interface</strong> (<strong class="keyWord">GUI</strong>) display for the user<a id="_idIndexMarker557"/> experience.</p>
    <p class="normal">The hive<a id="_idIndexMarker558"/> comprises subkeys that contain the <strong class="keyWord">Value</strong>, <strong class="keyWord">Type</strong>, and specific <strong class="keyWord">Data</strong> or settings being<a id="_idIndexMarker559"/> saved. This will give<a id="_idIndexMarker560"/> us a frame of reference as we explore the artifacts contained within the registry.</p>
    <p class="normal">As you can see in the following screenshot, it is difficult to decipher the meanings of the subkeys and values and what they represent:</p>
    <figure class="mediaobject"><img src="img/B18329_06_01.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.1: Registry Editor showing the USBSTOR registry key</p>
    <p class="normal">As we go through<a id="_idIndexMarker561"/> the artifacts, I will show you the view you will see with the Registry Viewer and the easier-to-read parsed version created by the forensic tools.</p>
    <p class="normal">We will use some open-source tools during this chapter:</p>
    <ul>
      <li class="bulletList">RegRipper (available for download from <a href="https://github.com/keydet89/RegRipper3.0">https://github.com/keydet89/RegRipper3.0</a>), created by Harlan Carvey.</li>
      <li class="bulletList">Eric Zimmerman (whose work is available for download from <a href="https://ericzimmerman.github.io/#!index.md">https://ericzimmerman.github.io/#!index.md</a>) has created<a id="_idIndexMarker562"/> several open-source utilities to parse Windows artifacts.</li>
    </ul>
    <p class="normal">There are several categories<a id="_idIndexMarker563"/> in which we look for artifacts. I like to use the SANS catalog descriptions of the artifacts, which can be found at <a href="https://digital-forensics.sans.org/community/posters">https://digital-forensics.sans.org/community/posters</a> and are listed as follows:</p>
    <ul>
      <li class="bulletList">Account usage</li>
      <li class="bulletList">File knowledge</li>
      <li class="bulletList">Physical location</li>
      <li class="bulletList">Program execution</li>
      <li class="bulletList">USB/drive usage</li>
      <li class="bulletList">Browser usage (which we will discuss in <em class="chapterRef">Chapter 9</em>, <em class="italic">Internet Artifacts</em>)</li>
    </ul>
    <p class="normal">With this understanding<a id="_idIndexMarker564"/> of the user profile, we will now discuss the artifacts that determine what actions are associated with the user accounts.</p>
    <h1 id="_idParaDest-122" class="heading-1">Determining account usage</h1>
    <p class="normal">Identifying the user behind the keyboard<a id="_idIndexMarker565"/> is one of the hardest things you must<a id="_idIndexMarker566"/> do when conducting a digital forensic examination. You will have to parse through many artifacts to help make that determination. First, you will want to gather as much information about the user account in question and see whether you can relate it to the physical person. You will want to gain as much information about that user account and its activity related to the matter you are investigating. We will now go over some artifacts from a Windows-based operating system that will help you determine and identify that account activity starting with the user’s last login or password change.</p>
    <h2 id="_idParaDest-123" class="heading-2">Last login/last password change</h2>
    <p class="normal">The following path will contain information<a id="_idIndexMarker567"/> about the user accounts on the system:</p>
    <pre class="programlisting con"><code class="hljs-con">C:\windows\system32\config\SAM\Domains\Account\Users
</code></pre>
    <p class="normal">To navigate to the location that contains the user account information, I will use Eric Zimmerman’s Registry Explorer. I have exported the registry hive files from the forensic image to run Registry Explorer and RegRipper.</p>
    <p class="normal">In the following screenshot, we can see that I have already opened the folder path and the subkeys, and within the <strong class="keyWord">Users</strong> subkey, there are folders with hexadecimal names and a folder entitled <code class="inlineCode">Names</code>. Within the <code class="inlineCode">Names</code> subkey, you see a listing of the accounts on the machine:</p>
    <figure class="mediaobject"><img src="img/B18329_06_02.png" alt="Graphical user interface, text, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.2: Registry Explorer showing the USERS key and subkeys</p>
    <p class="normal">It lists the names in English, so they are easily<a id="_idIndexMarker568"/> readable. Out of the six accounts being shown, one has been deleted (<code class="inlineCode">defaultuser0</code>), and one has the username of <code class="inlineCode">jcloudy</code>. The value for the <code class="inlineCode">jcloudy</code> subkey will point to the subkeys with the hexadecimal values. Here, <code class="inlineCode">jcloudy</code> points to <code class="inlineCode">x3E9</code>.</p>
    <p class="normal">In subkey <code class="inlineCode">x3E9</code>, as shown in the following screenshot, I see that I have an <strong class="screenText">F</strong> and a <strong class="screenText">V</strong> value and below that, I can see information pertaining to the user’s passwords:</p>
    <figure class="mediaobject"><img src="img/B18329_06_03.png" alt="Graphical user interface, text, application, email  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.3: Registry subkey X3E9</p>
    <p class="normal">To make it easier, we can run RegRipper and see whether we can get an easier-to-read output. An example of the output for the <code class="inlineCode">jcloudy</code> account is as follows:</p>
    <figure class="mediaobject"><img src="img/B18329_06_04.png" alt="Text  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.4: RegRipper output for the jcloudy account</p>
    <p class="normal">RegRipper parses the data<a id="_idIndexMarker569"/> and presents it in an easy-to-read format. And we can see when the account was created, the password hint, the last time the user logged in, and the number of times the user has logged in to the system.</p>
    <p class="normal">As you look at the username <code class="inlineCode">jcloudy</code>, you can see the numerals <code class="inlineCode">1001</code>, and below that, an entry marked <code class="inlineCode">SID</code>.</p>
    <p class="normal"><strong class="keyWord">SID</strong> is the <strong class="keyWord">security identifier</strong> used by the Windows operating<a id="_idIndexMarker570"/> system to identify objects within. This is how Windows addresses components internally. At the end of the SID is the <strong class="keyWord">relative identifier</strong> (<strong class="keyWord">RID</strong>), which is the last digits after<a id="_idIndexMarker571"/> the SID. For example, if you see <code class="inlineCode">500</code> as the RID, that will identify the administrator account for that system. The guest account would have an RID of <code class="inlineCode">501</code>. In this case, as shown in the following diagram, we see the RID of <code class="inlineCode">1001</code>. This informs me that the <code class="inlineCode">jcloudy</code> account is user-created, and is not an account created by the system through an automated process:</p>
    <figure class="mediaobject"><img src="img/B18329_06_05.png" alt="Diagram  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.5: Breakdown of the SID</p>
    <p class="normal">When doing your exam, the most commonly<a id="_idIndexMarker572"/> looked at portion of the SID is the RID. We can associate the RID with a specific user account. As the user creates accounts on the system, the RID will increase by one digit. For example, we could have a user, <code class="inlineCode">user X</code>, with an RID of <code class="inlineCode">1005</code>, and if I cannot find accounts <code class="inlineCode">1001</code> through <code class="inlineCode">1004</code>, it is possible that someone/something deleted those user accounts.</p>
    <p class="normal">We are going through the registry to find artifacts that support (or do not support) our hypothesis about what occurred. Another source of information to help determine what happened on the system are the event logs.</p>
    <p class="normal">Windows categorizes events into three different classes:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">System</strong>: Information generated<a id="_idIndexMarker573"/> by the Windows operating system</li>
      <li class="bulletList"><strong class="keyWord">Application</strong>: Information generated<a id="_idIndexMarker574"/> by applications on the local machine</li>
      <li class="bulletList"><strong class="keyWord">Security</strong>: Information related<a id="_idIndexMarker575"/> to login attempts</li>
    </ul>
    <p class="normal">In Windows Vista through Windows 10, we can find the event logs at the following path:</p>
    <pre class="programlisting con"><code class="hljs-con">C:\Windows\System32\winevt\logs
</code></pre>
    <p class="normal">A common excuse that users give when they are accused of using the system for criminal or inappropriate reasons<a id="_idIndexMarker576"/> is that someone else had access to their system. <strong class="keyWord">Remote Desktop Protocol</strong> (<strong class="keyWord">RDP</strong>) is a way to access a host from another location. The security log will record any access using the RDP protocol. You will want to look for event ID numbers <strong class="keyWord">4778</strong> and <strong class="keyWord">4779</strong>, which would show you when the service connected/reconnected and when it disconnected.</p>
    <p class="normal">You can also search for the type of logon into the system. For example, when we examine the security log for event ID <strong class="keyWord">4624</strong>, this will tell us the day, time, username, and the means with which the login was successful. As you can see in the following screenshot of <strong class="screenText">Event Viewer</strong>, you can use this application<a id="_idIndexMarker577"/> to review the exported log files. </p>
    <p class="normal">Once you have loaded the selected log file you want to examine, you can filter the results only to show the events that are relevant to your investigation:</p>
    <figure class="mediaobject"><img src="img/B18329_06_06.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.6: Event Viewer displaying event information</p>
    <p class="normal">The type of logon is also significant. Was the user sitting at the keyboard, or did the user log in from a remote site? Event ID <code class="inlineCode">4624</code> will identify the login type used by the user. In the following screenshot, you can see the output of Event Viewer showing when the user logged in and the login type. </p>
    <p class="normal">Here, it shows the user’s login was type 2, which is “interactive”:</p>
    <figure class="mediaobject"><img src="img/B18329_06_07.png" alt="Graphical user interface  Description automatically generated with low confidence"/></figure>
    <p class="packt_figref">Figure 6.7: Event Viewer showing the logon type</p>
    <p class="normal">The following is a list from Microsoft<a id="_idIndexMarker578"/> of the other logon types<a id="_idIndexMarker579"/> you may encounter, together with their descriptions:</p>
    <figure class="mediaobject"><img src="img/B18329_06_08.png" alt="Table  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.8: Microsoft logon types</p>
    <p class="normal">You may also want to establish the attempted login events to determine whether an attacker compromised the account. The following event IDs will help you make that determination:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">4624</code> - Successful logon</li>
      <li class="bulletList"><code class="inlineCode">4625</code> - Unsuccessful logon</li>
      <li class="bulletList"><code class="inlineCode">4634</code> - Logon session terminated</li>
      <li class="bulletList"><code class="inlineCode">4647</code> - Logon session terminated by the user</li>
      <li class="bulletList"><code class="inlineCode">4648</code> - User logon was attempted by a user using different credentials</li>
      <li class="bulletList"><code class="inlineCode">4672</code> - User logon with Admin rights</li>
      <li class="bulletList"><code class="inlineCode">4720</code> - User account created</li>
    </ul>
    <p class="normal">A full list of Microsoft Windows Event IDs<a id="_idIndexMarker580"/> can be found at:</p>
    <p class="normal"><a href="https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/">https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/</a></p>
    <p class="normal">Suppose you see many failed<a id="_idIndexMarker581"/> logins, or a user was granted administrator rights when they usually do not possess superuser rights. In that case, these event ID clues provide you with additional investigative avenues to determine what occurred.</p>
    <p class="normal">Now that we’ve examined the user’s account activity, next we will discuss the artifacts associated with user account file access.</p>
    <h1 id="_idParaDest-124" class="heading-1">Determining file knowledge</h1>
    <p class="normal">Some incidents you investigate<a id="_idIndexMarker582"/> may deal with contraband<a id="_idIndexMarker583"/> images, stolen data, or unlawful access to data. You will have to determine whether the user had knowledge of the file(s) in question, or whether the file(s) existed on the user’s system.</p>
    <p class="normal">We will now talk about some artifacts you can find in the Windows operating system that will help you make that determination.</p>
    <h2 id="_idParaDest-125" class="heading-2">Exploring the thumbcache</h2>
    <p class="normal">A thumbcache is a database<a id="_idIndexMarker584"/> of thumbnail images created when using Windows Explorer<a id="_idIndexMarker585"/> in a thumbnail view. Depending on the size<a id="_idIndexMarker586"/> of the thumbnail, you may have multiple databases with the same image but with different sizes. It depends on the view the user selected while in Windows Explorer. The existence of an image found in the database is not substantial proof that the user knew the image was on the system. The system can add a thumbnail to the cache without the user’s knowledge. The thumbcache can be found in the user’s profile at the following path:</p>
    <pre class="programlisting con"><code class="hljs-con">AppData\Local\Microsoft\Windows\Explorer
</code></pre>
    <p class="normal">Your commercial forensic tools will process the thumbcache with no issues. If you want to use an open-source<a id="_idIndexMarker587"/> utility, you can use Thumbcache Viewer (which can be downloaded at <a href="https://thumbcacheviewer.github.io/">https://thumbcacheviewer.github.io/</a>).</p>
    <p class="normal">The following is an example of the output of Thumbcache Viewer:</p>
    <figure class="mediaobject"><img src="img/B18329_06_09.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.9: Thumbcache Viewer output</p>
    <p class="normal">As you can see, the thumbnail does not have the same filename as the source image. To identify the original file that was used to create the thumbnail, we need to look in the Windows Search Indexing database, <code class="inlineCode">Windows.edb</code>, which can be found at the following path:</p>
    <pre class="programlisting con"><code class="hljs-con">C:\ProgramData\Microsoft\Search\Data\Applications\Windows\Windows.edb
</code></pre>
    <p class="normal">You will need an additional tool to find the information about<a id="_idIndexMarker588"/> the image used to create the thumbnail. You can use <code class="inlineCode">ESEDatabaseView</code> (located at <a href="https://www.nirsoft.net/utils/ese_database_view.html">https://www.nirsoft.net/utils/ese_database_view.html</a>).</p>
    <p class="normal">The thumbnail name is <code class="inlineCode">96 5a be bc cc 2b f2 27</code>, which is made up of hexadecimal characters. We need to reverse the values<a id="_idIndexMarker589"/> to search the database, so we will want<a id="_idIndexMarker590"/> to search for <code class="inlineCode">27 f2 2b cc bc be 5a 96</code>. The information we are looking for is in different locations depending on the operating system.</p>
    <ul>
      <li class="bulletList">On a Windows 7 system, you want to examine the contents of the table <code class="inlineCode">SystemIndex_0A</code>.</li>
      <li class="bulletList">On a Windows 8/10 computer, you want to examine the contents of the table <code class="inlineCode">SystemIndex_PropertyStore</code>.</li>
    </ul>
    <p class="normal">Once we input the hexadecimal values into the filter, it reduces the data to a single row:</p>
    <figure class="mediaobject"><img src="img/B18329_06_10.png" alt="Graphical user interface, text, application, email  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.10: Filtered database results</p>
    <p class="normal">In the following screenshot, we can see that the file came from the desktop of the user <code class="inlineCode">jcloudy</code>. The name of the image is <code class="inlineCode">MyTiredHead.jpg</code>:</p>
    <figure class="mediaobject"><img src="img/B18329_06_11.png" alt="Graphical user interface, text, application, email  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.11: Filename display in the database</p>
    <p class="normal">In the following screenshot, we can verify that this is the correct file when we look in the <code class="inlineCode">System_ThumbnailCacheID</code> field:</p>
    <figure class="mediaobject"><img src="img/B18329_06_12.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.12: Thumbnail name in the database</p>
    <p class="normal">That completes the discussion<a id="_idIndexMarker591"/> on the thumbcache. We will now explore the artifacts created <a id="_idIndexMarker592"/>by the Edge/Internet Explorer/File Explorer browsers.</p>
    <h2 id="_idParaDest-126" class="heading-2">Exploring Microsoft browsers</h2>
    <p class="normal">Microsoft uses the same<a id="_idIndexMarker593"/> method to record a user’s file activity and internet history<a id="_idIndexMarker594"/> with the Internet Explorer/File Explorer/Edge browsers. In addition, it records local and remote file access. Most commercial forensics tools parse these files easily. Depending on the version, the history file will be in the following areas:</p>
    <figure class="mediaobject"><img src="img/B18329_06_13.png" alt="Text  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.13: IE Locations</p>
    <p class="normal">In the following screenshot, you can see that the user is using version 10/11 because of the existence of the <code class="inlineCode">WebCacheV01.dat</code> file:</p>
    <figure class="mediaobject"><img src="img/B18329_06_14.png" alt="Graphical user interface, table  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.14: File Explorer showing the WebCacheV01.dat file</p>
    <p class="normal">The <code class="inlineCode">.dat</code> file is an ESE<a id="_idIndexMarker595"/> database. If you want to use a single-use forensic tool, you can<a id="_idIndexMarker596"/> export the <code class="inlineCode">.dat</code> file out of the forensic image and view it with an<a id="_idIndexMarker597"/> open-source forensic tool such as <code class="inlineCode">ESEDatabaseView</code>.</p>
    <p class="normal">(Located at <a href="https://www.nirsoft.net/utils/ese_database_view.html">https://www.nirsoft.net/utils/ese_database_view.html</a>)</p>
    <p class="normal">You will want to navigate to the <code class="inlineCode">Containers</code> table. The following screenshot is the output from X-Ways Forensics:</p>
    <figure class="mediaobject"><img src="img/B18329_06_15.png" alt="Graphical user interface, text, application, email  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.15: X-Ways display of the contents of the WebCache</p>
    <p class="normal">As you can see, we have a date and timestamp and the file path of the file that was viewed. We have one offline HTML file (the first line), which was located on the user’s desktop. We see the user opened two PDF files, two JPEG files, one HTML file, and one DOCX file.</p>
    <p class="normal">There are additional artifacts<a id="_idIndexMarker598"/> that show that a user account accessed a file, which<a id="_idIndexMarker599"/> we will discuss next.</p>
    <h2 id="_idParaDest-127" class="heading-2">Determining most recently used/recently used</h2>
    <p class="normal">An <strong class="keyWord">MRU</strong> (<strong class="keyWord">Most Recently Used</strong>) is a list of recently used files<a id="_idIndexMarker600"/> stored in the user’s <strong class="keyWord">NTUSER.DAT</strong> hive. When you open<a id="_idIndexMarker601"/> an application and see the history<a id="_idIndexMarker602"/> list of prior files that the application has used, you are looking at an MRU. There are a lot of MRU lists stored within the registry file. We will go over some more common locations.</p>
    <p class="normal"><strong class="keyWord">OpenSavePidlMRU</strong> from the user’s <strong class="keyWord">NTUSER.DAT</strong> file tracks the last 20 files opened/saved<a id="_idIndexMarker603"/> via the Windows Common Dialogue (these are the commonly encountered <strong class="keyWord">Open/Save As</strong> dialog boxes). In the following example, we can see the last 20 files used by the user:</p>
    <figure class="mediaobject"><img src="img/B18329_06_16.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.16: Content of NTUSER.DAT key - OpenSavePidlMRU </p>
    <p class="normal">Another key to look at is:</p>
    <pre class="programlisting con"><code class="hljs-con">NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs
</code></pre>
    <p class="normal">This key contains a list of files executed/opened by the user through the Windows Explorer application. You will<a id="_idIndexMarker604"/> also have subkeys, based on file extensions, listing<a id="_idIndexMarker605"/> those files that were executed/opened. The system will store the entries in chronological order of when the files were executed/opened by the user.</p>
    <p class="normal">When looking at the last entry/modified time of the key, it will correspond to the last entry in the list. This key will keep track of the previous 150 files that were opened/executed. The following is the output of the key (I am only showing the top-level entries for brevity’s sake):</p>
    <figure class="mediaobject"><img src="img/B18329_06_17.png" alt="Graphical user interface, text, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.17: Recent Docs entries</p>
    <p class="normal">This is an example of the file extension subkeys I described earlier, and it shows the recently used CSV files:</p>
    <pre class="programlisting con"><code class="hljs-con">Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs\.csv
</code></pre>
    <figure class="mediaobject"><img src="img/B18329_06_18.png" alt="A picture containing application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.18: Content of NTUSER.DAT key - Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs for CSV files</p>
    <p class="normal">This is an example of the file extension<a id="_idIndexMarker606"/> subkeys I described earlier, and<a id="_idIndexMarker607"/> it shows the recently used DOCX files:</p>
    <pre class="programlisting con"><code class="hljs-con">Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs\.docx
</code></pre>
    <figure class="mediaobject"><img src="img/B18329_06_19.png" alt="Text  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.19: Content of NTUSER.DAT key - Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs\.docx</p>
    <p class="normal">This is an example of the file extension subkeys I described earlier, and it shows the recently used HTML files:</p>
    <pre class="programlisting con"><code class="hljs-con">Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs\.html 
</code></pre>
    <figure class="mediaobject"><img src="img/B18329_06_20.png" alt="Text  Description automatically generated with medium confidence"/></figure>
    <p class="packt_figref">Figure 6.20: Content of NTUSER.DAT key - Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs\.html</p>
    <p class="normal">There is also an additional subkey, <code class="inlineCode">\Folder</code>, that lists<a id="_idIndexMarker608"/> when the user opened folders<a id="_idIndexMarker609"/> on the system, which is shown as follows:</p>
    <pre class="programlisting con"><code class="hljs-con">Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs\Folder 
</code></pre>
    <figure class="mediaobject"><img src="img/B18329_06_21.png" alt="Graphical user interface, text, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.21: Content of NTUSER.DAT key - Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs\Folders</p>
    <p class="normal">Entries of potential interest include OneDrive and CloudLog. If I am looking for evidence of specific files, the subject may store the data in cloud storage. When I see artifacts showing the use of cloud storage, it provides additional locations that I will have to locate and acquire the digital evidence to continue my digital forensic investigation.</p>
    <p class="normal">As you can see, these are great<a id="_idIndexMarker610"/> artifacts to see what files were accessed by the user, but what happens when the user deletes a file? That leads us on to our<a id="_idIndexMarker611"/> next topic, the Recycle Bin.</p>
    <h2 id="_idParaDest-128" class="heading-2">Looking into the Recycle Bin</h2>
    <p class="normal">The <strong class="keyWord">Recycle Bin</strong> is Microsoft’s effort<a id="_idIndexMarker612"/> to protect users from their actions. It provides an intermediary step<a id="_idIndexMarker613"/> for when a user deletes a file. Windows will move the file into a holding area known as the <strong class="keyWord">Recycle Bin</strong>.</p>
    <p class="normal">The <strong class="keyWord">Recycle Bin</strong> is a hidden folder stored in the root directory of every fixed disk on the system. The folder name is <code class="inlineCode">$Recycle.Bin</code>. On an NTFS formatted disk, there will be sub-folders named with the user’s SID. These sub-folders are created whenever a user logs on to the system for the first time:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">$Recycle.Bin</code>
        <ul>
          <li class="bulletList"><code class="inlineCode">S-1-5-21-2734969515-1644526556-1039763013-1001</code></li>
        </ul>
      </li>
    </ul>
    <p class="normal">When a user deletes a file, the original file gets renamed and becomes part of a set of <code class="inlineCode">Recycle.Bin</code> files. The system will rename the original file with <code class="inlineCode">$R</code> and then six random alphanumeric characters for the filename. The file extension will remain the same. The system will create a second file, which will start with <code class="inlineCode">$I</code> and then have the same six alphanumeric characters that the <code class="inlineCode">$R</code> file has. The <code class="inlineCode">$I</code> file will also have the same file extension as the <code class="inlineCode">$R</code> file.</p>
    <p class="normal">The <code class="inlineCode">$I</code> file will track the time of deletion and the path to the original file location:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Size</strong>: 4.9 MB </li>
      <li class="bulletList"><strong class="keyWord">Moved to recycle bin</strong>: <code class="inlineCode">04/05/2018 02:20:17 +0 C:\Users\jcloudy\Desktop\Larry King_ Time to Repeal the 'Poorly Written' Second Amendment_files</code></li>
    </ul>
    <p class="normal">As you can see, we have the size of the original file, when the user deleted it, and the original path that includes the filename.</p>
    <p class="normal">If a user deletes a directory, you will still have the <code class="inlineCode">$R</code> and <code class="inlineCode">$I</code> files for the directory. The <code class="inlineCode">$R</code> file will contain all the subdirectories and all the files with the original names, as shown in the following screenshot:</p>
    <figure class="mediaobject"><img src="img/B18329_06_22.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.22: Deleted directory</p>
    <p class="normal">The user can empty the <strong class="keyWord">Recycle Bin</strong>. When that occurs, the filesystem updates that the clusters<a id="_idIndexMarker614"/> are now available for use. Until the system overwrites the data, you may recover data<a id="_idIndexMarker615"/> from the unallocated clusters. Just be aware that the <code class="inlineCode">$I</code> (on an NTFS volume) will be resident data in the MFT. NTFS is very efficient in reusing the file entries in the MFT, so it’s challenging to recover the information in the <code class="inlineCode">$I</code> file.</p>
    <p class="normal">If the <strong class="keyWord">Recycle Bin</strong> is emptied, other artifacts may be referencing the file(s). That brings us to our next topic, link (LNK) files.</p>
    <h2 id="_idParaDest-129" class="heading-2">Understanding shortcut (LNK) files</h2>
    <p class="normal">A <code class="inlineCode">.lnk</code> file is used<a id="_idIndexMarker616"/> by the Windows operating<a id="_idIndexMarker617"/> system as a shortcut or link to files, applications, or resources. It is a simple, easy-to-use method for users to gain access to frequently used documents or applications. The link file will contain useful information for the digital forensic investigator, including the following:</p>
    <ul>
      <li class="bulletList">File MAC times</li>
      <li class="bulletList">File size</li>
      <li class="bulletList">File path</li>
      <li class="bulletList">Volume details</li>
    </ul>
    <p class="normal">This information will remain even if the destination file has been deleted. The system will create a link file every time the file is double-clicked or when using the <strong class="screenText">File Open</strong> dialog box. These link files will be stored in the <code class="inlineCode">Recent</code> folder located at the following path:</p>
    <pre class="programlisting con"><code class="hljs-con">%Username%\Appdata\Roaming\Microsoft\Windows\
</code></pre>
    <p class="normal">Most commercial forensic tools can analyze<a id="_idIndexMarker618"/> link files. An open-source option is Eric Zimmerman’s LECmd tool (which can be found at <a href="https://ericzimmerman.github.io/">https://ericzimmerman.github.io/</a>).</p>
    <p class="normal">When we analyze the contents of the link file, we can see a large amount of information that could be helpful to the digital forensic investigator:</p>
    <figure class="mediaobject"><img src="img/B18329_06_23.png" alt="Graphical user interface, text, application  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.23: Link File contents</p>
    <p class="normal">We can see that the destination<a id="_idIndexMarker619"/> file is a Microsoft Word document stored on the user’s desktop. When<a id="_idIndexMarker620"/> we look at the field ID list, we can also see the file’s internal metadata (MAC values). This data can be fundamental when trying to tie knowledge of the file to a specific user. We can also see the date/time when the system created the link file. Additional information is the volume type/serial number and hostname, which allow us to tie this link file to the specific location of the destination file. Be aware that this is an option that the user or systems administrator can turn off. Another artifact similar to LNK files is the JumpList.</p>
    <h2 id="_idParaDest-130" class="heading-2">Deciphering JumpLists</h2>
    <p class="normal">JumpLists <a id="_idIndexMarker621"/>were introduced with Windows 7 and are very<a id="_idIndexMarker622"/> similar to the <code class="inlineCode">Recent</code> folder (which we discussed with LNK files). They allow the user to access frequently used/recently used files from the Windows taskbar. Even if the user clears out the <code class="inlineCode">Recent</code> folder, it will not clear out the information stored in the JumpLists.</p>
    <p class="normal"> JumpLists can be found at the following paths:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">%UserProfile%\AppData\Roaming\Microsoft\Windows\Recent\Automaticdesti nations</code></li>
      <li class="bulletList"><code class="inlineCode">%UserProfile%\AppData\Roaming\Microsoft\Windows\Recent\CustomDestinations</code></li>
    </ul>
    <p class="normal">There are<a id="_idIndexMarker623"/> two types<a id="_idIndexMarker624"/> of JumpLists:</p>
    <ul>
      <li class="bulletList">Automatic – system-created. Records information about file usage.</li>
      <li class="bulletList">Custom – application-created. Records task-specific information about the application.</li>
    </ul>
    <p class="normal">In the following screenshot, you can see the <code class="inlineCode">AutomaticDestinations</code> folder, and inside the folder will be files containing the JumpLists:</p>
    <figure class="mediaobject"><img src="img/B18329_06_24.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.24: JumpList display</p>
    <p class="normal">The system names the JumpLists based on their JumpLists IDs. For example, in the preceding screenshot, we see <code class="inlineCode">5d696d521de238c3.automaticDestinations-ms</code>. A search of the JumpLists ID list (which can be found at <a href="https://community.malforensics.com/t/list-of-jump-list-ids/158">https://community.malforensics.com/t/list-of-jump-list-ids/158</a>) shows that this is the JumpLists ID<a id="_idIndexMarker625"/> for the Google Chrome browser.</p>
    <p class="normal">Most commercial forensic tools will parse out the JumpLists. An open-source option is Eric Zimmerman’s <a id="_idIndexMarker626"/>JumpList Explorer.</p>
    <p class="normal">(Located at <a href="https://ericzimmerman.github.io/">https://ericzimmerman.github.io/</a>)</p>
    <p class="normal">The following is the information contained in the file. You can see that the user was using Chrome to view PDF files and offline HTML files. It also contains the date/time the user opened the files:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">7 04/06/2018 03:56:32 +0 C:\Users\jcloudy\Desktop\LeftUsesBoycotts.pdf</code></li>
      <li class="bulletList"><code class="inlineCode">6 04/06/2018 03:55:00 +0 C:\Users\jcloudy\Desktop\AMEN.pdf</code></li>
      <li class="bulletList"><code class="inlineCode">5 04/05/2018 05:51:41 +0 C:\Users\jcloudy\Desktop\UKknifeBan.pdf</code></li>
      <li class="bulletList"><code class="inlineCode">4 04/05/2018 05:48:40 +0 C:\Users\jcloudy\Desktop\SelfDefenseisMurder.pdf</code></li>
      <li class="bulletList"><code class="inlineCode">3 03/30/2018 04:32:25 +0 C:\Users\jcloudy\Desktop\Cubs' Anthony Rizzo Praises Parkland Kids, Says 'It's too Easy to Get a Gun'.html</code></li>
      <li class="bulletList"><code class="inlineCode">2 03/30/2018 04:29:48 +0 C:\Users\jcloudy\Desktop\Larry King_ Time to Repeal the 'Poorly Written' Second Amendment.html</code></li>
      <li class="bulletList"><code class="inlineCode">1 03/27/2018 09:51:18 +0 C:\Users\jcloudy\OneDrive\Getting started with OneDrive.pdf desktop-pm6c56d</code></li>
    </ul>
    <p class="normal">JumpLists are<a id="_idIndexMarker627"/> artifacts for files; the<a id="_idIndexMarker628"/> next artifact will show which folders the user accessed.</p>
    <h2 id="_idParaDest-131" class="heading-2">Opening shellbags</h2>
    <p class="normal">Shellbags are a set of registry<a id="_idIndexMarker629"/> keys that remember the size and location of the folders and libraries that<a id="_idIndexMarker630"/> the user has accessed via the GUI. In addition, you may find artifacts<a id="_idIndexMarker631"/> showing user interaction with network devices, removable media, or encrypted containers.</p>
    <p class="normal">You will find them in a registry hive called <code class="inlineCode">USRCLASS.DAT</code>, located in the users, <code class="inlineCode">AppData\Local\Microsoft\Windows</code> folder.</p>
    <p class="normal">Most commercial forensic tools will parse out the shellbags from the <code class="inlineCode">USRCLASS.DAT</code> file, but the presentation of the artifact will be different. I like to use Eric Zimmerman’s Shellbag Explorer as an open-source alternative.</p>
    <p class="normal">In the following screenshot, you can see the graphical representation of the folders the user accessed via the Windows GUI. This screenshot is taken from Shellbag Explorer:</p>
    <figure class="mediaobject"><img src="img/B18329_06_25.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.25: Shellbag Explorer: a graphical representation of shellbags</p>
    <p class="normal">You cannot determine whether<a id="_idIndexMarker632"/> the user accessed any files from within the folder through<a id="_idIndexMarker633"/> this artifact. What this artifact shows is that the user accessed the folder. As I look at the display, I see that the user was using three cloud storage services. We have seen prior artifacts for Box Sync and Dropbox, but this is the first reference I have seen regarding Google Drive.</p>
    <p class="normal">In the following output from RegRipper, we can see the access date and timestamps and the date/time of the first access:</p>
    <figure class="mediaobject"><img src="img/B18329_06_26.png" alt="Graphical user interface, text, application, email  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.26: RegRipper output Google Drive</p>
    <p class="normal">This artifact is important<a id="_idIndexMarker634"/> if the subject states that they did not know about a file/folder<a id="_idIndexMarker635"/> location. This artifact is created by the user’s actions. The next artifact can also be used to show user knowledge of a file.</p>
    <h2 id="_idParaDest-132" class="heading-2">Understanding prefetch</h2>
    <p class="normal">Prefetch is a feature<a id="_idIndexMarker636"/> Microsoft introduced to enhance the user experience with the Windows<a id="_idIndexMarker637"/> operating system. It allows faster response times by preloading data into the RAM in anticipation of its demand by the user or system. You will find the prefetch files at the following path:</p>
    <pre class="programlisting con"><code class="hljs-con">%WINDOWS%\PREFETCH
</code></pre>
    <p class="normal">The files will have a file extension of <code class="inlineCode">.pf</code>. In addition, the prefetch file will contain information about the executable file associated with it, such as the list of files used by the executable, the number of times the user ran the executable, and the last date/time when the user ran the executable.</p>
    <p class="normal">Most commercial forensic tools will parse out the prefetch files. For an open-source option, you<a id="_idIndexMarker638"/> can use NirSoft’s <strong class="keyWord">WinPrefetchViewtool</strong>.</p>
    <p class="normal">(Located at <a href="https://www.nirsoft.net/utils/win_prefetch_view.html">https://www.nirsoft.net/utils/win_prefetch_view.html</a>)</p>
    <p class="normal">In the following screenshot, we are looking at the output of <code class="inlineCode">WinPrefetchView</code>. You can see the date and timestamp and the process path of the executable (be aware that due to the method with which the system monitors the prefetch files, you may have to subtract 10 seconds from the created/modified times to get an accurate time):</p>
    <figure class="mediaobject"><img src="img/B18329_06_27.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.27: Prefetch files displayed by WinPrefetchView</p>
    <p class="normal">By using these artifacts, you can determine which applications are being used by the user, which may lead to the discovery of hidden partitions, mobile devices, encrypted containers, or cloud storage.</p>
    <p class="normal">As operating systems<a id="_idIndexMarker639"/> change or are updated, the artifacts may move or be removed. You will have to stay<a id="_idIndexMarker640"/> current as changes become known. We will now look at artifacts that help us determine the physical location of the system.</p>
    <h1 id="_idParaDest-133" class="heading-1">Identifying physical locations</h1>
    <p class="normal">Knowing the system’s physical location<a id="_idIndexMarker641"/> may help you prove or disprove the allegations<a id="_idIndexMarker642"/> against the subject you are investigating. For example, there was an investigation into a compromise of the organization’s network. A former employee was the suspect in the attack because of their threats during the termination process. When the suspect was interviewed, he denied being in the area and stated he was out of state. A judge authorized a search warrant for the suspect’s mobile device and laptop computer. When conducting the forensic analysis of the laptop, the examiner found it to have been recently restored to a new version of the operating system. Artifacts in the unallocated space led us to believe the user had wiped the device. (The user overwrote all available sectors with hexadecimal 00 characters.) The suspect had not tampered with the mobile device, and we could analyze the device. We were able to map out the Wi-Fi hotspots the device had accessed in the immediate neighborhood when the suspect was allegedly out of state. When confronted with the digital evidence, the suspect confessed and admitted he forgot about his mobile device and that it was automatically connecting to Wi-Fi hotspots.</p>
    <p class="normal">We will now talk about some<a id="_idIndexMarker643"/> artifacts you can look at in a system to help determine their physical<a id="_idIndexMarker644"/> location at the time of an incident.</p>
    <h2 id="_idParaDest-134" class="heading-2">Determining time zones</h2>
    <p class="normal">Time zone information on the system<a id="_idIndexMarker645"/> allows you to have a starting<a id="_idIndexMarker646"/> point with which to correlate activity that is recorded with the date/time that the incident occurred. All the internal dates and timestamps will be based on the time zone information recorded in the registry. We can find the time zone information within the system hive. We can find the key at the following path:</p>
    <pre class="programlisting con"><code class="hljs-con">SYSTEM\CurrentControlSet\Control\TimeZoneInformation
</code></pre>
    <p class="normal">This will give us the following output, courtesy of RegRipper:</p>
    <figure class="mediaobject"><img src="img/B18329_06_28.png" alt="Text  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.28: RegRipper output - SYSTEM\CurrentControlSet\Control\TimeZoneInformation</p>
    <p class="normal"><code class="inlineCode">Tzres.dll</code> is the time zone resource <code class="inlineCode">DLL</code>. You have the fields of <code class="inlineCode">Bias</code> and <code class="inlineCode">ActiveTimeBias</code>, which show the values of <code class="inlineCode">300</code> and <code class="inlineCode">240</code>, respectively, which is the number of minutes offset from GMT. And then you have the time zone common name, which in this case is <code class="inlineCode">Eastern Standard Time</code>.</p>
    <p class="normal">Time zones are not always<a id="_idIndexMarker647"/> accurate – the user can set the time zone<a id="_idIndexMarker648"/> to the zone of their choice. The next artifact we will examine may help in locating a physical location.</p>
    <h2 id="_idParaDest-135" class="heading-2">Exploring network history</h2>
    <p class="normal">Knowing which networks, be they wired<a id="_idIndexMarker649"/> or wireless, the suspect has connected<a id="_idIndexMarker650"/> to might give you location information about their whereabouts at the time in question. You will find the relevant information in the <code class="inlineCode">Software hive</code> or an XML document managed by the operating system. The Wi-Fi document will be found at the following path:</p>
    <pre class="programlisting con"><code class="hljs-con">C:\ProgramData\Microsoft\Wlansvc\Profiles\Interfaces
</code></pre>
    <p class="normal">This directory contains subfolders (using the GUID naming convention) for each interface. The XML<a id="_idIndexMarker651"/> document will contain the <strong class="keyWord">SSID</strong> (<strong class="keyWord">Service Set Identifier</strong>) of the networks the interface has connected to. The following output is consistent with the information you would find in the XML document:</p>
    <figure class="mediaobject"><img src="img/B18329_06_29.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.29: XML Output of WLAN Profile</p>
    <p class="normal">As you can see, the SSID of the network is <code class="inlineCode">Net 2.4</code> and it is using <code class="inlineCode">WPA2PSK</code> authentication.</p>
    <p class="normal">If you go to the registry location, you will find sub hives that will contain networking information such as the <code class="inlineCode">Profiles</code> subkey, which gives us additional information about the wireless network(s) the subject connected to:</p>
    <pre class="programlisting con"><code class="hljs-con">SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList
</code></pre>
    <p class="normal">The following is the RegRipper output of the <code class="inlineCode">networklist</code> sub hive:</p>
    <figure class="mediaobject"><img src="img/B18329_06_30.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.30: RegRipper output - SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList</p>
    <p class="normal">The registry hive gives us a little<a id="_idIndexMarker652"/> bit more information, including the MAC address<a id="_idIndexMarker653"/> date and timestamp of when the last connection was made. There is also an additional log file we can examine: the WLAN event log.</p>
    <h2 id="_idParaDest-136" class="heading-2">Understanding the WLAN event log</h2>
    <p class="normal">Microsoft Windows also keeps<a id="_idIndexMarker654"/> an event log of wireless connections. The log<a id="_idIndexMarker655"/> can be found at the following path:</p>
    <pre class="programlisting con"><code class="hljs-con">C:\windows\System32\winevt\Logs\Microsoft-Windows-WLAN-AutoConfigOperational.evtx
</code></pre>
    <p class="normal">This log contains SSID information, MAC addresses, and the date and timestamps of the connection. The following event ID numbers may be pertinent to your investigation:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">11000</code> - Wireless network association </li>
      <li class="bulletList"><code class="inlineCode">8001</code> - Connected to a wireless network</li>
      <li class="bulletList"><code class="inlineCode">8002</code> - Failed to connect to wireless network</li>
      <li class="bulletList"><code class="inlineCode">8003</code> - Disconnected from a wireless network</li>
      <li class="bulletList"><code class="inlineCode">6100</code> - Network diagnostics (System log)</li>
    </ul>
    <div><p class="normal"><strong class="keyWord">Note</strong></p>
      <p class="normal">Everything you ever wanted<a id="_idIndexMarker656"/> to know about Microsoft Windows can be found at <a href="https://docs.microsoft.com/en-us/">https://docs.microsoft.com/en-us/</a>.</p>
    </div>
    <p class="normal">The following output is consistent with what you will see in the event log:</p>
    <figure class="mediaobject"><img src="img/B18329_06_31.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.31: Event log for WIFI access</p>
    <p class="normal">This is an <code class="inlineCode">11000</code> event ID, which is the start of a wireless connection. So, based on this specific artifact, you can articulate that a connection was made to the wireless network <code class="inlineCode">Net 2.4</code> on March 27, 2018, at 12:15:58 (GMT) by the computer <code class="inlineCode">SYSTEM</code>.</p>
    <p class="normal">If you know where the wireless<a id="_idIndexMarker657"/> network <code class="inlineCode">Net 2.4</code> is located, you can associate<a id="_idIndexMarker658"/> this computer with that physical location.</p>
    <p class="normal">Next, we will discuss the artifacts that allow us to determine whether the user executed a specific program.</p>
    <h1 id="_idParaDest-137" class="heading-1">Exploring program execution</h1>
    <p class="normal">Program execution artifacts indicate programs<a id="_idIndexMarker659"/> or applications that were run <a id="_idIndexMarker660"/>on the system. The user could cause the execution, or an autostart/run event managed by the system. Some categories overlap with the file knowledge category we discussed earlier in the chapter. I am not going to re-examine those specific artifacts in this section. Just be aware that the artifacts from recent apps, JumpLists, an MRU, and prefetch files will also contain information about program/application activity.</p>
    <h2 id="_idParaDest-138" class="heading-2">Determining UserAssist</h2>
    <p class="normal"><code class="inlineCode">UserAssist</code> is a registry key<a id="_idIndexMarker661"/> in the user’s <code class="inlineCode">NTUSER.DAT</code> file and can be found at the following path:</p>
    <pre class="programlisting con"><code class="hljs-con">NTUSER.DAT\Software\Microsoft\Windows\Currentversion\Explorer\UserAssist
</code></pre>
    <p class="normal">The key tracks the GUI-based applications<a id="_idIndexMarker662"/> that were launched in the system. The system encodes the data in the key with ROT 13 encoding. RegRipper will decode the data automatically. The following represents the output you will see from RegRipper:</p>
    <figure class="mediaobject"><img src="img/B18329_06_32.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.32: Contents of NTUSER.DAT\Software\Microsoft\Windows\Currentversion\Explorer\UserAssist</p>
    <p class="normal">As shown in the preceding output, you can see the date and timestamp of the last execution and the path of the executable. The number in parentheses at the end indicates the number<a id="_idIndexMarker663"/> of times the user/system has activated the executable. Next, we will discuss the Shimcache, which also contains information about executed programs.</p>
    <h2 id="_idParaDest-139" class="heading-2">Exploring the Shimcache</h2>
    <p class="normal">This is the default location<a id="_idIndexMarker664"/> of the Shimcache:</p>
    <pre class="programlisting con"><code class="hljs-con">SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache
</code></pre>
    <p class="normal">The Shimcache<a id="_idIndexMarker665"/> is used to track compatibility issues with executed programs. Some information that is stored in this cache is as follows:</p>
    <ul>
      <li class="bulletList">File path</li>
      <li class="bulletList"><code class="inlineCode">$Standard</code> Information Attribute Modify Time</li>
      <li class="bulletList">The update time of the Shimcache</li>
    </ul>
    <p class="normal">The following represents the output you will see from RegRipper:</p>
    <figure class="mediaobject"><img src="img/B18329_06_33.png" alt="Text, letter  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.33: Shimcache output</p>
    <p class="normal">The artifacts found in the Shimcache<a id="_idIndexMarker666"/> can provide supporting evidence to the other artifacts found throughout the system, that is, the registry, event logs, filesystem, and so on.</p>
    <p class="normal">Sometimes, the user will have programs or files contained within a portable device. The next set of artifacts will deal with the use of USB devices.</p>
    <h1 id="_idParaDest-140" class="heading-1">Understanding USB/attached devices</h1>
    <p class="normal">There are several security risks associated with a USB device. They are small, portable, high-capacity storage devices<a id="_idIndexMarker667"/> that can be used to exfiltrate data from<a id="_idIndexMarker668"/> an organization, or they can be used to deliver malware to an organization to compromise its security protocols. </p>
    <p class="normal">As a digital forensic investigator, you will want to know whether there were any USB devices attached to the host you are examining. We will now talk about some Windows system artifacts that will allow you to identify USB device usage on the host.</p>
    <p class="normal">We will now look at the results for two registry keys. The first key can be found at the following path:</p>
    <pre class="programlisting con"><code class="hljs-con">SYSTEM\CurrentControlSet\Enum\USB
</code></pre>
    <p class="normal">This registry key identifies the USB devices attached to the system, as shown in the following output:</p>
    <figure class="mediaobject"><img src="img/B18329_06_34.png" alt="Text  Description automatically generated with medium confidence"/></figure>
    <p class="packt_figref">Figure 6.34: Content of Registry key - SYSTEM\CurrentControlSet\Enum\USB</p>
    <p class="normal">We can see there were two USB devices<a id="_idIndexMarker669"/> attached to the system at different<a id="_idIndexMarker670"/> times. We have different volume serial numbers and the last write times from when the system accessed the devices. The volume serial number found in the registry is not the physical device serial number.</p>
    <div><p class="normal"><strong class="keyWord">Note</strong></p>
      <p class="normal">Devices that do not have a unique volume serial number will have an <code class="inlineCode">&amp;</code> as the second character of the volume serial number.</p>
    </div>
    <p class="normal">The next registry key you want to look at is the following:</p>
    <pre class="programlisting con"><code class="hljs-con">SYSTEM\CurrentControlSet\Enum\USBSTOR
</code></pre>
    <p class="normal">When we look at the values in <code class="inlineCode">USBSTOR</code>, we get some additional information about the devices, including the commercial name of the device. We also confirm the serial numbers of the devices with these two entries in the <code class="inlineCode">SYSTEM</code> hive:</p>
    <figure class="mediaobject"><img src="img/B18329_06_35.png" alt="Text  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.35: Content of Registry key - SYSTEM\CurrentControlSet\Enum\USBSTOR</p>
    <p class="normal">In the <code class="inlineCode">MountedDevices</code> key in the <code class="inlineCode">SYSTEM</code> hive, which can be found in <code class="inlineCode">SYSTEM\MountedDevices</code>, we can map<a id="_idIndexMarker671"/> the USB device(s) via the serial number<a id="_idIndexMarker672"/> to a drive letter on the system:</p>
    <figure class="mediaobject"><img src="img/B18329_06_36.png" alt="Graphical user interface, text, application, email  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.36: Content of Registry key - SYSTEM\MountedDevices</p>
    <p class="normal">When we analyze the data, we can see that two USB devices (serial numbers <code class="inlineCode">AA010215170355310594</code> and <code class="inlineCode">AA010603160707470215</code>) were connected to the system. One was recognized as the <code class="inlineCode">D:</code> drive and the second device was recognized as the <code class="inlineCode">E:</code> drive.</p>
    <p class="normal">Does the question remain as to which user account was responsible for the USB device usage? To determine the answer to that question, we would have to take the GUID from each of the USB devices and compare them to the user’s <code class="inlineCode">NTUSER.DAT</code> file. The GUIDs we are searching for are <code class="inlineCode">3869c27a-31b8-11e8-9b12-ecf4bb487fed</code> and <code class="inlineCode">5c3108bb-31c0-11e8-9b10-806e6f6e6963</code>.</p>
    <p class="normal">RegRipper will also analyze the <code class="inlineCode">NTUSER.DAT</code> file and give us the information about the devices that were used and associated with the user’s account:</p>
    <figure class="mediaobject"><img src="img/B18329_06_37.png" alt="Graphical user interface, text, application  Description automatically generated"/> </figure>
    <p class="packt_figref">Figure 6.37: Content of Registry key - Software\Microsoft\Windows\CurrentVersion\Explorer\MountPoints2</p>
    <p class="normal">As you can see, we find both GUIDs in the registry entry, which shows when the devices were last mounted. So we can<a id="_idIndexMarker673"/> now say that the user used a specific USB<a id="_idIndexMarker674"/> device on the system while the <code class="inlineCode">jcloudy</code> account was logged in.</p>
    <h1 id="_idParaDest-141" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, we have discussed how to locate artifacts on a Microsoft Windows-based operating system to determine the subject’s culpability in the matter being investigated. You have learned about the different categories of artifacts and what actions of the user/system they represent. Using the knowledge you have gained from this chapter will allow you to quickly determine which accounts were active during the timeframe you are investigating and whether the incident involved a removable storage device. In addition, you have learned about the artifacts to analyze in determining whether a user had knowledge of a specific file or application. Finally, we have used several commercial and open-source forensic tools to access the artifacts. As a result, you now know how to find and analyze digital evidence found on a Microsoft Windows-based operating system.</p>
    <p class="normal">The next chapter will deal with memory forensics.</p>
    <h1 id="_idParaDest-142" class="heading-1">Questions</h1>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Where would you find the registry files?<ol class="alphabeticList" style="list-style-type: lower-alpha;">
          <li class="alphabeticList" value="1"><code class="inlineCode">%SystemRoot%\System32\Config</code></li>
          <li class="alphabeticList"><code class="inlineCode">%SystemRoot%\System32</code></li>
          <li class="alphabeticList"><code class="inlineCode">%SystemRoot%\\Config\System32</code></li>
          <li class="alphabeticList"><code class="inlineCode">%SystemRoot%\System64\Config</code></li>
        </ol>
      </li>
      <li class="numberedList">When examining log files, which event ID identifies a successful logon?<ol class="alphabeticList" style="list-style-type: lower-alpha;">
          <li class="alphabeticList" value="1">4624</li>
          <li class="alphabeticList">4625</li>
          <li class="alphabeticList">4672</li>
          <li class="alphabeticList">4642</li>
        </ol>
      </li>
      <li class="numberedList">A thumbcache is a ______________.<ol class="alphabeticList" style="list-style-type: lower-alpha;">
          <li class="alphabeticList" value="1">Database of toenail images</li>
          <li class="alphabeticList">Database of thumbnail images</li>
          <li class="alphabeticList">Database of deleted thumbnail images</li>
          <li class="alphabeticList">Database of deleted images</li>
        </ol>
      </li>
      <li class="numberedList">The user can use Internet Explorer/Edge to view files.<ol class="alphabeticList" style="list-style-type: lower-alpha;">
          <li class="alphabeticList" value="1">True</li>
          <li class="alphabeticList">False</li>
        </ol>
      </li>
      <li class="numberedList">Which of the following will you find in a link (LNK) file?<ol class="alphabeticList" style="list-style-type: lower-alpha;">
          <li class="alphabeticList" value="1">Volume serial number</li>
          <li class="alphabeticList">Router name</li>
          <li class="alphabeticList">Date of deletion</li>
          <li class="alphabeticList">Volume details</li>
        </ol>
      </li>
      <li class="numberedList">Which of the following Microsoft Windows operating systems uses JumpLists?<ol class="alphabeticList" style="list-style-type: lower-alpha;">
          <li class="alphabeticList" value="1">Windows 98</li>
          <li class="alphabeticList">Windows ME</li>
          <li class="alphabeticList">Windows 7</li>
          <li class="alphabeticList">Windows 2000</li>
        </ol>
      </li>
      <li class="numberedList">In which registry hive would we find artifacts relating to USB devices?<ol class="alphabeticList" style="list-style-type: lower-alpha;">
          <li class="alphabeticList" value="1">NT USER.DAT</li>
          <li class="alphabeticList">SYSTEM</li>
          <li class="alphabeticList">SOFTWARE</li>
          <li class="alphabeticList">SECURITY</li>
        </ol>
      </li>
    </ol>
    <p class="normal">The answers can be found at the rear of the book under <em class="italic">Assessments</em>.</p>
    <h1 id="_idParaDest-143" class="heading-1">Further reading</h1>
    <p class="normal">Refer to the following links for more information on topics covered in this chapter:</p>
    <ul>
      <li class="bulletList">Altheide, C., Carvey, H. A., and Davidson, R. (2011). <em class="italic">Digital Forensics with Open Source Tools</em>. Amsterdam: Elsevier/Syngress (available at <a href="https://www.amazon.com/Digital-Forensics-Open-Source-Tools/dp/1597495867">https://www.amazon.com/Digital-Forensics-Open-Source-Tools/dp/1597495867</a>)</li>
      <li class="bulletList">Carvey, H. A. (2005). <em class="italic">Windows forensics and incident recovery</em>. Boston: Addison-Wesley (available at <a href="https://www.amazon.com/Windows-Forensics-Incident-Recovery-Harlan/dp/0321200985">https://www.amazon.com/Windows-Forensics-Incident-Recovery-Harlan/dp/0321200985</a>)</li>
      <li class="bulletList">Bunting, S. (2012). <em class="italic">EnCase Computer Forensics: The Official EnCE: EnCase Certified Examiner; Study Guide</em>. Indianapolis, IN: Wiley (available at <a href="https://www.amazon.com/EnCase-Computer-Forensics-Official-EnCE/dp/0470901063">https://www.amazon.com/EnCase-Computer-Forensics-Official-EnCE/dp/0470901063</a>)</li>
    </ul>
    <h1 id="_idParaDest-144" class="heading-1">Exercise</h1>
    <h2 id="_idParaDest-145" class="heading-2">Data set</h2>
    <p class="normal"><code class="inlineCode">Chapter 6 Owl Exercise.e01</code></p>
    <h2 id="_idParaDest-146" class="heading-2">Software needed</h2>
    <p class="normal">Autopsy - <a href="https://www.autopsy.com/">https://www.autopsy.com/</a></p>
    <h2 id="_idParaDest-147" class="heading-2">Scenario</h2>
    <p class="normal">In a jurisdiction where owls are illegal to trade and buy, two users are discussing the illegal trade of owls. A computer is taken into evidence belonging to a user who is attempting to purchase owls illegally. It has been requested that you conduct an analysis of the digital evidence. A forensic image has been obtained and is ready for you. You may use Autopsy or any other tool.</p>
    <p class="normal">Some artifacts you may want to look for include:</p>
    <ul>
      <li class="bulletList">Web searches</li>
      <li class="bulletList">Shopping searches</li>
      <li class="bulletList">Chat clients</li>
      <li class="bulletList">Email</li>
      <li class="bulletList">Documents</li>
      <li class="bulletList">Social networks</li>
      <li class="bulletList">OS artifacts</li>
      <li class="bulletList">LNK files</li>
      <li class="bulletList">Recycle Bin</li>
      <li class="bulletList">Shellbag</li>
    </ul>
    <p class="normal">Potential keywords:</p>
    <ul>
      <li class="bulletList">Owl</li>
      <li class="bulletList">Owlet</li>
      <li class="bulletList">Feathers</li>
      <li class="bulletList">Eggs</li>
      <li class="bulletList">Crossbreeding</li>
      <li class="bulletList">Nocturnal</li>
      <li class="bulletList">Nest</li>
      <li class="bulletList">Hoot</li>
      <li class="bulletList">Conservation</li>
      <li class="bulletList">Wingspan</li>
    </ul>
    <h1 id="_idParaDest-148" class="heading-1">Join our community on Discord</h1>
    <p class="normal">Join our community’s Discord space for discussions with the author and other readers:</p>
    <p class="normal"><a href="https://packt.link/CyberSec">https://packt.link/CyberSec</a></p>
    <p class="normal"><img src="img/QR_Code3852467292877112093.png" alt=""/></p>
  </div>
</body></html>