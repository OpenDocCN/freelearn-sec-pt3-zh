- en: Windows Registry Analysis
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following recipes:'
  prefs: []
  type: TYPE_NORMAL
- en: Extracting and viewing Windows Registry files with Magnet AXIOM
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Parsing Registry files with RegRipper
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Recovering deleted Registry artifacts with Registry Explorer
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Registry analysis with FTK Registry Viewer
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Windows Registry is one of the richest sources of digital evidence. You
    can find lots of extremely useful pieces of information during examination of
    the Registry hives and keys. Computer configurations, recently visited webpages
    and opened documents, connected USB devices, and many other artifacts can all
    be acquired through Windows Registry forensic examination.
  prefs: []
  type: TYPE_NORMAL
- en: The Registry has a tree structure. Each tree consists of keys, and each key
    may have one or more subkeys and values.
  prefs: []
  type: TYPE_NORMAL
- en: 'As forensic examiners usually deal with drive images, it''s very important
    to know where these registry files are stored. The first six files are located
    at `C:\Windows\System32\config`. These files are:'
  prefs: []
  type: TYPE_NORMAL
- en: COMPONENTS
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: DEFAULT
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: SAM
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: SECURITY
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: SOFTWARE
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: SYSTEM
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'There are also two files for each user account:'
  prefs: []
  type: TYPE_NORMAL
- en: '`NTUSER.DAT`, located at `C:\Users\%Username%\`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`UsrClass.dat`, located at `C:\Users\%Username%\AppData\Local\Microsoft\Windows`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In this chapter, we will show you how to examine these files with both commercial
    and open source forensic tools, and how to recover deleted keys, sub keys, and
    values.
  prefs: []
  type: TYPE_NORMAL
- en: Extracting and viewing Windows Registry files with Magnet AXIOM
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You have already learnt a bit about how to use Magnet AXIOM in your forensic
    examinations, especially if you need to extract and analyze data from shadow copies.
    But this tool has lots of very useful features, so we will use it in a few more
    recipes. This time you will learn how to use Magnet AXIOM, and especially its
    Registry Explorer component, for Windows Registry forensics.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you are following the recipes in this book one by one, you already have Magnet
    AXIOM - at least a trial version - installed. If not, refer to [*Chapter 5*](cdc042a6-a9ed-423a-96da-96e6d7767d8e.xhtml),
    *Windows Shadow Copies Analysis,* for installation instructions. Once you've installed
    the tool, you are ready to go.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The steps to be followed for Windows Registry analysis using Magnet AXIOM are
    as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s create a new case. Once it has been created and all the fields are filled
    in, go to evidence sources. Click the Load evidence button, and you will see the
    SELECT AN EVIDENCE SOURCE window, like the one in the following figure:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/85ea068c-6e6e-4a71-a934-050a871c0c8b.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.1\. Magnet AXIOM SELECT AN EVIDENCE SOURCE window
  prefs: []
  type: TYPE_NORMAL
- en: This time, let's choose the COMPUTER IMAGE option. Again, you can use one of
    the images you acquired in a previous recipe; both RAW and E01 are supported.
    Looking at the following figure, we can see that our image contains two partitions
    and an unpartitioned space.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/1b00e693-3aac-4f7c-94ca-38c78ae8acb4.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.2\. Magnet AXIOM ADD FILES AND FOLDERS window
  prefs: []
  type: TYPE_NORMAL
- en: 'You can tick only the main partition (Partition 2), or choose all available
    partitions, as we did. Click NEXT and you will be brought to the SELECT SEARCH
    TYPE screen, which you can see in the following figure:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/21df54f3-538d-49b6-ac2a-834ec830911e.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.3\. Magnet AXIOM SELECT SEARCH TYPE window
  prefs: []
  type: TYPE_NORMAL
- en: 'There are four search types in the Magnet AXIOM process:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Full - used to extract data from all locations, including unallocated space,
    shadow copies, and so on.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Quick** - used to extract data from common areas.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Sector level** - this option is very useful for unknown or corrupted file
    systems, or formatted drives.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Custom** - this option enables the examiner to choose locations. For example,
    if you want AXIOM to carve unallocated space only, you can choose only this location.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: For testing purposes, you can choose all locations, but it will take a lot of
    time to process it. Also, you can start from Quick type to gather low-hanging
    fruits. If you don't want to make changes to artifact types, you can go straight
    to the ANALYZE EVIDENCE section. Click the ANALYZE EVIDENCE button, and Magnet
    AXIOM Examine will show up.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once data source processing has finished, go to the drop-down menu on the left,
    like the one you can see in the following figure, and choose the Registry option:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/fb012f23-6b9a-4b97-b91e-9d7b324743aa.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.4\. Magnet AXIOM Examine navigation pane
  prefs: []
  type: TYPE_NORMAL
- en: 'Once you choose this, you can see all available files containing registry hives
    on the navigation pane, as in the following figure:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/f02ea21d-c091-4276-88f7-56ea74350881.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.5\. AXIOM Registry viewer's navigation pane
  prefs: []
  type: TYPE_NORMAL
- en: If you click on the plus sign of a registry file, you can browse its contents,
    and also see the values on the evidence pane of AXIOM Registry viewer.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/70f87636-fe56-4194-bcd5-c5ee9be08efc.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.6\. AXIOM Registry viewer's evidence pane
  prefs: []
  type: TYPE_NORMAL
- en: 'In the preceding figure, you can see the contents of the TimeZoneInformation
    key. This is a very important key, as it helps examiners to detect the right time
    zone. More information about the key you are viewing and its source can be found
    in the DETAILS pane, shown in the following figure:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/fe17f065-44bc-47af-8d50-eaefef19d47b.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.7\. AXIOM Registry viewer's details pane
  prefs: []
  type: TYPE_NORMAL
- en: 'Look at the Evidence source. If you click the blue link, it brings you to the
    registry file''s location and opens it in the file system viewer. Now you can
    export the registry file. To do this, right-click the file and choose **Save file
    / folder to...** as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/bb152ca2-4b05-42f9-8b8f-0ca0ce354f46.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.8\. Exporting a registry file
  prefs: []
  type: TYPE_NORMAL
- en: You can also view the artifacts AXIOM extracted automatically during the processing
    phase. To do this, right-click the registry file and click View related artifacts
    from the context menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once you have exported the file, you can parse it with other tools. Of course,
    Magnet AXIOM is a very powerful forensic tool and it extracts lots of data from
    registry files, but sometimes it's useful to parse them with some other tools,
    for example, **RegRipper.** We will show you how to do this in the next recipe.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Magnet AXIOM collects all available registry files so that a digital forensic
    examiner can analyze them manually, or export them for parsing with other tools.
    Also, AXIOM extracts a lot of forensic artifacts from these files automatically,
    so an examiner can analyze the results in the evidence pane of Magnet AXIOM Examine.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The Magnet AXIOM overview:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://www.magnetforensics.com/magnet-axiom/](https://www.magnetforensics.com/magnet-axiom/)'
  prefs: []
  type: TYPE_NORMAL
- en: Parsing registry files with RegRipper
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: RegRipper is an open source Windows forensic tool developed by the famous forensicator
    Harlan Carvey, the author of the *Windows Forensic Analysis* series. It's written
    in Perl, and has a lot of useful plugins available. Also, digital forensic examiners
    capable of writing in Perl can create their own plugins for their specific needs.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Go to RegRipper's page at Harlan's GitHub, click on the green button (Clone
    or Download), and choose the Download ZIP option. Once the archive is downloaded
    (in our case it is named **RegRipper2.8-master.zip**), unpack it, and you are
    ready to go.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The steps for parsing registry files with RegRipper:'
  prefs: []
  type: TYPE_NORMAL
- en: 'You already know how to export registry files from disk images, at least with
    Magnet AXIOM. So, we are sure you have a file to parse with RegRipper. Start `rr.exe`,
    and you will see a window like the one in the following figure:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/920bc867-7ee6-4024-9761-6a5e5eacc24b.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.9\. RegRipper main window
  prefs: []
  type: TYPE_NORMAL
- en: 'Here, you have three fields to fill in:'
  prefs: []
  type: TYPE_NORMAL
- en: Hive File - Use the Browse button and choose the hive (registry) file you exported
    previously. In our case, it's SYSTEM.
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
- en: Report File - Use the Browse button and choose a file to save the output (it's
    in plain text, so a TXT file will do). In our case, the file is called SYSTEM_output.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Profile - Choose the right profile for parsing from the drop-down menu. We are
    using the SYSTEM file as the source, so our profile of choice is 'system'.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Once you''ve chosen your files and the right profile, you can press the Rip
    It button. As soon as processing is finished, you are ready to analyze the output:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/cd23b0ec-e7ce-4b88-bfc9-69399c662af6.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.10\. RegRipper output
  prefs: []
  type: TYPE_NORMAL
- en: If you scroll down the output file, you will see that there is a lot of important
    information from a forensic point of view, such as connected USB devices, EventLog
    configuration, mounted devices, network connections, and so on. The tools work
    very fast, so this is a good tool set to start with.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: RegRipper uses Perl modules, according to the profile chosen by a forensic examiner,
    to extract data from a hive (registry) file, and save the output to a `TXT` file.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The RegRipper download page:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://github.com/keydet89/RegRipper2.8](https://github.com/keydet89/RegRipper2.8)'
  prefs: []
  type: TYPE_NORMAL
- en: Recovering deleted Registry artifacts with Registry Explorer
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Registry Explorer is another free Windows Registry forensic tool by another
    famous digital forensic examiner: Eric Zimmerman. One of the extremely useful
    features of this tool is its capability to recover deleted records. And it''s
    easier than you might imagine.'
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Go to Eric's GitHub and click on the Registry Explorer download link. In our
    case, it's called **Registry Explorer/RECmd Version 0.8.1.0**. As at the time
    of writing, the most recent version of the tool is 0.8.1.0\. Once **RegistryExplorer_RECmd.zip**
    is downloaded, unpack it and you are ready to go.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The steps to recover deleted registry artifacts using registry explorer are
    as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Start RegistryExplorer.exe, go to Options and make sure the Recover deleted
    keys/values option is enabled, as in the following figure:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/cfade4b0-3e0c-4e85-a051-d0f0945d78b9.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.11\. Registry Explorer Recover deleted keys/values option
  prefs: []
  type: TYPE_NORMAL
- en: Now you are ready to choose a hive file for processing. To do this, go to **File
    - Load offline hive**, or just press **Alt + 1**. That's it.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now you can browse the contents of your hive file, in our case SYSTEM, including
    associated and unassociated deleted records, as you can see in the following figure:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/0f0d9ee0-50f0-4f41-8d4e-fb341fa16e14.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.12\. Associated and unassociated deleted records
  prefs: []
  type: TYPE_NORMAL
- en: The difference between associated and unassociated records is that the first
    group is still associated with keys in the active registry, and the second group
    is not.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Registry Explorer processes the hive file of choice and automatically recovers
    deleted records, both associated and unassociated. Once processing is finished,
    an examiner can browse available data.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Eric Zimmerman''s GitHub:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://ericzimmerman.github.io/](https://ericzimmerman.github.io/)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Introducing Registry Explorer:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://binaryforay.blogspot.ru/2015/02/introducing-registry-explorer.html](https://binaryforay.blogspot.ru/2015/02/introducing-registry-explorer.html)'
  prefs: []
  type: TYPE_NORMAL
- en: Registry analysis with FTK Registry Viewer
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: FTK Registry Viewer ships as part of AccessData's products, or can also be downloaded
    separately. It allows users to view the contents of the registry on a Windows
    machine.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'If you already have FTK, Registry Viewer will be on your system. If you do
    not, you can download FTK Imager at AccessData''s website - it''s free. You will
    need to fill in some personal information, including your name, company name,
    position and email address to gain access to the free download. The following
    figure shows the download page for FTK Imager:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/4b8564cb-d86d-46c1-ae3e-cc38b464ab78.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.13\. Downloading FTK Imager
  prefs: []
  type: TYPE_NORMAL
- en: If you only need to download Registry Viewer, you can do that on the Product
    Downloads page as well.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Once Registry Viewer has been installed, navigate to it on your machine and
    double-click the icon to open the program. Open FTK Imager at the same time.
  prefs: []
  type: TYPE_NORMAL
- en: In Imager, go to File > Obtain Protected Files.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/cbc46f6b-b2d1-4bcb-807a-6893e8e5f014.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.14\. Obtaining protected files
  prefs: []
  type: TYPE_NORMAL
- en: In the small box that pops up, choose a destination folder for your files.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/32f8a8e1-212e-4e59-87da-e3e748811ce3.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.15\. Choosing a destination folder
  prefs: []
  type: TYPE_NORMAL
- en: Note the warning about Imager getting the files from your own system. This is
    fine in an example like this, or as part of a practice case, but if it shows up
    when you're trying to find evidence on a forensic image, you know you've chosen
    the wrong source!
  prefs: []
  type: TYPE_NORMAL
- en: Make sure you choose Password recovery and all registry files from below the
    destination folder bar, otherwise you will only get a stripped-back version of
    the results. Click OK.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'It may take a little while to generate, and for the first few seconds it might
    look like nothing is happening. Remember, patience is a virtue when dealing with
    technology! You can check whether the process has finished by opening the folder
    in the file path you specified earlier, which should now be populated as shown
    in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/4d0c0fa2-2a4b-4fa3-83b4-08da806ee911.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.16\. The populated folder
  prefs: []
  type: TYPE_NORMAL
- en: Click File and then Change folder and Search Options. This will open a dialogue
    box. Click the View tab and enable the option Show hidden files, folders and drives
    under Hidden files and folders.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/79918ff5-09d2-43c0-b336-8bf29d91a606.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.17\. Showing hidden files
  prefs: []
  type: TYPE_NORMAL
- en: Click Apply and then OK.
  prefs: []
  type: TYPE_NORMAL
- en: Now we can look at the data we have collected from the registry using Registry
    Viewer.
  prefs: []
  type: TYPE_NORMAL
- en: To do that, open Registry Viewer and click File > Open, then go to the folder
    in which you saved the registry files and find the one marked `NTUSER.DAT`. Open
    it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The SOFTWARE menu will give you a nice long list of all the pieces of software
    that have been installed on the machine in question:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/023efe12-c6e7-465d-ab97-e7b22dbee2b6.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.18\. Software installed on the machine
  prefs: []
  type: TYPE_NORMAL
- en: You can see which programs have been uninstalled and when the uninstallations
    took place under `NTUSER.DAT\SOFTWARE\Microsoft\UserData\UninstallTimes`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/270e5308-bddb-4d55-8b96-9574087fa442.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.19\. Uninstall times
  prefs: []
  type: TYPE_NORMAL
- en: This can be particularly useful if you suspect that a user has been taking anti-forensic
    measures to try to scupper an investigation.
  prefs: []
  type: TYPE_NORMAL
- en: 'Under `NTUSER.DAT\SOFTWARE\Microsoft\InternetExplorer\TypedURLs`, you can see
    the addresses of any sites a user visited in Internet Explorer:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/07362b15-1576-4979-ae05-9b7290f2cfb9.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6.20\. Sites visited in Internet Explorer
  prefs: []
  type: TYPE_NORMAL
- en: Under `NTUSER.DAT\Software\Microsoft\Internet Explorer\IntelliForms`, you can
    see data from autocomplete forms, such as usernames and passwords.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Registry Viewer collects registry files from a machine or a forensic image,
    allowing manual examination with FTK or Imager.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'AccessData''s Products page:'
  prefs: []
  type: TYPE_NORMAL
- en: '[http://accessdata.com/product-download](http://accessdata.com/product-download)'
  prefs: []
  type: TYPE_NORMAL
- en: 'The AccessData Registry Viewer User Guide:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://ad-pdf.s3.amazonaws.com/RegistryViewer_UG.pdf](https://ad-pdf.s3.amazonaws.com/RegistryViewer_UG.pdf)'
  prefs: []
  type: TYPE_NORMAL
