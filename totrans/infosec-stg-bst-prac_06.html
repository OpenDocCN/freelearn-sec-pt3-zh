<html><head></head><body>
		<div><h1 id="_idParaDest-68"><a id="_idTextAnchor075"/>Chapter 4: Designing and Protecting Network Security</h1>
			<p>In all honesty, the end of the previous chapter and the beginning of this chapter is an illusion. It's definitely the case that we are building on top of the knowledge we gained from the previous chapter, and we're going to lean on that chapter heavily in this one. The reason for this is that because we had covered so much already in the previous chapter, my publishers and I decided it was necessary to create an imaginary boundary that signaled the end of one topic and the beginning of another. I'm going to do my best to not repeat myself, unless the point is worth repeating. </p>
			<p>Now that we've got the "ambiguous and invisible chapter boundary" problem out of the way, I can get into the housekeeping for this chapter. In this chapter, the goal is to learn how we can combine our knowledge of threats, vulnerabilities, and mitigations from the previous chapter, along with our knowledge of risk management and governance, to create secure-by-design network architectures (or at least something that is as close to secure-by-design as possible, while balancing usability). </p>
			<p>We'll talk about securing the various network components with design choices and mitigations to bolster your organization's network security. I also aim to discuss how we might ensure we secure various network components when those components aren't under our control anymore. As we all continue our combined migration to the cloud, like a digital Oregon Trail – no, not the video game – we will venture into new challenges and reduced control. The main difference between the current cloud migration and the Americans heading west in the 1830s is that in the move to the cloud, fewer people will die of dysentery. Well, at least I hope that's the case.</p>
			<p>After that, we're going to look at implementing secure communications between any combination of assets and users, including any combination of cloud and on-premises.</p>
			<p>We will cover the following topics in this chapter:</p>
			<ul>
				<li>Designing secure network architectures</li>
				<li>Strategies for protecting network security</li>
			</ul>
			<p>So, let's get started! </p>
			<h1 id="_idParaDest-69"><a id="_idTextAnchor076"/>Designing secure network architectures</h1>
			<p>If your InfoSec<a id="_idIndexMarker414"/> learning path has been anything like mine, a load of your time has been spent learning about networking. Do <strong class="bold">Chief Information Security Officers</strong> (<strong class="bold">CISOs</strong>) talk about networking very often in the day to day? Well, yes… networking is mentioned in the LinkedIn/evening drinks/corporate "networking" type of way, but they're very rarely talking about <strong class="bold">TCP/IP</strong>. </p>
			<p>Does that suggest that <a id="_idIndexMarker415"/>you shouldn't know about networking? Or that you should forget all that you've learned? Of course not. By knowing about these topics, and understanding the likelihood of a threat exploiting a vulnerability in network devices or protocols, along with the impact of that event, will enable you to make more informed decisions for mitigations, rooted in the principles of risk management. </p>
			<p>In my opinion, it's worth learning a bit of everything in InfoSec, regardless of the path you currently have your sights set on following. Learn about something that is happening in the world of InfoSec at the moment, or something that is going on in your organization. When you start to feel a level of diminishing returns on the time you're putting into it, reassess whether the topic is something you enjoy learning about or something you need to know, or if you can focus on something else for the time being. </p>
			<p>Of course, the concept of network security is much more than just protocols, bits, bytes, and the systems that are associated with data in motion, but let's quickly cover some of the concepts and definitions we must be aware of, and ensure we're on the same page. </p>
			<h2 id="_idParaDest-70"><a id="_idTextAnchor077"/>Internet Protocol suite and the OSI model</h2>
			<p>There are two <a id="_idIndexMarker416"/>major models that I'd like to reference in this chapter to help you conceptualize how users and applications interface with<a id="_idIndexMarker417"/> nodes and network devices, in order to communicate with other nodes and networks, including over the internet. They are <a id="_idIndexMarker418"/>known as the <strong class="bold">Internet Protocol suite</strong> and the <strong class="bold">OSI model</strong>. </p>
			<p>By understanding both, and how they overlap, we can get a better idea of how to categorize, and therefore protect and govern, the various devices in our estate. </p>
			<h3>TCP/IP suite<a id="_idTextAnchor078"/></h3>
			<p>The <strong class="bold">TCP/IP suite</strong> or the <strong class="bold">Internet Protocol suite</strong> is a group of communications protocols and a model that is used on <a id="_idIndexMarker419"/>computer networks and the internet, and its importance to this topic cannot be understated. Development funding for this protocol stack came from <strong class="bold">DARPA</strong>, the <strong class="bold">Defense Advanced Research Projects Agency</strong> in the <em class="italic">United States Department of Defense</em>. This is <a id="_idIndexMarker420"/>a bit of fun trivia, if your idea of "fun trivia" includes questions such as "Which military agency developed the Internet Protocol suite?"</p>
			<p>It's referred to as <strong class="bold">TCP/IP</strong> because of the <strong class="bold">Transmission Control Protocol</strong> and <strong class="bold">Internet Protocol</strong> –  <strong class="bold">TCP</strong> and <strong class="bold">IP</strong>, respectively – both of which are two of the foundational protocols used in the model, and <a id="_idIndexMarker421"/>therefore two of the foundational protocols used on the internet. </p>
			<p>TCP/IP gives us end-to-end communication, from being turned into packets, to being addressed, to being transmitted, routed, and ultimately received. In the TCP/IP model, there are four "layers" that split various protocols into classifications related to their scope: </p>
			<ul>
				<li>Communication methods for data remaining inside a single network segment is done in the <strong class="bold">link layer</strong> or <strong class="bold">network access layer</strong>. </li>
				<li>Communication methods for data that traverses between independent networks is done in the <strong class="bold">internet layer</strong>. </li>
				<li>Communication between hosts is done in the <strong class="bold">transport layer</strong> or <strong class="bold">host-to-host layer</strong>. </li>
				<li>Communication between processes is done in the <strong class="bold">application layer</strong>. </li>
			</ul>
			<p>The TCP/IP Protocol Suite abides by standards that have been set out and maintained by the Internet Engineering Task Force. </p>
			<p>If we wanted to<a id="_idIndexMarker422"/> make a diagram using the Internet Protocol suite layers, showing an application on a host sending data to another host's application over two routers, it could look something like this, where <strong class="bold">Host A</strong> has the communication travel down the TCP/IP data flow layers, and then up and down the link and internet layers of two routers, before traveling all the way back up to the application layer of <strong class="bold">Host B</strong>: </p>
			<div><div><img src="img/Figure_4.01_B16611.jpg" alt="Figure 4.1 – Diagram of a TCP/IP data flow&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.1 – Diagram of a TCP/IP data flow</p>
			<p>Now that we've reviewed the TCP/IP protocol suite, it's definitely worth delving into a different way of looking at the <a id="_idIndexMarker423"/>same concept, in what is known as <em class="italic">the OSI model</em>.</p>
			<h3>OSI model</h3>
			<p>Another model for standardizing <a id="_idIndexMarker424"/>communications in a computing system is the <strong class="bold">Open Systems Interconnection</strong> model, or <strong class="bold">OSI</strong> model. It is a standardization of communications functions, regardless of any internal structure or technology. The OSI model has seven layers, as opposed to TCP/IP's four:</p>
			<ul>
				<li><strong class="bold">Layer 1 – Physical</strong>: Handles <a id="_idIndexMarker425"/>converting digital bits into radio, electrical, or optical signals, with voltage levels, timing, maximum distance, modulation, physical connectors, layouts of pins, and cable specs. </li>
				<li><strong class="bold">Layer 2 – Data Link</strong>: Handles the<a id="_idIndexMarker426"/> connection between two nodes communicating directly with one another. It can correct errors from the physical layer and is able to control the connection status, such as establishing or terminating a connection, along with controlling the flow of data. </li>
				<li><strong class="bold">Layer 3 – Network</strong>: Handles the <a id="_idIndexMarker427"/>connection between two nodes in separate networks, potentially using routing via other nodes. It can also handle larger messages between two local nodes than the data link layer can, by splitting the messages into fragments and delivering those separately. </li>
				<li><strong class="bold">Layer 4 – Transport</strong>: Gives us the ability to transfer messages from two nodes in the form of variable-length <a id="_idIndexMarker428"/>data sequences. It has controls in place for error handling and data flow, and can keep track of messages that succeed and fail, allowing the failed segments to be resent. It is usually agreed that the TCP and UDP protocols sit in Layer 4. </li>
				<li><strong class="bold">Layer 5 – Session</strong>: Creates, maintains, and terminates the connections between local and remote applications from Layer 7. Usually, Layer 5 is implemented in <a id="_idIndexMarker429"/>applications that use <strong class="bold">remote procedure calls</strong>, or <strong class="bold">RPCs</strong>, thus treating <a id="_idIndexMarker430"/>programs that are on another node or network as though they were local applications. It handles requests from Layer 6 before passing them to Layer 4. </li>
				<li><strong class="bold">Layer 6 – Presentation</strong>: Translates <a id="_idIndexMarker431"/>between network and application formats, transforming the data from the previously mentioned layers into a suitable format that is acceptable based on the destination application. For this reason, it's commonly referred to as the <em class="italic">Syntax</em> layer. It can also compress data, and can map the transfer between applications directly, preventing the ability to "pass down the protocol stack" to the previously mentioned layers. </li>
				<li><strong class="bold">Layer 7 – Application</strong>: Handles<a id="_idIndexMarker432"/> communication with the software application that a user also interacts with. It is responsible for showing the user the relevant data that has been transmitted. <p>To help conceptualize what type of data is handled by which layer in the OSI model, I've included the following diagram:</p></li>
			</ul>
			<div><div><img src="img/Figure_4.02_B16611.jpg" alt="Figure 4.2 – Diagram of the OSI model&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.2 – Diagram of the OSI model</p>
			<p>If we were to look at the <a id="_idIndexMarker433"/>OSI model and see how it might interact between applications over the internet in a similar way to how we looked at the Internet Protocol suite, we could make a diagram that looks like this: </p>
			<div><div><img src="img/Figure_4.03_B16611.jpg" alt="Figure 4.3 – Flow for the OSI model&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.3 – Flow for the OSI model</p>
			<p>So, if we<a id="_idIndexMarker434"/> were to compare the two, meaning the Internet Protocol suite and the OSI model, what would we find? Let's get into it! </p>
			<h3>Comparing the Internet Protocol suite and the OSI model</h3>
			<p>When comparing the<a id="_idIndexMarker435"/> two different models, we can see a few things: </p>
			<ul>
				<li>The OSI model separates the<a id="_idIndexMarker436"/> activities in the TCP/IP application layer into the application, the presentation, and (partially) the session layers. </li>
				<li>The host-to-host/transport layer in TCP/IP is handled with the remainder of the session layer, and the transport layer in the OSI model. </li>
				<li>The TCP/IP internet layer is only a part of the OSI's network layer, while the remainder of the network layer, along with the entire data link and physical layers from OSI, fall into TCP/IP's network access layer. </li>
			</ul>
			<p>If we wanted to make a diagram to compare the two models, you might come up with something that looks like this: </p>
			<div><div><img src="img/Figure_4.04_B16611.jpg" alt="Figure 4.4 – OSI versus TCP/IP&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.4 – OSI versus TCP/IP</p>
			<p>Various concepts Internet Protocol suite and components surrounding networks exist that we haven't covered <a id="_idIndexMarker437"/>yet, such as how TCP works, or UDP, or what ports are. Let's dip our toe into that now. </p>
			<h2 id="_idParaDest-71"><a id="_idTextAnchor079"/>Network components and protocols</h2>
			<p><code>HTTP/1.1</code> and <code>HTTP/2</code> application layer protocols for the web. Recently, it was<a id="_idIndexMarker439"/> decided that their successor, <code>HTTP/3</code>, would instead utilize the <em class="italic">QUIC protocol</em>, which has <strong class="bold">UDP</strong> at its heart.</p>
			<p>TCP is known for its three-way handshake, which is used in establishing a connection. Imagine that a client wants to connect to a server that has a passively open port for connections. This is what happens:</p>
			<ol>
				<li>The client sends a message to the server, setting a sequence number and creating an "Active Open" connection, otherwise known as a <strong class="bold">SYN</strong>, <em class="italic">or Synchronize</em>. </li>
				<li>The server responds to the client's <strong class="bold">SYN</strong> message with an acknowledgment, incrementing the <a id="_idIndexMarker440"/>client's sequence number by 1, and setting its own sequence number, otherwise<a id="_idIndexMarker441"/> known as a <strong class="bold">SYN-ACK</strong>. </li>
				<li>The client then<a id="_idIndexMarker442"/> replies to the server, with both the incremented sequence number sent by the server, along with its own sequence number incremented by 1, acknowledging that the<a id="_idIndexMarker443"/> connection has been made. This is known as the <strong class="bold">ACK</strong>, <em class="italic">or Acknowledge</em>. </li>
			</ol>
			<p>Now that you definitely know this, you're ready for a TCP/IP joke:</p>
			<div><div><img src="img/Figure_4.05_B16611.jpg" alt="Figure 4.5 – Elon Musk tells a joke&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.5 – Elon Musk tells a joke</p>
			<p>To terminate a connection on TCP, a <em class="italic">four-way handshake</em> must occur, with each side able to initiate<a id="_idIndexMarker444"/> the termination. For an example, if a client wants to terminate a connection to a server, this is what happens: </p>
			<ol>
				<li value="1">The client sends a <strong class="bold">FIN</strong> packet, which is an indication to gracefully terminate the connection. </li>
				<li>The server responds with an <strong class="bold">ACK</strong> packet. </li>
				<li>The server sends its own <strong class="bold">FIN</strong> packet. </li>
				<li>The client responds with an <strong class="bold">ACK</strong> packet. </li>
				<li>The client stops accepting new connections, waits for a timeout, and then finally closes the connection. </li>
			</ol>
			<p>Linux operating systems handle things a bit differently, sending an <strong class="bold">RST</strong> packet instead of a <strong class="bold">FIN</strong>, which is an immediate termination, rather than gracefully terminating the <strong class="bold">FIN</strong> packet. </p>
			<p>Additionally, <em class="italic">steps 2 </em>and <em class="italic">3</em> can sometimes be combined into a <strong class="bold">FIN &amp; ACK</strong> packet being sent at once. </p>
			<p> The <strong class="bold">User Datagram Protocol</strong> (<strong class="bold">UDP</strong>) is a <a id="_idIndexMarker445"/>member of the Internet Protocol suite, even if it doesn't make an appearance in the name of the protocol the way TCP does. UDP lacks a handshake to confirm a connection, and is used under the assumption that any errors or corrections aren't necessary, which removes any processing requirement from the network interface. Packets<a id="_idIndexMarker446"/> can be received in an order that isn't congruent with the way they were sent and packets can be dropped, and for that reason it is seen as less reliable, but valuable for speed. This means that UDP is faster and more lightweight than TCP, and that it is popular in online games and video chats. </p>
			<p>The<code>.org</code>, <code>.com</code>, <code>.net</code>, <code>.dk</code>, <code>.wtf</code>, and so on. </p>
			<p>Common free DNS resolver services include Cloudflare (<code>1.1.1.1</code> and <code>1.0.0.1</code>), Google (<code>8.8.8.8</code> and <code>8.8.4.4</code>), Quad9 (<code>9.9.9.9</code> and <code>149.112.112.112</code>), and OpenDNS (<code>208.67.222.220</code> and <code>208.67.222.220</code>), among others. These serve to route the requests that are sent to specific domain names to their IP address counterparts. </p>
			<p><code>32</code> bits, with four sets of numbers <a id="_idIndexMarker448"/>between the range of <code>0</code> and <code>255</code> (otherwise known as octets, or <code>8</code> bits); for <a id="_idIndexMarker449"/>example, from <code>0.0.0.0</code> to <code>255.255.255.255</code>, and everything in-between, such as <code>255.0.0.0</code>, <code>0.255.0.0</code>, or <code>108.177.8.63</code>. </p>
			<p>Internal IPv4 "blocks" are also determined: <code>10.0.0.0</code> to <code>10.255.255.255</code> contains 16,777,216 addresses that have been reserved for private networks. The same goes for <code>172.16.0.0</code> to <code>172.31.255.255</code> and everybody's favorite, <code>192.168.0.0</code> to <code>192.168.255.255</code>. </p>
			<p><strong class="bold">IPv6</strong> is a wild idea that hasn't really <a id="_idIndexMarker450"/>taken off. In 2074, when it's actually used, I'm sure there will be an author who is interested in <a id="_idIndexMarker451"/>going into the details of it. Until then, a casual understanding is fine, as long as it's not part of your everyday work. It's similar to IPv4 but has a larger number of possible addresses, and also has some features that help optimize routing. </p>
			<p><strong class="bold">Subnets</strong> or subnetworks are<a id="_idIndexMarker452"/> subdivisions of an IP network. If you split your network into multiple networks, you're subnetting. You can do this by grouping computers that belong to the same network into the same IP address group, thus improving your organization by partitioning a network address space into logical groups. </p>
			<p>For example, you might have a network number for the first two octets, a subnet identifier for the third octet, and a host identifier for the final octet. You assign one subnet the routing prefix of <code>192.168.100.0/24</code> and another the routing prefix of <code>192.168.200.0/24</code>. This defines the first <code>24</code> bits (3 octets) as the network prefix and the final octet as the host address space. There are 256 addresses for each of the subnetworks, thus creating a more organized structure for your network. </p>
			<p>Let's take a look at a visual breakdown of this concept: </p>
			<div><div><img src="img/Figure_4.06_B16611.jpg" alt="Figure 4.6 – Subnets visualized&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.6 – Subnets visualized</p>
			<p>In large organizations, or<a id="_idIndexMarker453"/> various other scenarios, 256 addresses might not be enough for a subnet, so I have only used this as a simple example. </p>
			<h3>Network ports</h3>
			<p>Communication <a id="_idIndexMarker454"/>endpoints in <a id="_idIndexMarker455"/>networks are called <strong class="bold">ports</strong>. Operating systems use logical "ports" to identify network service processes. Both TCP and UDP use port numbers to reach the logical endpoint. Some common port numbers that have been assigned by the <strong class="bold">Internet Assigned Numbers Authority</strong> (<strong class="bold">IANA</strong>) that are worth remembering off the top of<a id="_idIndexMarker456"/> your head are as follows: </p>
			<ul>
				<li><strong class="bold">Port 20</strong>: FTP data transfer</li>
				<li><strong class="bold">Port 21</strong>: FTP command-and-control</li>
				<li><strong class="bold">Port 22</strong>: SSH, a secure shell</li>
				<li><strong class="bold">Port 23</strong>: Telnet, a remote login service</li>
				<li><strong class="bold">Port 25</strong>: SMTP, mail routing</li>
				<li><strong class="bold">Port 53</strong>: DNS, which is usually open</li>
				<li><strong class="bold">Port 80</strong>: HTTP, used for pages without TLS/SSL/HTTPS</li>
				<li><strong class="bold">Port 110</strong>: POP3, for mail clients</li>
				<li><strong class="bold">Port 123</strong>: NTP, for network time</li>
				<li><strong class="bold">Port 143</strong>: IMAP, for mail</li>
				<li><strong class="bold">Port 161</strong>: SNMP, for device management on networks</li>
				<li><strong class="bold">Port 443</strong>: HTTPS, for HTTP traffic with TLS/SSL/HTTPS</li>
			</ul>
			<p>This isn't to say that these port <a id="_idIndexMarker457"/>numbers are always associated with that type of protocol traffic, though. The thing is, you could have internal HTTP traffic on <code>8080</code>, <code>8081</code>, or <code>3000</code> (or pretty much any other port), depending on the web app framework you're using. It's important to note that the ports are always associated with a host IP address and the type of protocol it's using. If you wanted to reach a page on an internal Vue.JS web app that is being presented from a server with an IP address of <code>192.168.1.25</code> on port <code>8080</code>, you could navigate to it through your browser via <code>192.168.1.25:8080</code>, and it would open the web app's home page for you from that port, instead of via port <code>80</code> or <code>443</code>, which are the defaults for the browser. </p>
			<p>What I'm getting at is that these are common port number designations, but they're not rules. </p>
			<p>The fact that it is possible to remotely access devices through protocols such as SSH is a risk that may need to be mitigated by your organization. The reason you might want to do this is because there are automated tools that are constantly trying to log into any public-facing IP address, and then trying to SSH on port <code>22</code>. In the name of time, they will generally try port <code>22</code>, and then move on to another low-hanging fruit if it doesn't work. </p>
			<p>In order to obfuscate the most common automated attacks on port <code>22</code>, you might decide to change your default port for SSH on your servers from <code>22</code> to a different port, for example. That way, if an automated tool is attempting to SSH into one of your servers, it has to figure out which port SSH is on. That being said, that's not enough to protect against SSH attacks, and it's definitely <em class="italic">security-through-obscurity</em> rather than a true mitigation, but it's the first step that can be taken for a <em class="italic">defense-in-depth</em> approach. </p>
			<p>One more thing to note about network ports is that you can have multiple services on one server. You can SSH into the server, but also access a web page and handle emails, DNS, SMTP, and so on. </p>
			<p>Next, we'll look at the<a id="_idIndexMarker458"/> various hardware devices and applications we can use for networking.</p>
			<h2 id="_idParaDest-72"><a id="_idTextAnchor080"/>Network devices and applications</h2>
			<p>Networks have a<a id="_idIndexMarker459"/> wealth of various hardware and application-based peripherals, and it's worth looking into a few of the security-related ones here, to ensure we're on the same page. This will also help preface the <a id="_idIndexMarker460"/>next section, where we will be dealing with common attacks and tactics for defense and detection. </p>
			<h3>Network switches </h3>
			<p>A <strong class="bold">network switch</strong> is a piece of hardware<a id="_idIndexMarker461"/> that sits in-between your devices, through Ethernet connections typically, and forwards traffic to the appropriate device. It operates on <em class="italic">Layer 2 of the OSI model</em>, and <a id="_idIndexMarker462"/>uses the device's <em class="italic">MAC address</em> to forward data to the device. If the switch also has routing functionality, it could also operate on <em class="italic">Layer 3 of the OSI model</em>. These switches are usually called <em class="italic">Layer 3 switches</em>. </p>
			<p>A key takeaway about switches is that they only send data to the appropriate address, rather than to every address connected to it, the way hubs do. </p>
			<h3>Routers</h3>
			<p>Thankfully, since <a id="_idIndexMarker463"/>we've already learned about ports, IP addresses, layers, and so on, we can quickly discuss how the internet works. Routers are<a id="_idIndexMarker464"/> devices that forward data between networks. In order words, routers direct internet traffic. Routers communicate with one another by forwarding data packets from their network to another network. Here, the network's router receives the packet, reads the destination node address, and by using its routing table, either forwards it to another network or to the destination node that sits in its own network. Enterprise routers connect businesses to the core routers, optical fiber, and undersea cables. These <a id="_idIndexMarker465"/>are known as <strong class="bold">the internet backbone</strong>:</p>
			<div><div><img src="img/Figure_4.07_B16611.jpg" alt="Figure 4.7 – Undersea cables and data centers, also known as &quot;the internet backbone&quot;&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.7 – Undersea cables and data centers, also known as "the internet backbone"</p>
			<p>Isn't it funny that the<a id="_idIndexMarker466"/> internet's core infrastructure is cables lying at the bottom of oceans? As payments, electricity, and supply chains become more reliant on the internet, wouldn't you agree that it's crucial to ensure we <a id="_idIndexMarker467"/>reduce the risk of any <strong class="bold">Single Point of Failures (SPFs)</strong>? What are some of the vulnerabilities of this current setup? </p>
			<h3>Load balancers</h3>
			<p>A service that can delegate<a id="_idIndexMarker468"/> processing over an array of servers is known as a <strong class="bold">load balancer</strong>. This service helps improve efficiency and <a id="_idIndexMarker469"/>prevents you from over-utilizing one server, while underutilizing another that performs the same task. It helps to improve stability and increases speed. </p>
			<h3>Proxies</h3>
			<p><strong class="bold">Proxies</strong> are server<a id="_idIndexMarker470"/> applications or hardware that help the client make requests to the server rather than letting the client make requests directly to the server, and then pass back the response. Proxy server processing can include<a id="_idIndexMarker471"/> load balancing services or security processes that simplify the request and make it fit for the server to handle, or perform error handling to get the proxied information response. </p>
			<h3>Firewalls</h3>
			<p>Another system that controls<a id="_idIndexMarker472"/> network traffic, this time based on security rules, is called a <strong class="bold">firewall</strong>. This includes both ingress and egress traffic, and protects<a id="_idIndexMarker473"/> your trusted network from sending and receiving traffic to ones you may not want to trust… such as the internet.  </p>
			<p>There are software firewalls, hardware appliance firewalls, and virtual appliance firewalls. Software (or host-based) firewalls are installed on the endpoint as a service or agent to control traffic and network resources. </p>
			<p>Here's a classic diagram of a firewall, visualized as a brick wall: </p>
			<div><div><img src="img/Figure_4.08_B16611.jpg" alt="Figure 4.8 – Classic firewall diagram&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.8 – Classic firewall diagram</p>
			<p>Having shown that, I'd also like to go into how firewalls work, from type to type, and how they go about allowing traffic in, not like a brick wall, but more like a bouncer at that nightclub you were never allowed into. </p>
			<h4>Packet filter firewalls</h4>
			<p>Firewalls that act as proxies and inspect the data that is transmitted between endpoints are called <strong class="bold">packet filter firewalls</strong>. They refer to an access control list that determines the packets that are<a id="_idIndexMarker474"/> inspected, and what should be done to each. A few examples of the actions that can be taken could be to discard, forward, or send a <em class="italic">TCP RST</em> response to the sender and close the connection. You might think of these actions as firewall<a id="_idIndexMarker475"/> rules, which can filtered by source and destination IP addresses or ports, or by protocol. </p>
			<p>Consider the benefits of this: you're able to control which protocols communicate on which ports to which devices. That's a brilliant step in the right direction for your information security posture. Your existing list of assets can include information that will allow you to fully understand what communication is required, and what communication isn't required. This is powerful because often, a "flat network" increases your exposure to ransomware, network traversal, and privilege escalation. Imagine that you have created a rule in your firewall that blocks all communications between subnets, except port <code>3306</code> (which is <em class="italic">MySQL</em>) from <code>192.168.100.25</code> (which we can imagine is an application server address) to <code>192.168.200.50</code> (which we can assume is the MySQL server). </p>
			<p>Now, if a command is attempted from a different application, deleting all the data in the SQL database isn't effective because that command has been filtered by the firewall.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">You should definitely also consider authentication, authorization, and preventing such actions that are out of the ordinary. This is a form of defense-in-depth. </p>
			<p>The <em class="italic">Deny-All, and then Whitelist approved traffic</em> technique is highly effective at preventing worms from spreading in your network, as well as lateral movement. However, in my experience, it is difficult to implement in organizations with complex networks that have components and applications communicating between devices that aren't recorded. Blocking that traffic could lead to an outage and cost the organization money, so some <a id="_idIndexMarker476"/>serious preparation is needed to fully understand what <em class="italic">stateful firewalls</em> are doing<a id="_idIndexMarker477"/> at any given time. </p>
			<h4>Connection tracking firewalls</h4>
			<p><strong class="bold">Connection tracking firewalls</strong>, or <em class="italic">stateful firewalls</em> (or <em class="italic">second-generation firewalls</em>) are similar to first-generation proxy/packet filter firewalls, but they retain information about communication between endpoints by keeping the IP addresses and port numbers <a id="_idIndexMarker478"/>from Layer 4. This allows for an overall better understanding of how the nodes are interacting. Instead of inspecting each packet, it utilizes the data it has <a id="_idIndexMarker479"/>from the context of previously <a id="_idIndexMarker480"/>open connections. As a result, they have a performance advantage over the packet filtering firewalls as the bouncer is allowing the regulars straight into the bar, while asking the people he doesn't know for ID. </p>
			<p>Another advantage of stateful firewalls is that they protect against port scanning by only opening ports when they are required by specific incoming packets. </p>
			<p>Unfortunately, with this power comes the ability to trick the firewall into thinking you're a trusted party by, for example, having some JavaScript on a website request information from the malicious actor's endpoint. </p>
			<h4>Application firewalls</h4>
			<p><strong class="bold">Application firewalls</strong> (or, <strong class="bold">Layer 7 Firewalls</strong>) can control system calls to a service or app on a system, according to a policy that has been configured. It's called a <em class="italic">Layer 7 Firewall</em> because it is<a id="_idIndexMarker481"/> able to control all the way up the OSI model to Layer 7, which is the<a id="_idIndexMarker482"/> application layer. They can be either host-based or network-based, and <a id="_idIndexMarker483"/>are able to protect against unwanted applications that are using a port that isn't the standard IANA designation. </p>
			<p>A <strong class="bold">next-generation firewall</strong> performs deep-packet inspection <a id="_idIndexMarker484"/>at the application layer in order to enable <strong class="bold">intrusion prevention system</strong> (<strong class="bold">IPS</strong>) functionality, <em class="italic">sandboxing</em>, <em class="italic">user identity management</em>, <em class="italic">web filtering</em>, and <em class="italic">web application firewall</em> tooling. </p>
			<h4>Web application firewalls</h4>
			<p><strong class="bold">Web application firewalls</strong> can protect <a id="_idIndexMarker485"/>your web apps from malicious users. The web app firewall handles HTTP traffic as a reverse proxy before it reaches the server, inspects<a id="_idIndexMarker486"/> the traffic, and uses policies to filter activity. This activity could include common web app exploitation techniques often used by malicious actors, such as CSRF, XSS, and SQL injection attacks, and enabling <em class="italic">rate limiting</em> helps prevent DoS and DDoS attacks from being effective. </p>
			<h4>Endpoint firewalls</h4>
			<p><strong class="bold">Endpoint firewalls</strong> are application firewalls that<a id="_idIndexMarker487"/> protect against unauthorized connections. They will generally scan a process ID for the data packet and compare that against<a id="_idIndexMarker488"/> a built-in set of rules. They exist at the application layer, but filter connections between Layer 7 and the layers below. They might also<a id="_idIndexMarker489"/> be known as <em class="italic">socket filters</em> since they filter connections via socket calls on the host. </p>
			<h4>The importance of firewall configuration</h4>
			<p>As I mentioned <a id="_idIndexMarker490"/>earlier in this chapter, misconfiguring a firewall can cause serious issues in an organization, and getting it right is a highly important task. Understanding the way traffic moves in your networks, as well as designing a way in which it <em class="italic">should</em> move, is an imperative step in ensuring proper mitigation against risks in your organization. </p>
			<p>Tools are available to help inspect existing traffic and help you better understand exactly what the traffic might be used for. These tools are often also used by malicious actors once they're inside your network, as they are highly effective when used properly. </p>
			<h3>Sniffing tools</h3>
			<p>Tools available for inspecting network traffic, in order to better understand the nature of the<a id="_idIndexMarker491"/> communication, are <a id="_idIndexMarker492"/>considered <strong class="bold">packet sniffers</strong> or <strong class="bold">packet capture</strong> tools. A very well-known <a id="_idIndexMarker493"/>and highly utilized example of these tools would be <strong class="bold">Wireshark</strong>, a network protocol analyzer that can be used to understand networking issues or detect intrusions but can also be used to spy on network users, collect sensitive<a id="_idIndexMarker494"/> information, and exploit your network. Other examples include <strong class="bold">tcpdump</strong>, which runs<a id="_idIndexMarker495"/> on the command line, and <strong class="bold">Ettercap</strong>, a security tool that poisons the ARP table on the target <a id="_idIndexMarker496"/>machines, acting as a <strong class="bold">Man-in-the-Middle</strong>. We will discuss these terms and how to protect against these threats later in this chapter. </p>
			<h3>Network Intrusion Detection and Prevention</h3>
			<p><strong class="bold">Intrusion Detection Systems</strong> (<strong class="bold">IDS</strong>) are either software <a id="_idIndexMarker497"/>suites or devices that monitor a network for policy violations. <strong class="bold">Network Intrusion Detection Systems</strong> (<strong class="bold">NIDS</strong>) monitor network traffic, while <strong class="bold">Host-based Intrusion Detection Systems</strong> (<strong class="bold">HIDS</strong>) monitor operating<a id="_idIndexMarker498"/> system activity. </p>
			<p>Sometimes, these tools <a id="_idIndexMarker499"/>will utilize reputation-based algorithms to detect known malicious sources and destinations, or even machine learning models, to flexibly correlate based on a large dataset. </p>
			<p>A <strong class="bold">Security Information and Events Monitoring</strong> (<strong class="bold">SIEM</strong>) system would be collecting all of the events in your network<a id="_idIndexMarker500"/> from these IDSs and IPSs, and combining all of the metrics in order to correlate activities and determine if these are actually malicious or false alarms. </p>
			<p><strong class="bold">Intrusion Prevention Systems</strong> (<strong class="bold">IPS</strong>) are devices that respond<a id="_idIndexMarker501"/> to detected threats and prevent the actor from performing the attempted action, either by reconfiguring the firewall rules or by modifying the content of the request to prevent exploitation. </p>
			<h3>VPNs and their uses</h3>
			<p><strong class="bold">Virtual </strong>create a virtual boundary to allow users in a public network to create, read, update, and delete data in the same way they would be able to if they were in a<a id="_idIndexMarker502"/> private network. Imagine a tunnel from a user's home to a corporate office. If the user sends a request through<a id="_idIndexMarker503"/> the tunnel, the response comes back through the tunnel. Generally speaking, that communication is protected from any sniffing via encryption. </p>
			<p>VPNs are commonly used by businesses to allow distributed teams to work in a shared environment, but other uses have appeared. For example, if a government prevents their citizen's internet connections from being able to access Facebook IP addresses, a user could, alternatively, send a request through a VPN connection to a PC in another country, which isn't owned by Facebook, which then requests and passes on the information from the Facebook servers to the end user. </p>
			<h3>Content delivery networks</h3>
			<p><strong class="bold">Content delivery networks</strong> (<strong class="bold">CDNs</strong>), are designed to provide low-latency, high-availability access to your servers' data by geographically distributing various proxy servers around the world. If you have a user in Australia, for example, they'll reach out to their nearest server<a id="_idIndexMarker504"/> in Sydney, which both holds a cache for much of the content on your host server and performs a request to your server for the content it doesn't have. </p>
			<p>Most of the web traffic that <a id="_idIndexMarker505"/>you request daily is actually served by a CDN cache, with the latest (locally unseen) content being the only thing served from the source host. Oftentimes, CDN providers supplement their service with security tools for protecting against web application exploitation tactics and denial of service attacks. </p>
			<p>On that note, let's look into methods for attacking systems and how we, as information security professionals, may defend against those attacks. </p>
			<h2 id="_idParaDest-73"><a id="_idTextAnchor081"/>Attacks, defense, and detection</h2>
			<p>So, if you put your hacker hoodie on and seriously think about it, you might be able to dream up a couple ways to exploit these systems. How would you go about doing that? When we're looking at methods malicious actors may use to compromise the security of your organization's assets, there are new techniques being utilized continually, but most of the classic techniques still work. I'm going to use this section to go over a few of the most common attack techniques and their mitigations. </p>
			<h3>Man-in-the-Middle attacks</h3>
			<p><strong class="bold">Man-In-The-Middle</strong> (<strong class="bold">MITM</strong>) attacks are where the malicious actor secretly sits "in the middle" of your communications, passing<a id="_idIndexMarker506"/> information on after potentially reading or altering the message. If the malicious actor in the middle is reading the messages, it's also known <a id="_idIndexMarker507"/>as <em class="italic">eavesdropping.</em></p>
			<h3>MITM defense and detection</h3>
			<p>When looking at mitigating against MITM attacks, we need to look at cryptography. Cryptography can offer authentication, proving mathematically that the source of the message was<a id="_idIndexMarker508"/> legitimate, as well as proof of integrity, which can mathematically prove that the message hasn't been altered. </p>
			<p>In order for this to work, you'll need a way to exchange keys or certificates, for example, a public key infrastructure, as we see in TLS traffic. If it can't be proven that the identity of the source or destination is valid, the session is ended, and communication stops. The weakness in this solution is that security is lost in the event that the Certificate Authority, which issues the cryptographic certificates, is compromised. </p>
			<p>If you are capturing and analyzing your organization's network traffic, you would be able to gather information about each server your network interacts with, such as the source IP address, DNS name, X.509 certificate, Certificate Authority, and whether other clients have the same certificate. </p>
			<h3>DNS hijacking</h3>
			<p><strong class="bold">DNS hijacking</strong> is the act of performing DNS<a id="_idIndexMarker509"/> resolution with a <strong class="bold">rogue DNS server</strong>. If you, as the attacker, can get a computer, a server, or a router to perform a DNS lookup to a DNS server that has<a id="_idIndexMarker510"/> been poisoned or is under your control, rather than one of the authentic public ones we've mentioned previously, we can make it believe they're interacting with the legitimate service. Sometimes, this is called <strong class="bold">pharming</strong>, but the term <a id="_idIndexMarker511"/>didn't really catch on the<a id="_idIndexMarker512"/> way <strong class="bold">phishing</strong> did. </p>
			<h4>DNS hijacking defense</h4>
			<p>Using the previously mentioned<a id="_idIndexMarker513"/> DNS servers, such as those from Cloudflare, Google, and OpenDNS, with <code>53</code>, unencrypted, so it's not end-to-end encrypted, and since TLS may not implement the entire route properly, it doesn't guarantee privacy. </p>
			<p>Additionally, webmasters <a id="_idIndexMarker516"/>can create certain entries for their website's <strong class="bold">DNS records</strong>, which protect against hijacking on their domain, but that's not a very scalable approach and relies on the providers being proactive. </p>
			<h3>ARP spoofing</h3>
			<p>With <strong class="bold">ARP spoofing</strong>, a mapping between a <strong class="bold">MAC address</strong> and an <strong class="bold">IP address</strong> in the <strong class="bold">ARP table</strong> is changed, but the table continues to act as a validator and as a facilitator for connecting a source to a destination. <strong class="bold">ARP spoofing</strong> is either done to perform a <em class="italic">DoS</em> attack by directing all traffic requested from several IPs to one device MAC address, or a <em class="italic">MITM</em> attack, such as modifying traffic, stealing session IDs, and more. </p>
			<p>Sometimes, ARP<a id="_idIndexMarker517"/> spoofing is done for redundancy purposes, to ensure that when a server goes down, another is able to step in. Another legitimate use case for this technique is being able to debug and analyze traffic between two hosts while using a switch, as switch traffic is not transparent/replicated across all the endpoints on the network. </p>
			<p>Imagine that a user is monitoring <strong class="bold">Host C</strong>. If they want to watch traffic go from <strong class="bold">Host A</strong> to <strong class="bold">Host B</strong>, they can set <strong class="bold">A's</strong> ARP to consider <strong class="bold">B's</strong> MAC address as <strong class="bold">C's</strong> actual MAC, and then set <strong class="bold">B</strong> to consider <strong class="bold">A's</strong> MAC address as <strong class="bold">C's</strong> actual MAC, and allow for <strong class="bold">C</strong> to forward the packets. At this point, they have a MITM situation. </p>
			<p>This is really hard to imagine through my description, I concede. Here's a diagram that should help you out: </p>
			<div><div><img src="img/Figure_4.09_B16611.jpg" alt="Figure 4.9 – A diagram of an ARP spoof&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.9 – A diagram of an ARP spoof</p>
			<p>As you can see, tricking <a id="_idIndexMarker518"/>computers to believe one device is another one is a pretty simple way to eavesdrop and requires adequate protection. </p>
			<h4>ARP spoofing defense</h4>
			<p>You can set up your ARP cache for critical servers and endpoints so that they're <em class="italic">static</em> and <em class="italic">read-only</em>, which means they don't allow updates to be made. This is extremely simple, but adds to the <a id="_idIndexMarker519"/>overhead for IT. It's also very difficult to scale because each machine must be mapped accordingly, meaning you're looking at <em class="italic">n^2-n</em> ARP entries, where <em class="italic">n</em> is the number of endpoints on the network. If you have 1,000 endpoints, you have 999,000 ARP entries. </p>
			<p>Alternatively, you could use a software solution that provides a certification for ARP responses and can be built into the DHCP server to ensure all IP addresses, either static or dynamic, are handled properly. Alternatively, you can just send a notification to an admin in the event that an ARP entry changes, but that's not really a preventative control. </p>
			<p>You can also configure <a id="_idIndexMarker520"/>your hosts operating systems so that they gracefully handle unsolicited changes to the ARP cache. </p>
			<h3>DNS spoofing</h3>
			<p><strong class="bold">DNS spoofing/DNS cache poisoning</strong> is similar to an <strong class="bold">ARP spoofing attack</strong>, and is where a trusted source of information is poisoned with malicious data. With <strong class="bold">DNS spoofing</strong>, the victim is requesting a<a id="_idIndexMarker521"/> response from what looks like a <a id="_idIndexMarker522"/>legitimate source (which they always take for granted) in their <a id="_idIndexMarker523"/>network's DNS cache. In reality, the DNS server's cache data has been poisoned by the malicious actor and the request is being sent to a separate destination, instead of the legitimate service. These types of attacks fall under the <strong class="bold">spoofing</strong> category. </p>
			<h4>DNS spoofing defense</h4>
			<p>In order to <a id="_idIndexMarker524"/>avoid <em class="italic">DNS spoofing attacks</em>, you need to reconsider your organization's trust. You want to authenticate, you want to verify, and you want to make it as streamlined as possible. Cryptography protocols such as TLS/HTTPS and SSH help with preventing this activity by verifying the source, and source port randomization reduces the likelihood of a DNS spoof attempt via a race condition flaw being successful. </p>
			<p>Additionally, DNSSEC or secure DNS is a method of using cryptographically signed certificates to prove the authenticity of DNS data. All of the original top-level domains (and many country-code TLDs) support DNSSEC.  </p>
			<h3>Sniffing</h3>
			<p><strong class="bold">Sniffing attacks</strong>, as we discussed in the <em class="italic">Sniffing tools</em> section of this chapter, is when network traffic is captured<a id="_idIndexMarker525"/> by utilizing a sniffer such as <em class="italic">Wireshark</em> or <em class="italic">Ettercap</em>. Wireshark is a commonly used tool in IT, with <a id="_idIndexMarker526"/>excellent features for diagnosing connectivity or web application issues. However, when a malicious actor utilizes a sniffer (providing the traffic is unencrypted), network traffic can easily be read, which could lead to credentials being captured and network exploitation. </p>
			<h4>Sniffing defense and detection</h4>
			<p>Typically, when <a id="_idIndexMarker527"/>we're looking at sniffing attacks or network monitoring, the mitigation is centered around utilizing the appropriate protocols that are protected with encryption. Rather than use HTTP, use HTTP over TLS. Rather than use FTP, use SFTP. Instead of Telnet, use SSH. </p>
			<p>If you're forced to use the old/insecure protocols, you could potentially route them over a VPN and wrap them in an encrypted tunnel. </p>
			<p>Additionally, to prevent malicious actors from being able to utilize these tools on your network, you may want to set up a prevention/notification for any time a known network monitor is installed or executed on a system. Furthermore, utilizing switches instead of hubs can prevent traffic from being sprayed all over your network, and mitigate against a non-admin user device becoming compromised. </p>
			<h3>DoS attacks</h3>
			<p>Have we covered these? I'm even starting to lose track here! A <strong class="bold">DoS</strong> attack is a way to <a id="_idIndexMarker528"/>overwhelm a system or network by creating more requests than it can process. It's achieved either through a flood of traffic, or though very clever timeout attacks. </p>
			<p>Think back to what we learned about the three-way TCP connection handshake and how that works, while using Elon's joke:  </p>
			<pre>You: "Hi, I'd like a beer." (SYN)
Barman: "You would like a beer?" (SYN-ACK)
You: "Yes, I would like a beer." (ACK)</pre>
			<p>So, after your initial <code>SYN</code>, what would happen if you never confirmed the server's <code>SYN-ACK</code> response with an <code>ACK</code>, but instead you opened another connection with the first SYN request again? And again, and again, and again? Well, the server waits for a response for a set amount of time before closing the connection, and eventually, you would make the server fill up their potential connections. This<a id="_idIndexMarker529"/> is called a <strong class="bold">SYN flood</strong>, or a <strong class="bold">half-open attack</strong>. </p>
			<p>There are DoS attacks for the application<a id="_idIndexMarker530"/> layer, along with DoS attacks for the network, but generally, a DoS attack is successful when it causes a system that is serving legitimate users to stop doing so. </p>
			<p>You might be <a id="_idIndexMarker531"/>targeted by a DoS attack for political purposes, chaotic reasons, blackmail, revenge, hacktivism, or because a group thinks it's funny, also known as <em class="italic">"for the lulz"</em>. </p>
			<h4>DDoS attacks</h4>
			<p><strong class="bold">Distributed Denial-of-Service (DDoS)</strong> attacks are DoS attacks that come from various sources, making it very difficult to understand which traffic is legitimate and which traffic is part of the botnet. </p>
			<p>The number of nodes that constitute a DDoS rather than a DoS isn't as important as whether you are able to discern between the nodes that are legitimate users, and those that are contributing to the malicious traffic taking your network or systems down. </p>
			<p>Previously, GitHub has been subject to a 1.35 terabit-per-second DDoS attack, which was achieved through <em class="italic">amplification</em> by "bouncing" traffic from a separate service (memcache, running on multiple servers in this instance) to the GitHub destination, creating up to 51,000 packets per source request. In order to get to 1.35 terabits-per-second, you're looking at around 130 million packets per second. </p>
			<h4>DoS defense</h4>
			<p>When we're looking<a id="_idIndexMarker532"/> at a DoS, we're generally looking at a single source of requests, so we could potentially do some of the following:</p>
			<ul>
				<li>Filter traffic from unwanted sources, such as those trying to DoS your systems.</li>
				<li>Increase the number of requests your servers can put into their backlog instead of handling them in real time. </li>
				<li>Reducing the timeout duration, for which your server waits for the final ACK response. </li>
				<li>If the server isn't able to handle many more requests before becoming overwhelmed, you can configure it to recycle the oldest request that hasn't been<a id="_idIndexMarker533"/> confirmed. </li>
				<li>You can increase the cache. </li>
				<li>You can utilize firewalls. </li>
			</ul>
			<h4>DDoS defense and detection</h4>
			<p>Similarly, when <a id="_idIndexMarker534"/>defending against a DoS, you want to prevent illicit DDoS traffic from reaching your server to begin with. In my previous example, the memcache DDoS at GitHub could be blocked by simply blocking port <code>11211</code> on an <code>11211</code> is the memcache source port, making for<a id="_idIndexMarker535"/> a simple mitigation. </p>
			<p>However, how can your system discern legitimate traffic from illegitimate traffic when it's distributed, and not based on a pattern or from a port that can easily be blocked? </p>
			<p>You want a system that can detect, classify, and respond to traffic requests that are seen as illegitimate, either through hardware or software solutions. For example, an application frontend hardware solution can be used along with routers and switches to analyze data packets and handle the traffic based on insights. This could include updating the ACL or rate limiting certain sources. Your IPS/IDS are also able to provide valuable insight into your network traffic, in order to identify real and illegitimate traffic and react with firewall rules in a reactive way. </p>
			<p>Web application firewalls can identify legitimate traffic to your web app based on insights and intelligence from the vendors' other customers, and how often the request has been seen previously as a malicious source, not completing requests. </p>
			<p>Something you would like to avoid is your cloud service, with elastic load balancing, from being vulnerable to a massive surge of traffic, thus leading to your wallet being heavily impacted by the upcoming cloud service provider bill. This is also known as a <strong class="bold">Denial-of-Wallet</strong> attack. There are<a id="_idIndexMarker536"/> various solutions for this that are generally offered by the cloud service providers themselves, and they can be part of your defense in depth strategy. It could be worth having a discussion with them, or reading their documentation on the topic. </p>
			<p>Furthermore, there are DDoS protection providers, such as Cloudflare and Imperva, that provide CDN and threat<a id="_idIndexMarker537"/> intelligence solutions to help your organization withstand increased levels of traffic. </p>
			<h3>Typosquatting</h3>
			<p><code>www.arifrance.com</code> (note the misspelling of "air").</p>
			<h4>Typosquatting defense</h4>
			<p>Unfortunately, there <a id="_idIndexMarker539"/>are a limited number of defenses against typosquatting. You can preemptively purchase similar domains to your business in order to reduce the likelihood that a malicious actor can buy one, which is tricky enough to fool your user base. You can also file a case with the <strong class="bold">World Intellectual Property Organization</strong> (<strong class="bold">WIPO</strong>), to complain that your registered domain name is confusingly similar to the malicious actors' registered <a id="_idIndexMarker540"/>domain, and that the malicious actor has no legitimate interest in that domain. It's not ideal, but that's the situation. </p>
			<h1 id="_idParaDest-74"><a id="_idTextAnchor082"/>Strategies for protecting network security</h1>
			<p>Now that we <a id="_idIndexMarker541"/>have gone through the TCP/IP suite and OSI model, network components <a id="_idIndexMarker542"/>and protocols, network devices and applications, some of the attacks, and how to defend against and detect those attacks, I would like to discuss some strategies you can use to actually protect your network and prevent malicious actors from having a field day in your estate. </p>
			<h2 id="_idParaDest-75"><a id="_idTextAnchor083"/>Creating a policy</h2>
			<p>What we will want to do, in<a id="_idIndexMarker543"/> terms of a best practice, is define our strategy as a network security policy. This is a document that describes the rules that your organization will need to abide by in the realm of how the organization's environment is designed, maintained, protected, revised, and deprovisioned. </p>
			<p>This document doesn't need to be complex, but can be as detailed as required to ensure the organization's network is effectively protected. How passwords or email attachments are handled in-transit can be included in this policy, or preferred encryption methods for various communications, if that's important to mitigating the risks inherent to your organization. Most importantly, you should highlight the change control process for your organization's network. If a change needs to be made, those responsible will need to abide by this policy. </p>
			<p>In order to draft this policy, you will need a few things: </p>
			<ul>
				<li>Top management buy-in. There's no way you're going to successfully change the actions of individuals in your organization, and control their access to services online, without the blessing from top management. If you don't have this, handling any pushback will be impossible.</li>
				<li>Understanding your organization's requirements from a regulatory and compliance perspective, in order to effectively avoid compliance risks. </li>
				<li>Understanding your organization's network, information, and services. Without this, how can you create an effective and relevant policy? </li>
				<li>Understanding your users and their access requirements in their daily work. Yet again, you need this document to reflect your reality; otherwise, it's just a sheet of paper with nonsense written on it. </li>
			</ul>
			<p>You will want to keep this document up to date, and update it any time any of the following occur:</p>
			<ul>
				<li>Technological changes </li>
				<li>Changes to regulatory requirements </li>
				<li>Changes to terminology </li>
				<li>Changes to your asset impact </li>
				<li>Changes to the threat landscape </li>
			</ul>
			<p>Once these processes <a id="_idIndexMarker544"/>and policies have been established, you can execute your plan for implementing the appropriate controls to protect your organization. </p>
			<h2 id="_idParaDest-76"><a id="_idTextAnchor084"/>Keep it simple</h2>
			<p>You don't want undue complexity in your network, and you don't want to make the security complex either. You might <a id="_idIndexMarker545"/>have a hybrid environment, where your on-premises and cloud assets are communicating with each other, or a network where the scope is unimaginable to our human brains… this is all absolutely fine, as long as you keep it as simple as possible. </p>
			<p>What you need is visibility into your assets, clarity in your architecture and design, and a fantastic understanding of your organization's activities. You need an idea of what the core function of each asset is, and (for example) how new firewall rules may affect each asset. This should be documented, and optimizations should be continually designed, planned, implemented, and tested. </p>
			<h2 id="_idParaDest-77"><a id="_idTextAnchor085"/>Business continuity and disaster recovery</h2>
			<p>As we've previously discussed, it's highly<a id="_idIndexMarker546"/> valuable to have a plan for when things go wrong. Regardless of the level of risk your organization faces, I'm willing to bet that it's important that you are able to restore business operations quickly and effectively in the event of a disruption. Disruption<a id="_idIndexMarker547"/> can often happen at the network level, so having the appropriate <strong class="bold">Business Continuity Plan</strong> (<strong class="bold">BCP</strong>) and <strong class="bold">Disaster Recovery Plan</strong> (<strong class="bold">DRP</strong>) in place that takes this into consideration is paramount to your <a id="_idIndexMarker548"/>organization's success. </p>
			<h2 id="_idParaDest-78"><a id="_idTextAnchor086"/>Backup and restore procedures</h2>
			<p>We've mentioned this one<a id="_idIndexMarker549"/> before as well, but it's highly important for keeping your network alive: you need to have a plan and procedure for backing up, testing, and recovering the systems that perform your critical business functions, while focusing on risk mitigation and improving recovery times. </p>
			<h2 id="_idParaDest-79"><a id="_idTextAnchor087"/>Insider threat mitigations/third-party threats</h2>
			<p>An insider threat has access<a id="_idIndexMarker550"/> to your network assets and can escalate their privileges more easily than an external threat can. In order to mitigate against these threats, either from intentional or accidental sources, we should consider employing methods from the Zero Trust approach. </p>
			<h3>Zero Trust </h3>
			<p>You can't expect that just because<a id="_idIndexMarker551"/> you have a firewall, a segregated network, and mitigations against sniffing, spoofing, or DNS hijacking that your network is safe and secure from threats that have gained access to (or naturally have access to) your internal estate. </p>
			<p>If internal users always have elevated privileges, regardless of context, a compromised account in the wrong hands is going to cause major issues. As a result, we could move to a <em class="italic">least privilege</em> model, where we only allow<a id="_idIndexMarker552"/> a user, device, or account to access what it needs in order to complete the task specified. Unfortunately, that still doesn't fully mitigate against a compromised admin account. </p>
			<p>What we'd be more interested in is a <strong class="bold">Zero Trust</strong> model, granting privilege based on context, such as the requester's identity, device, and location, along with least privilege access, and just-in-time access to mitigate the harm that can be done. Any request for elevated privileges can be accompanied with <em class="italic">Two-Factor Authentication (2FA)</em>, abiding by the "<em class="italic">Never trust, always verify</em>" mantra. </p>
			<p>Additionally, we will want to recognize and report suspicious behavior and act on it automatically to reduce the impact of a compromise. </p>
			<p>Rather than the classic "<em class="italic">castle-and-moat</em>" style network perimeter, where anybody inside the network is considered to be a trusted user, a major concentration point here is that we consider devices, both internal and external to the network perimeter, in the same way: with <em class="italic">Zero Trust</em>. We need proof, not faith. It's an ideology rather than a technology stack, and it can be achieved with some very basic rules. </p>
			<p>Another ideology of Zero Trust networks is to microsegment your estate into several different secure "zones" for specific groups. If a user doesn't need to access certain data, then they don't have access to that zone. It requires an understanding of your organization's data, as well as a technological solution for preventing access. Data loss prevention tools can work together with labels to protect various types of sensitive and confidential information access by the wrong users, utilizing encryption and parsing the data of the file itself to detect known<a id="_idIndexMarker553"/> patterns that may indicate a file contains such information. </p>
			<p>One more catchphrase from the Zero Trust school is to "<em class="italic">assume breach</em>". Essentially, you must assume that your network is compromised. This is how we mitigate against insider threats with Zero Trust: by reducing the ability for a compromised account to perform overarching actions across the entire estate. Utilizing segmentation of user privileges, along with the <strong class="bold">two-man principle</strong>, where you need more than one person's approval to be <a id="_idIndexMarker554"/>able to perform an action, and <strong class="bold">segregation of duties</strong> where a single action isn't completed by a single person from end-to-end, you are able to reduce the likelihood of <a id="_idIndexMarker555"/>a sole actor being able to silently make changes to your network. </p>
			<p>The fantastic thing about this ideology is that it allows for a distributed team, with a less-defined network boundary, which is very relevant in the modern era where organizations are dealing with multi-cloud and on-premises hybrid environments, combined with users who are working from home and using their own devices. </p>
			<h2 id="_idParaDest-80"><a id="_idTextAnchor088"/>Software and firmware updates</h2>
			<p>Patching your systems with security<a id="_idIndexMarker556"/> updates will have an enormous impact on the overall health of your estate, and will bolster your information security. Additionally, up-to-date systems are more agile and better at processing information. Yet, with all of these advantages, most organizations that I've worked with have major issues with their legacy systems; they're outdated, past the manufacturer's <em class="italic">end of life</em>, unable to be renewed due to <a id="_idIndexMarker557"/>incompatible software, or have an unknown level of risk in the event of an update. </p>
			<p>As a result, it's highly important to <a id="_idIndexMarker558"/>define an <strong class="bold">asset life cycle</strong>, including the provisioning, updating, maintenance, and disposal processes. In addition to this, <strong class="bold">vulnerability management</strong> should be considered and defined, with a clear plan for identifying, classifying, remediating, and <a id="_idIndexMarker559"/>mitigating against known vulnerabilities in your estate. This is to ensure that, in 10 years, you don't end up with <em class="italic">legacy servers</em> running the equivalent of Windows XP or Windows Server 2003 today, which is extremely vulnerable to ransomware, highly incompatible, slow, and brittle. More information on how we can handle updates and vulnerabilities can be found in <a href="B16611_07_Final_JM_ePub.xhtml#_idTextAnchor123"><em class="italic">Chapter 7</em></a><em class="italic">, Owning Security Operations</em>. </p>
			<h2 id="_idParaDest-81"><a id="_idTextAnchor089"/>Ensuring secure communication</h2>
			<p>The communication that <a id="_idIndexMarker560"/>occurs to and from your estate and inside your networks is vulnerable to being eavesdropped on and tampered with. Data encryption is a key part of ensuring your network is secure and protecting your organizational assets. <em class="italic">Data at rest</em> can be encrypted, as previously discussed, but encrypting <em class="italic">data in transit</em> should also be a key focus for security professionals looking to mitigate against eavesdropping and tampering threats. </p>
			<p><em class="italic">Encryption</em> is not only able to help protect the data by making it unreadable to unauthorized entities, but it can also confirm the <em class="italic">integrity</em> of the information, and also confirm the <em class="italic">identity</em> of the sender and recipient of a message. </p>
			<p>The downside to this is that you need to trust that the entities managing the keys in the encryption process, such as the Certificate Authority, are secure. Performing <strong class="bold">due diligence</strong> and having a good <strong class="bold">vendor assessment program</strong> in place can help you understand the risk of this happening, and potentially cause you to reconsider the vendor you are currently using, in favor of one with a better security posture. </p>
			<p>Another aspect of secure communication is that communications can occur outside of the realm of your estate. Your <a id="_idIndexMarker561"/>users may communicate with third parties by using a cloud service or text messages on their mobile device, and it's difficult to keep on top of this activity. Proper education in your organization about your policies regarding these practices can reduce the likelihood of an accidental breach. When it comes to malicious actors, you might want to think about a <strong class="bold">Cloud Application Security Broker</strong> (<strong class="bold">CASB</strong>) for your network, which blocks certain actions being performed on cloud web apps. It could, for example, prevent a file <a id="_idIndexMarker562"/>with a certain type of label from being uploaded to <em class="italic">Dropbox</em> or <em class="italic">Twitter</em>. </p>
			<h2 id="_idParaDest-82"><a id="_idTextAnchor090"/>Cloud network security</h2>
			<p>What I am seeing more and more of is the<a id="_idIndexMarker563"/> transition toward the public cloud, which leads to relinquishing responsibility when it comes to the physical (and sometimes architectural) aspects of network security. Does the fact that you've outsourced your network security mean that you're not responsible for it anymore? Who is responsible? </p>
			<p>The answer to that question is always that <em class="italic">top management is ultimately responsible for security</em>. As we've said previously, they have hired you to help them reduce their risk, and part of that undertaking is understanding the level of risk that exists, comparing that risk level against your organization's risk appetite, and mitigating it until the risk is below that line. </p>
			<p>So, outsourcing physical and architectural aspects of network security to a <strong class="bold">cloud service provider</strong>, or <strong class="bold">CSP</strong>, has risks and <a id="_idIndexMarker564"/>opportunities, and it's your responsibility to understand those. </p>
			<p>Often, using due diligence and performing vendor security assessments will help you understand how your suppliers are handling these aspects of security for your outsourced datacenters. In addition to understanding the security controls that the service provider has put into place, you can get a better understanding of the products that the providers offer, such as data encryption, monitoring and logs, access control, key vaults, and so on. </p>
			<p>It's important to understand what falls under your organization's responsibility, rather than the CSP, in the cloud's <strong class="bold">shared responsibilities model</strong>. </p>
			<p>Being able to quickly make changes to your infrastructure in the cloud means that change control processes may not be considered, leading to misconfiguration. It's pivotal to include the cloud in the wider scope of your network security policy's <em class="italic">Change Management</em> section. Changes that can be made very quickly have the potential to bring your network to its knees. Additionally, changes that have been made without oversight could include misconfigurations, leading to easy breaches from malicious actors. </p>
			<p>Along with the change management <a id="_idIndexMarker565"/>policies comes proper testing and implementation of security controls for new or changed infrastructure before it goes live into production. Additionally, a deprovisioning procedure should be included to complete an instance's life cycle. It's important to keep an eye on this and control it, both in terms of policy and automation rules, otherwise your estate will continue to grow with more and more insecure instances, with old instances not being deprovisioned properly, giving easy access to confidential information. </p>
			<h2 id="_idParaDest-83"><a id="_idTextAnchor091"/>Education and awareness</h2>
			<p>You might determine that <a id="_idIndexMarker566"/>educating your organization's users and administrators about how information is handled is necessary for success and risk mitigation. To do so, you can create an information security awareness policy, which will dictate the organization's requirements on this topic. </p>
			<p>The requirements aren't set in stone, so you may want to ensure that all employees that access organization data must complete training courses provided by your organization on how to securely handle such data. </p>
			<p>You might be able to educate users on phishing, and what constitutes <strong class="bold">Personally Identifiable Information </strong>(<strong class="bold">PII</strong>) or <strong class="bold">Protected Health information </strong>(<strong class="bold">PHI</strong>). You might also be able to create security champions, as we've mentioned previously. </p>
			<h2 id="_idParaDest-84"><a id="_idTextAnchor092"/>Security Operations Center</h2>
			<p>Finally, we have a <strong class="bold">Security Operations Center</strong> (<strong class="bold">SOC</strong>), which is a team of security analysts, engineers, and managers that monitor the network for anomalies and issues and react accordingly, in real time. </p>
			<p>Oftentimes, in<a id="_idIndexMarker567"/> order to do this, they must utilize SIEM systems and aggregate signals from all of the network hardware and software they can in order to detect outages <a id="_idIndexMarker568"/>or intrusions. This includes what we've talked about earlier in this chapter (and in the previous one) regarding IDS, IPS, firewalls, CDNs, antivirus, and vulnerability management systems all sending data to the centralized <em class="italic">single-pane-of-glass</em> observation solution. </p>
			<p>Further reading on security monitoring best practices can be found in <a href="B16611_07_Final_JM_ePub.xhtml#_idTextAnchor123"><em class="italic">Chapter 7</em></a><em class="italic">, Owning Security Operations.</em> </p>
			<p>Summary</p>
			<p>What an absolute behemoth of a chapter! Are you okay? Do you need a second? I think I may… </p>
			<p>It's so great to be finished with this chapter, having covered as much as we have. At the start of this chapter, we talked about the Internet Protocol suite and OSI model, before moving on to the various devices and applications we can use to set up a network, such as switches, routers, firewalls, and CDNs. </p>
			<p>After that, we looked at some common network attacks, as well as how to defend against and detect them. After that, we talked about typosquatting, DNS hijacking, and MITM attacks, which helped us think in the way a malicious actor might. </p>
			<p>From there, we looked at the strategies for protecting network security, including making policies, reducing complexity, business continuity, mitigating against insider threats and Zero Trust, updates, and cloud security, among other things. </p>
			<p>Next, we will move on to a topic that I'm sure will float your boat: controlling access and managing identity. Let's get started!</p>
		</div>
	</body></html>