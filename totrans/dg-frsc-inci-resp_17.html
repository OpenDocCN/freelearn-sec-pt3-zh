<html><head></head><body>
<div id="_idContainer391">
<h1 class="chapter-number" id="_idParaDest-296"><a id="_idTextAnchor304"/><span class="koboSpan" id="kobo.1.1">17</span></h1>
<h1 id="_idParaDest-297"><a id="_idTextAnchor305"/><span class="koboSpan" id="kobo.2.1">Leveraging Threat Intelligence</span></h1>
<p><span class="koboSpan" id="kobo.3.1">One area of incident response that has had a significant impact on an organization’s ability to respond to cyberattacks is the use of cyber threat intelligence or, simply, threat intelligence. </span><span class="koboSpan" id="kobo.3.2">The term </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">Cyber Threat Intelligence</span></strong><span class="koboSpan" id="kobo.5.1"> covers a wide range of information, data points, and techniques that allow analysts to identify attack types in their network, adequately respond to them, and prepare for future attacks. </span><span class="koboSpan" id="kobo.5.2">To be able to properly leverage this capability, information security analysts should have a solid foundation in the various terminologies, methodologies, and tools that can be utilized in conjunction with threat intelligence. </span><span class="koboSpan" id="kobo.5.3">If analysts can utilize this data, they will be in a better position to take proactive security measures and, in the event of a security incident, be more efficient in their response. </span></p>
<p><span class="koboSpan" id="kobo.6.1">In this chapter’s discussion of cyber threat intelligence, the following key topics will </span><span class="No-Break"><span class="koboSpan" id="kobo.7.1">be discussed:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.8.1">Threat </span><span class="No-Break"><span class="koboSpan" id="kobo.9.1">intelligence overview</span></span></li>
<li><span class="koboSpan" id="kobo.10.1">Sourcing </span><span class="No-Break"><span class="koboSpan" id="kobo.11.1">threat intelligence</span></span></li>
<li><span class="koboSpan" id="kobo.12.1">The MITRE </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">ATT&amp;CK framework</span></span></li>
<li><span class="koboSpan" id="kobo.14.1">Working </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">with IOCs</span></span></li>
<li><span class="koboSpan" id="kobo.16.1">Threat intelligence and </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">incident response</span></span></li>
</ul>
<h1 id="_idParaDest-298"><a id="_idTextAnchor306"/><span class="koboSpan" id="kobo.18.1">Threat intelligence overview</span></h1>
<p><span class="koboSpan" id="kobo.19.1">Like some</span><a id="_idIndexMarker1512"/><span class="koboSpan" id="kobo.20.1"> terms in information security and incident response, threat intelligence is a bit nebulous. </span><span class="koboSpan" id="kobo.20.2">Various organizations, such as the government and academics, produce information and data that is often touted as threat intelligence. </span><span class="koboSpan" id="kobo.20.3">Various commercial providers also have information available, either through free or paid subscriptions, that is touted as threat intelligence. </span><span class="koboSpan" id="kobo.20.4">This often results in difficulty when determining what threat intelligence is and what, simply, data or </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">information is.</span></span></p>
<p><span class="koboSpan" id="kobo.22.1">A good starting point to determine what comprises threat intelligence is to utilize a definition. </span><span class="koboSpan" id="kobo.22.2">Here is the Gartner research company’s definition of </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">threat intelligence:</span></span></p>
<p class="author-quote"><span class="koboSpan" id="kobo.24.1">“Threat intelligence is evidence-based knowledge, including context, mechanisms, indicators, implications, and actionable advice, about an existing or emerging menace or hazard to assets that can be used to inform decisions regarding the subject’s response to that menace or hazard.”</span></p>
<p><span class="koboSpan" id="kobo.25.1">When </span><a id="_idIndexMarker1513"/><span class="koboSpan" id="kobo.26.1">examining this definition, there are several key elements that need to be present for data or information to be considered </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">threat intelligence:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.28.1">Evidence-based</span></strong><span class="koboSpan" id="kobo.29.1">: This chapter</span><a id="_idIndexMarker1514"/><span class="koboSpan" id="kobo.30.1"> will examine how evidence obtained through other processes, such as malware analysis, produces threat intelligence. </span><span class="koboSpan" id="kobo.30.2">For any intelligence product to be useful, it must first be obtained through proper evidence-collection methods. </span><span class="koboSpan" id="kobo.30.3">In this way, analysts that rely on it can be sure of </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">its validity.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.32.1">Utility</span></strong><span class="koboSpan" id="kobo.33.1">: For threat intelligence to have a positive impact on a security incident’s outcome or an organization’s security posture, it must have some utility. </span><span class="koboSpan" id="kobo.33.2">The intelligence must provide clarity, in terms of context and data, about specific behaviors or methods to determine whether an analyst is evaluating an incident against other incidents of a similar nature. </span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.34.1">Actionable</span></strong><span class="koboSpan" id="kobo.35.1">: The key element that separates data or information from threat intelligence is action. </span><span class="koboSpan" id="kobo.35.2">Intelligence should drive action, whether that is a specific sequence of events or a specific focus area of an incident or whether a specific security control is implemented in the face of intelligence about what cyber threats the organization is most likely </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">to face.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.37.1">To see how this plays together, imagine a scenario where an incident response team at a healthcare institution is attempting to ascertain what types of attacks are most likely to occur against their</span><a id="_idIndexMarker1515"/><span class="koboSpan" id="kobo.38.1"> infrastructure. </span><span class="koboSpan" id="kobo.38.2">Vague data about cybercriminals wanting to steal data is not useful. </span><span class="koboSpan" id="kobo.38.3">There is no specific context or information in that dataset, and the end result is that the organization cannot put that information </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">into action.</span></span></p>
<p><span class="koboSpan" id="kobo.40.1">On the other hand, say that the incident response team leverages a third-party threat intelligence provider and this third party outlines a specific criminal group by name. </span><span class="koboSpan" id="kobo.40.2">The provider also indicates that these groups are currently utilizing PDF files sent via email to hospital employees. </span><span class="koboSpan" id="kobo.40.3">The PDF files contain a remote access Trojan that is controlled from C2 servers, which are spread out in Europe. </span><span class="koboSpan" id="kobo.40.4">The third party also provides the team with MD5 file hashes of malware, the IP and domain addresses of the C2 servers, and, finally, the filenames most associated with the PDF document. </span></p>
<p><span class="koboSpan" id="kobo.41.1">With this information, the incident response team can align their security controls to prevent PDF attachments from opening in emails. </span><span class="koboSpan" id="kobo.41.2">They can also utilize tools to search their infrastructure to determine whether an infection has already occurred. </span><span class="koboSpan" id="kobo.41.3">Finally, they may be able to configure their event management solution in order to alert the team if any host within the network attempts to communicate with the </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">C2 server.</span></span></p>
<p><span class="koboSpan" id="kobo.43.1">The major difference between these two scenarios is that the latter scenario drives actions within the organization. </span><span class="koboSpan" id="kobo.43.2">In the first scenario, the information was so vague and useless that the organization was left no better off. </span><span class="koboSpan" id="kobo.43.3">In the second scenario, the team could execute </span><a id="_idIndexMarker1516"/><span class="koboSpan" id="kobo.44.1">specific actions to either prevent an adverse condition or be better prepared to respond </span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">to one.</span></span></p>
<p><span class="koboSpan" id="kobo.46.1">Threat intelligence is a response to the increased complexity and technical skill of cyber threat actors. </span><span class="koboSpan" id="kobo.46.2">The focus of threat intelligence is on the following threat </span><span class="No-Break"><span class="koboSpan" id="kobo.47.1">actor groups:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.48.1">Cybercriminals</span></strong><span class="koboSpan" id="kobo.49.1">: Organized</span><a id="_idIndexMarker1517"/><span class="koboSpan" id="kobo.50.1"> and technically </span><a id="_idIndexMarker1518"/><span class="koboSpan" id="kobo.51.1">skilled, cybercriminals have been responsible for a variety of financial crimes against banking, retail, and other organizations. </span><span class="koboSpan" id="kobo.51.2">The motive for these groups is purely mercenary, and their goal is to acquire data that can be monetized. </span><span class="koboSpan" id="kobo.51.3">For example, attacks against retailers such as Home Depot and Target involved the theft of credit card data with the intent of selling numbers on the dark web or other </span><span class="No-Break"><span class="koboSpan" id="kobo.52.1">black markets.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.53.1">Hacktivism</span></strong><span class="koboSpan" id="kobo.54.1">: Groups</span><a id="_idIndexMarker1519"/><span class="koboSpan" id="kobo.55.1"> such as </span><strong class="bold"><span class="koboSpan" id="kobo.56.1">Anonymous</span></strong><span class="koboSpan" id="kobo.57.1"> and</span><a id="_idIndexMarker1520"/><span class="koboSpan" id="kobo.58.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.59.1">Idlib Martyrs’ Brigade</span></strong><span class="koboSpan" id="kobo.60.1"> are hacker groups that take on large businesses, governments, and even religious institutions to further a political cause. </span><span class="koboSpan" id="kobo.60.2">Penetrating networks to obtain confidential data for disclosure or conducting denial-of-service attacks is done as part of an overall political versus </span><span class="No-Break"><span class="koboSpan" id="kobo.61.1">monetary objective.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.62.1">Cyber espionage</span></strong><span class="koboSpan" id="kobo.63.1">: Nation-states </span><a id="_idIndexMarker1521"/><span class="koboSpan" id="kobo.64.1">such as the United States, Russia, China, Iran, and North Korea continually engage in espionage activities involving penetrating networks and obtaining intelligence. </span><span class="koboSpan" id="kobo.64.2">One of the most well-known cyberattacks, the Stuxnet virus, was</span><a id="_idIndexMarker1522"/><span class="koboSpan" id="kobo.65.1"> reportedly perpetrated by the United States </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">and Israel.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.67.1">Another key element to understanding threat intelligence is the concept of </span><strong class="bold"><span class="koboSpan" id="kobo.68.1">Advanced Persistent Threat</span></strong><span class="koboSpan" id="kobo.69.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.70.1">APT</span></strong><span class="koboSpan" id="kobo.71.1">). </span><span class="koboSpan" id="kobo.71.2">The</span><a id="_idIndexMarker1523"/><span class="koboSpan" id="kobo.72.1"> term APT has been around for approximately a decade and is used to describe a cyber threat actor whose capability and motivation go far beyond that of a cybercriminal or cyber vandal. </span><span class="koboSpan" id="kobo.72.2">APT groups often target organizations for an intended </span><a id="_idIndexMarker1524"/><span class="koboSpan" id="kobo.73.1">purpose with a clear objective in mind and over a long period of time. </span><span class="koboSpan" id="kobo.73.2">As the term APT describes, these groups have the following characteristics: </span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.74.1">Advanced</span></strong><span class="koboSpan" id="kobo.75.1">: APT threat</span><a id="_idIndexMarker1525"/><span class="koboSpan" id="kobo.76.1"> actors have advanced skills. </span><span class="koboSpan" id="kobo.76.2">These skills often involve intelligence-gathering skills that exceed what can be obtained through open source methods. </span><span class="koboSpan" id="kobo.76.3">This includes sources</span><a id="_idIndexMarker1526"/><span class="koboSpan" id="kobo.77.1"> such as </span><strong class="bold"><span class="koboSpan" id="kobo.78.1">Imagery Intelligence</span></strong><span class="koboSpan" id="kobo.79.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.80.1">IMINT</span></strong><span class="koboSpan" id="kobo.81.1">), which includes pictures</span><a id="_idIndexMarker1527"/><span class="koboSpan" id="kobo.82.1"> available through sites such as Google Earth. </span><strong class="bold"><span class="koboSpan" id="kobo.83.1">Signals Intelligence</span></strong><span class="koboSpan" id="kobo.84.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.85.1">SIGINT</span></strong><span class="koboSpan" id="kobo.86.1">) is intelligence gathered through the compromise of voice and data communications that use telephone infrastructure, cellular data, or radio signals. </span><span class="koboSpan" id="kobo.86.2">Finally, APT groups can</span><a id="_idIndexMarker1528"/><span class="koboSpan" id="kobo.87.1"> leverage </span><strong class="bold"><span class="koboSpan" id="kobo.88.1">Human Intelligence</span></strong><span class="koboSpan" id="kobo.89.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.90.1">HUMINT</span></strong><span class="koboSpan" id="kobo.91.1">) or gather intelligence from interacting with human sources. </span><span class="koboSpan" id="kobo.91.2">Further, these groups can not only utilize advanced network penetration tools, but they are also adept at finding zero-day vulnerabilities and crafting custom malware and exploits that specifically target </span><span class="No-Break"><span class="koboSpan" id="kobo.92.1">these vulnerabilities.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.93.1">Persistent</span></strong><span class="koboSpan" id="kobo.94.1">: APT threat actors are focused on a clearly-defined objective and will often forgo other opportunities to get closer to achieving their objective. </span><span class="koboSpan" id="kobo.94.2">APT threat actors will often go months or even years to achieve an objective through the intelligent leveraging of vulnerabilities and continuing at a pace that allows them to bypass detection mechanisms. </span><span class="koboSpan" id="kobo.94.3">One of the key differentiators between APT threat actors and others is the intention to stay within the target network for a long period of time. </span><span class="koboSpan" id="kobo.94.4">While a cybercriminal group will stay long enough to download a database full of credit card numbers, an APT group will maintain access within a network for as long </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">as possible.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.96.1">Threat</span></strong><span class="koboSpan" id="kobo.97.1">: To organizations that face APT groups, they are most definitely a threat. </span><span class="koboSpan" id="kobo.97.2">APT threat actors conduct their attacks with a specific objective and have the necessary</span><a id="_idIndexMarker1529"/><span class="koboSpan" id="kobo.98.1"> infrastructure and skillset to attack targets such as large corporations, the military, and </span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">government organizations.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.100.1">Threat intelligence is a wide field of study with many elements that are tied together. </span><span class="koboSpan" id="kobo.100.2">In the end, threat intelligence should drive action within an organization. </span><span class="koboSpan" id="kobo.100.3">What that action may be is often </span><a id="_idIndexMarker1530"/><span class="koboSpan" id="kobo.101.1">decided after careful evaluation of the threat intelligence. </span><span class="koboSpan" id="kobo.101.2">This involves understanding the type of threat intelligence being reviewed and what advantage each of those types provides </span><span class="No-Break"><span class="koboSpan" id="kobo.102.1">the organization.</span></span></p>
<h2 id="_idParaDest-299"><a id="_idTextAnchor307"/><span class="koboSpan" id="kobo.103.1">Threat intelligence types</span></h2>
<p><span class="koboSpan" id="kobo.104.1">When discussing </span><a id="_idIndexMarker1531"/><span class="koboSpan" id="kobo.105.1">the wide variety of information types and datasets that constitute threat intelligence, they often fall into one of three main categories: </span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.106.1">Tactical threat intelligence</span></strong><span class="koboSpan" id="kobo.107.1">: This</span><a id="_idIndexMarker1532"/><span class="koboSpan" id="kobo.108.1"> is </span><a id="_idIndexMarker1533"/><span class="koboSpan" id="kobo.109.1">the most granular of the three threat intelligence categories. </span><span class="koboSpan" id="kobo.109.2">Information in this category involves either </span><strong class="bold"><span class="koboSpan" id="kobo.110.1">Indicators of Compromise</span></strong><span class="koboSpan" id="kobo.111.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.112.1">IOCs</span></strong><span class="koboSpan" id="kobo.113.1">), </span><strong class="bold"><span class="koboSpan" id="kobo.114.1">Indicators of Attack</span></strong><span class="koboSpan" id="kobo.115.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.116.1">IOAs</span></strong><span class="koboSpan" id="kobo.117.1">), or </span><strong class="bold"><span class="koboSpan" id="kobo.118.1">Tactics, Techniques, and Procedures</span></strong><span class="koboSpan" id="kobo.119.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.120.1">TTPs</span></strong><span class="koboSpan" id="kobo.121.1">): </span><ul><li><strong class="bold"><span class="koboSpan" id="kobo.122.1">IOCs</span></strong><span class="koboSpan" id="kobo.123.1">: An IOC is </span><a id="_idIndexMarker1534"/><span class="koboSpan" id="kobo.124.1">an artifact observed on a system </span><a id="_idIndexMarker1535"/><span class="koboSpan" id="kobo.125.1">that is indicative of a compromise of some sort. </span><span class="koboSpan" id="kobo.125.2">For example, a C2 IP address or an MD5 hash of a malicious file are both IOCs. </span></li><li><strong class="bold"><span class="koboSpan" id="kobo.126.1">IOAs</span></strong><span class="koboSpan" id="kobo.127.1">: An</span><a id="_idIndexMarker1536"/><span class="koboSpan" id="kobo.128.1"> IOA is</span><a id="_idIndexMarker1537"/><span class="koboSpan" id="kobo.129.1"> an artifact observed on a system that is indicative of an attack or an attempted attack. </span><span class="koboSpan" id="kobo.129.2">This can be differentiated from an IOC, as an IOA does not indicate that a system was compromised but rather attacked due to indicators left by an adversary attacking a system. </span><span class="koboSpan" id="kobo.129.3">An example may be connection attempts left in a firewall log that are indicative of an automated port scan utilizing Nmap or another</span><a id="_idIndexMarker1538"/><span class="koboSpan" id="kobo.130.1"> network </span><a id="_idIndexMarker1539"/><span class="koboSpan" id="kobo.131.1">scanning tool. </span></li><li><strong class="bold"><span class="koboSpan" id="kobo.132.1">TTPs</span></strong><span class="koboSpan" id="kobo.133.1">: Humans </span><a id="_idIndexMarker1540"/><span class="koboSpan" id="kobo.134.1">are creatures of habit and, as a </span><a id="_idIndexMarker1541"/><span class="koboSpan" id="kobo.135.1">result, cyber attackers often develop a unique methodology for how they attack a network. </span><span class="koboSpan" id="kobo.135.2">For example, a cybercriminal group may favor a social engineering email that has an Excel spreadsheet that executes a remote access Trojan. </span><span class="koboSpan" id="kobo.135.3">From there, they may attempt to access the credit card </span><strong class="bold"><span class="koboSpan" id="kobo.136.1">point of sale</span></strong><span class="koboSpan" id="kobo.137.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.138.1">POS</span></strong><span class="koboSpan" id="kobo.139.1">) device</span><a id="_idIndexMarker1542"/><span class="koboSpan" id="kobo.140.1"> and infect it with another piece of malware. </span><span class="koboSpan" id="kobo.140.2">How this group executes such an attack is their TTPs. </span></li></ul></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.141.1">Operational threat intelligence</span></strong><span class="koboSpan" id="kobo.142.1">: The past decade has seen more and more coordinated </span><a id="_idIndexMarker1543"/><span class="koboSpan" id="kobo.143.1">attacks</span><a id="_idIndexMarker1544"/><span class="koboSpan" id="kobo.144.1"> that do not just target one organization but may target an entire industry, region, or country. </span><span class="koboSpan" id="kobo.144.2">Operational threat intelligence is data and information about the wider goal of cyberattacks and cyber threat actors. </span><span class="koboSpan" id="kobo.144.3">This often involves not just examining the incident response team’s own organization but examining how cyber threat actors are attacking the larger industry. </span><span class="koboSpan" id="kobo.144.4">For example, in returning to a previous example where incident responders at a healthcare institution were preparing for an attack, wider knowledge of what types of attacks are occurring at similar-sized and staffed healthcare institutions would be helpful in aligning their own security controls to the prevalent threats. </span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.145.1">Strategic threat intelligence</span></strong><span class="koboSpan" id="kobo.146.1">: Senior </span><a id="_idIndexMarker1545"/><span class="koboSpan" id="kobo.147.1">leadership</span><a id="_idIndexMarker1546"/><span class="koboSpan" id="kobo.148.1"> such as the CIO or CISO often must concern themselves with the strategic goals of the organization alongside the necessary controls to ensure that the organization is addressing the cyber threat landscape. </span><span class="koboSpan" id="kobo.148.2">Strategic threat intelligence examines trends in cyberattacks, what cyber threat actors are prevalent, and what industries are major targets. </span><span class="koboSpan" id="kobo.148.3">Other key data points are changes in technology that a threat</span><a id="_idIndexMarker1547"/><span class="koboSpan" id="kobo.149.1"> actor</span><a id="_idIndexMarker1548"/><span class="koboSpan" id="kobo.150.1"> or group may leverage in </span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">an attack.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.152.1">The best use of threat intelligence is to understand that each one of these types can be integrated into an overall strategy. </span><span class="koboSpan" id="kobo.152.2">Leveraging internal and external threat intelligence of all three types provides key decision makers with an understanding of the threat landscape, managers with the ability to implement appropriate security controls and procedures, and analysts with the ability to search for ongoing security issues or to prepare their own response to </span><span class="No-Break"><span class="koboSpan" id="kobo.153.1">a cyberattack.</span></span></p>
<h2 id="_idParaDest-300"><a id="_idTextAnchor308"/><span class="koboSpan" id="kobo.154.1">The Pyramid of Pain</span></h2>
<p><span class="koboSpan" id="kobo.155.1">A useful construct </span><a id="_idIndexMarker1549"/><span class="koboSpan" id="kobo.156.1">for describing the various types of IOCs and IOAs that an adversary can leverage and their ability to modify them during an attack is the Pyramid of Pain. </span><span class="koboSpan" id="kobo.156.2">This construct, developed by David Bianco, describes the relationship between the IOCs, IOAs, and TTPs that an attacker makes available through observations by the defender and the attacker’s ability to change those indicators. </span><span class="koboSpan" id="kobo.156.3">The following diagram shows the relationship between the various indicators and the work effort necessary to modify them to bypass </span><span class="No-Break"><span class="koboSpan" id="kobo.157.1">security controls:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer353">
<span class="koboSpan" id="kobo.158.1"><img alt="Figure 17.1 – The Pyramid of Pain " src="image/B18571_17_001.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.159.1">Figure 17.1 – The Pyramid of Pain</span></p>
<p><span class="koboSpan" id="kobo.160.1">For example, an attacker may have crafted a piece of malware that spreads through lateral movement via the Windows SMB protocol. </span><span class="koboSpan" id="kobo.160.2">To bypass traditional signature-based malware prevention tools, the attacker uses a polymorphic virus that changes its hash every time it is installed. </span><span class="koboSpan" id="kobo.160.3">This change allows the piece of malware to bypass this control. </span><span class="koboSpan" id="kobo.160.4">Other indicators, such as network or host artifacts, are harder to change for the attacker and, as a result, responders have a greater chance of successfully stopping an attack by aligning their security controls at the top layers of the pyramid. </span></p>
<p><span class="koboSpan" id="kobo.161.1">From a threat intelligence perspective, the Pyramid of Pain allows responders to align threat intelligence requirements with what would be useful from a long-term strategy. </span><span class="koboSpan" id="kobo.161.2">Having detailed information and intelligence about the TTPs in use by threat actors will provide more insight into how the threat actor operates. </span><span class="koboSpan" id="kobo.161.3">Lower-level indicators such as the IP addresses </span><a id="_idIndexMarker1550"/><span class="koboSpan" id="kobo.162.1">of C2 servers are useful, but responders do need to understand that these can easily be changed by </span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">the adversary.</span></span></p>
<h2 id="_idParaDest-301"><a id="_idTextAnchor309"/><span class="koboSpan" id="kobo.164.1">The threat intelligence methodology</span></h2>
<p><span class="koboSpan" id="kobo.165.1">Threat intelligence </span><a id="_idIndexMarker1551"/><span class="koboSpan" id="kobo.166.1">goes through a feedback cycle to keep pace with an ever-changing environment. </span><span class="koboSpan" id="kobo.166.2">While several methodologies can place context around this challenge, one that is often utilized is the cycle of intelligence used by the US Department of Defense. </span><span class="koboSpan" id="kobo.166.3">This cycle provides the framework and a starting point for organizations to incorporate threat intelligence into </span><span class="No-Break"><span class="koboSpan" id="kobo.167.1">their operations:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer354">
<span class="koboSpan" id="kobo.168.1"><img alt="Figure 17.2 – The intelligence cycle " src="image/B18571_17_002.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.169.1">Figure 17.2 – The intelligence cycle</span></p>
<p><span class="koboSpan" id="kobo.170.1">The </span><a id="_idIndexMarker1552"/><span class="koboSpan" id="kobo.171.1">phases are explained </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">as follows:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.173.1">Direction</span></strong><span class="koboSpan" id="kobo.174.1">: Decision</span><a id="_idIndexMarker1553"/><span class="koboSpan" id="kobo.175.1"> makers, such as the CISO, information security personnel, or incident response analysts, set down what threat intelligence is required. </span><span class="koboSpan" id="kobo.175.2">In determining the requirements for intelligence, it is good practice to identify the users of each of the types of threat intelligence previously discussed. </span><span class="koboSpan" id="kobo.175.3">For example, a CISO might want threat intelligence about what trends in cyberattacks against hospitals are anticipated in the next year. </span><span class="koboSpan" id="kobo.175.4">An incident response analyst may require intelligence on what individual IOCs of malware are being seen in other healthcare institutions. </span><span class="koboSpan" id="kobo.175.5">The organization may also start by looking at what critical systems and applications are in use, as well as the critical data they are trying to protect. </span><span class="koboSpan" id="kobo.175.6">Another good starting point is if an organization already has some information about what types of cyber threats they may face. </span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.176.1">Collection</span></strong><span class="koboSpan" id="kobo.177.1">: In the collection stage, the organization obtains the data and information from its sources. </span><span class="koboSpan" id="kobo.177.2">In terms of cyber threat intelligence, this can come from government organizations such as government-sponsored CERTs or through commercial organizations that sell curated and analyzed threat intelligence. </span><span class="koboSpan" id="kobo.177.3">Finally, there are a great many </span><strong class="bold"><span class="koboSpan" id="kobo.178.1">Open Source Intelligence</span></strong><span class="koboSpan" id="kobo.179.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.180.1">OSINT</span></strong><span class="koboSpan" id="kobo.181.1">) feeds</span><a id="_idIndexMarker1554"/><span class="koboSpan" id="kobo.182.1"> that an organization can leverage. </span><span class="koboSpan" id="kobo.182.2">For example, malware sites such as VirusTotal and Malware Bazaar make IOCs and complete examples available to the larger cyber security and response communities. </span><span class="koboSpan" id="kobo.182.3">There are also providers such as AlienVault that provide a full platform that can be searched for IOCs. </span><span class="koboSpan" id="kobo.182.4">Commercial entities will also make some threat intelligence available to the community. </span><span class="koboSpan" id="kobo.182.5">OSINT is extremely valuable for organizations that are just starting out and need to show the value of threat intelligence without breaking the bank. </span><span class="koboSpan" id="kobo.182.6">Additionally, OSINT can also serve as a significant portion of an organization’s</span><a id="_idIndexMarker1555"/><span class="koboSpan" id="kobo.183.1"> overall </span><a id="_idIndexMarker1556"/><span class="koboSpan" id="kobo.184.1">intelligence collection. </span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.185.1">Processing</span></strong><span class="koboSpan" id="kobo.186.1">: The sheer amount of intelligence that an organization may obtain can be staggering. </span><span class="koboSpan" id="kobo.186.2">During the processing stage, the organization takes the raw data, evaluates it, determines the relevance and reliability of the data, and then collates it for the </span><span class="No-Break"><span class="koboSpan" id="kobo.187.1">next step.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.188.1">Analysis</span></strong><span class="koboSpan" id="kobo.189.1">: During the analysis stage, the organization evaluates the data that has been processed and combines it with other data from other sources. </span><span class="koboSpan" id="kobo.189.2">From here, it is interpreted, and the finished product can be deemed curated or properly evaluated threat intelligence. </span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.190.1">Dissemination</span></strong><span class="koboSpan" id="kobo.191.1">: The newly curated threat intelligence is then sent to the various users within the organization </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">for use.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.193.1">The cyclical nature of this methodology ensures that feedback is part of the process. </span><span class="koboSpan" id="kobo.193.2">Those analysts involved in the collection and processing should make sure that they receive feedback on the relevance and veracity of the intelligence that is disseminated. </span><span class="koboSpan" id="kobo.193.3">From here, they would be</span><a id="_idIndexMarker1557"/><span class="koboSpan" id="kobo.194.1"> able to tune the intelligence product over time. </span><span class="koboSpan" id="kobo.194.2">This ensures the highest </span><a id="_idIndexMarker1558"/><span class="koboSpan" id="kobo.195.1">level of relevancy and fidelity of intelligence consumed by </span><span class="No-Break"><span class="koboSpan" id="kobo.196.1">end users.</span></span></p>
<p><span class="koboSpan" id="kobo.197.1">Now that we have covered the foundational elements of threat intelligence, let’s look at how to source </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">this data.</span></span></p>
<h1 id="_idParaDest-302"><a id="_idTextAnchor310"/><span class="koboSpan" id="kobo.199.1">Sourcing threat intelligence</span></h1>
<p><span class="koboSpan" id="kobo.200.1">There are three</span><a id="_idIndexMarker1559"/><span class="koboSpan" id="kobo.201.1"> primary sources of threat intelligence that an organization can leverage. </span><span class="koboSpan" id="kobo.201.2">Threat intelligence can be produced by the organization in an internal process, acquired through open source methods, or, finally, through third-party threat intelligence vendors. </span><span class="koboSpan" id="kobo.201.3">Each organization can utilize its own internal processes to determine what its needs are and what sources </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">to leverage.</span></span></p>
<h2 id="_idParaDest-303"><a id="_idTextAnchor311"/><span class="koboSpan" id="kobo.203.1">Internally developed sources</span></h2>
<p><span class="koboSpan" id="kobo.204.1">The most complex</span><a id="_idIndexMarker1560"/><span class="koboSpan" id="kobo.205.1"> threat intelligence sources are those that an organization internally develops. </span><span class="koboSpan" id="kobo.205.2">This is due to the infrastructure that is needed to obtain the individual IOCs from malware campaigns and TTPs from threat actors. </span><span class="koboSpan" id="kobo.205.3">To obtain IOCs, the organization can make use of honeypots or other deliberately vulnerable systems to acquire unique malware samples. </span><span class="koboSpan" id="kobo.205.4">They will also need to have the expertise and systems available to not only evaluate suspected malware but reverse engineer it. </span><span class="koboSpan" id="kobo.205.5">From there, they would be able to extract the individual IOCs that can then be utilized. </span></p>
<p><span class="koboSpan" id="kobo.206.1">Other systems such as SIEM platforms can be utilized to track an attacker’s TTPs as they attempt to penetrate a network. </span><span class="koboSpan" id="kobo.206.2">From</span><a id="_idIndexMarker1561"/><span class="koboSpan" id="kobo.207.1"> here, a </span><strong class="bold"><span class="koboSpan" id="kobo.208.1">Security Operations Center</span></strong><span class="koboSpan" id="kobo.209.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.210.1">SOC</span></strong><span class="koboSpan" id="kobo.211.1">) analyst can record how different attackers go about their penetration attempts. </span><span class="koboSpan" id="kobo.211.2">With this information, the organization can build a profile of specific groups. </span><span class="koboSpan" id="kobo.211.3">This can aid in the alignment of security controls to better prevent or detect </span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">network intrusions.</span></span></p>
<p><span class="koboSpan" id="kobo.213.1">Developing threat intelligence internally requires expertise in areas such as malware analysis, network, and host-based forensics. </span><span class="koboSpan" id="kobo.213.2">Furthermore, the infrastructure required is often cost prohibitive. </span><span class="koboSpan" id="kobo.213.3">As a result, organizations are often forced to rely on third-party providers or </span><a id="_idIndexMarker1562"/><span class="koboSpan" id="kobo.214.1">what is shared openly among </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">other organizations.</span></span></p>
<h2 id="_idParaDest-304"><a id="_idTextAnchor312"/><span class="koboSpan" id="kobo.216.1">Commercial sourcing</span></h2>
<p><span class="koboSpan" id="kobo.217.1">An alternative to</span><a id="_idIndexMarker1563"/><span class="koboSpan" id="kobo.218.1"> internal sourcing is to contract a threat intelligence vendor. </span><span class="koboSpan" id="kobo.218.2">These organizations utilize their personnel and infrastructure to acquire malware, analyze attacks, and conduct research on various threat groups. </span><span class="koboSpan" id="kobo.218.3">Commercial threat intelligence providers will often process the threat intelligence so that it is tailored to the individual client organization. </span></p>
<p><span class="koboSpan" id="kobo.219.1">Often, commercial vendors provide SIEM and SOC services for a variety of clients utilizing a common SIEM platform. </span><span class="koboSpan" id="kobo.219.2">From here, they can aggregate samples of malware and attacks across various enterprises that span the entire world. </span><span class="koboSpan" id="kobo.219.3">This allows them to offer a comprehensive product to their clients. </span><span class="koboSpan" id="kobo.219.4">This is one of the distinct advantages of utilizing a commercial service. </span><span class="koboSpan" id="kobo.219.5">This is in addition to the cost savings that come from transferring the cost to a </span><span class="No-Break"><span class="koboSpan" id="kobo.220.1">third party.</span></span></p>
<h2 id="_idParaDest-305"><a id="_idTextAnchor313"/><span class="koboSpan" id="kobo.221.1">Open source intelligence</span></h2>
<p><span class="koboSpan" id="kobo.222.1">One sourcing</span><a id="_idIndexMarker1564"/><span class="koboSpan" id="kobo.223.1"> area that has become quite popular with organizations of every size is OSINT providers. </span><span class="koboSpan" id="kobo.223.2">Community groups, and even commercial enterprises, make threat intelligence available to the larger cyber community free of charge. </span><span class="koboSpan" id="kobo.223.3">Groups such as SANS and US-CERT provide specific information about threats and vulnerabilities. </span><span class="koboSpan" id="kobo.223.4">Commercial providers such as AlienVault provide</span><a id="_idIndexMarker1565"/><span class="koboSpan" id="kobo.224.1"> an </span><strong class="bold"><span class="koboSpan" id="kobo.225.1">Open Threat Exchange</span></strong><span class="koboSpan" id="kobo.226.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.227.1">OTX</span></strong><span class="koboSpan" id="kobo.228.1">) that allows a user community to share threat intelligence such as IOCs and TTPs. </span><span class="koboSpan" id="kobo.228.2">Other commercial organizations will provide whitepapers and reports on APT groups or strategic threat intelligence on emerging trends within the information security industry. </span><span class="koboSpan" id="kobo.228.3">Depending on the organization, OSINT is often very useful and provides a low-cost alternative to commercial services. </span></p>
<p><span class="koboSpan" id="kobo.229.1">The widespread use of OSINT has led to various organizations creating methods to share threat intelligence across organizations. </span><span class="koboSpan" id="kobo.229.2">Depending on the source, the actual way that an organization can obtain threat intelligence is dependent on how it </span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">is configured.</span></span></p>
<p><span class="koboSpan" id="kobo.231.1">While not a completely exhaustive list, the following are some of the formats of cyber threat OSINT that </span><span class="No-Break"><span class="koboSpan" id="kobo.232.1">are available:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.233.1">OpenIOC</span></strong><span class="koboSpan" id="kobo.234.1">: OpenIOC was </span><a id="_idIndexMarker1566"/><span class="koboSpan" id="kobo.235.1">first developed so that Mandiant products could ingest threat intelligence and utilize it to search for evidence of compromise on the systems analyzed. </span><span class="koboSpan" id="kobo.235.2">It has evolved into an XML schema that describes the technical IOCs that an incident responder can use in determining whether a system has </span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">been compromised.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.237.1">STIX</span></strong><span class="koboSpan" id="kobo.238.1">: The </span><strong class="bold"><span class="koboSpan" id="kobo.239.1">Structured Threat Information Expression</span></strong><span class="koboSpan" id="kobo.240.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.241.1">STIX</span></strong><span class="koboSpan" id="kobo.242.1">) is a product of the </span><a id="_idIndexMarker1567"/><span class="koboSpan" id="kobo.243.1">OASIS consortium. </span><span class="koboSpan" id="kobo.243.2">This machine-readable format allows organizations to share threat intelligence across various commercial and freeware threat intelligence </span><span class="No-Break"><span class="koboSpan" id="kobo.244.1">aggregation platforms.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.245.1">TAXII</span></strong><span class="koboSpan" id="kobo.246.1">: The </span><strong class="bold"><span class="koboSpan" id="kobo.247.1">Trusted Automated Exchange of Intelligence Information</span></strong><span class="koboSpan" id="kobo.248.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.249.1">TAXII</span></strong><span class="koboSpan" id="kobo.250.1">) is</span><a id="_idIndexMarker1568"/><span class="koboSpan" id="kobo.251.1"> an </span><a id="_idIndexMarker1569"/><span class="koboSpan" id="kobo.252.1">application layer protocol that shares threat intelligence over HTTPS. </span><span class="koboSpan" id="kobo.252.2">TAXII defines an API that can be utilized to share threat intelligence in the STIX format. </span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.253.1">VERIS</span></strong><span class="koboSpan" id="kobo.254.1">: The </span><strong class="bold"><span class="koboSpan" id="kobo.255.1">Vocabulary for Event Recording and Incident Sharing</span></strong><span class="koboSpan" id="kobo.256.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.257.1">VERIS</span></strong><span class="koboSpan" id="kobo.258.1">) is a</span><a id="_idIndexMarker1570"/><span class="koboSpan" id="kobo.259.1"> comprehensive schema for standardizing the language of cybersecurity incidents. </span><span class="koboSpan" id="kobo.259.2">The one key problem that the VERIS schema attempts to solve is the lack of a standard way to document security incidents. </span><span class="koboSpan" id="kobo.259.3">VERIS provides a structure in which organizations have a defined way to categorize the variety of attacks that may occur. </span><span class="koboSpan" id="kobo.259.4">The VERIS schema also serves as the collection point of data provided by organizations that is incorporated into the Verizon Data </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">Breach Study.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.261.1">With a variety of intelligence sources available, one challenge that presents itself is the ability of </span><a id="_idIndexMarker1571"/><span class="koboSpan" id="kobo.262.1">organizations to aggregate, organize, and utilize threat intelligence. </span><span class="koboSpan" id="kobo.262.2">In the next section, a discussion of threat intelligence platforms will provide insight into solving </span><span class="No-Break"><span class="koboSpan" id="kobo.263.1">these issues.</span></span></p>
<h1 id="_idParaDest-306"><a id="_idTextAnchor314"/><span class="koboSpan" id="kobo.264.1">The MITRE ATT&amp;CK framework</span></h1>
<p><span class="koboSpan" id="kobo.265.1">Looking back at</span><a id="_idIndexMarker1572"/><span class="koboSpan" id="kobo.266.1"> the Pyramid of Pain discussion in the previous section, we can see at the very top are the TTPs that the adversary uses. </span><span class="koboSpan" id="kobo.266.2">Modifying these requires additional resources and time on the adversary’s end. </span><span class="koboSpan" id="kobo.266.3">Focusing on TTPs from a threat intelligence and mitigation perspective also provides defenders better protection as detections are not tied to an indicator such as a domain name or IP address, which can be </span><span class="No-Break"><span class="koboSpan" id="kobo.267.1">easily modified.</span></span></p>
<p><span class="koboSpan" id="kobo.268.1">The MITRE Corporation has</span><a id="_idIndexMarker1573"/><span class="koboSpan" id="kobo.269.1"> created the </span><strong class="bold"><span class="koboSpan" id="kobo.270.1">Adversarial Tactics, Techniques, and Common Knowledge</span></strong><span class="koboSpan" id="kobo.271.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.272.1">ATT&amp;CK</span></strong><span class="koboSpan" id="kobo.273.1">) knowledge base, available at </span><a href="https://attack.mitre.org/"><span class="koboSpan" id="kobo.274.1">https://attack.mitre.org/</span></a><span class="koboSpan" id="kobo.275.1">. </span><span class="koboSpan" id="kobo.275.2">This knowledge base incorporates adversary tradecraft, tactics techniques, and adversary behaviors that run through the various stages of a cyberattack. </span><span class="koboSpan" id="kobo.275.3">It was started in September 2013, and, as of the time of writing, is now on its </span><span class="No-Break"><span class="koboSpan" id="kobo.276.1">ninth version.</span></span></p>
<p><span class="koboSpan" id="kobo.277.1">The ATT&amp;CK knowledge base started out focusing on the Windows operating system but, over its lifetime, has incorporated malicious activity directed at macOS and Linux as well. </span><span class="koboSpan" id="kobo.277.2">MITRE has also included as part of the knowledge base pre-attack techniques such as resource development and reconnaissance. </span><span class="koboSpan" id="kobo.277.3">Finally, MITRE recently included tactics and techniques in use by adversaries to compromise </span><span class="No-Break"><span class="koboSpan" id="kobo.278.1">mobile devices.</span></span></p>
<p><span class="koboSpan" id="kobo.279.1">This behavioral model has three core components. </span><span class="koboSpan" id="kobo.279.2">The first of these components is </span><strong class="bold"><span class="koboSpan" id="kobo.280.1">Tactics</span></strong><span class="koboSpan" id="kobo.281.1">. </span><span class="koboSpan" id="kobo.281.2">The </span><a id="_idIndexMarker1574"/><span class="koboSpan" id="kobo.282.1">fourteen separate Tactics represent the adversary’s goal during the sequence of attack. </span><span class="koboSpan" id="kobo.282.2">For example, let us </span><a id="_idIndexMarker1575"/><span class="koboSpan" id="kobo.283.1">look at the </span><strong class="bold"><span class="koboSpan" id="kobo.284.1">Persistence</span></strong><span class="koboSpan" id="kobo.285.1"> tactic as defined by MITRE in the </span><span class="No-Break"><span class="koboSpan" id="kobo.286.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer355">
<span class="koboSpan" id="kobo.287.1"><img alt="Figure 17.3 – MITRE ATT&amp;CK Persistence " src="image/B18571_17_003.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.288.1">Figure 17.3 – MITRE ATT&amp;CK Persistence</span></p>
<p><span class="koboSpan" id="kobo.289.1">MITRE defines persistence as the adversary trying to maintain their foothold. </span><span class="koboSpan" id="kobo.289.2">This definition is further expanded to address the next component, techniques. </span><span class="koboSpan" id="kobo.289.3">Techniques are the means and methods that an adversary uses to achieve the overall tactical goal. </span><span class="koboSpan" id="kobo.289.4">For example, adversaries can make</span><a id="_idIndexMarker1576"/><span class="koboSpan" id="kobo.290.1"> use of </span><strong class="bold"><span class="koboSpan" id="kobo.291.1">boot or logon scripts</span></strong><span class="koboSpan" id="kobo.292.1"> to maintain persistence as the MITRE ATT&amp;CK technique </span><strong class="bold"><span class="koboSpan" id="kobo.293.1">T1037</span></strong><span class="koboSpan" id="kobo.294.1"> indicates in the </span><span class="No-Break"><span class="koboSpan" id="kobo.295.1">following</span></span><span class="No-Break"><a id="_idIndexMarker1577"/></span><span class="No-Break"><span class="koboSpan" id="kobo.296.1"> screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer356">
<span class="koboSpan" id="kobo.297.1"><img alt="Figure 17.4 – MITRE ATT&amp;CK technique T1037 " src="image/B18571_17_004.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.298.1">Figure 17.4 – MITRE ATT&amp;CK technique T1037</span></p>
<p><span class="koboSpan" id="kobo.299.1">The technique</span><a id="_idIndexMarker1578"/><span class="koboSpan" id="kobo.300.1"> description provides not only a definition but other key resources as well. </span><span class="koboSpan" id="kobo.300.2">For example, the </span><strong class="bold"><span class="koboSpan" id="kobo.301.1">Data Sources</span></strong><span class="koboSpan" id="kobo.302.1"> field shows incident responders and digital forensic analysts’ potential sources of evidence to confirm the use</span><a id="_idIndexMarker1579"/><span class="koboSpan" id="kobo.303.1"> of the technique. </span><span class="koboSpan" id="kobo.303.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.304.1">Common Attack Pattern Enumeration and Classification Identification</span></strong><span class="koboSpan" id="kobo.305.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.306.1">CAPEC</span></strong><span class="koboSpan" id="kobo.307.1">) ID cross-references the MITRE ATT&amp;CK framework</span><a id="_idIndexMarker1580"/><span class="koboSpan" id="kobo.308.1"> with the </span><strong class="bold"><span class="koboSpan" id="kobo.309.1">MITRE CAPEC</span></strong><span class="koboSpan" id="kobo.310.1">. </span><span class="koboSpan" id="kobo.310.2">The CAPEC, available at </span><a href="https://capec.mitre.org/"><span class="koboSpan" id="kobo.311.1">https://capec.mitre.org/</span></a><span class="koboSpan" id="kobo.312.1">, provides details of adversary </span><span class="No-Break"><span class="koboSpan" id="kobo.313.1">attack patterns.</span></span></p>
<p><span class="koboSpan" id="kobo.314.1">Many of the techniques in the MITRE ATT&amp;CK framework also contain sub-techniques. </span><span class="koboSpan" id="kobo.314.2">These sub-techniques provide a more granular look at the various methods and tools the adversary uses in the execution of the technique. </span><span class="koboSpan" id="kobo.314.3">For example, if we drill down further, we see the entry </span><strong class="bold"><span class="koboSpan" id="kobo.315.1">ID T1037.001</span></strong><span class="koboSpan" id="kobo.316.1">, as in the </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer357">
<span class="koboSpan" id="kobo.318.1"><img alt="Figure 17.5 – MITRE ATT&amp;CK T1307.001 procedure example " src="image/B18571_17_005.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.319.1">Figure 17.5 – MITRE ATT&amp;CK T1307.001 procedure example</span></p>
<p><span class="koboSpan" id="kobo.320.1">This provides real-world context to the tactics and techniques that threat actors use. </span><span class="koboSpan" id="kobo.320.2">In this case, for example, we see that the</span><a id="_idIndexMarker1581"/><span class="koboSpan" id="kobo.321.1"> threat group </span><strong class="bold"><span class="koboSpan" id="kobo.322.1">APT28</span></strong><span class="koboSpan" id="kobo.323.1"> uses a Trojan and adds the </span><strong class="source-inline"><span class="koboSpan" id="kobo.324.1">HKCU\Environment\UserInitMprLogonScript</span></strong><span class="koboSpan" id="kobo.325.1"> registry key to maintain persistence on a system.  </span></p>
<p><span class="koboSpan" id="kobo.326.1">Outside of the tactics and techniques, the MITRE ATT&amp;CK framework also serves as a clearing house</span><a id="_idIndexMarker1582"/><span class="koboSpan" id="kobo.327.1"> of sorts for both malicious tools and threat actor groups. </span><span class="koboSpan" id="kobo.327.2">For example, we identified that APT28 utilizes a specific tool to maintain persistence, but we may not even know who or what APT28 is. </span><span class="koboSpan" id="kobo.327.3">Pivoting off the link in the techniques section, we see that the MITRE ATT&amp;CK framework contains an overview of the threat actor, its origins, aliases, and a review of the high-profile attacks it has </span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">carried out.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer358">
<span class="koboSpan" id="kobo.329.1"><img alt="Figure 17.6 – APT28 profile " src="image/B18571_17_006.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.330.1">Figure 17.6 – APT28 profile</span></p>
<p><span class="koboSpan" id="kobo.331.1">When discussing aliases, there are several challenges with tying tactics and techniques to groups. </span><span class="koboSpan" id="kobo.331.2">First, groups may pop up and then disappear after a campaign. </span><span class="koboSpan" id="kobo.331.3">Individuals may shift. </span><span class="koboSpan" id="kobo.331.4">Finally, threat intelligence researchers such as FireEye and RecordedFuture have their own nomenclature for describing groups. </span><span class="koboSpan" id="kobo.331.5">As we saw in the previous example, APT28 could be tied to other groups as well. </span><span class="koboSpan" id="kobo.331.6">MITRE provides a more detailed breakdown of the group and </span><a id="_idIndexMarker1583"/><span class="koboSpan" id="kobo.332.1">its associated designations. </span></p>
<div>
<div class="IMG---Figure" id="_idContainer359">
<span class="koboSpan" id="kobo.333.1"><img alt="Figure 17.7 – APT28 Associated Group Descriptions " src="image/B18571_17_007.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.334.1">Figure 17.7 – APT28 Associated Group Descriptions</span></p>
<p><span class="koboSpan" id="kobo.335.1">Drilling down into the</span><a id="_idIndexMarker1584"/><span class="koboSpan" id="kobo.336.1"> dossier, there is a list of the tactics and techniques that the group has been known to use when carrying out attacks. </span></p>
<div>
<div class="IMG---Figure" id="_idContainer360">
<span class="koboSpan" id="kobo.337.1"><img alt="Figure 17.8 – APT28 Techniques Used " src="image/B18571_17_008.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.338.1">Figure 17.8 – APT28 Techniques Used</span></p>
<p><span class="koboSpan" id="kobo.339.1">In addition to </span><a id="_idIndexMarker1585"/><span class="koboSpan" id="kobo.340.1">the tactics</span><a id="_idIndexMarker1586"/><span class="koboSpan" id="kobo.341.1"> and techniques that the APT28 group has been shown to use, MITRE also includes specific tools, such as exploit frameworks, malware, and exploits, such as the use of credential harvesting tools, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer361">
<span class="koboSpan" id="kobo.343.1"><img alt="Figure 17.9 – Mimikatz tool use " src="image/B18571_17_009.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.344.1">Figure 17.9 – Mimikatz tool use</span></p>
<p><span class="koboSpan" id="kobo.345.1">You might have</span><a id="_idIndexMarker1587"/><span class="koboSpan" id="kobo.346.1"> already surmised that we can pivot off the Mimikatz entry to get a better understanding of the tool itself. </span><span class="koboSpan" id="kobo.346.2">If you had that thought, you would be correct. </span><span class="koboSpan" id="kobo.346.3">Clicking on </span><strong class="bold"><span class="koboSpan" id="kobo.347.1">Mimikatz</span></strong><span class="koboSpan" id="kobo.348.1"> shows an overview of </span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">the tool.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer362">
<span class="koboSpan" id="kobo.350.1"><img alt="Figure 17.10 – Mimikatz tool profile " src="image/B18571_17_010.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.351.1">Figure 17.10 – Mimikatz tool profile</span></p>
<p><span class="koboSpan" id="kobo.352.1">Aside from an easily searchable interface that allows threat intelligence professionals to cross-reference tools, techniques, and tactics, the framework is meticulously footnoted. </span><span class="koboSpan" id="kobo.352.2">The source material for the information contained can be readily searched and accessed via hyperlinks, saving time and resources if an analysis requires a review of the </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">source material.</span></span></p>
<p><span class="koboSpan" id="kobo.354.1">The ATT&amp;CK framework also includes a </span><strong class="bold"><span class="koboSpan" id="kobo.355.1">Navigator</span></strong><span class="koboSpan" id="kobo.356.1"> for easily viewing the various tactics, techniques, and </span><a id="_idIndexMarker1588"/><span class="koboSpan" id="kobo.357.1">tools that are included. </span><span class="koboSpan" id="kobo.357.2">The Navigator can be accessed at the URL </span><a href="https://mitre-attack.github.io/attack-navigator/v2/enterprise/"><span class="koboSpan" id="kobo.358.1">https://mitre-attack.github.io/attack-navigator/v2/enterprise/</span></a><span class="koboSpan" id="kobo.359.1">. </span><span class="koboSpan" id="kobo.359.2">The site lists the tactics in the top row </span><a id="_idIndexMarker1589"/><span class="koboSpan" id="kobo.360.1">with the corresponding techniques in the columns as seen in the </span><span class="No-Break"><span class="koboSpan" id="kobo.361.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer363">
<span class="koboSpan" id="kobo.362.1"><img alt="Figure 17.11 – ATT&amp;CK Navigator " src="image/B18571_17_011.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.363.1">Figure 17.11 – ATT&amp;CK Navigator</span></p>
<p><span class="koboSpan" id="kobo.364.1">The Navigator also has several controls that allow the user to interact with the tool. </span><span class="koboSpan" id="kobo.364.2">In this case, </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.365.1">Figure 17</span></em></span><em class="italic"><span class="koboSpan" id="kobo.366.1">.12</span></em><span class="koboSpan" id="kobo.367.1"> shows the various </span><span class="No-Break"><span class="koboSpan" id="kobo.368.1">controls available:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer364">
<span class="koboSpan" id="kobo.369.1"><img alt="Figure 17.12 – ATT&amp;CK Navigator controls " src="image/B18571_17_012.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.370.1">Figure 17.12 – ATT&amp;CK Navigator controls</span></p>
<p><span class="koboSpan" id="kobo.371.1">For example, we will use the multiselect feature to highlight the techniques used by the group APT28. </span><span class="koboSpan" id="kobo.371.2">First, click on the hamburger icon with the plus sign under selection controls, as</span><a id="_idIndexMarker1590"/><span class="koboSpan" id="kobo.372.1"> shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.373.1">Figure 17</span></em></span><em class="italic"><span class="koboSpan" id="kobo.374.1">.13</span></em><span class="koboSpan" id="kobo.375.1">. </span><span class="koboSpan" id="kobo.375.2">This will produce the </span><span class="No-Break"><span class="koboSpan" id="kobo.376.1">following menu:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer365">
<span class="koboSpan" id="kobo.377.1"><img alt="Figure 17.13 – ATT&amp;CK Navigator multiselect feature " src="image/B18571_17_013.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.378.1">Figure 17.13 – ATT&amp;CK Navigator multiselect feature</span></p>
<p><span class="koboSpan" id="kobo.379.1">The drop-down menu contains intelligence on threat groups and software that are contained within the ATT&amp;CK framework. </span><span class="koboSpan" id="kobo.379.2">Scroll down the threat groups to </span><strong class="bold"><span class="koboSpan" id="kobo.380.1">APT</span></strong><span class="koboSpan" id="kobo.381.1"> and then click </span><strong class="bold"><span class="koboSpan" id="kobo.382.1">Select</span></strong><span class="koboSpan" id="kobo.383.1">. </span><span class="koboSpan" id="kobo.383.2">This will put a border around the techniques associated with the group. </span><span class="koboSpan" id="kobo.383.3">Next, click on</span><a id="_idIndexMarker1591"/><span class="koboSpan" id="kobo.384.1"> the color palate under </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">layer controls:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer366">
<span class="koboSpan" id="kobo.386.1"><img alt="Figure 17.14 – ATT&amp;CK Navigator palate control " src="image/B18571_17_014.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.387.1">Figure 17.14 – ATT&amp;CK Navigator palate control</span></p>
<p><span class="koboSpan" id="kobo.388.1">The palate allows you to change the background colors of the various techniques. </span><span class="koboSpan" id="kobo.388.2">In this case, we are only examining one layer so, in the </span><strong class="bold"><span class="koboSpan" id="kobo.389.1">Low value</span></strong><span class="koboSpan" id="kobo.390.1"> setting, change </span><strong class="source-inline"><span class="koboSpan" id="kobo.391.1">0</span></strong><span class="koboSpan" id="kobo.392.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.393.1">1</span></strong><span class="koboSpan" id="kobo.394.1"> to highlight the APT28 techniques </span><span class="No-Break"><span class="koboSpan" id="kobo.395.1">in red.</span></span></p>
<p><span class="koboSpan" id="kobo.396.1">The next step is to set the scoring to show the APT28 techniques. </span><span class="koboSpan" id="kobo.396.2">Access the scoring menu by clicking the bar chart icon under </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.397.1">technique controls</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer367">
<span class="koboSpan" id="kobo.399.1"><img alt="Figure 17.15 – ATT&amp;CK Navigator technique control score " src="image/B18571_17_015.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.400.1">Figure 17.15 – ATT&amp;CK Navigator technique control score</span></p>
<p><span class="koboSpan" id="kobo.401.1">Enter the </span><a id="_idIndexMarker1592"/><span class="koboSpan" id="kobo.402.1">number </span><strong class="source-inline"><span class="koboSpan" id="kobo.403.1">1</span></strong><span class="koboSpan" id="kobo.404.1"> under </span><strong class="bold"><span class="koboSpan" id="kobo.405.1">score</span></strong><span class="koboSpan" id="kobo.406.1"> and then click </span><em class="italic"><span class="koboSpan" id="kobo.407.1">Enter</span></em><span class="koboSpan" id="kobo.408.1">. </span><span class="koboSpan" id="kobo.408.2">This will then highlight the techniques in red. </span><span class="koboSpan" id="kobo.408.3">At this point, you can explore the Navigator by right-clicking on a specific technique and clicking </span><strong class="bold"><span class="koboSpan" id="kobo.409.1">view technique</span></strong><span class="koboSpan" id="kobo.410.1">. </span><span class="koboSpan" id="kobo.410.2">This will bring you to the specific technique’s page as we </span><span class="No-Break"><span class="koboSpan" id="kobo.411.1">saw earlier.</span></span></p>
<p><span class="koboSpan" id="kobo.412.1">The final feature we will look at right now is the ability to download the techniques associated with APT28. </span><span class="koboSpan" id="kobo.412.2">Under the layer controls, you can download the file as a JSON file using the down-arrow</span><a id="_idIndexMarker1593"/><span class="koboSpan" id="kobo.413.1"> icon, a </span><strong class="bold"><span class="koboSpan" id="kobo.414.1">Comma Separated Value</span></strong><span class="koboSpan" id="kobo.415.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.416.1">CSV</span></strong><span class="koboSpan" id="kobo.417.1">) document via the graph icon, and finally, an image via the </span><span class="No-Break"><span class="koboSpan" id="kobo.418.1">camera icon.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer368">
<span class="koboSpan" id="kobo.419.1"><img alt="Figure 17.16 – ATT&amp;CK Navigator capture options " src="image/B18571_17_016.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.420.1">Figure 17.16 – ATT&amp;CK Navigator capture options</span></p>
<p><span class="koboSpan" id="kobo.421.1">Clicking on the camera icon will open a second tab in Navigator. </span><span class="koboSpan" id="kobo.421.2">At the far right, a copy of the image can </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">be downloaded.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer369">
<span class="koboSpan" id="kobo.423.1"><img alt="Figure 17.17 – ATT&amp;CK Navigator APT28 tactics and techniques " src="image/B18571_17_017.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.424.1">Figure 17.17 – ATT&amp;CK Navigator APT28 tactics and techniques</span></p>
<p><span class="koboSpan" id="kobo.425.1">The ATT&amp;CK framework is an excellent resource for gaining insight into the tactics, techniques, and tools in use by threat actors. </span><span class="koboSpan" id="kobo.425.2">Since its inception, this framework has been tied into</span><a id="_idIndexMarker1594"/><span class="koboSpan" id="kobo.426.1"> organizations’ threat intelligence and incident response reporting, quickly turning the framework into the rubric by which organizations define </span><span class="No-Break"><span class="koboSpan" id="kobo.427.1">their observations.</span></span></p>
<h1 id="_idParaDest-307"><a id="_idTextAnchor315"/><span class="koboSpan" id="kobo.428.1">Working with IOCs and IOAs</span></h1>
<p><span class="koboSpan" id="kobo.429.1">A common </span><a id="_idIndexMarker1595"/><span class="koboSpan" id="kobo.430.1">mistake</span><a id="_idIndexMarker1596"/><span class="koboSpan" id="kobo.431.1"> that is often made by organizations that start the process of leveraging threat intelligence is to subscribe to a few commercial or open source feeds and turn them on. </span><span class="koboSpan" id="kobo.431.2">This approach will see the enterprise quickly become inundated with data. </span><span class="koboSpan" id="kobo.431.3">Most of this data will be unusable for the organization. </span><span class="koboSpan" id="kobo.431.4">The reality is that analysts and other stakeholders should work through crafting what data is relevant to their organization and use sources that can provide the best data to fit that relevance. </span></p>
<p><span class="koboSpan" id="kobo.432.1">In this case, we will focus on OSINT sources. </span><span class="koboSpan" id="kobo.432.2">There are several commercial organizations, such as CrowdStrike and AlienVault, that make IOCs and IOAs available to the community. </span><span class="koboSpan" id="kobo.432.3">Other sites are strictly focused on servicing the cybersecurity community without a</span><a id="_idIndexMarker1597"/><span class="koboSpan" id="kobo.433.1"> commercial component. </span><span class="koboSpan" id="kobo.433.2">The following are </span><a id="_idIndexMarker1598"/><span class="koboSpan" id="kobo.434.1">some resources that analysts </span><span class="No-Break"><span class="koboSpan" id="kobo.435.1">can leverage:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.436.1">AlienVault Open Threat Exchange</span></strong><span class="koboSpan" id="kobo.437.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.438.1">OTX</span></strong><span class="koboSpan" id="kobo.439.1">): This site, available at </span><a href="https://otx.alienvault.com/"><span class="koboSpan" id="kobo.440.1">https://otx.alienvault.com/</span></a><span class="koboSpan" id="kobo.441.1">, aggregates</span><a id="_idIndexMarker1599"/><span class="koboSpan" id="kobo.442.1"> indicators and threat intelligence reports from commercial enterprises such as Cisco Talos and Palo Alto Unit 42 as well as independent researchers from around the world. </span><span class="koboSpan" id="kobo.442.2">This intelligence is aggregated and allows users to search on keywords, IOCs, and even specific </span><span class="No-Break"><span class="koboSpan" id="kobo.443.1">threat actors.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.444.1">VirusTotal</span></strong><span class="koboSpan" id="kobo.445.1">: One of the key</span><a id="_idIndexMarker1600"/><span class="koboSpan" id="kobo.446.1"> sources of IOCs is VirusTotal. </span><span class="koboSpan" id="kobo.446.2">The site, </span><a href="https://www.virustotal.com/"><span class="koboSpan" id="kobo.447.1">https://www.virustotal.com/</span></a><span class="koboSpan" id="kobo.448.1">, and the associated data are owned and operated by Google and it is arguably the go-to spot for analysts and responders when it comes to intelligence about malware. </span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.449.1">Hybrid Analysis</span></strong><span class="koboSpan" id="kobo.450.1">: Hybrid </span><a id="_idIndexMarker1601"/><span class="koboSpan" id="kobo.451.1">Analysis, available at </span><a href="https://www.hybrid-analysis.com/"><span class="koboSpan" id="kobo.452.1">https://www.hybrid-analysis.com/</span></a><span class="koboSpan" id="kobo.453.1">, is operated by CrowdStrike. </span><span class="koboSpan" id="kobo.453.2">A unique feature of antivirus and EDR providers is that they often have an extensive collection of malware IOCs due to their presence in a range of organizations. </span><span class="koboSpan" id="kobo.453.3">Hybrid Analysis is a combination of a malware sandbox and an IOC database that allows users to both analyze samples and search on existing samples. </span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.454.1">MalwareBazaar</span></strong><span class="koboSpan" id="kobo.455.1">: Another malware IOC resource that is handy is MalwareBazaar. </span><span class="koboSpan" id="kobo.455.2">What</span><a id="_idIndexMarker1602"/><span class="koboSpan" id="kobo.456.1"> the site lacks in bells and whistles, it makes up for in the sheer number of samples and IOCs available. </span><span class="koboSpan" id="kobo.456.2">The site, </span><a href="https://bazaar.abuse.ch/"><span class="koboSpan" id="kobo.457.1">https://bazaar.abuse.ch/</span></a><span class="koboSpan" id="kobo.458.1">, is part of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.459.1">abuse.ch</span></strong><span class="koboSpan" id="kobo.460.1"> set of subdomains that provide IOCs related to botnets </span><span class="No-Break"><span class="koboSpan" id="kobo.461.1">and malware.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.462.1">These four sites only scratch the surface of what is available for IOCs but do provide a solid foundation for a focused collection plan. </span><span class="koboSpan" id="kobo.462.2">All four of these sites provide community accounts with minimum functionality that is still very useful. </span><span class="koboSpan" id="kobo.462.3">They also include searching for keywords, IP addresses, and file hashes. </span><span class="koboSpan" id="kobo.462.4">The final feature that is of interest to analysts is the API, which allows for querying the databases through scripts or through other programmatic means. </span><span class="koboSpan" id="kobo.462.5">We will look at how this feature can be leveraged later in the chapter. </span></p>
<p><span class="koboSpan" id="kobo.463.1">To access these sites, the analyst only must provide an email address and password. </span><span class="koboSpan" id="kobo.463.2">One technique that minimizes stress is to create an email address devoted strictly to threat intelligence sites. </span><span class="koboSpan" id="kobo.463.3">Many of these sites will send notifications, sometimes dozens of alerts, a day. </span><span class="koboSpan" id="kobo.463.4">Having an email account that is strictly for accessing these sites and aggregating alerts will remove the need to continually clean up a primary </span><span class="No-Break"><span class="koboSpan" id="kobo.464.1">email account.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.465.1">Awesome threat intelligence sources</span></p>
<p class="callout"><span class="koboSpan" id="kobo.466.1">There are sites that specifically aggregate sites specifically dedicated to providing IOCs and IOAs to the wider community. </span><span class="koboSpan" id="kobo.466.2">There are also GitHub repositories such as </span><a href="https://github.com/hslatman/awesome-threat-intelligence"><span class="koboSpan" id="kobo.467.1">https://github.com/hslatman/awesome-threat-intelligence</span></a><span class="koboSpan" id="kobo.468.1"> that can be used to craft sources for collection. </span><span class="koboSpan" id="kobo.468.2">Again, proceed with caution and do not try to collect </span><span class="No-Break"><span class="koboSpan" id="kobo.469.1">the ocean.</span></span></p>
<p><span class="koboSpan" id="kobo.470.1">Now that </span><a id="_idIndexMarker1603"/><span class="koboSpan" id="kobo.471.1">we </span><a id="_idIndexMarker1604"/><span class="koboSpan" id="kobo.472.1">have some sources outlined, let’s look at a sample workflow where IOCs are obtained from a threat intelligence site and put into use. </span><span class="koboSpan" id="kobo.472.2">In this case, an analyst wants to take threat intelligence related to the threat actor HAFNIUM and search through logs or other evidence for indications that their systems have been compromised. </span></p>
<p><span class="koboSpan" id="kobo.473.1">In this case, we will leverage the AlienVault OTX. </span><span class="koboSpan" id="kobo.473.2">A keyword search for </span><strong class="source-inline"><span class="koboSpan" id="kobo.474.1">HAFNIUM</span></strong><span class="koboSpan" id="kobo.475.1"> brings up several results. </span><span class="koboSpan" id="kobo.475.2">In this case, we will look at the following </span><span class="No-Break"><span class="koboSpan" id="kobo.476.1">hit: </span></span><a href="https://otx.alienvault.com/pulse/6127557db7ec02a119d8c23d"><span class="No-Break"><span class="koboSpan" id="kobo.477.1">https://otx.alienvault.com/pulse/6127557db7ec02a119d8c23d</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.478.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.479.1">Navigating to the URL reveals the references shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.480.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer370">
<span class="koboSpan" id="kobo.481.1"><img alt="Figure 17.18 – HAFNIUM intelligence sources " src="image/B18571_17_018.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.482.1">Figure 17.18 – HAFNIUM intelligence sources</span></p>
<p><span class="koboSpan" id="kobo.483.1">The IOCs </span><a id="_idIndexMarker1605"/><span class="koboSpan" id="kobo.484.1">are</span><a id="_idIndexMarker1606"/><span class="koboSpan" id="kobo.485.1"> listed below </span><span class="No-Break"><span class="koboSpan" id="kobo.486.1">the references:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer371">
<span class="koboSpan" id="kobo.487.1"><img alt="Figure 17.19 – HAFNIUM IOCs " src="image/B18571_17_019.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.488.1">Figure 17.19 – HAFNIUM IOCs</span></p>
<p><span class="koboSpan" id="kobo.489.1">To make use of these IOCs, we need to download them. </span><span class="koboSpan" id="kobo.489.2">In the top-right corner of the page is the </span><strong class="bold"><span class="koboSpan" id="kobo.490.1">Download</span></strong><span class="koboSpan" id="kobo.491.1"> button. </span><span class="koboSpan" id="kobo.491.2">This allows the user to download in a variety of formats, such as STIX, OpenCTI, and CSV files. </span><span class="koboSpan" id="kobo.491.3">In this case, download a CSV file. </span></p>
<div>
<div class="IMG---Figure" id="_idContainer372">
<span class="koboSpan" id="kobo.492.1"><img alt="Figure 17.20 – IOC download " src="image/B18571_17_020.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.493.1">Figure 17.20 – IOC download</span></p>
<p><span class="koboSpan" id="kobo.494.1">Once </span><a id="_idIndexMarker1607"/><span class="koboSpan" id="kobo.495.1">downloaded, navigate </span><a id="_idIndexMarker1608"/><span class="koboSpan" id="kobo.496.1">to the site </span><a href="https://cti.uncoder.io/"><span class="koboSpan" id="kobo.497.1">https://cti.uncoder.io/</span></a><span class="koboSpan" id="kobo.498.1">. </span><span class="koboSpan" id="kobo.498.2">This site, provided to the community by SOC Prime, will convert the IOCs contained in the download into a SPLUNK query. </span><span class="koboSpan" id="kobo.498.3">In this case, click </span><strong class="bold"><span class="koboSpan" id="kobo.499.1">Upload IOCs</span></strong><span class="koboSpan" id="kobo.500.1"> and navigate to the AlienVault CSV file that </span><span class="No-Break"><span class="koboSpan" id="kobo.501.1">was downloaded:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer373">
<span class="koboSpan" id="kobo.502.1"><img alt="Figure 17.21 – CTI Uncoder upload " src="image/B18571_17_021.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.503.1">Figure 17.21 – CTI Uncoder upload</span></p>
<p><span class="koboSpan" id="kobo.504.1">Now that the IOCs </span><a id="_idIndexMarker1609"/><span class="koboSpan" id="kobo.505.1">have </span><a id="_idIndexMarker1610"/><span class="koboSpan" id="kobo.506.1">been downloaded, we can use the Uncoder CTI to build a SPLUNK query to search log files for any matching domain names associated with HAFNIUM. </span><span class="koboSpan" id="kobo.506.2">In this case, under </span><strong class="bold"><span class="koboSpan" id="kobo.507.1">Generate Queries by IOC Types</span></strong><span class="koboSpan" id="kobo.508.1">, select </span><strong class="bold"><span class="koboSpan" id="kobo.509.1">Domain</span></strong><span class="koboSpan" id="kobo.510.1">. </span><span class="koboSpan" id="kobo.510.2">Under </span><strong class="bold"><span class="koboSpan" id="kobo.511.1">Query Platform</span></strong><span class="koboSpan" id="kobo.512.1">, select </span><strong class="bold"><span class="koboSpan" id="kobo.513.1">SPLUNK</span></strong><span class="koboSpan" id="kobo.514.1">. </span><span class="koboSpan" id="kobo.514.2">The rest of the settings can be left as their default. </span><span class="koboSpan" id="kobo.514.3">Click </span><strong class="bold"><span class="koboSpan" id="kobo.515.1">Generate</span></strong><span class="koboSpan" id="kobo.516.1"> and the following SPLUNK query </span><span class="No-Break"><span class="koboSpan" id="kobo.517.1">is generated:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.518.1">
(dest_host="api.onedvirer.xyz" OR dest_host="rawfuns.com" OR dest_host="yolkish.com" OR dest_host="back.rooter.tk" OR dest_host="lab.symantecsafe.org" OR dest_host="mm.portomnail.com" OR dest_host="ns.rtechs.org" OR dest_host="p.estonine.com" OR dest_host="soft.mssysinfo.xyz" OR dest_host="www.averyspace.net" OR dest_host="www.komdsecko.net")</span></pre>
<p><span class="koboSpan" id="kobo.519.1">This query can then be run against the analyst’s dataset to find any matching hits. </span></p>
<p><span class="koboSpan" id="kobo.520.1">This is a simple workflow but shows how the raw IOCs or IOAs provided by community or OSINT sources can be leveraged for queries and other investigative tasks. </span><span class="koboSpan" id="kobo.520.2">Building on that concept, we will examine how IOCs can be leveraged specifically for incident response and digital forensics as part of the investigation. </span></p>
<h1 id="_idParaDest-308"><a id="_idTextAnchor316"/><span class="koboSpan" id="kobo.521.1">Threat intelligence and incident response</span></h1>
<p><span class="koboSpan" id="kobo.522.1">During an</span><a id="_idIndexMarker1611"/><span class="koboSpan" id="kobo.523.1"> investigation, the </span><a id="_idIndexMarker1612"/><span class="koboSpan" id="kobo.524.1">CSIRT or analysts may come across a situation where an incident investigation seems to have stalled. </span><span class="koboSpan" id="kobo.524.2">This could be because the analysts know something is wrong or have indicators of a compromise but no concrete evidence to point in a specific direction. </span><span class="koboSpan" id="kobo.524.3">Threat intelligence can be leveraged by analysts to enhance their ability to discover previously </span><span class="No-Break"><span class="koboSpan" id="kobo.525.1">undiscovered evidence.</span></span></p>
<h2 id="_idParaDest-309"><a id="_idTextAnchor317"/><span class="koboSpan" id="kobo.526.1">Autopsy</span></h2>
<p><span class="koboSpan" id="kobo.527.1">Many of the </span><a id="_idIndexMarker1613"/><span class="koboSpan" id="kobo.528.1">forensic tools that are available can ingest threat</span><a id="_idIndexMarker1614"/><span class="koboSpan" id="kobo.529.1"> intelligence to aid incident response analysts. </span><span class="koboSpan" id="kobo.529.2">For example, disk forensics platforms, discussed in </span><a href="B18571_11.xhtml#_idTextAnchor188"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.530.1">Chapter 11</span></em></span></a><span class="koboSpan" id="kobo.531.1">, can ingest hashes from threat intelligence feeds to search for IOCs. </span><span class="koboSpan" id="kobo.531.2">In addition to commercial disk forensics tools, the Autopsy platform can conduct searches against a hash set. </span><span class="koboSpan" id="kobo.531.3">For example, we can import the MD5 hashes from the HAFNIUM Pulse that we examined in the previous section. </span><span class="koboSpan" id="kobo.531.4">In this case, we will extract the MD5 hashes from the CSV file that was downloaded, as seen in the following screenshot, and input that </span><span class="No-Break"><span class="koboSpan" id="kobo.532.1">into Autopsy.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer374">
<span class="koboSpan" id="kobo.533.1"><img alt="Figure 17.22 – IOC CSV file " src="image/B18571_17_022.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.534.1">Figure 17.22 – IOC CSV file</span></p>
<p><span class="koboSpan" id="kobo.535.1">From here, the hash values can be loaded </span><span class="No-Break"><span class="koboSpan" id="kobo.536.1">into Autopsy:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.537.1">First, open Autopsy, and from the home page, click on </span><strong class="bold"><span class="koboSpan" id="kobo.538.1">Tools</span></strong><span class="koboSpan" id="kobo.539.1"> and then </span><strong class="bold"><span class="koboSpan" id="kobo.540.1">Options</span></strong><span class="koboSpan" id="kobo.541.1">. </span><span class="koboSpan" id="kobo.541.2">Find the </span><strong class="bold"><span class="koboSpan" id="kobo.542.1">Hash Sets</span></strong><span class="koboSpan" id="kobo.543.1"> icon and click </span><span class="No-Break"><span class="koboSpan" id="kobo.544.1">on it:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer375">
<span class="koboSpan" id="kobo.545.1"><img alt="Figure 17.23 – Autopsy Hash Sets upload " src="image/B18571_17_023.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.546.1">Figure 17.23 – Autopsy Hash Sets upload</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.547.1">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.548.1">New Hash Set</span></strong><span class="koboSpan" id="kobo.549.1"> and </span><a id="_idIndexMarker1615"/><span class="koboSpan" id="kobo.550.1">the following window </span><span class="No-Break"><span class="koboSpan" id="kobo.551.1">will appear:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer376">
<span class="koboSpan" id="kobo.552.1"><img alt="Figure 17.24 – Create Hash Set " src="image/B18571_17_024.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.553.1">Figure 17.24 – Create Hash Set</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.554.1">Enter a name </span><a id="_idIndexMarker1616"/><span class="koboSpan" id="kobo.555.1">for the hash set database. </span><span class="koboSpan" id="kobo.555.2">In this case, </span><strong class="source-inline"><span class="koboSpan" id="kobo.556.1">HAFNIUM</span></strong><span class="koboSpan" id="kobo.557.1"> is a good selection as the hash files are associated with exploits leveraging that vulnerability. </span><span class="koboSpan" id="kobo.557.2">Click </span><strong class="bold"><span class="koboSpan" id="kobo.558.1">Save As</span></strong><span class="koboSpan" id="kobo.559.1">, and an Explorer window will open. </span><span class="koboSpan" id="kobo.559.2">This provides a location for the database that will be created. </span><span class="koboSpan" id="kobo.559.3">It is fine to leave the default location. </span><span class="koboSpan" id="kobo.559.4">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.560.1">OK</span></strong><span class="koboSpan" id="kobo.561.1">. </span></li>
<li><span class="koboSpan" id="kobo.562.1">In the next window, click on </span><strong class="bold"><span class="koboSpan" id="kobo.563.1">Add Hashes to Database</span></strong><span class="koboSpan" id="kobo.564.1">. </span><span class="koboSpan" id="kobo.564.2">A window will appear that allows for the input of hash values. </span><span class="koboSpan" id="kobo.564.3">Copy the MD5 hashes from the HAFNIUM intelligence report and paste them into </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">the window:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer377">
<span class="koboSpan" id="kobo.566.1"><img alt="Figure 17.25 – Hash values " src="image/B18571_17_025.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.567.1">Figure 17.25 – Hash values</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.568.1">Click </span><strong class="bold"><span class="koboSpan" id="kobo.569.1">OK</span></strong><span class="koboSpan" id="kobo.570.1"> and </span><a id="_idIndexMarker1617"/><span class="koboSpan" id="kobo.571.1">the</span><a id="_idIndexMarker1618"/><span class="koboSpan" id="kobo.572.1"> following window should appear after the hash values have been added successfully. </span><span class="No-Break"><span class="koboSpan" id="kobo.573.1">Click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.574.1">OK</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer378">
<span class="koboSpan" id="kobo.576.1"><img alt="Figure 17.26 – Hash set upload " src="image/B18571_17_026.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.577.1">Figure 17.26 – Hash set upload</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.578.1">On the final screen, click </span><strong class="bold"><span class="koboSpan" id="kobo.579.1">Apply</span></strong><span class="koboSpan" id="kobo.580.1"> and then </span><strong class="bold"><span class="koboSpan" id="kobo.581.1">OK</span></strong><span class="koboSpan" id="kobo.582.1">. </span><span class="koboSpan" id="kobo.582.2">At this point, the hashes have been loaded into </span><span class="No-Break"><span class="koboSpan" id="kobo.583.1">the database.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.584.1">This capability allows analysts to search through disk images for matching hashes. </span><span class="koboSpan" id="kobo.584.2">This is a much more efficient way to search for evidence than attempting to find the files through other methods. </span><span class="koboSpan" id="kobo.584.3">Autopsy also allows different databases depending on the incident. </span><span class="koboSpan" id="kobo.584.4">This ability to continually feed updated information allows analysts to find evidence of a new type of compromise from an event from a week or two ago that would have</span><a id="_idIndexMarker1619"/><span class="koboSpan" id="kobo.585.1"> gone</span><a id="_idIndexMarker1620"/><span class="koboSpan" id="kobo.586.1"> undetected if using traditional searching. </span></p>
<h2 id="_idParaDest-310"><a id="_idTextAnchor318"/><span class="koboSpan" id="kobo.587.1">Maltego</span></h2>
<p><span class="koboSpan" id="kobo.588.1">One tool </span><a id="_idIndexMarker1621"/><span class="koboSpan" id="kobo.589.1">that</span><a id="_idIndexMarker1622"/><span class="koboSpan" id="kobo.590.1"> is useful for searching a variety of intelligence sources related to an IOC is Maltego. </span><span class="koboSpan" id="kobo.590.2">This tool utilizes transforms that connect the platform to third-party sources such as VirusTotal. </span><span class="koboSpan" id="kobo.590.3">This allows the analyst to search various sources for additional context on an indicator such as a file hash, IP address, or domain. </span><span class="koboSpan" id="kobo.590.4">There are several pricing tiers, but Paterva, the company that has </span><a id="_idIndexMarker1623"/><span class="koboSpan" id="kobo.591.1">developed Maltego, makes a community edition available </span><span class="No-Break"><span class="koboSpan" id="kobo.592.1">at </span></span><a href="https://www.maltego.com/downloads/"><span class="No-Break"><span class="koboSpan" id="kobo.593.1">https://www.maltego.com/downloads/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.594.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.595.1">Once it's downloaded, you will need to provide an email address and password to configure an account. </span><span class="koboSpan" id="kobo.595.2">Once installed and signed in, the following screen </span><span class="No-Break"><span class="koboSpan" id="kobo.596.1">will appear:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer379">
<span class="koboSpan" id="kobo.597.1"><img alt="Figure 17.27 – Maltego GUI " src="image/B18571_17_027.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.598.1">Figure 17.27 – Maltego GUI</span></p>
<p><span class="koboSpan" id="kobo.599.1">The right side of the GUI is the Transform Hub. </span><span class="koboSpan" id="kobo.599.2">This is where the user can download and configure the specific tools that are used to pull data from various sources. </span><span class="koboSpan" id="kobo.599.3">In this case, we select the </span><strong class="bold"><span class="koboSpan" id="kobo.600.1">VirusTotal (Public API)</span></strong><span class="koboSpan" id="kobo.601.1"> transform. </span><span class="koboSpan" id="kobo.601.2">It is worth noting that the community edition has limited transforms. </span><span class="koboSpan" id="kobo.601.3">This is sufficient for testing and some limited research but if you need more information, consider purchasing a licensed copy. </span><span class="koboSpan" id="kobo.601.4">Hovering </span><a id="_idIndexMarker1624"/><span class="koboSpan" id="kobo.602.1">the </span><a id="_idIndexMarker1625"/><span class="koboSpan" id="kobo.603.1">cursor on the VirusTotal transform brings up the </span><span class="No-Break"><span class="koboSpan" id="kobo.604.1">following window:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer380">
<span class="koboSpan" id="kobo.605.1"><img alt="Figure 17.28 – VirusTotal transform " src="image/B18571_17_028.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.606.1">Figure 17.28 – VirusTotal transform</span></p>
<p><span class="koboSpan" id="kobo.607.1">A dialog box will appear, click </span><strong class="bold"><span class="koboSpan" id="kobo.608.1">Yes</span></strong><span class="koboSpan" id="kobo.609.1"> to install the transform. </span><span class="koboSpan" id="kobo.609.2">The following window </span><span class="No-Break"><span class="koboSpan" id="kobo.610.1">will appear:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer381">
<span class="koboSpan" id="kobo.611.1"><img alt="Figure 17.29 – VirusTotal transform API " src="image/B18571_17_029.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.612.1">Figure 17.29 – VirusTotal transform API</span></p>
<p><span class="koboSpan" id="kobo.613.1">The VirusTotal</span><a id="_idIndexMarker1626"/><span class="koboSpan" id="kobo.614.1"> transform</span><a id="_idIndexMarker1627"/><span class="koboSpan" id="kobo.615.1"> requires an API key from </span><a id="_idIndexMarker1628"/><span class="koboSpan" id="kobo.616.1">VirusTotal. </span><span class="koboSpan" id="kobo.616.2">This can be obtained by creating an account on VirusTotal. </span><span class="koboSpan" id="kobo.616.3">The API key is free and allows Maltego to run the queries from VirusTotal. </span><span class="koboSpan" id="kobo.616.4">Once the API key is entered, click </span><strong class="bold"><span class="koboSpan" id="kobo.617.1">OK</span></strong><span class="koboSpan" id="kobo.618.1">. </span><span class="koboSpan" id="kobo.618.2">You can repeat this process for any additional transforms. </span><span class="koboSpan" id="kobo.618.3">For example, AlienVault OTX also has a transform that is useful when conducting </span><span class="No-Break"><span class="koboSpan" id="kobo.619.1">incident investigations.</span></span></p>
<p><span class="koboSpan" id="kobo.620.1">Now that we have some transforms installed, we can start using Maltego. </span><span class="koboSpan" id="kobo.620.2">Click on the upper left-hand corner circle and click </span><strong class="bold"><span class="koboSpan" id="kobo.621.1">New</span></strong><span class="koboSpan" id="kobo.622.1">. </span><span class="koboSpan" id="kobo.622.2">This will open a new graph as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.623.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer382">
<span class="koboSpan" id="kobo.624.1"><img alt="Figure 17.30 – Maltego New Graph " src="image/B18571_17_030.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.625.1">Figure 17.30 – Maltego New Graph</span></p>
<p><span class="koboSpan" id="kobo.626.1">On the</span><a id="_idIndexMarker1629"/><span class="koboSpan" id="kobo.627.1"> left-hand </span><a id="_idIndexMarker1630"/><span class="koboSpan" id="kobo.628.1">side of the GUI is </span><strong class="bold"><span class="koboSpan" id="kobo.629.1">Entity Palette</span></strong><span class="koboSpan" id="kobo.630.1">. </span><span class="koboSpan" id="kobo.630.2">These are the specific types of IOCs that Maltego can search and graph for the user. </span><span class="koboSpan" id="kobo.630.3">In this case, we will look at a simple IP address, 138.68.79.195, to determine what relationship it has to any other indicators. </span><span class="koboSpan" id="kobo.630.4">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.631.1">Ipv4 Address</span></strong><span class="koboSpan" id="kobo.632.1"> in </span><strong class="bold"><span class="koboSpan" id="kobo.633.1">Entity Palette</span></strong><span class="koboSpan" id="kobo.634.1"> and drag it into the center screen, then cut and paste the IP address. </span><span class="koboSpan" id="kobo.634.2">Right-click on the entity, and the </span><strong class="bold"><span class="koboSpan" id="kobo.635.1">Run Transforms</span></strong><span class="koboSpan" id="kobo.636.1"> window </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1">will open:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer383">
<span class="koboSpan" id="kobo.638.1"><img alt="Figure 17.31 – Run Transforms " src="image/B18571_17_031.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.639.1">Figure 17.31 – Run Transforms</span></p>
<p><span class="koboSpan" id="kobo.640.1">For this </span><a id="_idIndexMarker1631"/><span class="koboSpan" id="kobo.641.1">example, we </span><a id="_idIndexMarker1632"/><span class="koboSpan" id="kobo.642.1">will look at running the AlienVault OTX transform. </span><span class="koboSpan" id="kobo.642.2">Click the right arrow. </span><span class="koboSpan" id="kobo.642.3">The transform will query AlienVault OTX for any related entities or IOCs related to the </span><span class="No-Break"><span class="koboSpan" id="kobo.643.1">IP address:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer384">
<span class="koboSpan" id="kobo.644.1"><img alt="Figure 17.32 – IP address graph " src="image/B18571_17_032.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.645.1">Figure 17.32 – IP address graph</span></p>
<p><span class="koboSpan" id="kobo.646.1">In this case, the</span><a id="_idIndexMarker1633"/><span class="koboSpan" id="kobo.647.1"> transform</span><a id="_idIndexMarker1634"/><span class="koboSpan" id="kobo.648.1"> found several domain registrations, an IP address, URLs, and a file hash associated with malware. </span><span class="koboSpan" id="kobo.648.2">The same process can be repeated for the hash. </span><span class="koboSpan" id="kobo.648.3">Here, the VirusTotal transform is run against the malware entity, which indicates that the IP address is associated with the post-exploitation tool </span><span class="No-Break"><span class="koboSpan" id="kobo.649.1">Cobalt Strike:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer385">
<span class="koboSpan" id="kobo.650.1"><img alt="Figure 17.33 – VirusTotal hash return " src="image/B18571_17_033.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.651.1">Figure 17.33 – VirusTotal hash return</span></p>
<p><span class="koboSpan" id="kobo.652.1">Maltego is a useful tool for uncovering the relationship between IOCs and the larger adversary infrastructure. </span><span class="koboSpan" id="kobo.652.2">As we saw, a simple IP address that may have been found in a review of firewall logs can be turned into a profile of the adversary, their infrastructure, and their tools by leveraging OSINT sources. </span><span class="koboSpan" id="kobo.652.3">Along with being useful in uncovering links between IOCs, OSINT can be used to detect the presence of hidden malware or other exploits </span><a id="_idIndexMarker1635"/><span class="koboSpan" id="kobo.653.1">using </span><a id="_idIndexMarker1636"/><span class="koboSpan" id="kobo.654.1">the YARA rules discussed in the </span><span class="No-Break"><span class="koboSpan" id="kobo.655.1">last chapter.</span></span></p>
<h2 id="_idParaDest-311"><a id="_idTextAnchor319"/><span class="koboSpan" id="kobo.656.1">YARA and Loki</span></h2>
<p><span class="koboSpan" id="kobo.657.1">In the previous</span><a id="_idIndexMarker1637"/><span class="koboSpan" id="kobo.658.1"> chapter</span><a id="_idIndexMarker1638"/><span class="koboSpan" id="kobo.659.1"> on </span><a id="_idIndexMarker1639"/><span class="koboSpan" id="kobo.660.1">malware, we</span><a id="_idIndexMarker1640"/><span class="koboSpan" id="kobo.661.1"> looked at the pattern-matching tool YARA, including how to create rules. </span><span class="koboSpan" id="kobo.661.2">In this example, we are going to look at applying a wide range of YARA rules through a scanner that will attempt to identify files or executables that match the pattern. </span></p>
<p><span class="koboSpan" id="kobo.662.1">A good tool for scanning systems with YARA rules is Loki, a simple IOC scanner available at </span><a href="https://github.com/Neo23x0/Loki"><span class="koboSpan" id="kobo.663.1">https://github.com/Neo23x0/Loki</span></a><span class="koboSpan" id="kobo.664.1">. </span><span class="koboSpan" id="kobo.664.2">This lightweight platform allows incident response analysts to scan folders, files, or even entire volumes for IOCs such as YARA rules, known bad file hashes, filename IOCs, and known C2 servers. </span><span class="koboSpan" id="kobo.664.3">Out of the box, Loki has an extensive library of IOCs that are updated regularly. </span><span class="koboSpan" id="kobo.664.4">To get started with Loki, take the </span><span class="No-Break"><span class="koboSpan" id="kobo.665.1">following steps:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.666.1">To check a system volume for specific IOCs, download and extract Loki to a USB device or to a local system. </span><span class="koboSpan" id="kobo.666.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.667.1">loki</span></strong><span class="koboSpan" id="kobo.668.1"> folder and the following files are found: </span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer386">
<span class="koboSpan" id="kobo.669.1"><img alt="Figure 17.34 – Loki files " src="image/B18571_17_034.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.670.1">Figure 17.34 – Loki files</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.671.1">Loki </span><a id="_idIndexMarker1641"/><span class="koboSpan" id="kobo.672.1">must</span><a id="_idIndexMarker1642"/><span class="koboSpan" id="kobo.673.1"> be</span><a id="_idIndexMarker1643"/><span class="koboSpan" id="kobo.674.1"> updated</span><a id="_idIndexMarker1644"/><span class="koboSpan" id="kobo.675.1"> with the most current IOCs, so right-click on </span><strong class="bold"><span class="koboSpan" id="kobo.676.1">loki-upgrader</span></strong><span class="koboSpan" id="kobo.677.1"> and run as administrator. </span><span class="koboSpan" id="kobo.677.2">The upgrader will run, updating both the executable and the signature files. </span><span class="koboSpan" id="kobo.677.3">Once completed, the updater </span><span class="No-Break"><span class="koboSpan" id="kobo.678.1">will close.</span></span></li>
<li><span class="koboSpan" id="kobo.679.1">Navigate back to the Loki file and a new file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">signature-base</span></strong><span class="koboSpan" id="kobo.681.1"> will have </span><span class="No-Break"><span class="koboSpan" id="kobo.682.1">been added:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer387">
<span class="koboSpan" id="kobo.683.1"><img alt="Figure 17.35 – The signature-base file " src="image/B18571_17_035.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.684.1">Figure 17.35 – The signature-base file</span></p>
<p><span class="koboSpan" id="kobo.685.1">This </span><a id="_idIndexMarker1645"/><span class="koboSpan" id="kobo.686.1">folder </span><a id="_idIndexMarker1646"/><span class="koboSpan" id="kobo.687.1">contains </span><a id="_idIndexMarker1647"/><span class="koboSpan" id="kobo.688.1">all </span><a id="_idIndexMarker1648"/><span class="koboSpan" id="kobo.689.1">of the IOCs that Loki can search for a volume against. </span><span class="koboSpan" id="kobo.689.2">This also allows analysts who create their own YARA rules to load them into the file as well, giving them the ability to customize </span><span class="No-Break"><span class="koboSpan" id="kobo.690.1">the solution.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.691.1">To run a scan of a system, right-click on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.692.1">loki.exe</span></strong><span class="koboSpan" id="kobo.693.1"> application and run it as an administrator. </span><span class="koboSpan" id="kobo.693.2">This will start the executable and open the </span><span class="No-Break"><span class="koboSpan" id="kobo.694.1">following window:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer388">
<span class="koboSpan" id="kobo.695.1"><img alt="Figure 17.36 – Loki scan " src="image/B18571_17_036.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.696.1">Figure 17.36 – Loki scan</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.697.1">After </span><a id="_idIndexMarker1649"/><span class="koboSpan" id="kobo.698.1">the </span><a id="_idIndexMarker1650"/><span class="koboSpan" id="kobo.699.1">ruleset </span><a id="_idIndexMarker1651"/><span class="koboSpan" id="kobo.700.1">is </span><a id="_idIndexMarker1652"/><span class="koboSpan" id="kobo.701.1">updated, Loki will then begin searching the volume for any matching patterns </span><span class="No-Break"><span class="koboSpan" id="kobo.702.1">or IOCs:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer389">
<span class="koboSpan" id="kobo.703.1"><img alt="Figure 17.37 – Loki scan output " src="image/B18571_17_037.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.704.1">Figure 17.37 – Loki scan output</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.705.1">Any </span><a id="_idIndexMarker1653"/><span class="koboSpan" id="kobo.706.1">matching</span><a id="_idIndexMarker1654"/><span class="koboSpan" id="kobo.707.1"> rules </span><a id="_idIndexMarker1655"/><span class="koboSpan" id="kobo.708.1">will</span><a id="_idIndexMarker1656"/><span class="koboSpan" id="kobo.709.1"> show up in red. </span><span class="koboSpan" id="kobo.709.2">In this case, Loki has hit on the tool Nmap, which is often used to scan internal networks for both legitimate and </span><span class="No-Break"><span class="koboSpan" id="kobo.710.1">malicious reasons:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer390">
<span class="koboSpan" id="kobo.711.1"><img alt="Figure 17.38 – Loki scan hit " src="image/B18571_17_038.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.712.1">Figure 17.38 – Loki scan hit</span></p>
<p><span class="koboSpan" id="kobo.713.1">From here, the analyst can take note of any hits and conduct an examination later. </span><span class="koboSpan" id="kobo.713.2">Another key feature is that Loki can be deployed on multiple systems as part of the triage of systems that have possibly been infected with a new strain of malware. </span><span class="koboSpan" id="kobo.713.3">For example, an incident response analyst may be able to search for the IOC of the Petya ransomware attack using YARA rules taken from a threat intelligence provider, such as ReversingLabs, which </span><a id="_idIndexMarker1657"/><span class="koboSpan" id="kobo.714.1">includes a download of the YARA rules from </span><span class="No-Break"><span class="koboSpan" id="kobo.715.1">GitHub: </span></span><a href="https://github.com/reversinglabs/reversinglabs-yara-rules"><span class="No-Break"><span class="koboSpan" id="kobo.716.1">https://github.com/reversinglabs/reversinglabs-yara-rules</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.717.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.718.1">From here, the YARA rules can then be fed into Loki or another platform and utilized to triage suspected systems. </span></p>
<p><span class="koboSpan" id="kobo.719.1">The number of tools that an incident response analyst can bring to bear is increasing every day. </span><span class="koboSpan" id="kobo.719.2">These include commercial tools and freeware tools that integrate a variety of threat intelligence feeds and functionality. </span><span class="koboSpan" id="kobo.719.3">These tools can be used proactively to detect and alert as well </span><a id="_idIndexMarker1658"/><span class="koboSpan" id="kobo.720.1">as</span><a id="_idIndexMarker1659"/><span class="koboSpan" id="kobo.721.1"> investigate</span><a id="_idIndexMarker1660"/><span class="koboSpan" id="kobo.722.1"> an </span><a id="_idIndexMarker1661"/><span class="koboSpan" id="kobo.723.1">incident in progress. </span><span class="koboSpan" id="kobo.723.2">CSIRTs should make a concerted effort to examine these tools and integrate them into their processes. </span><span class="koboSpan" id="kobo.723.3">Doing so will aid them in detecting and efficiently investigating </span><span class="No-Break"><span class="koboSpan" id="kobo.724.1">an incident.</span></span></p>
<h1 id="_idParaDest-312"><a id="_idTextAnchor320"/><span class="koboSpan" id="kobo.725.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.726.1">Sun Tzu’s </span><em class="italic"><span class="koboSpan" id="kobo.727.1">The Art of War</span></em><span class="koboSpan" id="kobo.728.1"> includes the strategic concept of knowing your adversary and knowing yourself. </span><span class="koboSpan" id="kobo.728.2">Through this, you can be confident in your ability to prevail in the contest. </span><span class="koboSpan" id="kobo.728.3">Threat intelligence has quickly become a critical component of an organization’s proactive security controls, as well as an important factor in its ability to respond to an incident. </span><span class="koboSpan" id="kobo.728.4">This chapter examined the emerging techniques and methodologies of cyber threat intelligence and the sources, technology, and methods to put this data to use. </span></p>
<p><span class="koboSpan" id="kobo.729.1">To move forward, organizations looking to leverage the advantages that threat intelligence provides must first understand the threat. </span><span class="koboSpan" id="kobo.729.2">From there, they can define their requirements and begin the intelligence process. </span><span class="koboSpan" id="kobo.729.3">Finally, by integrating their toolset to utilize threat intelligence, they can position themselves to have more effective proactive controls and the ability to respond efficiently. </span><span class="koboSpan" id="kobo.729.4">While threat intelligence may not remove the fear of an adversary entirely, it allows organizations a good deal more ammunition to combat today’s threats. </span><span class="koboSpan" id="kobo.729.5">Threat intelligence also serves an important function when looking at the proactive practice of identifying threats in an environment through threat hunting, which is the subject of a later chapter. </span><span class="koboSpan" id="kobo.729.6">Before we get into hunting, we are going to examine a specific type of </span><span class="No-Break"><span class="koboSpan" id="kobo.730.1">threat: ransomware.</span></span></p>
<h1 id="_idParaDest-313"><a id="_idTextAnchor321"/><span class="koboSpan" id="kobo.731.1">Questions</span></h1>
<ol>
<li value="1"><span class="koboSpan" id="kobo.732.1">What is not a key element of intelligence? </span><ol><li><span class="koboSpan" id="kobo.733.1">Indicator of compromise </span></li><li><span class="koboSpan" id="kobo.734.1">Utility </span></li><li><span class="koboSpan" id="kobo.735.1">Evidence-based </span></li><li><span class="koboSpan" id="kobo.736.1">Actionable </span></li></ol></li>
<li><span class="koboSpan" id="kobo.737.1">Which of the following is part of the cyber kill chain? </span><ol><li><span class="koboSpan" id="kobo.738.1">Phishing </span></li><li><span class="koboSpan" id="kobo.739.1">Weaponization </span></li><li><span class="koboSpan" id="kobo.740.1">Malware </span></li><li><span class="koboSpan" id="kobo.741.1">IOC </span></li></ol></li>
<li><span class="koboSpan" id="kobo.742.1">TTPs describe actions taken by adversaries during a network attack. </span><ol><li><span class="koboSpan" id="kobo.743.1">True </span></li><li><span class="koboSpan" id="kobo.744.1">False </span></li></ol></li>
<li><span class="koboSpan" id="kobo.745.1">Which is not a threat intelligence type? </span><ol><li><span class="koboSpan" id="kobo.746.1">Operational </span></li><li><span class="koboSpan" id="kobo.747.1">Strategic </span></li><li><span class="koboSpan" id="kobo.748.1">Defense </span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.749.1">Tactical</span></span></li></ol></li>
</ol>
<h1 id="_idParaDest-314"><a id="_idTextAnchor322"/><span class="koboSpan" id="kobo.750.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.751.1">Refer to the following for more details on the topics covered in </span><span class="No-Break"><span class="koboSpan" id="kobo.752.1">this chapter:</span></span></p>
<ul>
<li><em class="italic"><span class="koboSpan" id="kobo.753.1">Operationalizing Threat </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.754.1">Intelligence</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.755.1">: </span></span><a href="https://www.packtpub.com/product/operationalizing-threat-intelligence/9781801814683"><span class="No-Break"><span class="koboSpan" id="kobo.756.1">https://www.packtpub.com/product/operationalizing-threat-intelligence/9781801814683</span></span></a></li>
<li><span class="koboSpan" id="kobo.757.1">What Is Threat Intelligence? </span><span class="koboSpan" id="kobo.757.2">Definition and Examples: </span><a href="https://www.recordedfuture.com/threat-intelligence-definition/Threats/Vulnerabilities"><span class="koboSpan" id="kobo.758.1">https://www.recordedfuture.com/threat-intelligence-definition/Threats/Vulnerabilities</span></a><span class="koboSpan" id="kobo.759.1">: </span><a href="https://www.sans.org/reading-room/whitepapers/threats/paper/38790"><span class="koboSpan" id="kobo.760.1">https://www.sans.org/reading-room/whitepapers/threats/paper/38790</span></a><span class="hidden"> </span></li>
<li><span class="koboSpan" id="kobo.761.1">Yara GitHub repository: </span><a href="https://github.com/VirusTotal/yara"><span class="koboSpan" id="kobo.762.1">https://github.com/VirusTotal/yara</span></a> </li>
<li><span class="koboSpan" id="kobo.763.1">Suricata: </span><a href="https://suricata-ids.org/"><span class="koboSpan" id="kobo.764.1">https://suricata-ids.org/</span></a> </li>
<li><span class="koboSpan" id="kobo.765.1">The Zeek Network Security Monitor: </span><a href="https://www.zeek.org/"><span class="koboSpan" id="kobo.766.1">https://www.zeek.org/</span></a> </li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.767.1">Snort: </span></span><a href="https://www.snort.org/"><span class="No-Break"><span class="koboSpan" id="kobo.768.1">https://www.snort.org/</span></span></a></li>
</ul>
</div>
</body></html>