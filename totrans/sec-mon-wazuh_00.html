<html><head></head><body>
<div><h1 id="_idParaDest-6"><a id="_idTextAnchor005"/>Preface</h1>
<p>Hi there! Welcome to <em class="italic">Security Monitoring Using Wazuh</em>. In this book, we will explore the realm of security operations and management using Wazuh – an open source security platform that unifies <strong class="bold">Security Incident and Event Management</strong> (<strong class="bold">SIEM</strong>) and <strong class="bold">Extended Detection and Response</strong> (<strong class="bold">XDR</strong>) capabilities – to enhance threat detection, incident response, threat hunting, and compliance management within your organizations.</p>
<p>Wazuh combines powerful features such as intrusion detection, log analysis, file integrity monitoring, vulnerability detection, and security configuration assessment into a unified solution.</p>
<p>I will provide relevant information and guide you through the deployment of the Wazuh system, its integration with several third-party security tools, and practical use cases. My expertise in open source derives from two primary sources:</p>
<ul>
<li>A decade of experience in consulting and constructing open-source security solutions within enterprise networks</li>
<li>Insights gleaned from podcasts, interviews, and discussions with industry experts</li>
</ul>
<p>The demand for open-source security tools such as Wazuh is fueled by their affordability, community support, and flexibility, helping organizations to enhance threat detection, incident response, security monitoring, threat intelligence, and compliance management. Learning and gaining hands-on experience with tools such as Wazuh can significantly help aspirant security analysts or professionals in enhancing their skills in intrusion detection, log analysis, incident response, vulnerability management, and custom scripts, directly from a single platform. Engaging with open source communities helps you develop network opportunities and continuous learning, positioning you to become a valuable individual in the cybersecurity industry.</p>
<h1 id="_idParaDest-7"><a id="_idTextAnchor006"/>Who this book is for</h1>
<p>Security analysts, SOC analysts, and security architects can gain practical insights into how to set up a Wazuh platform and leverage it to improve an organization’s security posture.</p>
<p>The three main target audiences for this book are as follows:</p>
<ul>
<li><strong class="bold">Security engineers</strong>: For security engineers, this book offers comprehensive guidance on deploying and configuring Wazuh for intrusion detection, malware detection, security monitoring, and so on.</li>
<li><strong class="bold">Security architects</strong>: They will gain information on designing security infrastructure with Wazuh as a core component, enabling them to build a scalable and compliant security solution that effectively mitigates risk and delivers real-time alerts.</li>
<li><strong class="bold">SOC analyst</strong>: They will benefit from practical insights and real-world use cases on the Wazuh platform. They will learn to analyze security alerts, create custom Wazuh rules and decoders, and respond promptly to threats.</li>
</ul>
<h1 id="_idParaDest-8"><a id="_idTextAnchor007"/>What this book covers</h1>
<p><a href="B19549_01.xhtml#_idTextAnchor014"><em class="italic">Chapter 1</em></a>, <em class="italic">Intrusion Detection System (IDS) Using Wazuh</em>, provides fundamentals on IDSs and Suricata and its capabilities and features, installing Wazuh and setting up Suricata, utilizing Suricata in threat detection, handling network scanning probes, identifying Metasploit exploits, simulating web-based attacks with DVWA, and measuring NIDS effectiveness with tmNIDS.</p>
<p><a href="B19549_02.xhtml#_idTextAnchor042"><em class="italic">Chapter 2</em></a>, <em class="italic">Malware Detection Using Wazuh</em>, introduces you to malware, using FIM for detection, integrating VirusTotal for enhanced analysis, and integrating Windows Defender and Sysmon.</p>
<p><a href="B19549_03.xhtml#_idTextAnchor077"><em class="italic">Chapter 3</em></a>, <em class="italic">Threat Intelligence and Analysis</em>, discusses enhancing Wazuh capabilities by integrating threat intelligence and analysis tools such as MISP, TheHive, and Cortex. This chapter includes real-world examples of threat intelligence in a variety of contexts, as well as instructions on configuring and utilizing TheHive, Cortex, and MISP for cooperative threat analysis and response.</p>
<p><a href="B19549_04.xhtml#_idTextAnchor116"><em class="italic">Chapter 4</em></a>, <em class="italic">Security Automation and Orchestration Using Shuffle</em>, covers the integration of <strong class="bold">Security orchestration, Automation, and Response</strong> (<strong class="bold">SOAR</strong>) with the Wazuh platform that can be utilized to streamline and enhance incident response processes. The chapter focuses on the implementation of automated workflows, playbooks, and response actions using Wazuh and Shuffle.</p>
<p><a href="B19549_05.xhtml#_idTextAnchor136"><em class="italic">Chapter 5</em></a>, <em class="italic">Incident Response with Wazuh</em>, focuses on Wazuh’s Active response capability to remediate threats in real time, covering several practical use cases such as blocking brute-force attempts and automatically isolating Windows machines.</p>
<p><a href="B19549_06.xhtml#_idTextAnchor163"><em class="italic">Chapter 6</em></a>, <em class="italic">Threat Hunting with Wazuh</em>, delves into the methodology of proactive threat hunting using Wazuh, focusing on log analysis, attack mapping, Osquery utilization, and command monitoring.</p>
<p><a href="B19549_07.xhtml#_idTextAnchor191"><em class="italic">Chapter 7</em></a>, <em class="italic">Vulnerability and Configuration Assessment</em>, explores vulnerability and policy assessment using Wazuh. It will cover the important parts of finding vulnerabilities, monitoring configurations, and following standard compliance frameworks in a business. This chapter also covers the basics of vulnerability assessment and compliance standards such as PCI DSS, NIST 800-53, and HIPAA. It also provides ideas on how to use Wazuh’s features to make sure your organization follows all of its security rules and policies.</p>
<p><a href="B19549_08.xhtml#_idTextAnchor214"><em class="italic">Chapter 8</em></a>, <em class="italic">Appendix</em> delves into a list of custom Wazuh rules to enhance security monitoring. It explores the creation of custom PowerShell rules to detect suspicious activities within Windows environments. Additionally, the chapter discusses the implementation of custom Auditd rules for auditing Linux systems, bolstering defense against potential threats. Moreover, it provides insights into crafting custom Kaspersky endpoint security rules, enabling comprehensive threat detection and response. Finally, it covers custom Sysmon rules mapped to certain MITRE ATT&amp;CK® techniques.</p>
<p><a href="B19549_09.xhtml#_idTextAnchor244"><em class="italic">Chapter 9</em></a>, <em class="italic">Glossary</em>, provides a comprehensive glossary covering key terms and concepts essential for understanding security monitoring and Wazuh functionality. From <em class="italic">active response</em>, which automates response actions, to <em class="italic">Amazon EC2 instances</em> and beyond, each entry offers concise explanations. Terms such as <em class="italic">compliance</em>, <em class="italic">IDS</em>, and <em class="italic">vulnerability detection module</em> are elucidated, aiding you in grasping crucial security concepts. Additionally, tools such as <em class="italic">PowerShell</em>, <em class="italic">Docker</em>, and <em class="italic">YARA</em> are defined, highlighting their significance in modern cybersecurity practices. This glossary serves as a valuable reference for both novice and experienced security professionals who are navigating the complex landscape of security monitoring and threat detection.</p>
<h1 id="_idParaDest-9"><a id="_idTextAnchor008"/>To get the most out of this book</h1>
<p><em class="italic">You need to have a basic understanding of cybersecurity concepts such as malware, network scanning, web application attacks, and </em><em class="italic">security compliance.</em></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">Software/hardware covered in </strong><strong class="bold">the book</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Operating </strong><strong class="bold">system requirements</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Wazuh OVA</p>
</td>
<td class="No-Table-Style">
<p>Windows and Ubuntu Linux</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Suricata IDS and Osquery</p>
</td>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>VirusTotal</p>
</td>
<td class="No-Table-Style"/>
</tr>
</tbody>
</table>
<h1 id="_idParaDest-10"><a id="_idTextAnchor009"/>Download the example code files</h1>
<p>You can download the code mentioned in the book from the GitHub repository here: <a href="https://github.com/PacktPublishing/Security-Monitoring-using-Wazuh">https://github.com/PacktPublishing/Security-Monitoring-using-Wazuh</a></p>
<p>We also have other code bundles from our rich catalog of books and videos available at <a href="https://github.com/PacktPublishing/">https://github.com/PacktPublishing/</a>. Check them out!</p>
<p class="callout-heading">Disclaimer on images</p>
<p class="callout">This book contains many horizontally long screenshots. These screenshots provide readers with an overview of Wazuh's execution plans for various operations. As a result, the text in these images may appear small at 100% zoom. Additionally, you will be able to examine these plans more thoroughly in the output of Wazuh as you work through the examples.</p>
<p>Conventions used</p>
<p>There are a number of text conventions used throughout this book.</p>
<p><code>Code in text</code>: Indicates code words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles. Here is an example: “Copy the <code>curl</code> command to download the Wazuh module and start the Wazuh agent service as mentioned in the following diagram.”</p>
<p>A block of code is set as follows:</p>
<pre class="source-code">
&lt;rule id="200101" level="1"&gt; 
&lt;if_sid&gt;60009&lt;/if_sid&gt; 
&lt;field name="win.system.providerName"&gt;^PowerShell$&lt;/field&gt; 
&lt;mitre&gt;</pre> <p>When we wish to draw your attention to a particular part of a code block, the relevant lines or items are set in bold:</p>
<pre class="source-code">
<strong class="bold">policy: </strong>
<strong class="bold">   id: "rdp_audit" </strong>
<strong class="bold">   file: "sca_rdp_audit.yml" </strong>
   name: "System audit for Windows based      system" 
   description: "Guidance for establishing a secure configuration for Unix based systems." </pre> <p>Any command-line input or output is written as follows:</p>
<pre class="console">
$ sudo systemctl restart wazuh-agent</pre> <p><strong class="bold">Bold</strong>: Indicates a new term, an important word, or words that you see on screen. For instance, words in menus or dialog boxes appear in <strong class="bold">bold</strong>. Here is an example: “<strong class="bold">Suricata</strong> is an open-source network<strong class="bold"> intrusion detection and prevention </strong><strong class="bold">system (IDS/IPS)</strong>.”</p>
<p class="callout-heading">Tips or important notes</p>
<p class="callout">Appear like this.</p>
<h1 id="_idParaDest-11"><a id="_idTextAnchor010"/>Get in touch</h1>
<p>Feedback from our readers is always welcome.</p>
<p><strong class="bold">General feedback</strong>: If you have questions about any aspect of this book, email us at <a href="mailto:customercare@packtpub.com">customercare@packtpub.com</a> and mention the book title in the subject of your message.</p>
<p><strong class="bold">Errata</strong>: Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit <a href="http://www.packtpub.com/support/errata">www.packtpub.com/support/errata</a> and fill in the form.</p>
<p><strong class="bold">Piracy</strong>: If you come across any illegal copies of our works in any form on the internet, we would be grateful if you would provide us with the location address or website name. Please contact us at <a href="mailto:copyright@packt.com">copyright@packt.com</a> with a link to the material.</p>
<p><strong class="bold">If you are interested in becoming an author</strong>: If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please visit <a href="http://authors.packtpub.com">authors.packtpub.com</a>.</p>
<h1 id="_idParaDest-12"><a id="_idTextAnchor011"/>Share Your Thoughts</h1>
<p>Once you’ve read <em class="italic">Security Monitoring with Wazuh</em>, we’d love to hear your thoughts! Please <a href="https://packt.link/r/1-837-63215-4">click here to go straight to the Amazon review page</a> for this book and share your feedback.</p>
<p>Your review is important to us and the tech community and will help us make sure we’re delivering excellent quality content.</p>
<h1 id="_idParaDest-13"><a id="_idTextAnchor012"/>Download a free PDF copy of this book</h1>
<p>Thanks for purchasing this book!</p>
<p>Do you like to read on the go but are unable to carry your print books everywhere?</p>
<p>Is your eBook purchase not compatible with the device of your choice?</p>
<p>Don’t worry, now with every Packt book you get a DRM-free PDF version of that book at no cost.</p>
<p>Read anywhere, any place, on any device. Search, copy, and paste code from your favorite technical books directly into your application.</p>
<p>The perks don’t stop there, you can get exclusive access to discounts, newsletters, and great free content in your inbox daily</p>
<p>Follow these simple steps to get the benefits:</p>
<ol>
<li>Scan the QR code or visit the link below</li>
</ol>
<div><a href="https://packt.link/free-ebook/9781837632152 ">
<div><img alt="Download a free PDF copy of this book QR Code" src="img/B19549_QR_Free_PDF.jpg"/>
</div>
</a>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a href="https://packt.link/free-ebook/9781837632152">https://packt.link/free-ebook/9781837632152</a></p>
<ol>
<li value="2">Submit your proof of purchase</li>
<li>That’s it! We’ll send your free PDF and other benefits to your email directly</li>
</ol>
</div>


<div><h1 id="_idParaDest-14" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor013"/>Part 1:Threat Detection</h1>
</div>
<div><p>In this part, we will focus on utilizing Wazuh for effective threat detection. You will learn to set up an <strong class="bold">intrusion detection system</strong> (<strong class="bold">IDS</strong>) to discover suspicious traffic. In addition to that, you will also learn the architecture, components, and core capabilities of the Wazuh platform. You will learn about several capabilities of Wazuh to detect malware with some practical use cases.</p>
<p>This part includes the following chapters:</p>
<ul>
<li><a href="B19549_01.xhtml#_idTextAnchor014"><em class="italic">Chapter 1</em></a>, <em class="italic">Intrusion Detection System (IDS) Using Wazuh</em></li>
<li><a href="B19549_02.xhtml#_idTextAnchor042"><em class="italic">Chapter 2</em></a>, <em class="italic">Malware Detection Using Wazuh</em></li>
</ul>
</div>
<div><div></div>
</div>
<div><div></div>
</div>
</body></html>