<html><head></head><body>
<div id="_idContainer352">
<h1 class="chapter-number" id="_idParaDest-277"><a id="_idTextAnchor284"/><span class="koboSpan" id="kobo.1.1">16</span></h1>
<h1 id="_idParaDest-278"><a id="_idTextAnchor285"/><span class="koboSpan" id="kobo.2.1">Malware Analysis for Incident Response</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Malicious software continues to be an ever-evolving scourge on enterprise and consumer systems. </span><span class="koboSpan" id="kobo.3.2">As soon as defenses are created, malware coders create a new strain that has the power to corrupt or destroy a system. </span><span class="koboSpan" id="kobo.3.3">Malware is even being utilized as a weapon against nation states and global organizations. </span><span class="koboSpan" id="kobo.3.4">The majority of data breach incidents involve the use of malware to achieve some goal. </span><span class="koboSpan" id="kobo.3.5">Organizations in every sector of the economy have faced the threat of malware. </span><span class="koboSpan" id="kobo.3.6">With the addition of ransomware attacks such as Conti and Ryuk, organizations have had to spring into action to address </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">these attacks.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">With malware an ever-present risk, it is critical that incident response analysts have some knowledge of the methods and tools utilized in the analysis of malicious code. </span><span class="koboSpan" id="kobo.5.2">It would be impossible to address the complexities of malware analysis in a single chapter. </span><span class="koboSpan" id="kobo.5.3">Therefore, this chapter will focus on the foundational elements of malware analysis, while examining some of the tools that are utilized. </span><span class="koboSpan" id="kobo.5.4">This will give any analyst a solid understanding of these methods, which will allow them to see the results of such an analysis in the context of </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">an incident.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">In this discussion of malware analysis, the following topics will </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">be addressed:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.9.1">Malware </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">analysis overview</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Setting up a </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">malware sandbox</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.13.1">Static analysis</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.14.1">Dynamic analysis</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.15.1">ClamAV</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.16.1">YARA</span></span></li>
</ul>
<h1 id="_idParaDest-279"><a id="_idTextAnchor286"/><span class="koboSpan" id="kobo.17.1">Malware analysis overview</span></h1>
<p><span class="koboSpan" id="kobo.18.1">Malware analysis, or malware reverse engineering, is a highly technical and </span><a id="_idIndexMarker1368"/><span class="koboSpan" id="kobo.19.1">specialized field in forensics. </span><span class="koboSpan" id="kobo.19.2">Antivirus and threat intelligence utilizes a highly trained cadre of programmers and forensic personnel who acquire malware from the wild, and then rip it open to determine what it does, how it does it, and who may be responsible for it. </span><span class="koboSpan" id="kobo.19.3">This is done utilizing two types of analysis: static and dynamic. </span><span class="koboSpan" id="kobo.19.4">Like much of digital forensics, each type of analysis affords some advantages, and incident response analysts should be familiar </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">with both.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.21.1">Malware analysis</span></p>
<p class="callout"><span class="koboSpan" id="kobo.22.1">This chapter just scratches the surface of a highly specialized facet of cyber security. </span><span class="koboSpan" id="kobo.22.2">The intent is to give a few examples of how an analyst can extract actionable IOCs from malware associated with an incident. </span><span class="koboSpan" id="kobo.22.3">For a more detailed treatment of the subject, check out </span><em class="italic"><span class="koboSpan" id="kobo.23.1">Monnappa K A’s Learning Malware Analysis</span></em><span class="koboSpan" id="kobo.24.1">, available </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">at </span></span><a href="https://www.packtpub.com/product/learning-malware-analysis/9781788392501"><span class="No-Break"><span class="koboSpan" id="kobo.26.1">https://www.packtpub.com/product/learning-malware-analysis/9781788392501</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.27.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.28.1">An excellent malware analysis methodology was created by Lenny Zeltser, a malware analysis professional who has an excellent array of resources on his website at </span><a href="https://Zeltser.com"><span class="koboSpan" id="kobo.29.1">https://Zeltser.com</span></a><span class="koboSpan" id="kobo.30.1">. </span><span class="koboSpan" id="kobo.30.2">This methodology comprises the following seven steps that aid analysts in </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">their process:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.32.1">Create a controlled laboratory environment where examinations can </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">be conducted.</span></span></li>
<li><span class="koboSpan" id="kobo.34.1">Examine the behavior of the suspected malware as it interacts with the </span><strong class="bold"><span class="koboSpan" id="kobo.35.1">operating system</span></strong><span class="koboSpan" id="kobo.36.1"> (</span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.37.1">OS</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">) environment.</span></span></li>
<li><span class="koboSpan" id="kobo.39.1">Examine the suspicious application’s code, to gain a sense of the </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">inner workings.</span></span></li>
<li><span class="koboSpan" id="kobo.41.1">Perform dynamic analysis to determine what actions to take that could not be identified in </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">static analysis.</span></span></li>
<li><span class="koboSpan" id="kobo.43.1">Determine if the malware is packed and unpack it </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">as necessary.</span></span></li>
<li><span class="koboSpan" id="kobo.45.1">Continue the process until the analysis objectives have </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">been completed.</span></span></li>
<li><span class="koboSpan" id="kobo.47.1">Prepare a supplement to the forensics reporting and return the laboratory to its state before </span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">the analysis.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.49.1">Generally, malware analysis </span><a id="_idIndexMarker1369"/><span class="koboSpan" id="kobo.50.1">can be divided into four separate categories, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.51.1">Figure 16</span></em></span><em class="italic"><span class="koboSpan" id="kobo.52.1">.1</span></em><span class="koboSpan" id="kobo.53.1">, based on a similar diagram created by SANS instructor Allissa Torres. </span><span class="koboSpan" id="kobo.53.2">These four categories differ in terms of their tools, techniques, and difficulty. </span><span class="koboSpan" id="kobo.53.3">The first and easiest technique to execute is </span><em class="italic"><span class="koboSpan" id="kobo.54.1">Fully Automated Analysis</span></em><span class="koboSpan" id="kobo.55.1">. </span><span class="koboSpan" id="kobo.55.2">In </span><a id="_idIndexMarker1370"/><span class="koboSpan" id="kobo.56.1">this instance, a copy of the malware is executed in a malware sandbox, an environment created to execute malware so that an understanding of its behavior can be ascertained within a relatively short period. </span><span class="koboSpan" id="kobo.56.2">This provides a good picture of the malware’s behavior and IOCs. </span><span class="koboSpan" id="kobo.56.3">What this method does not provide is a detailed analysis of the code, which may uncover other specifics, such as potential vulnerabilities leveraged or specific software it may </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">be targeting:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer329">
<span class="koboSpan" id="kobo.58.1"><img alt="Figure 16.1 – Malware analysis categories " src="image/B18571_16_001.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.59.1">Figure 16.1 – Malware analysis categories</span></p>
<p><span class="koboSpan" id="kobo.60.1">The next technique</span><a id="_idIndexMarker1371"/><span class="koboSpan" id="kobo.61.1"> is </span><em class="italic"><span class="koboSpan" id="kobo.62.1">static property analysis</span></em><span class="koboSpan" id="kobo.63.1">. </span><span class="koboSpan" id="kobo.63.2">In this technique, tools are used to determine the file hash, header, strings, file properties, and other metadata associated with the malicious code. </span><span class="koboSpan" id="kobo.63.3">This technique is also very fast but does require some knowledge of malware to analyze and interpret the results. </span><span class="koboSpan" id="kobo.63.4">Usually, if the file is run through an automated sandbox along with the static properties analyzed, it is sufficient to gain insight into the behaviors of the malware and extract pertinent IOCs related to </span><span class="No-Break"><span class="koboSpan" id="kobo.64.1">an incident.</span></span></p>
<p><span class="koboSpan" id="kobo.65.1">The</span><a id="_idIndexMarker1372"/><span class="koboSpan" id="kobo.66.1"> next two analysis stages involve a little more expertise, tooling, and time. </span><span class="koboSpan" id="kobo.66.2">The third stage, </span><em class="italic"><span class="koboSpan" id="kobo.67.1">interactive behavior analysis</span></em><span class="koboSpan" id="kobo.68.1">, involves using a combination of automated tools and static property analysis to examine specific elements of the malware. </span><span class="koboSpan" id="kobo.68.2">For example, a sample might be executed in a sandbox and specific network behaviors are controlled to determine if the malware attempts to reach out to an external host to download a secondary payload. </span><span class="koboSpan" id="kobo.68.3">This stage affords the analysts much more control over the sandbox environment as they can change parameters based on their observations. </span><span class="koboSpan" id="kobo.68.4">In this case, the analyst can control the sandbox’s network connection and determine what the specific traffic </span><span class="No-Break"><span class="koboSpan" id="kobo.69.1">looks like.</span></span></p>
<p><span class="koboSpan" id="kobo.70.1">The</span><a id="_idIndexMarker1373"/><span class="koboSpan" id="kobo.71.1"> final stage is </span><em class="italic"><span class="koboSpan" id="kobo.72.1">manual code reversing</span></em><span class="koboSpan" id="kobo.73.1">. </span><span class="koboSpan" id="kobo.73.2">As you might expect given the time and difficulty in this stage, this is a highly specialized skill set. </span><span class="koboSpan" id="kobo.73.3">In this stage, the malware sample goes through a reverse engineering process. </span><span class="koboSpan" id="kobo.73.4">While this does take time and skill, this insight is critical to fully understanding the code. </span><span class="koboSpan" id="kobo.73.5">For example, the Stuxnet malware went through extensive reverse engineering where the analysts were able to determine what </span><a id="_idIndexMarker1374"/><span class="koboSpan" id="kobo.74.1">specific </span><strong class="bold"><span class="koboSpan" id="kobo.75.1">Programmable Logic Controllers</span></strong><span class="koboSpan" id="kobo.76.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.77.1">PLCs</span></strong><span class="koboSpan" id="kobo.78.1">) were targeted. </span><span class="koboSpan" id="kobo.78.2">Without this insight, the true intent of the malware may not have </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">been discovered.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.80.1">Stuxnet malware analysis</span></p>
<p class="callout"><span class="koboSpan" id="kobo.81.1">Stuxnet is still</span><a id="_idIndexMarker1375"/><span class="koboSpan" id="kobo.82.1"> widely discussed in cyber security </span><a id="_idIndexMarker1376"/><span class="koboSpan" id="kobo.83.1">and cyber warfare circles, even a decade after it was first discovered. </span><span class="koboSpan" id="kobo.83.2">It is worth exploring Kim Zetter’s research in her book </span><em class="italic"><span class="koboSpan" id="kobo.84.1">Countdown to Zero Day: Stuxnet and the Launch of the World’s First Digital Weapon</span></em><span class="koboSpan" id="kobo.85.1"> and the 2016 documentary </span><em class="italic"><span class="koboSpan" id="kobo.86.1">Zero Days</span></em><span class="koboSpan" id="kobo.87.1">. </span><span class="koboSpan" id="kobo.87.2">Both provide a deep look at how malware reverse engineering played a significant role in uncovering Stuxnet. </span><span class="koboSpan" id="kobo.87.3">A copy of Symantec’s analysis of the Stuxnet virus is included with this book in the supplemental material. </span><span class="koboSpan" id="kobo.87.4">It is a good idea to review it as it provides real insight into the expertise and time necessary to conduct a </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">full analysis.</span></span></p>
<p><span class="koboSpan" id="kobo.89.1">The best approach to extracting the maximum amount of data from a sample of malicious code is to conduct a full examination of the file using static and dynamic analysis techniques. </span><span class="koboSpan" id="kobo.89.2">A full spectrum approach that leverages these techniques provides the surest way to gain the best picture of how a sample of malware operates and what the capabilities and potential targets of the malware are. </span><span class="koboSpan" id="kobo.89.3">A good example of this is examining the analysis that was conducted on the Stuxnet virus, which was used against the Natanz Uranium enrichment facility in Iran. </span><span class="koboSpan" id="kobo.89.4">Exhaustive analysis by researchers at Kaspersky and Symantec provided the cyber and national security community with extensive analysis that showed the sophisticated malware’s capability </span><span class="No-Break"><span class="koboSpan" id="kobo.90.1">and target.</span></span></p>
<p><span class="koboSpan" id="kobo.91.1">There are a </span><a id="_idIndexMarker1377"/><span class="koboSpan" id="kobo.92.1">few challenges with malware reverse engineering when examining the practice of extracting indicators. </span><span class="koboSpan" id="kobo.92.2">First, the tools and techniques for reverse engineering take significant time to acquire. </span><span class="koboSpan" id="kobo.92.3">Reverse engineering is a specialized field and given the amount of malware around, it may be difficult to immediately engage someone to conduct full reverse engineering. </span><span class="koboSpan" id="kobo.92.4">Second, the process itself is time-consuming. </span><span class="koboSpan" id="kobo.92.5">A detailed static analysis where the code is analyzed using binary analysis tools can take time. </span><span class="koboSpan" id="kobo.92.6">If other teams such as Incident Response or the Security Operations Center need indicators to block or pivot into investigating, waiting for complete reverse engineering is </span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">not advised.</span></span></p>
<p><span class="koboSpan" id="kobo.94.1">With these challenges in mind, some tools and techniques can be leveraged by threat intelligence and incident response analysts to extract pertinent indicators and TTPs while they wait for the more detailed results of a complete reverse engineering examination. </span><span class="koboSpan" id="kobo.94.2">We will examine those tools and techniques later in </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">this chapter.</span></span></p>
<h2 id="_idParaDest-280"><a id="_idTextAnchor287"/><span class="koboSpan" id="kobo.96.1">Malware classification</span></h2>
<p><span class="koboSpan" id="kobo.97.1">Malicious</span><a id="_idIndexMarker1378"/><span class="koboSpan" id="kobo.98.1"> software, or malware, is an all-encompassing term for any software that has been created to damage, disable, or produce an unwanted condition within a computer system. </span><span class="koboSpan" id="kobo.98.2">This definition, while functional, is also very broad in its categorization of malware. </span><span class="koboSpan" id="kobo.98.3">There is malware that is coded specifically to steal credit card numbers from payment systems, while other malware is utilized to take control of a system, allowing an attacker to remotely control that system. </span><span class="koboSpan" id="kobo.98.4">Analysts who observe these specific behaviors – such as how a compromised system sends communications out to the internet after infection, or what actions are taken on an infected system – may be able to determine the type of malware, and what the end goal of the attacker </span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">may be.</span></span></p>
<p><span class="koboSpan" id="kobo.100.1">In general, when discussing malware, the following are some of the more </span><span class="No-Break"><span class="koboSpan" id="kobo.101.1">specific categories:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.102.1">Virus</span></strong><span class="koboSpan" id="kobo.103.1">: For a</span><a id="_idIndexMarker1379"/><span class="koboSpan" id="kobo.104.1"> time, the term virus was used for any </span><a id="_idIndexMarker1380"/><span class="koboSpan" id="kobo.105.1">malicious code that had a detrimental impact on a computer system. </span><span class="koboSpan" id="kobo.105.2">As the types of malware increased, the term virus was relegated to mean any code that has an intentionally malicious impact on </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1">a system.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.107.1">Worm</span></strong><span class="koboSpan" id="kobo.108.1">: Often</span><a id="_idIndexMarker1381"/><span class="koboSpan" id="kobo.109.1"> part of a virus, a worm can not only </span><a id="_idIndexMarker1382"/><span class="koboSpan" id="kobo.110.1">have an impact on a system but is also able to self-replicate and impact other systems connected to it. </span><span class="koboSpan" id="kobo.110.2">One of the most famous worms was the Morris worm, which spread worldwide, causing </span><strong class="bold"><span class="koboSpan" id="kobo.111.1">denial-of-service</span></strong><span class="koboSpan" id="kobo.112.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.113.1">DoS</span></strong><span class="koboSpan" id="kobo.114.1">) attacks</span><a id="_idIndexMarker1383"/><span class="koboSpan" id="kobo.115.1"> across the internet </span><span class="No-Break"><span class="koboSpan" id="kobo.116.1">in 1988.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.117.1">Trojan</span></strong><span class="koboSpan" id="kobo.118.1">: The</span><a id="_idIndexMarker1384"/><span class="koboSpan" id="kobo.119.1"> Trojan horse of mythology is the inspiration</span><a id="_idIndexMarker1385"/><span class="koboSpan" id="kobo.120.1"> for this class of malware. </span><span class="koboSpan" id="kobo.120.2">Trojan malware is often hidden within a legitimate application or file. </span><span class="koboSpan" id="kobo.120.3">When an unsuspecting user opens the file, the malware infects the system. </span><span class="koboSpan" id="kobo.120.4">This type of malware often leverages a social engineering attack to infect </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">a system.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.122.1">Keylogger</span></strong><span class="koboSpan" id="kobo.123.1">: This </span><a id="_idIndexMarker1386"/><span class="koboSpan" id="kobo.124.1">specific malware hides in the</span><a id="_idIndexMarker1387"/><span class="koboSpan" id="kobo.125.1"> background of a running system and captures the keystrokes of the user. </span><span class="koboSpan" id="kobo.125.2">It then takes this information and sends it to a controller for review. </span><span class="koboSpan" id="kobo.125.3">Coders who write keyloggers are often interested in </span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">obtaining credentials.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.127.1">Rootkit</span></strong><span class="koboSpan" id="kobo.128.1">: Rootkits</span><a id="_idIndexMarker1388"/><span class="koboSpan" id="kobo.129.1"> are utilized to conceal other</span><a id="_idIndexMarker1389"/><span class="koboSpan" id="kobo.130.1"> malicious code </span><a id="_idIndexMarker1390"/><span class="koboSpan" id="kobo.131.1">such as a </span><strong class="bold"><span class="koboSpan" id="kobo.132.1">Remote Access Trojan</span></strong><span class="koboSpan" id="kobo.133.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.134.1">RAT</span></strong><span class="koboSpan" id="kobo.135.1">), which allows an attacker to take remote command of an </span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">infected system.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.137.1">Information-stealing malware</span></strong><span class="koboSpan" id="kobo.138.1">: Often </span><a id="_idIndexMarker1391"/><span class="koboSpan" id="kobo.139.1">coded for a single purpose, this type of </span><a id="_idIndexMarker1392"/><span class="koboSpan" id="kobo.140.1">malware is used to capture information such as credit card numbers or banking credentials, such as the Shylock malware, which was created specifically to capture </span><span class="No-Break"><span class="koboSpan" id="kobo.141.1">banking logins.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.142.1">Backdoor</span></strong><span class="koboSpan" id="kobo.143.1">: Another </span><a id="_idIndexMarker1393"/><span class="koboSpan" id="kobo.144.1">variation of remote </span><a id="_idIndexMarker1394"/><span class="koboSpan" id="kobo.145.1">access, this type of malware infects a system, and then allows the attacker to take control of the </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">infected system.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.147.1">Downloader</span></strong><span class="koboSpan" id="kobo.148.1">: As </span><a id="_idIndexMarker1395"/><span class="koboSpan" id="kobo.149.1">defenses have become</span><a id="_idIndexMarker1396"/><span class="koboSpan" id="kobo.150.1"> more sophisticated, so have the malware writers. </span><span class="koboSpan" id="kobo.150.2">A downloader is part of a multi-stage malware program. </span><span class="koboSpan" id="kobo.150.3">The downloader often infects a system, and then reaches out to a remote server for the rest of the code. </span><span class="koboSpan" id="kobo.150.4">This method is often utilized to bypass security controls and is useful for enabling malware coders to utilize larger and more </span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">sophisticated malware.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.152.1">Botnet</span></strong><span class="koboSpan" id="kobo.153.1">: A</span><a id="_idIndexMarker1397"/><span class="koboSpan" id="kobo.154.1"> botnet is</span><a id="_idIndexMarker1398"/><span class="koboSpan" id="kobo.155.1"> a series of computers, all controlled through a central system on the internet called a botnet controller. </span><span class="koboSpan" id="kobo.155.2">First, the botnet malware infects a system. </span><span class="koboSpan" id="kobo.155.3">As the number of infected systems </span><a id="_idIndexMarker1399"/><span class="koboSpan" id="kobo.156.1">grows, the malware writers can then utilize this botnet to conduct </span><strong class="bold"><span class="koboSpan" id="kobo.157.1">distributed denial-of-service</span></strong><span class="koboSpan" id="kobo.158.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.159.1">DDoS</span></strong><span class="koboSpan" id="kobo.160.1">) attacks against a </span><span class="No-Break"><span class="koboSpan" id="kobo.161.1">single target.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.162.1">Ransomware</span></strong><span class="koboSpan" id="kobo.163.1">: A </span><a id="_idIndexMarker1400"/><span class="koboSpan" id="kobo.164.1">relatively new type of malware, ransomware</span><a id="_idIndexMarker1401"/><span class="koboSpan" id="kobo.165.1"> encrypts a victim’s files. </span><span class="koboSpan" id="kobo.165.2">The malware then solicits a payment, often in the form of a cryptocurrency such as Bitcoin, from the victim for the </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">decryption key.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.167.1">File wipers</span></strong><span class="koboSpan" id="kobo.168.1">: A</span><a id="_idIndexMarker1402"/><span class="koboSpan" id="kobo.169.1"> file wiper either destroys</span><a id="_idIndexMarker1403"/><span class="koboSpan" id="kobo.170.1"> the files or </span><a id="_idIndexMarker1404"/><span class="koboSpan" id="kobo.171.1">can infect the </span><strong class="bold"><span class="koboSpan" id="kobo.172.1">Master Boot Record</span></strong><span class="koboSpan" id="kobo.173.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.174.1">MBR</span></strong><span class="koboSpan" id="kobo.175.1">) and modify records so that files are no longer accessible to </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">the system.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.177.1">Many of these variants are used together in a chain. </span><span class="koboSpan" id="kobo.177.2">For example, a malware coder may conduct an initial infection of a system, with a RAT disguised as a legitimate application. </span><span class="koboSpan" id="kobo.177.3">When an unsuspecting user opens the application, the code executes itself. </span><span class="koboSpan" id="kobo.177.4">It then downloads a second payload and further infects the system, allowing the coder remote access. </span><span class="koboSpan" id="kobo.177.5">Finally, with remote access, the attack continues, with the attacker identifying a payment system. </span><span class="koboSpan" id="kobo.177.6">From there, they load the second piece of malware onto the payment system and capture cleartext credit </span><span class="No-Break"><span class="koboSpan" id="kobo.178.1">card numbers.</span></span></p>
<p><span class="koboSpan" id="kobo.179.1">Another key aspect of malware is how it has evolved. </span><span class="koboSpan" id="kobo.179.2">There has been an explosion in how many variants of malware there are and the sheer amount of malicious code there is currently in the wild. </span><span class="koboSpan" id="kobo.179.3">Malware is evolving every day, with new techniques of encoding and delivery – as well as execution – changing rapidly. </span><span class="koboSpan" id="kobo.179.4">Analysts would be well advised to make a point of keeping abreast of these changes as they are happening so that they are prepared for the latest, and more </span><span class="No-Break"><span class="koboSpan" id="kobo.180.1">damaging, code.</span></span></p>
<p><span class="koboSpan" id="kobo.181.1">Before getting into static and dynamic analysis, we will look at configuring a </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">malware sandbox.</span></span></p>
<h1 id="_idParaDest-281"><a id="_idTextAnchor288"/><span class="koboSpan" id="kobo.183.1">Setting up a malware sandbox</span></h1>
<p><span class="koboSpan" id="kobo.184.1">One</span><a id="_idIndexMarker1405"/><span class="koboSpan" id="kobo.185.1"> consideration when analyzing malware is how to handle malware in a safe environment without accidentally infecting your system. </span><span class="koboSpan" id="kobo.185.2">The malware sandbox is a controlled environment where analysts can perform both static and dynamic analysis of malware without the risk of infecting a production system. </span><span class="koboSpan" id="kobo.185.3">In this case, we will look at two types of sandboxes; the local sandbox allows analysts to configure a system that is entirely under their control, while the cloud-based option allows analysts to leverage </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">dynamic analysis.</span></span></p>
<h2 id="_idParaDest-282"><a id="_idTextAnchor289"/><span class="koboSpan" id="kobo.187.1">Local sandbox</span></h2>
<p><span class="koboSpan" id="kobo.188.1">A</span><a id="_idIndexMarker1406"/><span class="koboSpan" id="kobo.189.1"> local sandbox is a system that has been configured </span><a id="_idIndexMarker1407"/><span class="koboSpan" id="kobo.190.1">with settings and tools in which an analyst can examine malware in a controlled environment. </span><span class="koboSpan" id="kobo.190.2">One technique to configure a local sandbox is the use of a virtualization hypervisor such as Virtual Box or VMWare and configuring an operating system on top. </span><span class="koboSpan" id="kobo.190.3">There are key advantages to using virtualization for the sandbox. </span><span class="koboSpan" id="kobo.190.4">We have already addressed the first: if the analyst infects the system, it will not impact the production system. </span><span class="koboSpan" id="kobo.190.5">Second is the snapshot feature. </span><span class="koboSpan" id="kobo.190.6">An analyst can configure the sandbox to their preference and then snapshot it. </span><span class="koboSpan" id="kobo.190.7">Once the analysis is complete, they can roll back to the snapshot and have a </span><span class="No-Break"><span class="koboSpan" id="kobo.191.1">fresh installation.</span></span></p>
<p><span class="koboSpan" id="kobo.192.1">The first step in the process is selecting the hypervisor. </span><span class="koboSpan" id="kobo.192.2">From here, Microsoft makes copies of the most popular Windows OSs, including servers, available. </span><span class="koboSpan" id="kobo.192.3">For example, a Windows 10 virtual machine that has already been configured can be downloaded from </span><a href="https://developer.microsoft.com/en-us/windows/downloads/virtual-machines"><span class="koboSpan" id="kobo.193.1">https://developer.microsoft.com/en-us/windows/downloads/virtual-machines</span></a><span class="koboSpan" id="kobo.194.1">, or the Windows 10 ISO can be downloaded </span><span class="No-Break"><span class="koboSpan" id="kobo.195.1">from </span></span><a href="https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise"><span class="No-Break"><span class="koboSpan" id="kobo.196.1">https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.197.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.198.1">Once installed, the analyst can download any tools or scripts to the virtual machine. </span><span class="koboSpan" id="kobo.198.2">This can be time-consuming, depending on the number of tools an analyst wants to include. </span><span class="koboSpan" id="kobo.198.3">Another option is to leverage preconfigured toolkits such as REToolKit, which is available at </span><a href="https://github.com/mentebinaria/retoolkit"><span class="koboSpan" id="kobo.199.1">https://github.com/mentebinaria/retoolkit</span></a><span class="koboSpan" id="kobo.200.1">. </span><span class="koboSpan" id="kobo.200.2">This installer downloads a variety of tools for static and dynamic malware analysis. </span><span class="koboSpan" id="kobo.200.3">Another option is to</span><a id="_idIndexMarker1408"/><span class="koboSpan" id="kobo.201.1"> use the </span><strong class="bold"><span class="koboSpan" id="kobo.202.1">Mandiant FLARE v 2.0</span></strong><span class="koboSpan" id="kobo.203.1">. </span><span class="koboSpan" id="kobo.203.2">FLARE </span><a id="_idIndexMarker1409"/><span class="koboSpan" id="kobo.204.1">utilizes a PowerShell script to download and configure a local sandbox on a variety of Windows platforms. </span><span class="koboSpan" id="kobo.204.2">The installation and usage instructions for</span><a id="_idIndexMarker1410"/><span class="koboSpan" id="kobo.205.1"> FLARE are available </span><span class="No-Break"><span class="koboSpan" id="kobo.206.1">at </span></span><a href="https://github.com/mandiant/flare-vm. "><span class="No-Break"><span class="koboSpan" id="kobo.207.1">https://github.com/mandiant/flare-vm</span></span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">.</span></span></a></p>
<p><span class="koboSpan" id="kobo.209.1">Immediately</span><a id="_idIndexMarker1411"/><span class="koboSpan" id="kobo.210.1"> after completing the sandbox setup, the analyst should take a snapshot of the fresh install. </span><span class="koboSpan" id="kobo.210.2">This will allow the analyst to use a fresh install with every analysis, ensuring that there is no cross-contamination. </span><span class="koboSpan" id="kobo.210.3">It also means that if the analyst accidentally executes malware, they can simply revert to a fresh installation and </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">try again.</span></span></p>
<p><span class="koboSpan" id="kobo.212.1">There are</span><a id="_idIndexMarker1412"/><span class="koboSpan" id="kobo.213.1"> a few considerations concerning configuring a local malware sandbox. </span><span class="koboSpan" id="kobo.213.2">First, ensure that you remove any network connections. </span><span class="koboSpan" id="kobo.213.3">Depending on the hypervisor and how networking is configured, there is a possibility of malware propagating across the network if the virtual machine is sharing network connectivity with other systems. </span><span class="koboSpan" id="kobo.213.4">Additionally, there are strains of malware that can escape a virtual machine. </span><span class="koboSpan" id="kobo.213.5">You should limit your sandboxes to hosts that you can wipe if necessary. </span><span class="koboSpan" id="kobo.213.6">A third consideration is that some variants of malware can identify if they are being executed in a virtual machine. </span><span class="koboSpan" id="kobo.213.7">If the analyst is attempting to execute the malware in a sandbox, it may not execute properly if it is one of these “sandbox-aware” variants. </span><span class="koboSpan" id="kobo.213.8">This can often cause frustration </span><span class="No-Break"><span class="koboSpan" id="kobo.214.1">with analysts.</span></span></p>
<h2 id="_idParaDest-283"><a id="_idTextAnchor290"/><span class="koboSpan" id="kobo.215.1">Cloud sandbox</span></h2>
<p><span class="koboSpan" id="kobo.216.1">An option</span><a id="_idIndexMarker1413"/><span class="koboSpan" id="kobo.217.1"> available to analysts that should supplement</span><a id="_idIndexMarker1414"/><span class="koboSpan" id="kobo.218.1"> their local sandboxes is cloud-based versions. </span><span class="koboSpan" id="kobo.218.2">These are usually commercial or community resources hosted in the cloud. </span><span class="koboSpan" id="kobo.218.3">The analyst can often upload a file or file hash and select the type of operating system; the sandbox does </span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">the rest.</span></span></p>
<p><span class="koboSpan" id="kobo.220.1">The key advantages of using this solution are time and resourcing. </span><span class="koboSpan" id="kobo.220.2">The analyst does not have to maintain a sandbox or go through the stress of trying to get the malware to run. </span><span class="koboSpan" id="kobo.220.3">Further, this solution often provides results in minutes, including detailed reporting on IOCs and </span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">malware behavior.</span></span></p>
<p><span class="koboSpan" id="kobo.222.1">The one key drawback to these types of solutions is that the analyst sometimes has no control over the </span><a id="_idIndexMarker1415"/><span class="koboSpan" id="kobo.223.1">data that the solution is collecting. </span><span class="koboSpan" id="kobo.223.2">For example, open source solutions such as VirusTotal make their results available to anyone. </span><span class="koboSpan" id="kobo.223.3">It is not uncommon for threat actors to</span><a id="_idIndexMarker1416"/><span class="koboSpan" id="kobo.224.1"> monitor such sites for any signs that a target has uploaded a sample. </span><span class="koboSpan" id="kobo.224.2">If you are using a cloud sandbox, it is advisable to use one that does not publish the results to the larger </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1">security community.</span></span></p>
<p><span class="koboSpan" id="kobo.226.1">With a sandbox in place, let’s go ahead and look at static </span><span class="No-Break"><span class="koboSpan" id="kobo.227.1">malware analysis.</span></span></p>
<h1 id="_idParaDest-284"><a id="_idTextAnchor291"/><span class="koboSpan" id="kobo.228.1">Static analysis</span></h1>
<p><span class="koboSpan" id="kobo.229.1">Static analysis </span><a id="_idIndexMarker1417"/><span class="koboSpan" id="kobo.230.1">involves examining the actual malware code without executing it on a system. </span><span class="koboSpan" id="kobo.230.2">For malware researchers, the code may be obtained from systems that are left out to be deliberately infected, or from production systems that have been impacted by </span><span class="No-Break"><span class="koboSpan" id="kobo.231.1">the malware.</span></span></p>
<p><span class="koboSpan" id="kobo.232.1">In this case, incident response analysts can obtain the code or executable through a combination of memory analysis and acquiring the actual executable while analyzing the hard drive. </span><span class="koboSpan" id="kobo.232.2">Static analysis often comprises several different techniques, </span><span class="No-Break"><span class="koboSpan" id="kobo.233.1">as follows:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.234.1">Fingerprinting</span></strong><span class="koboSpan" id="kobo.235.1">: One </span><a id="_idIndexMarker1418"/><span class="koboSpan" id="kobo.236.1">of the most basic</span><a id="_idIndexMarker1419"/><span class="koboSpan" id="kobo.237.1"> techniques is obtaining a cryptographical hash of the code. </span><span class="koboSpan" id="kobo.237.2">These hashes can then be compared to other known hashes to determine if the code has been </span><span class="No-Break"><span class="koboSpan" id="kobo.238.1">seen before.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.239.1">Antivirus scanning</span></strong><span class="koboSpan" id="kobo.240.1">: Antivirus </span><a id="_idIndexMarker1420"/><span class="koboSpan" id="kobo.241.1">vendors</span><a id="_idIndexMarker1421"/><span class="koboSpan" id="kobo.242.1"> often do not catch every virus. </span><span class="koboSpan" id="kobo.242.2">For example, some vendors may have analyzed the code and deployed a signature for their product. </span><span class="koboSpan" id="kobo.242.3">Other vendors may not have had access to the code or deployed a signature. </span><span class="koboSpan" id="kobo.242.4">A good step is to use multiple different antivirus vendors to scan </span><span class="No-Break"><span class="koboSpan" id="kobo.243.1">a file.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.244.1">String extraction</span></strong><span class="koboSpan" id="kobo.245.1">: Malware </span><a id="_idIndexMarker1422"/><span class="koboSpan" id="kobo.246.1">coders will</span><a id="_idIndexMarker1423"/><span class="koboSpan" id="kobo.247.1"> often include IP addresses, error messages, or other data encoded within the malware </span><a id="_idIndexMarker1424"/><span class="koboSpan" id="kobo.248.1">in cleartext. </span><span class="koboSpan" id="kobo.248.2">Finding these strings may allow the analysts to identify a </span><strong class="bold"><span class="koboSpan" id="kobo.249.1">Command and Control</span></strong><span class="koboSpan" id="kobo.250.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.251.1">C2</span></strong><span class="koboSpan" id="kobo.252.1">) server or other data that may indicate the purpose of </span><span class="No-Break"><span class="koboSpan" id="kobo.253.1">the malware.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.254.1">File format</span></strong><span class="koboSpan" id="kobo.255.1">: With</span><a id="_idIndexMarker1425"/><span class="koboSpan" id="kobo.256.1"> any executable, legitimate or not, there is metadata associated with it. </span><span class="koboSpan" id="kobo.256.2">Malware analysts can view the compilation time, functions, strings, menus, and icons of portable executable </span><span class="No-Break"><span class="koboSpan" id="kobo.257.1">format applications.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.258.1">Packer analysis</span></strong><span class="koboSpan" id="kobo.259.1">: To</span><a id="_idIndexMarker1426"/><span class="koboSpan" id="kobo.260.1"> bypass antivirus</span><a id="_idIndexMarker1427"/><span class="koboSpan" id="kobo.261.1"> programs, malware coders make use of packers. </span><span class="koboSpan" id="kobo.261.2">These packers use compression or encryption so that they do not leave a telltale file hash. </span><span class="koboSpan" id="kobo.261.3">There are some tools available but, often, conducting a static analysis against packed malware </span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">is difficult.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.263.1">Disassembly</span></strong><span class="koboSpan" id="kobo.264.1">: Reversing</span><a id="_idIndexMarker1428"/><span class="koboSpan" id="kobo.265.1"> the code by using specialized </span><a id="_idIndexMarker1429"/><span class="koboSpan" id="kobo.266.1">software allows malware analysts to view the assembly code. </span><span class="koboSpan" id="kobo.266.2">From here, the analyst may be able to determine which actions the malware is attempting </span><span class="No-Break"><span class="koboSpan" id="kobo.267.1">to perform.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.268.1">Compared to dynamic analysis, static analysis may seem a bit more laborious. </span><span class="koboSpan" id="kobo.268.2">While a lot of searching and analysis is done by hand, there are some advantages. </span><span class="koboSpan" id="kobo.268.3">First, it is safer to examine the code without having to execute it. </span><span class="koboSpan" id="kobo.268.4">This is especially true in organizations where a comprehensive sandbox solution is not in place. </span><span class="koboSpan" id="kobo.268.5">Also, it provides a more comprehensive analysis and a better understanding of what the malware coder’s intentions </span><span class="No-Break"><span class="koboSpan" id="kobo.269.1">might be.</span></span></p>
<p><span class="koboSpan" id="kobo.270.1">There are </span><a id="_idIndexMarker1430"/><span class="koboSpan" id="kobo.271.1">several disadvantages to static analysis as well. </span><span class="koboSpan" id="kobo.271.2">This technique requires the malware code in its entirety for the best results. </span><span class="koboSpan" id="kobo.271.3">Another key disadvantage is the time necessary to conduct the analysis. </span><span class="koboSpan" id="kobo.271.4">With malware becoming increasingly more complex, the time required for a static analysis may be longer than an organization </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">can afford.</span></span></p>
<p><span class="koboSpan" id="kobo.273.1">This is even more of an issue during an incident where the incident response team may be better off with an analysis that covers most of their issues now, rather than having to wait for the most </span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">comprehensive analysis.</span></span></p>
<h2 id="_idParaDest-285"><a id="_idTextAnchor292"/><span class="koboSpan" id="kobo.275.1">Static properties analysis</span></h2>
<p><span class="koboSpan" id="kobo.276.1">We </span><a id="_idIndexMarker1431"/><span class="koboSpan" id="kobo.277.1">will start by examining the static properties of a suspect file. </span><span class="koboSpan" id="kobo.277.2">In this case, we will be using a single tool that provides an overview of the file attributes, along with potential indicators. </span><span class="koboSpan" id="kobo.277.3">This is a straightforward way to examine using an open source tool. </span><span class="koboSpan" id="kobo.277.4">In this example, we will analyze a malware sample from the Malware Bazaar maintained by Abuse.ch. </span><span class="koboSpan" id="kobo.277.5">This sample can be found at </span><a href="https://bazaar.abuse.ch/sample/6b69de892df50de9a94577fed5a2cbb099820f7ca618771a93cca4de6196d242/"><span class="koboSpan" id="kobo.278.1">https://bazaar.abuse.ch/sample/6b69de892df50de9a94577fed5a2cbb099820f7ca618771a93cca4de6196d242/</span></a><span class="koboSpan" id="kobo.279.1">. </span><span class="koboSpan" id="kobo.279.2">Once you have downloaded the sample, you will need to uncompress the file using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.280.1">infected</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.281.1"> password.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.282.1">Safe malware handling</span></p>
<p class="callout"><span class="koboSpan" id="kobo.283.1">The</span><a id="_idIndexMarker1432"/><span class="koboSpan" id="kobo.284.1"> standard practice when handling malware samples is to compress the file with a utility such as 7-Zip and use the password that’s been infected. </span><span class="koboSpan" id="kobo.284.2">This accomplishes two things. </span><span class="koboSpan" id="kobo.284.3">First, it reduces the chance that an analyst will accidentally detonate the malware in a production environment when moving or copying the malware. </span><span class="koboSpan" id="kobo.284.4">Second, if the analyst has not disabled their malware protections on the sandbox, this technique keeps the malware from being quarantined </span><span class="No-Break"><span class="koboSpan" id="kobo.285.1">or removed.</span></span></p>
<p><span class="koboSpan" id="kobo.286.1">Now that we have a sample of live malware, let’s go ahead and look at the specific properties we can find </span><span class="No-Break"><span class="koboSpan" id="kobo.287.1">using PEStudio.</span></span></p>
<h3><span class="koboSpan" id="kobo.288.1">PEStudio</span></h3>
<p><span class="koboSpan" id="kobo.289.1">In this </span><a id="_idIndexMarker1433"/><span class="koboSpan" id="kobo.290.1">example, we </span><a id="_idIndexMarker1434"/><span class="koboSpan" id="kobo.291.1">are going to use the free tool </span><a id="_idIndexMarker1435"/><span class="koboSpan" id="kobo.292.1">PEStudio (available at </span><a href="https://www.winitor.com/download"><span class="koboSpan" id="kobo.293.1">https://www.winitor.com/download</span></a><span class="koboSpan" id="kobo.294.1">). </span><span class="koboSpan" id="kobo.294.2">This tool quickly extracts artifacts from files for analysis. </span><span class="koboSpan" id="kobo.294.3">Once downloaded, the tool opens the following window. </span><span class="koboSpan" id="kobo.294.4">Suspected malware files can be either simply dragged and dropped onto the window, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.295.1">Figure 16</span></em></span><em class="italic"><span class="koboSpan" id="kobo.296.1">.2</span></em><span class="koboSpan" id="kobo.297.1">, or you can add them using the folder icon at the top left of </span><span class="No-Break"><span class="koboSpan" id="kobo.298.1">the window:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer330">
<span class="koboSpan" id="kobo.299.1"><img alt="Figure 16.2 – PEStudio’s malware loading window " src="image/B18571_16_002.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.300.1">Figure 16.2 – PEStudio’s malware loading window</span></p>
<p><span class="koboSpan" id="kobo.301.1">Go ahead </span><a id="_idIndexMarker1436"/><span class="koboSpan" id="kobo.302.1">and uncompress the suspect file and drop it into the window. </span><span class="koboSpan" id="kobo.302.2">Immediately, the results of the analysis will start to populate, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.303.1">Figure 16</span></em></span><em class="italic"><span class="koboSpan" id="kobo.304.1">.3</span></em><span class="koboSpan" id="kobo.305.1">. </span><span class="koboSpan" id="kobo.305.2">In this case, we can see the file hash, along with other metadata that indicates</span><a id="_idIndexMarker1437"/><span class="koboSpan" id="kobo.306.1"> the file is an executable, as seen in the </span><strong class="bold"><span class="koboSpan" id="kobo.307.1">first-byte-text</span></strong><span class="koboSpan" id="kobo.308.1"> entry – that </span><span class="No-Break"><span class="koboSpan" id="kobo.309.1">is, </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.310.1">MZ</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.311.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer331">
<span class="koboSpan" id="kobo.312.1"><img alt="Figure 16.3 – PEStudio metadata view " src="image/B18571_16_003.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.313.1">Figure 16.3 – PEStudio metadata view</span></p>
<p><span class="koboSpan" id="kobo.314.1">Clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.315.1">indicators</span></strong><span class="koboSpan" id="kobo.316.1"> section, there are 46 separate file indicators. </span><span class="koboSpan" id="kobo.316.2">Of these, there are several that are highly suspect. </span><span class="koboSpan" id="kobo.316.3">The </span><strong class="bold"><span class="koboSpan" id="kobo.317.1">The file references a URL pattern</span></strong><span class="koboSpan" id="kobo.318.1"> entry, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.319.1">Figure 16</span></em></span><em class="italic"><span class="koboSpan" id="kobo.320.1">.4</span></em><span class="koboSpan" id="kobo.321.1">, is especially useful as it indicates the malware coder inserted a malicious URL, </span><a href="http://nsis.sf.net/NSIS_Error"><span class="koboSpan" id="kobo.322.1">http://nsis.sf.net/NSIS_Error</span></a><span class="koboSpan" id="kobo.323.1">, that either establishes Command and Control or downloads a </span><span class="No-Break"><span class="koboSpan" id="kobo.324.1">second stage:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer332">
<span class="koboSpan" id="kobo.325.1"><img alt="Figure 16.4 – PEStudio indicators view " src="image/B18571_16_004.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.326.1">Figure 16.4 – PEStudio indicators view</span></p>
<p><span class="koboSpan" id="kobo.327.1">PEStudio </span><a id="_idIndexMarker1438"/><span class="koboSpan" id="kobo.328.1">can also extract strings from the malware. </span><span class="koboSpan" id="kobo.328.2">This is useful for </span><a id="_idIndexMarker1439"/><span class="koboSpan" id="kobo.329.1">reconstructing some of the malware’s behavior. </span><span class="koboSpan" id="kobo.329.2">For example, in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.330.1">Figure 16</span></em></span><em class="italic"><span class="koboSpan" id="kobo.331.1">.5</span></em><span class="koboSpan" id="kobo.332.1">, we can see that the string at file offset </span><strong class="bold"><span class="koboSpan" id="kobo.333.1">0x00007066</span></strong><span class="koboSpan" id="kobo.334.1"> has a value of </span><strong class="bold"><span class="koboSpan" id="kobo.335.1">RegCloseKey</span></strong><span class="koboSpan" id="kobo.336.1">, which indicates that the malware most likely makes changes to the system registry settings. </span><span class="koboSpan" id="kobo.336.2">In addition, the strings are one of the best places to look for specific IOCs. </span><span class="koboSpan" id="kobo.336.3">In this case, we can see the C2 domain – that </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">is, </span></span><a href="http://nsis.sf.net/"><span class="No-Break"><span class="koboSpan" id="kobo.338.1">http://nsis.sf.net/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.339.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer333">
<span class="koboSpan" id="kobo.340.1"><img alt="Figure 16.5 – PEStudio strings " src="image/B18571_16_005.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.341.1">Figure 16.5 – PEStudio strings</span></p>
<p><span class="koboSpan" id="kobo.342.1">PEStudio </span><a id="_idIndexMarker1440"/><span class="koboSpan" id="kobo.343.1">allows</span><a id="_idIndexMarker1441"/><span class="koboSpan" id="kobo.344.1"> incident responders to get a 10,000-foot overview of suspected malware. </span><span class="koboSpan" id="kobo.344.2">Additionally, they may be able to determine if there are specific IOCs that can be extracted. </span><span class="koboSpan" id="kobo.344.3">As we saw, we were able to identify at least the domain that this malware used, along with specific behaviors such as the registry modifications. </span><span class="koboSpan" id="kobo.344.4">The major disadvantage of relying solely on this approach is that there is still a great deal about this malware that we do not know. </span><span class="koboSpan" id="kobo.344.5">Specifics on techniques such as obfuscation and persistence, along with additional actions, are still unknown. </span><span class="koboSpan" id="kobo.344.6">To get a sense of those, we will need to perform a much more </span><span class="No-Break"><span class="koboSpan" id="kobo.345.1">comprehensive analysis.</span></span></p>
<h1 id="_idParaDest-286"><a id="_idTextAnchor293"/><span class="koboSpan" id="kobo.346.1">Dynamic analysis</span></h1>
<p><span class="koboSpan" id="kobo.347.1">In static analysis, the focus is on examining the potential malware in a controlled environment. </span><span class="koboSpan" id="kobo.347.2">The focus is on examining the actual code or looking for specific file attributes that could be compared to other sources. </span><span class="koboSpan" id="kobo.347.3">In </span><a id="_idIndexMarker1442"/><span class="koboSpan" id="kobo.348.1">dynamic analysis, the focus is on allowing the potential malware to execute within a controlled environment, and observing the behaviors that the </span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">program exhibits.</span></span></p>
<p><span class="koboSpan" id="kobo.350.1">There are several </span><a id="_idIndexMarker1443"/><span class="koboSpan" id="kobo.351.1">advantages that dynamic analysis affords malware researchers and incident responders. </span><span class="koboSpan" id="kobo.351.2">First, allowing the code to execute fully will remove barriers such as encryption, or other obfuscation techniques that are utilized by malware coders. </span><span class="koboSpan" id="kobo.351.3">Second, several automated tools can be leveraged for dynamic analysis. </span><span class="koboSpan" id="kobo.351.4">This removes the manual process, which can be very labor-intensive as malware </span><a id="_idIndexMarker1444"/><span class="koboSpan" id="kobo.352.1">continues to increase in complexity. </span><span class="koboSpan" id="kobo.352.2">Finally, dynamic analysis is often much faster, as a researcher can monitor how a piece of potential malware works on a system in </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">real time.</span></span></p>
<p><span class="koboSpan" id="kobo.354.1">There are two broad categories of dynamic malware analysis that can be utilized, </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">as follows:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.356.1">Defined point analysis</span></strong><span class="koboSpan" id="kobo.357.1">: In</span><a id="_idIndexMarker1445"/><span class="koboSpan" id="kobo.358.1"> this</span><a id="_idIndexMarker1446"/><span class="koboSpan" id="kobo.359.1"> method, a test OS such as Windows 7 is configured in a live production state. </span><span class="koboSpan" id="kobo.359.2">Analysts make a recording of various registry key settings, processes, and network connections. </span><span class="koboSpan" id="kobo.359.3">Once these are recorded, the suspected malware is executed on the system. </span><span class="koboSpan" id="kobo.359.4">Once the analysts are confident that the malware has been executed completely, they will then compare two points of the system, such as comparing the running processes or identifying changes. </span><span class="koboSpan" id="kobo.359.5">This type of analysis can make use of some of the forensic techniques addressed in previous chapters. </span><span class="koboSpan" id="kobo.359.6">For example, analysts can take a freshly installed OS and perform a memory capture. </span><span class="koboSpan" id="kobo.359.7">This memory capture, and a subsequent one that is taken from the infected machine, gives the analysts a point of comparison to identify specific behaviors of </span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">the malware.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.361.1">Runtime behavior analysis</span></strong><span class="koboSpan" id="kobo.362.1">: In</span><a id="_idIndexMarker1447"/><span class="koboSpan" id="kobo.363.1"> this </span><a id="_idIndexMarker1448"/><span class="koboSpan" id="kobo.364.1">method, analysts utilize tools such as Process Explorer and other utilities to observe the behavior of the suspected malware while it is executing. </span><span class="koboSpan" id="kobo.364.2">Some tools automate a good deal of this process, to give analysts a good understanding of how the malware </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">is executing.</span></span></li>
</ul>
<h2 id="_idParaDest-287"><a id="_idTextAnchor294"/><span class="koboSpan" id="kobo.366.1">Process Explorer</span></h2>
<p><span class="koboSpan" id="kobo.367.1">One</span><a id="_idIndexMarker1449"/><span class="koboSpan" id="kobo.368.1"> of the key tools that allows a detailed examination</span><a id="_idIndexMarker1450"/><span class="koboSpan" id="kobo.369.1"> of malware as it is executing is Process Explorer. </span><span class="koboSpan" id="kobo.369.2">This tool is made as part of the Windows Sysinternals suite of tools and provides a no-cost platform for analysts to gain a sense of what each process is running and their parent process, as well as examine CPU usage. </span><span class="koboSpan" id="kobo.369.3">Simply download the application</span><a id="_idIndexMarker1451"/><span class="koboSpan" id="kobo.370.1"> from the following </span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">site: </span></span><a href="https://technet.microsoft.com/en-us/sysinternals/process-explorer"><span class="No-Break"><span class="koboSpan" id="kobo.372.1">https://technet.microsoft.com/en-us/sysinternals/process-explorer</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.373.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.374.1">Extract the contents, and then double-click the version of Process Explorer (32-bit or 64-bit version) that is applicable. </span><span class="koboSpan" id="kobo.374.2">The following window </span><span class="No-Break"><span class="koboSpan" id="kobo.375.1">will appear:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer334">
<span class="koboSpan" id="kobo.376.1"><img alt="Figure 16.6 – Process Explorer " src="image/B18571_16_006.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.377.1">Figure 16.6 – Process Explorer</span></p>
<p><span class="koboSpan" id="kobo.378.1">As can be</span><a id="_idIndexMarker1452"/><span class="koboSpan" id="kobo.379.1"> seen, there are several key pieces of information </span><a id="_idIndexMarker1453"/><span class="koboSpan" id="kobo.380.1">available to the analyst. </span><span class="koboSpan" id="kobo.380.2">The major advantage of this tool is its visual representation. </span><span class="koboSpan" id="kobo.380.3">As opposed to attempting to utilize either native Windows tools or other memory analysis tools after capture, analysts can quickly see if any processes </span><span class="No-Break"><span class="koboSpan" id="kobo.381.1">look suspicious.</span></span></p>
<p><span class="koboSpan" id="kobo.382.1">Analysts can send a process and its associated data to </span><a href="https://www.virustotal.com/gui/home/upload"><span class="koboSpan" id="kobo.383.1">https://www.virustotal.com/gui/home/upload</span></a><span class="koboSpan" id="kobo.384.1">. </span><span class="koboSpan" id="kobo.384.2">If a suspicious process is identified, Process Explorer will send the information off to the site for analysis and comparison. </span><span class="koboSpan" id="kobo.384.3">If a process is identified, click on it in the window. </span><span class="koboSpan" id="kobo.384.4">Navigate to </span><strong class="bold"><span class="koboSpan" id="kobo.385.1">Process</span></strong><span class="koboSpan" id="kobo.386.1">, and then check VirusTotal. </span><span class="koboSpan" id="kobo.386.2">The results will be indicated by a number out of 72, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer335">
<span class="koboSpan" id="kobo.388.1"><img alt="Figure 16.7 – PCHealthCheck.exe VirusTotal check " src="image/B18571_16_007.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.389.1">Figure 16.7 – PCHealthCheck.exe VirusTotal check</span></p>
<p><span class="koboSpan" id="kobo.390.1">Another key </span><a id="_idIndexMarker1454"/><span class="koboSpan" id="kobo.391.1">feature that</span><a id="_idIndexMarker1455"/><span class="koboSpan" id="kobo.392.1"> Process Explorer can provide is the ability to dump the process contents in much the same way that Volatility can. </span><span class="koboSpan" id="kobo.392.2">The major difference is that the analyst can conduct the dump without having to acquire a memory image. </span><span class="koboSpan" id="kobo.392.3">To dump the memory, click on the process, navigate to </span><strong class="bold"><span class="koboSpan" id="kobo.393.1">Process</span></strong><span class="koboSpan" id="kobo.394.1">, and then click </span><strong class="bold"><span class="koboSpan" id="kobo.395.1">Create Dump</span></strong><span class="koboSpan" id="kobo.396.1">. </span><span class="koboSpan" id="kobo.396.2">The analyst has the option to choose from a minidump or a full dump. </span><span class="koboSpan" id="kobo.396.3">As a standard practice, it is advisable to capture a full dump. </span><span class="koboSpan" id="kobo.396.4">This dump can then be saved to a directory </span><span class="No-Break"><span class="koboSpan" id="kobo.397.1">of choice.</span></span></p>
<h2 id="_idParaDest-288"><a id="_idTextAnchor295"/><span class="koboSpan" id="kobo.398.1">Process Spawn Control</span></h2>
<p><span class="koboSpan" id="kobo.399.1">One </span><a id="_idIndexMarker1456"/><span class="koboSpan" id="kobo.400.1">technique that can be leveraged in</span><a id="_idIndexMarker1457"/><span class="koboSpan" id="kobo.401.1"> examining malware is to create a virtual machine with the appropriate Windows OS. </span><span class="koboSpan" id="kobo.401.2">It is best to start with a bare-bones OS, with the Microsoft Office suite installed. </span><span class="koboSpan" id="kobo.401.3">Other third-party programs can be installed later if it appears that the malicious code leverages a vulnerability in those applications. </span><span class="koboSpan" id="kobo.401.4">A tool that is useful in </span><a id="_idIndexMarker1458"/><span class="koboSpan" id="kobo.402.1">this type of examination is Process Spawn Control. </span><span class="koboSpan" id="kobo.402.2">This PowerShell script, available at </span><a href="https://github.com/felixweyne/ProcessSpawnControl"><span class="koboSpan" id="kobo.403.1">https://github.com/felixweyne/ProcessSpawnControl</span></a><span class="koboSpan" id="kobo.404.1">, allows responders to control the execution of malware and observe what actions are taken in Process Explorer. </span><span class="koboSpan" id="kobo.404.2">To conduct this type of analysis, take the </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">following steps:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.406.1">Start Process Explorer and let it run for a </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">few seconds.</span></span></li>
<li><span class="koboSpan" id="kobo.408.1">In the PowerShell terminal, execute the </span><strong class="source-inline"><span class="koboSpan" id="kobo.409.1">ProcessSpawnControl.ps1</span></strong><span class="koboSpan" id="kobo.410.1"> script. </span><span class="koboSpan" id="kobo.410.2">Select </span><strong class="bold"><span class="koboSpan" id="kobo.411.1">Run Once</span></strong><span class="koboSpan" id="kobo.412.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">if prompted.</span></span></li>
<li><span class="koboSpan" id="kobo.414.1">Process Spawn Control will pause all executables, not just potential malware. </span><span class="koboSpan" id="kobo.414.2">Once it is running, open the Windows </span><strong class="source-inline"><span class="koboSpan" id="kobo.415.1">notepad.exe</span></strong><span class="koboSpan" id="kobo.416.1"> executable. </span><span class="koboSpan" id="kobo.416.2">The following window </span><span class="No-Break"><span class="koboSpan" id="kobo.417.1">should appear:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer336">
<span class="koboSpan" id="kobo.418.1"><img alt="Figure 16.8 – Process Spawn Control notepad.exe suspension " src="image/B18571_16_008.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.419.1">Figure 16.8 – Process Spawn Control notepad.exe suspension</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.420.1">In the </span><a id="_idIndexMarker1459"/><span class="koboSpan" id="kobo.421.1">Process Explorer window, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.422.1">notepad.exe</span></strong><span class="koboSpan" id="kobo.423.1"> process will appear to be suspended, as shown in the</span><a id="_idIndexMarker1460"/> <span class="No-Break"><span class="koboSpan" id="kobo.424.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer337">
<span class="koboSpan" id="kobo.425.1"><img alt="Figure 16.9 – Process Explorer notepad.exe suspended " src="image/B18571_16_009.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.426.1">Figure 16.9 – Process Explorer notepad.exe suspended</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.427.1">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.428.1">Allow run</span></strong><span class="koboSpan" id="kobo.429.1"> in the PowerShell dialog box. </span><span class="koboSpan" id="kobo.429.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.430.1">notepad.exe</span></strong><span class="koboSpan" id="kobo.431.1"> process will execute, </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer338">
<span class="koboSpan" id="kobo.433.1"><img alt="Figure 16.10 – Process Explorer notepad.exe running " src="image/B18571_16_010.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.434.1">Figure 16.10 – Process Explorer notepad.exe running</span></p>
<p><span class="koboSpan" id="kobo.435.1">Using these tools in combination allows the responder to understand how a potential malware executable functions, and what execution path it may take. </span><span class="koboSpan" id="kobo.435.2">This data, combined with other artifacts obtained through memory or log file analysis, can provide additional context to how malware has compromised </span><span class="No-Break"><span class="koboSpan" id="kobo.436.1">a system.</span></span></p>
<p><span class="koboSpan" id="kobo.437.1">While there are distinct advantages to dynamic analysis, incident responders should understand some of the concerns that need to be addressed before detonating suspected malware on a system. </span><span class="koboSpan" id="kobo.437.2">First, a controlled environment must </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">be configured.</span></span></p>
<p><span class="koboSpan" id="kobo.439.1">Suspected malware should never be executed in a production environment. </span><span class="koboSpan" id="kobo.439.2">Researchers and incident responders should ensure that any test or analysis environment is completely separated from the </span><span class="No-Break"><span class="koboSpan" id="kobo.440.1">production environment.</span></span></p>
<p><span class="koboSpan" id="kobo.441.1">Another </span><a id="_idIndexMarker1461"/><span class="koboSpan" id="kobo.442.1">concern is the number of resources </span><a id="_idIndexMarker1462"/><span class="koboSpan" id="kobo.443.1">that are required to create a proper environment for dynamic analysis. </span><span class="koboSpan" id="kobo.443.2">Malware researchers and incident responders make use of a sandbox environment to analyze malware. </span><span class="koboSpan" id="kobo.443.3">A sandbox is simply a controlled environment where suspect malware is executed, and the associated analysis can take place. </span><span class="koboSpan" id="kobo.443.4">For organizations that research malware, this sandbox can become quite large, as copies of the various OSs and their patch levels should be maintained. </span><span class="koboSpan" id="kobo.443.5">For example, for an organization to test a malware sample that impacts the Windows OS, they will often have to have instances of Windows XP, Windows 7, Windows 8, and – finally – Windows 10, along with the various patch levels. </span><span class="koboSpan" id="kobo.443.6">This allows them to zero in on the specific OSs that are impacted by the malware. </span><span class="koboSpan" id="kobo.443.7">In addition to the OSs, analysts will also need to have images of </span><span class="No-Break"><span class="koboSpan" id="kobo.444.1">the memory.</span></span></p>
<h2 id="_idParaDest-289"><a id="_idTextAnchor296"/><span class="koboSpan" id="kobo.445.1">Automated analysis</span></h2>
<p><span class="koboSpan" id="kobo.446.1">There is </span><a id="_idIndexMarker1463"/><span class="koboSpan" id="kobo.447.1">a wide range of providers for automated </span><a id="_idIndexMarker1464"/><span class="koboSpan" id="kobo.448.1">sandboxes. </span><span class="koboSpan" id="kobo.448.2">The one caveat to remember when using these services, especially those that fall under </span><strong class="bold"><span class="koboSpan" id="kobo.449.1">Community</span></strong><span class="koboSpan" id="kobo.450.1"> access, is that samples that are uploaded for analysis may be made public. </span><span class="koboSpan" id="kobo.450.2">Adversaries have been known to monitor various automated sandbox platforms to see when their code is examined. </span><span class="koboSpan" id="kobo.450.3">If malware has been extracted from a system under an incident response engagement and then uploaded, you very well may have tipped your hand to the adversary. </span><span class="koboSpan" id="kobo.450.4">In cases</span><a id="_idIndexMarker1465"/><span class="koboSpan" id="kobo.451.1"> where </span><strong class="bold"><span class="koboSpan" id="kobo.452.1">Operational Security</span></strong><span class="koboSpan" id="kobo.453.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.454.1">OPSEC</span></strong><span class="koboSpan" id="kobo.455.1">) is important, there are commercial solutions that do not </span><span class="No-Break"><span class="koboSpan" id="kobo.456.1">share samples.</span></span></p>
<h3><span class="koboSpan" id="kobo.457.1">Intezer sandbox</span></h3>
<p><span class="koboSpan" id="kobo.458.1">To demonstrate </span><a id="_idIndexMarker1466"/><span class="koboSpan" id="kobo.459.1">a few of the key features of online sandboxing, we will go</span><a id="_idIndexMarker1467"/><span class="koboSpan" id="kobo.460.1"> ahead and look at the Intezer Analyze sandbox </span><a id="_idIndexMarker1468"/><span class="koboSpan" id="kobo.461.1">located at </span><a href="https://analyze.intezer.com/"><span class="koboSpan" id="kobo.462.1">https://analyze.intezer.com/</span></a><span class="koboSpan" id="kobo.463.1">, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.464.1">Figure 16</span></em></span><em class="italic"><span class="koboSpan" id="kobo.465.1">.11</span></em><span class="koboSpan" id="kobo.466.1">. </span><span class="koboSpan" id="kobo.466.2">The Community version of the service allows you to search file hashes, similar to what we did when looking at sites such as VirusTotal and Hybrid Analysis. </span><span class="koboSpan" id="kobo.466.3">One step that should be conducted before you begin a full analysis is to search the file hash that’s been extracted through a tool such as PEStudio to determine if a sample has already been run in the sandbox. </span><span class="koboSpan" id="kobo.466.4">This step saves time. </span><span class="koboSpan" id="kobo.466.5">In</span><a id="_idIndexMarker1469"/><span class="koboSpan" id="kobo.467.1"> this case, we will work through </span><a id="_idIndexMarker1470"/><span class="koboSpan" id="kobo.468.1">running a sample to highlight the features we obtain through a full </span><span class="No-Break"><span class="koboSpan" id="kobo.469.1">sandbox analysis:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer339">
<span class="koboSpan" id="kobo.470.1"><img alt="Figure 16.11 – Intezer Analyze file upload " src="image/B18571_16_011.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.471.1">Figure 16.11 – Intezer Analyze file upload</span></p>
<p><span class="koboSpan" id="kobo.472.1">In this case, we will use the same sample that we examined with PEStudio. </span><span class="koboSpan" id="kobo.472.2">The sample can be placed into the sandbox via the web browser either by dragging and dropping the file or browsing the host filesystem. </span><span class="koboSpan" id="kobo.472.3">As shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.473.1">Figure 16</span></em></span><em class="italic"><span class="koboSpan" id="kobo.474.1">.12</span></em><span class="koboSpan" id="kobo.475.1">, once the sample is dropped into the web browser, the metadata will </span><span class="No-Break"><span class="koboSpan" id="kobo.476.1">be populated:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer340">
<span class="koboSpan" id="kobo.477.1"><img alt="Figure 16.12 – Intezer metadata " src="image/B18571_16_012.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.478.1">Figure 16.12 – Intezer metadata</span></p>
<p><span class="koboSpan" id="kobo.479.1">The </span><a id="_idIndexMarker1471"/><span class="koboSpan" id="kobo.480.1">preceding </span><a id="_idIndexMarker1472"/><span class="koboSpan" id="kobo.481.1">screenshot shows the metadata, including the hash value of the file. </span><span class="koboSpan" id="kobo.481.2">Another key piece of data that we see almost immediately with the execution of the file in the sandbox is that the suspect file shares strings and other attributes with the NSIS installer, which makes use of the Nullsoft Scriptable Install System. </span><span class="koboSpan" id="kobo.481.3">NSIS is an open source tool used for constructing Windows executables. </span><span class="koboSpan" id="kobo.481.4">NSIS malware variants use an obfuscation technique that attempts to appear as a legitimate installer by using non-malicious plugins, such as a bitmap image that serves as a background image and the non-malicious </span><strong class="source-inline"><span class="koboSpan" id="kobo.482.1">uninst.exe</span></strong><span class="koboSpan" id="kobo.483.1"> uninstaller. </span><span class="koboSpan" id="kobo.483.2">This type of Trojan malware has seen increased use as part of ransomware attacks. </span><span class="koboSpan" id="kobo.483.3">This is one of the key advantages of using a service such as this as we gain additional context about the file that we would not have if we had stopped at </span><span class="No-Break"><span class="koboSpan" id="kobo.484.1">static analysis:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer341">
<span class="koboSpan" id="kobo.485.1"><img alt="Figure 16.13 – Intezer – Generic Summary " src="image/B18571_16_013.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.486.1">Figure 16.13 – Intezer – Generic Summary</span></p>
<p><span class="koboSpan" id="kobo.487.1">After executing the malware, we will see that, as shown in the following screenshot, the Intezer analysis returns the overall</span><a id="_idIndexMarker1473"/><span class="koboSpan" id="kobo.488.1"> results, indicating that this file is associated with the Loki family of </span><span class="No-Break"><span class="koboSpan" id="kobo.489.1">Trojan malware:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer342">
<span class="koboSpan" id="kobo.490.1"><img alt="Figure 16.14 – Intezer malware conviction " src="image/B18571_16_014.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.491.1">Figure 16.14 – Intezer malware conviction</span></p>
<p><span class="koboSpan" id="kobo.492.1">The output</span><a id="_idIndexMarker1474"/><span class="koboSpan" id="kobo.493.1"> of the analysis in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.494.1">Figure 16</span></em></span><em class="italic"><span class="koboSpan" id="kobo.495.1">.15</span></em><span class="koboSpan" id="kobo.496.1"> shows additional samples that have been analyzed by Intezer that utilized the NSIS installer. </span><span class="koboSpan" id="kobo.496.2">Reused genes shows the relationship between our analyzed samples and others that have been analyzed in the past. </span><span class="koboSpan" id="kobo.496.3">This is common to see with a variety of families </span><span class="No-Break"><span class="koboSpan" id="kobo.497.1">of malware:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer343">
<span class="koboSpan" id="kobo.498.1"><img alt="Figure 16.15 – Reused genes " src="image/B18571_16_015.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.499.1">Figure 16.15 – Reused genes</span></p>
<p><span class="koboSpan" id="kobo.500.1">Malware such as Loki is often sold as “commodity malware.” </span><span class="koboSpan" id="kobo.500.2">This allows threat actors to purchase the code and modify it as necessary. </span><span class="koboSpan" id="kobo.500.3">This means that simply tying back a particular piece of code to a threat actor does not mean that it is simply that threat actor that has access. </span><span class="koboSpan" id="kobo.500.4">Threat actors across the globe and with varying degrees of skill will use and reuse code, making attributing malware to a </span><span class="No-Break"><span class="koboSpan" id="kobo.501.1">specific group.</span></span></p>
<p><span class="koboSpan" id="kobo.502.1">The code section shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.503.1">Figure 16</span></em></span><em class="italic"><span class="koboSpan" id="kobo.504.1">.16</span></em><span class="koboSpan" id="kobo.505.1"> shows the various code instructions contained within the malware. </span><span class="koboSpan" id="kobo.505.2">These may not have immediate value in terms of threat intelligence but often provide a starting point for more detailed static analysis, which, as we indicated earlier, is a </span><span class="No-Break"><span class="koboSpan" id="kobo.506.1">time-consuming process:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer344">
<span class="koboSpan" id="kobo.507.1"><img alt="Figure 16.16 – Code analysis " src="image/B18571_16_016.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.508.1">Figure 16.16 – Code analysis</span></p>
<p><span class="koboSpan" id="kobo.509.1">The next </span><a id="_idIndexMarker1475"/><span class="koboSpan" id="kobo.510.1">tab shows the strings that were extracted </span><a id="_idIndexMarker1476"/><span class="koboSpan" id="kobo.511.1">during the analysis. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.512.1">Figure 16</span></em></span><em class="italic"><span class="koboSpan" id="kobo.513.1">.17</span></em><span class="koboSpan" id="kobo.514.1"> shows the same URL (</span><a href="http://nsis.sf.net/NSIS_Error"><span class="koboSpan" id="kobo.515.1">http://nsis.sf.net/NSIS_Error</span></a><span class="koboSpan" id="kobo.516.1">) that we first observed when analyzing the code </span><span class="No-Break"><span class="koboSpan" id="kobo.517.1">with PEStudio:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer345">
<span class="koboSpan" id="kobo.518.1"><img alt="Figure 16.17 – Strings " src="image/B18571_16_017.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.519.1">Figure 16.17 – Strings</span></p>
<p><span class="koboSpan" id="kobo.520.1">Under</span><a id="_idIndexMarker1477"/><span class="koboSpan" id="kobo.521.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.522.1">Capabilities</span></strong><span class="koboSpan" id="kobo.523.1"> tab, the analysis provides a full</span><a id="_idIndexMarker1478"/><span class="koboSpan" id="kobo.524.1"> breakdown of the MITRE ATT&amp;CK Tactics and Techniques that the malware utilizes. </span><span class="koboSpan" id="kobo.524.2">As we can see in the </span><strong class="bold"><span class="koboSpan" id="kobo.525.1">Defense Evasion</span></strong><span class="koboSpan" id="kobo.526.1"> tactic column, the malware obfuscates files or information. </span><span class="koboSpan" id="kobo.526.2">This matches what we know about the NSIS installer package that was identified in </span><span class="No-Break"><span class="koboSpan" id="kobo.527.1">the metadata:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer346">
<span class="koboSpan" id="kobo.528.1"><img alt="Figure 16.18 – MITRE ATT&amp;CK techniques " src="image/B18571_16_018.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.529.1">Figure 16.18 – MITRE ATT&amp;CK techniques</span></p>
<p><span class="koboSpan" id="kobo.530.1">Finally, the</span><a id="_idIndexMarker1479"/><span class="koboSpan" id="kobo.531.1"> analysis provides the network and file IOCs that</span><a id="_idIndexMarker1480"/><span class="koboSpan" id="kobo.532.1"> we can see in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.533.1">Figure 16</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.534.1">.19</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.535.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer347">
<span class="koboSpan" id="kobo.536.1"><img alt="Figure 16.19 – Malware IOCs " src="image/B18571_16_019.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.537.1">Figure 16.19 – Malware IOCs</span></p>
<p><span class="koboSpan" id="kobo.538.1">When it comes to</span><a id="_idIndexMarker1481"/><span class="koboSpan" id="kobo.539.1"> automated sandboxing, there is a wide range </span><a id="_idIndexMarker1482"/><span class="koboSpan" id="kobo.540.1">of providers. </span><span class="koboSpan" id="kobo.540.2">Other</span><a id="_idIndexMarker1483"/><span class="koboSpan" id="kobo.541.1"> potential options</span><a id="_idIndexMarker1484"/><span class="koboSpan" id="kobo.542.1"> include </span><strong class="bold"><span class="koboSpan" id="kobo.543.1">Joe Sandbox</span></strong><span class="koboSpan" id="kobo.544.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.545.1">Hybrid Analysis</span></strong><span class="koboSpan" id="kobo.546.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.547.1">App.any</span></strong><span class="koboSpan" id="kobo.548.1">. </span><span class="koboSpan" id="kobo.548.2">Antivirus providers will often include a sandboxing feature that provides similar functionality that we explored here. </span><span class="koboSpan" id="kobo.548.3">Again, ensure you are fully aware of whether the sandboxing solution makes your uploaded samples available for general use. </span><span class="koboSpan" id="kobo.548.4">One technique that is </span><a id="_idIndexMarker1485"/><span class="koboSpan" id="kobo.549.1">an option where OPSEC is critical is to take the hash value of the file and search the sandbox solution to </span><a id="_idIndexMarker1486"/><span class="koboSpan" id="kobo.550.1">determine if a file with the same hash value has been uploaded. </span><span class="koboSpan" id="kobo.550.2">This will produce the same results without tipping your hand. </span><span class="koboSpan" id="kobo.550.3">In the case where there are no other organizations or individuals who have uploaded the same file, it is best to use a solution that does not share the analysis. </span><span class="koboSpan" id="kobo.550.4">Often, this is through commercial products that stipulate that your information is </span><span class="No-Break"><span class="koboSpan" id="kobo.551.1">not shared.</span></span></p>
<h1 id="_idParaDest-290"><a id="_idTextAnchor297"/><span class="koboSpan" id="kobo.552.1">ClamAV</span></h1>
<p><span class="koboSpan" id="kobo.553.1">The first</span><a id="_idIndexMarker1487"/><span class="koboSpan" id="kobo.554.1"> step in conducting a static analysis is to determine if the potential malware under analysis has been previously identified. </span><span class="koboSpan" id="kobo.554.2">A single sample’s hash can be uploaded to sites such as VirusTotal, but if a responder has acquired several files through their analysis, they will need to be able to determine if there are any that warrant </span><span class="No-Break"><span class="koboSpan" id="kobo.555.1">further examination.</span></span></p>
<p><span class="koboSpan" id="kobo.556.1">One technique is to use a commercial antivirus scanner to scan the directory. </span><span class="koboSpan" id="kobo.556.2">In this case, a free, open source tool that can be leveraged is ClamAV. </span><span class="koboSpan" id="kobo.556.3">ClamAV is a command-line utility that allows responders to scan a directory with a variety of suspicious file formats. </span><span class="koboSpan" id="kobo.556.4">From here, suspicious files that are identified can be further analyzed by </span><span class="No-Break"><span class="koboSpan" id="kobo.557.1">the responder.</span></span></p>
<p><span class="koboSpan" id="kobo.558.1">To set up </span><a id="_idIndexMarker1488"/><span class="koboSpan" id="kobo.559.1">ClamAV, download the package at </span><a href="https://www.clamav.net/downloads"><span class="koboSpan" id="kobo.560.1">https://www.clamav.net/downloads</span></a><span class="koboSpan" id="kobo.561.1">. </span><span class="koboSpan" id="kobo.561.2">In this example, we will use the Windows MSI file to </span><span class="No-Break"><span class="koboSpan" id="kobo.562.1">install ClamAV.</span></span></p>
<p><span class="koboSpan" id="kobo.563.1">The efficacy of ClamAV is largely dependent on the signatures that are included as part of the scanning package. </span><span class="koboSpan" id="kobo.563.2">Some malware variants may not have a corresponding signature available and, as a result, will go undetected. </span><span class="koboSpan" id="kobo.563.3">Understanding that, ClamAV is a useful way to examine a large number of potential malware files, and to identify those that are already known. </span><span class="koboSpan" id="kobo.563.4">The following installation instructions are for the </span><span class="No-Break"><span class="koboSpan" id="kobo.564.1">Windows OS:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.565.1">Navigate </span><a id="_idIndexMarker1489"/><span class="koboSpan" id="kobo.566.1">to the ClamAV downloads page at </span><a href="https://www.clamav.net/downloads#otherversions"><span class="koboSpan" id="kobo.567.1">https://www.clamav.net/downloads#otherversions</span></a><span class="koboSpan" id="kobo.568.1"> and download the Windows </span><span class="No-Break"><span class="koboSpan" id="kobo.569.1">MSI file.</span></span></li>
<li><span class="koboSpan" id="kobo.570.1">Run the installer. </span><span class="koboSpan" id="kobo.570.2">The default settings will place the ClamAV files in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.571.1">C:\Program </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.572.1">Files\ClamAV</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.573.1"> directory.</span></span></li>
<li><span class="koboSpan" id="kobo.574.1">Navigate to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.575.1">ClamAV</span></strong><span class="koboSpan" id="kobo.576.1"> directory and run the following two commands. </span><span class="koboSpan" id="kobo.576.2">These commands will move the configuration files to the appropriate </span><span class="No-Break"><span class="koboSpan" id="kobo.577.1">ClamAV directory:</span></span><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.578.1">copy .\conf_examples\freshclam.conf.sample .\freshclam.conf</span></strong></pre><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.579.1">copy .\conf_examples\clamd.conf.sample .\clamd.conf</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.580.1">After moving the configuration files, open each of the files with WordPad and delete the line that says </span><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">Example</span></strong><span class="koboSpan" id="kobo.582.1"> for both </span><span class="No-Break"><span class="koboSpan" id="kobo.583.1">configuration files:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer348">
<span class="koboSpan" id="kobo.584.1"><img alt="Figure 16.20 – Configuration file entry " src="image/B18571_16_020.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.585.1">Figure 16.20 – Configuration file entry</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.586.1">After removing the line from both configuration files, the malware signature base needs to be updated. </span><span class="koboSpan" id="kobo.586.2">Navigate to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.587.1">ClamAV</span></strong><span class="koboSpan" id="kobo.588.1"> folder and run the following in the </span><span class="No-Break"><span class="koboSpan" id="kobo.589.1">command line:</span></span><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.590.1">C:\Program Files\ClamAV&gt;freshclam.exe</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.591.1">This will produce the </span><span class="No-Break"><span class="koboSpan" id="kobo.592.1">following output:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer349">
<span class="koboSpan" id="kobo.593.1"><img alt="Figure 16.21 – FreshClam signature update " src="image/B18571_16_021.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.594.1">Figure 16.21 – FreshClam signature update</span></p>
<p><span class="koboSpan" id="kobo.595.1">ClamAV can </span><a id="_idIndexMarker1490"/><span class="koboSpan" id="kobo.596.1">function as a traditional antivirus program but in this case, we will look at using it to scan a directory of suspected files. </span><span class="koboSpan" id="kobo.596.2">In this example, files from </span><a href="http://Malware-traffic-Analysis.net"><span class="koboSpan" id="kobo.597.1">Malware-traffic-Analysis.net</span></a><span class="koboSpan" id="kobo.598.1"> were used. </span><span class="koboSpan" id="kobo.598.2">You can download the samples from </span><a href="https://www.malware-traffic-analysis.net/2021/10/13/2021-10-13-Dridex-malware-and-artifacts.zip"><span class="koboSpan" id="kobo.599.1">https://www.malware-traffic-analysis.net/2021/10/13/2021-10-13-Dridex-malware-and-artifacts.zip</span></a><span class="koboSpan" id="kobo.600.1">. </span><span class="koboSpan" id="kobo.600.2">Download and uncompress the files. </span><span class="koboSpan" id="kobo.600.3">Simply point </span><strong class="source-inline"><span class="koboSpan" id="kobo.601.1">clamscan.exe</span></strong><span class="koboSpan" id="kobo.602.1"> at the directory that contains suspect malware and run </span><strong class="source-inline"><span class="koboSpan" id="kobo.603.1">clamscan.exe</span></strong><span class="koboSpan" id="kobo.604.1">. </span><span class="koboSpan" id="kobo.604.2">For example, the following command runs Clamscan against a directory called </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.605.1">Suspected Malware</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.606.1">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.607.1">
C:\Program Files\ClamAV&gt;clamscan.exe "C:\Users\flare\Documents\Suspected Malware"</span></pre>
<p><span class="koboSpan" id="kobo.608.1">This command will load the signature files and then compare the files and produce the </span><span class="No-Break"><span class="koboSpan" id="kobo.609.1">following results:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer350">
<span class="koboSpan" id="kobo.610.1"><img alt="Figure 16.22 – Clamscan output " src="image/B18571_16_022.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.611.1">Figure 16.22 – Clamscan output</span></p>
<p><span class="koboSpan" id="kobo.612.1">In this case, there was a file that matches the </span><span class="No-Break"><span class="koboSpan" id="kobo.613.1">signature, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.614.1">Xls.Downloader.SquirrelWaffle1021-9903731-0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.615.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.616.1">The efficacy of ClamAV is largely dependent on the signatures that are included as part of the scanning package. </span><span class="koboSpan" id="kobo.616.2">Some malware variants may not have a corresponding signature</span><a id="_idIndexMarker1491"/><span class="koboSpan" id="kobo.617.1"> available and, as a result, will go undetected. </span><span class="koboSpan" id="kobo.617.2">Understanding that, ClamAV is a useful way to examine many potential malware files, and to identify those that are already known. </span><span class="koboSpan" id="kobo.617.3">A good technique to combat the issue of missing signatures is to leverage several different malware prevention vendors against the same sample. </span><span class="koboSpan" id="kobo.617.4">This increases the probability that any suspect files have </span><span class="No-Break"><span class="koboSpan" id="kobo.618.1">been identified.</span></span></p>
<h1 id="_idParaDest-291"><a id="_idTextAnchor298"/><span class="koboSpan" id="kobo.619.1">YARA</span></h1>
<p><span class="koboSpan" id="kobo.620.1">One tool that</span><a id="_idIndexMarker1492"/><span class="koboSpan" id="kobo.621.1"> has made its way from the malware analysis community into threat intelligence is YARA. </span><span class="koboSpan" id="kobo.621.2">This open source tool is often compared to the Linux </span><strong class="source-inline"><span class="koboSpan" id="kobo.622.1">GREP</span></strong><span class="koboSpan" id="kobo.623.1"> command for its ability to parse through large amounts of data and indicate if there are matching strings or data patterns. </span><span class="koboSpan" id="kobo.623.2">What the acronym YARA stands for is the subject of friendly debate with some going with </span><strong class="bold"><span class="koboSpan" id="kobo.624.1">YARA: Another Recursive Acronym</span></strong><span class="koboSpan" id="kobo.625.1"> or the author’s preferred </span><strong class="bold"><span class="koboSpan" id="kobo.626.1">Yet Another Ridiculous Acronym</span></strong><span class="koboSpan" id="kobo.627.1">. </span><span class="koboSpan" id="kobo.627.2">Nomenclature aside, the YARA tool’s ability to act as a Swiss Army knife for incident responders and malware research also has functionality that analysts </span><span class="No-Break"><span class="koboSpan" id="kobo.628.1">can leverage.</span></span></p>
<p><span class="koboSpan" id="kobo.629.1">The YARA tool is maintained by VirusTotal and comes in two components. </span><span class="koboSpan" id="kobo.629.2">The first of these is a scanning tool. </span><span class="koboSpan" id="kobo.629.3">This</span><a id="_idIndexMarker1493"/><span class="koboSpan" id="kobo.630.1"> tool, written in Python, is the engine that scans files such as memory dumps, disk images, or suspected malicious executables for matching indicators. </span><span class="koboSpan" id="kobo.630.2">Due to the tool being open source, along with its capabilities, third-party tools make use of the YARA rule structure. </span><span class="koboSpan" id="kobo.630.3">Florian Roth’s Nextron Systems’ Loki scanning tool incorporates YARA into its scanning software. </span><span class="koboSpan" id="kobo.630.4">The digital forensics memory analysis tool Volatility is also able to leverage YARA rules when analyzing </span><span class="No-Break"><span class="koboSpan" id="kobo.631.1">memory captures.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.632.1">YARA documentation</span></p>
<p class="callout"><span class="koboSpan" id="kobo.633.1">Complete </span><a id="_idIndexMarker1494"/><span class="koboSpan" id="kobo.634.1">documentation on YARA is available at </span><a href="https://yara.readthedocs.io/en/stable/index.html"><span class="koboSpan" id="kobo.635.1">https://yara.readthedocs.io/en/stable/index.html</span></a><span class="koboSpan" id="kobo.636.1">. </span><span class="koboSpan" id="kobo.636.2">This resource contains directions on installing the YARA scanning engine on Linux, Windows, and macOS, along with detailed directions on the </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1">entire toolset.</span></span></p>
<p><span class="koboSpan" id="kobo.638.1">The second component of YARA is </span><a id="_idIndexMarker1495"/><span class="koboSpan" id="kobo.639.1">rules. </span><span class="koboSpan" id="kobo.639.2">These rules are similar to other pattern-matching schemas such as the SNORT Intrusion Detection System rules. </span><span class="koboSpan" id="kobo.639.3">The scanning engine </span><a id="_idIndexMarker1496"/><span class="koboSpan" id="kobo.640.1">compares the analysis of the file against a set of rules that contain the IOCs. </span><span class="koboSpan" id="kobo.640.2">Given the utilities of YARA, malware analysis providers will often include YARA rules as part of their published analysis such as the following YARA rule, which was taken from the Cyber Security and Infrastructure Security Agency available at </span><a href="https://www.cisa.gov/uscert/ncas/analysis-reports/ar22-115b"><span class="koboSpan" id="kobo.641.1">https://www.cisa.gov/uscert/ncas/analysis-reports/ar22-115b</span></a><span class="koboSpan" id="kobo.642.1">. </span><span class="koboSpan" id="kobo.642.2">It is related to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.643.1">ISAACWIPER</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.644.1">malware variant:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.645.1">
rule CISA_10376640_01 : trojan wiper ISAACWIPER
{
   meta:
       Author = "CISA Code &amp; Media Analysis"
       Incident = "10376640"
       Date = "2022-03-14"
       Last_Modified = "20220418_1900"
       Actor = "n/a"
       Category = "Trojan Wiper"
       Family = "ISAACWIPER"
       Description = "Detects ISACC Wiper samples"
       MD5_1 = "aa98b92e3320af7a1639de1bac6c17cc"
       SHA256_1 = "abf9adf2c2c21c1e8bd69975dfccb5ca53060d8e1e7271a5e9ef3b56a7e54d9f"
       MD5_2 = "8061889aaebd955ba6fb493abe7a4de1"
       SHA256_2 = "afe1f2768e57573757039a40ac40f3c7471bb084599613b3402b1e9958e0d27a"
       MD5_3 = "ecce8845921a91854ab34bff2623151e"
       SHA256_3 = "13037b749aa4b1eda538fda26d6ac41c8f7b1d02d83f47b0d187dd645154e033"
   strings:
       $s0 = { 73 00 74 00 61 00 72 00 74 00 20 00 65 00 72 00 61 00 73 00 69 00 6E 00 67 }
       $s1 = { 6C 00 6F 00 67 00 69 00 63 00 61 00 6C }
       $s2 = { 46 00 41 00 49 00 4C 00 45 00 44 }
       $s3 = { 5C 00 6C 00 6F 00 67 00 2E 00 74 00 78 00 74 }
       $s4 = { 69 73 20 70 72 6F 67 72 61 6D 20 63 61 6E 6E 6F }
       $s5 = {53 74 61 72 74 40 34}
       $s6 = {3B 57 34 74 2D 6A}
       $s7 = {43 6C 65 61 6E 65 72 2E}
   condition:
       all of ($s0,$s1,$s2,$s3,$s4) or all of ($s5,$s6,$s7)
}</span></pre>
<p><span class="koboSpan" id="kobo.646.1">There are </span><a id="_idIndexMarker1497"/><span class="koboSpan" id="kobo.647.1">four components to the preceding YARA rule. </span><span class="koboSpan" id="kobo.647.2">Let’s go ahead and look at each portion in detail. </span><span class="koboSpan" id="kobo.647.3">The first component is </span><a id="_idIndexMarker1498"/><span class="koboSpan" id="kobo.648.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.649.1">rule name</span></strong><span class="koboSpan" id="kobo.650.1">. </span><span class="koboSpan" id="kobo.650.2">In this case, the rule name is </span><strong class="source-inline"><span class="koboSpan" id="kobo.651.1">rule CISA_10376640_01 : trojan </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.652.1">wiper ISAACWIPER</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.653.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.654.1">This identifies the YARA rule and should be meaningful to the author. </span><span class="koboSpan" id="kobo.654.2">A good rule to follow is to use the name of the malware variant, just like the preceding </span><span class="No-Break"><span class="koboSpan" id="kobo.655.1">rule does.</span></span></p>
<p><span class="koboSpan" id="kobo.656.1">The second component is the rule’s </span><a id="_idIndexMarker1499"/><span class="koboSpan" id="kobo.657.1">metadata. </span><span class="koboSpan" id="kobo.657.2">In the case of the preceding rule, this is identified with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.658.1">meta:</span></strong><span class="koboSpan" id="kobo.659.1"> line. </span><span class="koboSpan" id="kobo.659.2">The metadata can include fields that are descriptive of the rule. </span><span class="koboSpan" id="kobo.659.3">As in the preceding rule, this includes the author, the incident number, the date, and the various hash values associated with the malware. </span><span class="koboSpan" id="kobo.659.4">YARA rules allow for a great degree of flexibility in the metadata portion. </span><span class="koboSpan" id="kobo.659.5">Any information that may be helpful can </span><span class="No-Break"><span class="koboSpan" id="kobo.660.1">be included.</span></span></p>
<p><span class="koboSpan" id="kobo.661.1">Next is the meat of the YARA rule and that is </span><a id="_idIndexMarker1500"/><span class="koboSpan" id="kobo.662.1">its </span><strong class="bold"><span class="koboSpan" id="kobo.663.1">strings</span></strong><span class="koboSpan" id="kobo.664.1">. </span><span class="koboSpan" id="kobo.664.2">Strings are often obtained through analysis such as the use of PEStudio, as we saw in the previous example. </span><span class="koboSpan" id="kobo.664.3">These strings can be hexadecimal, text strings, or regular expressions. </span><span class="koboSpan" id="kobo.664.4">The text strings</span><a id="_idIndexMarker1501"/><span class="koboSpan" id="kobo.665.1"> can be</span><a id="_idIndexMarker1502"/><span class="koboSpan" id="kobo.666.1"> used with the </span><span class="No-Break"><span class="koboSpan" id="kobo.667.1">following modifiers:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.668.1">nocase</span></strong><span class="koboSpan" id="kobo.669.1">: This indicates that the strings should not be case-sensitive. </span><span class="koboSpan" id="kobo.669.2">This provides the rule author with a bit more leeway when it comes to the text strings found within the malware. </span><span class="koboSpan" id="kobo.669.3">For example, if the author wanted to include all variations of the word “malware,” the line within the YARA rule would look similar to </span><strong class="source-inline"><span class="koboSpan" id="kobo.670.1">$string1 = "</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.671.1">malware" nocase</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.672.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.673.1">wide</span></strong><span class="koboSpan" id="kobo.674.1">: Malware binaries often use strings encoded with two bytes per character. </span><span class="koboSpan" id="kobo.674.2">The wide modifier searches for strings encoded in this way. </span><span class="koboSpan" id="kobo.674.3">Pivoting from the previous example, the modifier can be added to the string: </span><strong class="source-inline"><span class="koboSpan" id="kobo.675.1">$string1 = "malware" </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.676.1">nocase wide</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.677.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.678.1">fullword</span></strong><span class="koboSpan" id="kobo.679.1">: The </span><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">fullword</span></strong><span class="koboSpan" id="kobo.681.1"> modifier should be used if the author only wishes to match a string that is delimited by non-alphanumeric characters – for example, in the previous example, if the rule author wanted to match on strings such as </span><em class="italic"><span class="koboSpan" id="kobo.682.1">malware</span></em><span class="koboSpan" id="kobo.683.1"> only and not </span><em class="italic"><span class="koboSpan" id="kobo.684.1">antimalware</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.685.1">or </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.686.1">malwared</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.687.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.688.1">xor</span></strong><span class="koboSpan" id="kobo.689.1">: This modifier looks for strings that have been encrypted with an XOR function. </span><span class="koboSpan" id="kobo.689.2">This is handy to keep in mind when looking through code associated with known Command and Control frameworks such as Cobalt Strike. </span><span class="koboSpan" id="kobo.689.3">In </span><a href="B18571_16.xhtml#_idTextAnchor284"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.690.1">Chapter 16</span></em></span></a><span class="koboSpan" id="kobo.691.1">, we will look at common ransomware attacks that use tools that make use of XOR functions to bypass </span><span class="No-Break"><span class="koboSpan" id="kobo.692.1">detection controls.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.693.1">Base64</span></strong><span class="koboSpan" id="kobo.694.1">: Another common tactic among threat actors is to utilize scripts encoded with</span><a id="_idIndexMarker1503"/><span class="koboSpan" id="kobo.695.1"> Base64 encoding. </span><span class="koboSpan" id="kobo.695.2">This modifier identifies encoded strings within the </span><span class="No-Break"><span class="koboSpan" id="kobo.696.1">malware file.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.697.1">In the sample YARA rule, the strings are made up of several hexadecimal strings, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.698.1">$s1 = { 6C 00 6F 00 67 00 69 00 63 00 61 00 </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.699.1">6C }</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.700.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.701.1">The final part of the YARA rule</span><a id="_idIndexMarker1504"/><span class="koboSpan" id="kobo.702.1"> is its </span><strong class="bold"><span class="koboSpan" id="kobo.703.1">conditions</span></strong><span class="koboSpan" id="kobo.704.1">. </span><span class="koboSpan" id="kobo.704.2">These set the parameters to identify if the sample matches the YARA rule. </span><span class="koboSpan" id="kobo.704.3">These are Boolean expressions that computer programmers are already familiar with. </span><span class="koboSpan" id="kobo.704.4">YARA can understand both the typical Boolean operators as well as the relational, arithmetic, and bitwise operators </span><span class="No-Break"><span class="koboSpan" id="kobo.705.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.706.1">YARA is a</span><a id="_idIndexMarker1505"/><span class="koboSpan" id="kobo.707.1"> flexible tool that can be used to identify the presence of malware or exploits in a variety of file locations. </span><span class="koboSpan" id="kobo.707.2">Additionally, YARA is an open source project with a wide range of contributors from commercial antivirus coders to independent researchers that make rules available to the community. </span><span class="koboSpan" id="kobo.707.3">In the next chapter, we will look at how these rules can be applied to an incident investigation. </span><span class="koboSpan" id="kobo.707.4">Before we conclude, though, we will look at a simple tool that can aid an analyst in crafting their </span><span class="No-Break"><span class="koboSpan" id="kobo.708.1">own rules.</span></span></p>
<h2 id="_idParaDest-292"><a id="_idTextAnchor299"/><span class="koboSpan" id="kobo.709.1">YarGen</span></h2>
<p><span class="koboSpan" id="kobo.710.1">Incident</span><a id="_idIndexMarker1506"/><span class="koboSpan" id="kobo.711.1"> response and malware analysts will often have to create rules for a large number of malware samples. </span><span class="koboSpan" id="kobo.711.2">Depending on the complexity of the malware and the quantity of malware, this can often be a time-consuming process. </span><span class="koboSpan" id="kobo.711.3">To help with the creation of YARA rules, Florian Roth has developed a Python-based tool called </span><strong class="bold"><span class="koboSpan" id="kobo.712.1">YarGen</span></strong><span class="koboSpan" id="kobo.713.1"> that automates the creation of </span><span class="No-Break"><span class="koboSpan" id="kobo.714.1">YARA rules.</span></span></p>
<p><span class="koboSpan" id="kobo.715.1">YarGen can </span><a id="_idIndexMarker1507"/><span class="koboSpan" id="kobo.716.1">be downloaded from GitHub at </span><a href="https://github.com/Neo23x0/yarGen"><span class="koboSpan" id="kobo.717.1">https://github.com/Neo23x0/yarGen</span></a><span class="koboSpan" id="kobo.718.1"> and installed on any system that can execute Python scripts. </span><span class="koboSpan" id="kobo.718.2">Once installed, the script can be run against a directory of malware samples. </span><span class="koboSpan" id="kobo.718.3">In this case, we will run the script against the malware sample we examined previously. </span><span class="koboSpan" id="kobo.718.4">In this case, the following command will run the script against </span><span class="No-Break"><span class="koboSpan" id="kobo.719.1">the sample:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.720.1">
remnux@remnux:~/yarGen-master$ python3 yarGen.py -m /home/remnux/Downloads/malware_samples/</span></pre>
<p><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.721.1">Figure 16</span></em></span><em class="italic"><span class="koboSpan" id="kobo.722.1">.23</span></em><span class="koboSpan" id="kobo.723.1"> indicates </span><a id="_idIndexMarker1508"/><span class="koboSpan" id="kobo.724.1">the script is </span><span class="No-Break"><span class="koboSpan" id="kobo.725.1">being run:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer351">
<span class="koboSpan" id="kobo.726.1"><img alt="Figure 16.23 – YarGen YARA rule generator " src="image/B18571_16_023.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.727.1">Figure 16.23 – YarGen YARA rule generator</span></p>
<p><span class="koboSpan" id="kobo.728.1">The command products the following YARA rule. </span><span class="koboSpan" id="kobo.728.2">It is important to note that the rules should be reviewed and modified as</span><a id="_idIndexMarker1509"/><span class="koboSpan" id="kobo.729.1"> needed as the tool does not perfectly match the strings and other data. </span><span class="koboSpan" id="kobo.729.2">Therefore, analysts should put the outputted rule through some cleanup and </span><a id="_idIndexMarker1510"/><span class="koboSpan" id="kobo.730.1">post-processing to ensure that the rule does not contain any unnecessary strings or conditions that increase the rate of </span><span class="No-Break"><span class="koboSpan" id="kobo.731.1">false positives:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.732.1">
 /*
   YARA Rule Set
   Author: yarGen Rule Generator
   Date: 2022-07-27
   Identifier: malware_samples
   Reference: https://github.com/Neo23x0/yarGen
*/
/* Rule Set ----------------------------------------------------------------- */
rule sig_6b69de892df50de9a94577fed5a2cbb099820f7ca618771a93cca4de6196d242
{
   meta:
      description = "malware_samples - file 6b69de892df50de9a94577fed5a2cbb099820f7ca618771a93cca4de6196d242.exe"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2021-07-27"
      hash1 = "6b69de892df50de9a94577fed5a2cbb099820f7ca618771a93cca4de6196d242"
   strings:
      $x1 = "&lt;?xml version=\"1.0\" e</span><a id="_idTextAnchor300"/><span class="koboSpan" id="kobo.733.1">ncoding=\"UTF-8\" standalone=\"yes\"?&gt;&lt;assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersio" ascii
      $x2 = "&lt;assemblyIdentity version=\"1.0.0.0\" processorArchitecture=\"X86\" name=\"Nullsoft.NSIS.exehead\" type=\"win32\"/&gt;&lt;description&gt;" ascii
      $s3 = "ExecutionLevel level=\"asInvoker\" uiAccess=\"false\"/&gt;&lt;/requestedPrivileges&gt;&lt;/security&gt;&lt;/trustInfo&gt;&lt;compatibility xmlns=\"urn:s" ascii
      $s4 = " Install System v2.46&lt;/description&gt;&lt;trustInfo xmlns=\"urn:schemas-microsoft-com:asm.v3\"&gt;&lt;security&gt;&lt;requestedPrivileges&gt;&lt;request" ascii
      $s5 = "s-microsoft-com:compatibility.v1\"&gt;&lt;application&gt;&lt;supportedOS Id=\"{35138b9a-5d96-4fbd-8e2d-a2440225f93a}\"/&gt;&lt;supportedOS Id=\"{e" ascii
      $s6 = "&lt;?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?&gt;&lt;assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersio" ascii
      $s7 = "SHFOLDER" fullword ascii /* Goodware String - occured 37 times */
      $s8 = "NullsoftInst" fullword ascii /* Goodware String - occured 89 times */
      $s9 = "SeShutdownPrivilege" fullword ascii /* Goodware String - occured 153 times */
      $s10 = "mXDZG^H}" fullword ascii
      $s11 = "WyUG\"_" fullword ascii
      $s12 = "_`.XJn" fullword ascii
      $s13 = "nTwZvD#" fullword ascii
      $s14 = "gTFeK?" </span><span class="koboSpan" id="kobo.733.2">fullword ascii
      $s15 = "snBZR_j" fullword ascii
      $s16 = "vRPe~VSR" fullword ascii
      $s17 = "008deee3d3f0" ascii
      $s18 = "]WJgX&gt;kMix" fullword ascii
      $s19 = ",ywSvQMQ" fullword ascii
      $s20 = "fjUu.$U" fullword ascii
   condition:
      uint16(0) == 0x5a4d and filesize &lt; 500KB and
      1 of ($x*) and 4 of ($s*)
}</span></pre>
<p><span class="koboSpan" id="kobo.734.1">In looking over the </span><a id="_idIndexMarker1511"/><span class="koboSpan" id="kobo.735.1">rule, we can see a few key strings that stand out. </span><span class="koboSpan" id="kobo.735.2">First is that the NSIS loader is identified in </span><strong class="source-inline"><span class="koboSpan" id="kobo.736.1">$x2 = "&lt;assemblyIdentity version=\"1.0.0.0\" processorArchitecture=\"X86\" name=\"Nullsoft.NSIS.exehead\" type=\"win32\"/&gt;&lt;description&gt;" ascii</span></strong><span class="koboSpan" id="kobo.737.1">. </span><span class="koboSpan" id="kobo.737.2">We also can see various ASCII strings that have been extracted in </span><strong class="source-inline"><span class="koboSpan" id="kobo.738.1">$s10-$s20</span></strong><span class="koboSpan" id="kobo.739.1">. </span><span class="koboSpan" id="kobo.739.2">This rule also makes use of the file size condition. </span><span class="koboSpan" id="kobo.739.3">This condition ensures that the file size matches, reducing false positives. </span><span class="koboSpan" id="kobo.739.4">The one key string that is missing is the URL that was identified earlier in our examination of the file with PEStudio. </span><span class="koboSpan" id="kobo.739.5">This can easily be incorporated as an additional string </span><span class="No-Break"><span class="koboSpan" id="kobo.740.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.741.1">
$x3 = "http://nsis.sf.net/NSIS_Error" ascii</span></pre>
<p><span class="koboSpan" id="kobo.742.1">With just a short amount of post-processing, this rule can be applied to other systems, disk or memory images, or other files to determine if the malware is present. </span><span class="koboSpan" id="kobo.742.2">YARA has become an often leveraged tool with regards to identifying the presence of malware or exploits on a system and should be included in an analyst’s toolset when they’re working </span><span class="No-Break"><span class="koboSpan" id="kobo.743.1">with malware.</span></span></p>
<h1 id="_idParaDest-293"><a id="_idTextAnchor301"/><span class="koboSpan" id="kobo.744.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.745.1">This chapter addressed the various elements of malware analysis for an incident responder. </span><span class="koboSpan" id="kobo.745.2">First, having an understanding of malware, in general, is necessary, as it is by far the most prevalent threat available to adversaries. </span><span class="koboSpan" id="kobo.745.3">Second, the techniques of malware analysis – static and dynamic – provide responders with tools and techniques to extract key data points. </span><span class="koboSpan" id="kobo.745.4">Finally, the use of sandboxing systems allows responders to gain insight into malware behavior and attributes quickly, and in a </span><span class="No-Break"><span class="koboSpan" id="kobo.746.1">controlled manner.</span></span></p>
<p><span class="koboSpan" id="kobo.747.1">In many ways, this chapter has merely scratched the surface concerning malware analysis. </span><span class="koboSpan" id="kobo.747.2">It should become apparent that, even with tools for static and dynamic analysis, incident response analysts still have a great deal of skill-building ahead of them if they want to master this highly specialized subset of digital forensics. </span><span class="koboSpan" id="kobo.747.3">Although it may be difficult, it is important to have at least a functional knowledge of this type of analysis as cybercriminals and nation states continue to utilize more sophisticated malware. </span><span class="koboSpan" id="kobo.747.4">This chapter delved into malware analysis by examining the types of malware currently being seen. </span><span class="koboSpan" id="kobo.747.5">An overview of the two primary methods of analysis – static and dynamic – gave some context regarding the tools available. </span><span class="koboSpan" id="kobo.747.6">The tools we discussed allow an analyst to identify behaviors in malware that can be used to identify them. </span><span class="koboSpan" id="kobo.747.7">Finally, executing malware can provide </span><span class="No-Break"><span class="koboSpan" id="kobo.748.1">further details.</span></span></p>
<p><span class="koboSpan" id="kobo.749.1">The next chapter will tie the use of threat intelligence into malware analysis, to allow analysts to tie their observations to what is happening to </span><span class="No-Break"><span class="koboSpan" id="kobo.750.1">other organizations.</span></span></p>
<h1 id="_idParaDest-294"><a id="_idTextAnchor302"/><span class="koboSpan" id="kobo.751.1">Questions</span></h1>
<p><span class="koboSpan" id="kobo.752.1">Answer the following questions to test your knowledge of </span><span class="No-Break"><span class="koboSpan" id="kobo.753.1">this chapter:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.754.1">Which of the following is not a type </span><span class="No-Break"><span class="koboSpan" id="kobo.755.1">of malware?</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.756.1">Trojan</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.757.1">Keylogger</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.758.1">Rootkit</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.759.1">Webshell</span></span></li></ol></li>
<li><span class="koboSpan" id="kobo.760.1">Responders should create a controlled environment in which to conduct </span><span class="No-Break"><span class="koboSpan" id="kobo.761.1">malware analysis.</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.762.1">True</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.763.1">False</span></span></li></ol></li>
<li><span class="koboSpan" id="kobo.764.1">Which of the following is a type of </span><span class="No-Break"><span class="koboSpan" id="kobo.765.1">static analysis?</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.766.1">Runtime behavior</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.767.1">String extraction</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.768.1">Memory addressing</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.769.1">Malware coding</span></span></li></ol></li>
<li><span class="koboSpan" id="kobo.770.1">Which of the following is a type of </span><span class="No-Break"><span class="koboSpan" id="kobo.771.1">dynamic analysis?</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.772.1">Disassembly</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.773.1">Defined point</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.774.1">Packer analysis</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.775.1">Artifact extraction</span></span></li></ol></li>
</ol>
<h1 id="_idParaDest-295"><a id="_idTextAnchor303"/><span class="koboSpan" id="kobo.776.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.777.1">Refer to the following for more information about the topics covered in </span><span class="No-Break"><span class="koboSpan" id="kobo.778.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.779.1">A source for </span><strong class="source-inline"><span class="koboSpan" id="kobo.780.1">.pcap</span></strong><span class="koboSpan" id="kobo.781.1"> files and malware </span><span class="No-Break"><span class="koboSpan" id="kobo.782.1">samples: </span></span><a href="https://www.malware-traffic-analysis.net/index.html"><span class="No-Break"><span class="koboSpan" id="kobo.783.1">https://www.malware-traffic-analysis.net/index.html</span></span></a></li>
<li><span class="koboSpan" id="kobo.784.1">Malware </span><span class="No-Break"><span class="koboSpan" id="kobo.785.1">Unicorn: </span></span><a href="https://malwareunicorn.org/#/"><span class="No-Break"><span class="koboSpan" id="kobo.786.1">https://malwareunicorn.org/#/</span></span></a></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.787.1">MalwareJake: </span></span><a href="http://malwarejake.blogspot.com/"><span class="No-Break"><span class="koboSpan" id="kobo.788.1">http://malwarejake.blogspot.com/</span></span></a></li>
<li><span class="koboSpan" id="kobo.789.1">Florian Roth’s GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.790.1">account: </span></span><a href="https://github.com/Neo23x0/"><span class="No-Break"><span class="koboSpan" id="kobo.791.1">https://github.com/Neo23x0/</span></span></a></li>
</ul>
</div>
</body></html>