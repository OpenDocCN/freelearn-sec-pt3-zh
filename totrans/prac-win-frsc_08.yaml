- en: Chapter 8. Event Log Analysis
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we will learn about Event Logs in the Microsoft operating system.
    We will discuss why it is important to cover issues related to event logs for
    successful investigation. We will consider differences between event logs depending
    on the MS Windows version.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: Event Logs - an introduction
  id: totrans-2
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: When an operating system works, a lot of events take place in the system. The
    range of these events is very large and a majority of them can be registered in
    the system. To register events on the system, there is a powerful mechanism called
    **Event Logging**. It presents a standard centralized way, which the operating
    system and applications use to record important information coming from software
    and hardware. An event can be something that occurred in the system or in some
    application, and it is necessary to notify the user. Information about every event
    should be recorded.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: Events are collected and stored by the Event Logging Service. This keeps events
    from different sources in event logs. Event logs provide chronological information,
    which allows us to determie problems in the system environment and security and tracks
    users' activities and the usage of system resources. However, the kind of data
    that will be actually recorded in an event log is dependent on system configuration
    and application settings. For example, security event logs is turned off on old
    Windows operating systems by default.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: 'Event logs provide a lot of data for investigators, and they can help with
    answers for the following issues:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
- en: '**What happened**: Some items of the event log record, such as Event ID and
    Event Category, help get information about a certain event.'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**When**: Timestamps are a key part of the event log and they provide the temporal
    context for an event. In a system where are a lot of events are generated, the
    timestamps could be very useful to narrow the timeframe of the search.'
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Who**: Which users are involved. All actions that are executed on the Windows
    operating system are committed in some account contexts. Some actions are committed
    not by the normal user but by the operating system, and this will be done in the
    system''s account context, for example, System or Network Service. We can identify
    who is the user behind a certain event.'
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**What systems are involved**: In the network environment, event logs usually
    have a lot of references to accounts from remote systems. Originally only the
    NetBIOS of workstations were recorded in event logs. However, it complicated the
    tracking of involved systems. In systems after Windows 2000, IP addresses are
    also kept in event logs.'
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**What resources are accessed**: The Event Logging Service can be configured
    to store very granulated information about various objects on the system. Almost
    any resource of the system can be considered as an object and, thereby, we can
    detect any requests for unauthorized access to resources.'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Event Logs system
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now that we've figured out that Windows event logs contain a lot of useful information
    and that they can be very valuable resources to detect security incidents, let's
    see where event logs can be found on different versions of MS Windows.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: In the evolution of the MS Windows process, even the Event Logs system was changed.
    It originally appeared in MS Windows 3.1\. Some minor changes occurred in every
    Windows version, but the names of event logs files and paths remained the same
    until Windows 2003\. Initial versions used the .evt binary format. This format
    is not suitable to search for strings or to browse for information without special
    software. Also, these logs have size limitations in results; therefore, new upcoming
    events could rewrite old stored data.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: 'Before Vista, the event logs were as follows:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: However, starting from Vista and Server 2008, significant changes were implemented
    in the event logs structure, types, and locations on the filesystem. The original
    version of the Event Logs system was a heavy load for system performance. A new
    version was developed to fix some issues related to performance too. The new .evtx
    format of event logs was introduced. However, the most significant changes touched
    the structure of the event logs.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: 'In Vista, many new types of event logs were added, their total number became
    more than 70\. These event logs can be found at the following location:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Moreover, the new Event Logs system allows sending events to a remote collector,
    so it''s necessary to keep in mind that additional event logs can be found on
    another server. Note that the presented path for the storage of event logs is
    the default value and it may be changed through the registry key:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: '`HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\Application`'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\System`'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\Security`'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Initially in MS Windows, three types of event logs existed:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: System
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Security
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Application
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: All other extra event logs can be united in the Custom group. Vista, Win7, Server
    2008, Win 8, and Server 2008 now have many additional event logs, including specialized
    event logs for some processes, such as PowerShell, Task Scheduler, and Windows
    Firewall.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s take a look at what kind of information is recorded in various types
    of event logs:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: '**Security Log**: This records events based on local and group policies.'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**System Log**: This records events from the operation system and its components,
    such as failure of a service on the boot system.'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Application Log**: This records events from applications, such as failure
    of access to a file or an antivirus notification.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Directory Service**: This records events from Active Directory and some services
    based on it. It is a standard event logon Domain Controller.'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**File Replication Server**: This records events about updates between Domain
    Controllers. It is a standard event logon Domain Controller.'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**DNS Server**: This is a standard event logon server where DNS server software
    is running. It records events about the management of zones, and the start and
    stop of a DNS server.'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The main reason to dedicate a separate directory for new event logs is their
    large number. As we already mentioned, it exceeds 70.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: 'A new event log can be divided into the following categories:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: '**Setup**: This is a new event log, in which information about Windows security
    updates, patches, hotfixes are stored'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Forwarded Events**: This is also a new event log to record events coming
    from remote computers'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Applications and Services**: This group includes all other new event logs,
    which were introduced in Windows 2008'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Security Event Logs
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The old Event Log system had some issues related to performance. In that version,
    the event log needed to be completely loaded into memory. Sometimes, just for
    one log, 300 MB of RAM had to be allocated. This behavior affected system performance
    very much, and it forced administrators to turn off event logging. In the new
    Event Log system, every event log file has a small header, which is followed by
    64Kb chunks. Now, only the currently used chunk will be loaded into memory. This certainly
    improves performance and reduces resource usage. Also, an increased likelihood
    of logging will be enabled. Almost all event logs could prove to be useful during
    an investigation, nonetheless, most answers for the questions that we have in
    forensics can be found in Security Event Log. System and Application Event Logs
    are more useful for system administrators for troubleshooting.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: Security Event Logs record audit events whenever they occur in the system or
    the user activity which is covered by local or group audit policies. They could
    present details about various user activities, including user authentication (logons,
    run as commands, and remote access) and user activities after logons. Using privileges
    and object auditing could be a trigger event that shows access to protected files,
    which user accessed it, and the date and time of when it happened. An audit allows
    applying security settings to itself so that all modifications of audit policy
    can be traced.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: Keep in mind that security policies may register events with success and failure
    results. It allows adjusting policies and records only data of interest. From
    an investigator's point of view, we want to log as much data as possible. This
    could create additional load to system performance, and it requires significant
    disk space to store information. This is not possible in many environments. For
    some nonforensic professionals, it is not obvious why successful and failed attempts
    to log on should be recorded and how it can help detect a brute force attack.
    Also, it is possible to set additional audit policies for a specific user with
    a built-in `gpedit.msc` snap-in. So, we can set a more detailed audit for critically
    valuable users.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
- en: Due its nature, Security Log has more protections than System and Application
    event logs. Starting from Windows XP SP2, the API for applications that send events
    to the Security event log was deprecated, excluding the Windows Security Service.
    Now this possibility is available only for Local Security Authority System Service
    (LSASS) because it is responsible for applying security policies in the system.
    Moreover, only users with administrator permissions can review, export, or clear
    the Security event log.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 由于其性质，安全日志比系统和应用程序事件日志有更多的保护。从 Windows XP SP2 开始，发送事件到安全事件日志的应用程序 API 被弃用，排除了
    Windows 安全服务。现在，这个功能仅对本地安全授权系统服务（LSASS）可用，因为它负责在系统中应用安全策略。此外，只有具有管理员权限的用户才能查看、导出或清除安全事件日志。
- en: 'Let''s take a look at what kind of information is stored in the Security event
    log:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看看安全事件日志中存储了什么样的信息：
- en: '**Account Logon**: These are events that are stored on the system and which
    authorize the user. So, it could be workstation or Domain Controller.'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**账户登录**：这些是存储在系统上的事件，用于授权用户登录。因此，可能是工作站或域控制器的登录。'
- en: '**Account Mgmt**: This is account maintenance and modification.'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**账户管理**：这是账户的维护和修改。'
- en: '**Logon Events**: This is every logon or logoff event on the local system.'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**登录事件**：这是本地系统中的每次登录或注销事件。'
- en: '**Directory Service**: These are attempts to access the objects of the Active
    Directory.'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**目录服务**：这些是访问 Active Directory 对象的尝试。'
- en: '**Object Access**: This is access to objects which have their own access control
    list.'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**对象访问**：这是对具有自己访问控制列表的对象的访问。'
- en: '**Policy Change**: These are modifications of users'' rights and audit policies.'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**策略更改**：这些是用户权限和审计策略的修改。'
- en: '**Privilege Use**: This has each case of an account exercising a user right.'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**特权使用**：这是账户行使用户权限的每个实例。'
- en: '**Process Tracking**: This stores the start, stop process, and objects access.'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**进程跟踪**：这记录了进程的启动、停止及对象访问。'
- en: '**System Events**: This is the start and shutdown of the system.'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**系统事件**：这是系统的启动和关闭。'
- en: The Security Event Categories give us understanding about what kind of events
    can be interesting for us. For every category, we can set an audit policy in the
    values No Auditing, Success, Failure, or Success and Failure both. Every time
    an event is recorded in the event log file, it is marked by the category to which
    it belongs. When the audit is turned off, we will not see any information about
    such types of events in the event log file.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 安全事件类别让我们了解哪些事件可能对我们有意义。对于每个类别，我们可以设置审计策略，其值可以是无审计、成功、失败或成功和失败两者。每当事件被记录在事件日志文件中时，它会被标记为所属的类别。当审计被关闭时，我们将无法在事件日志文件中看到此类事件的任何信息。
- en: One of the most disappointing things during an investigation is hitting a dead
    end. This often happens because we lack event logs. Some investigations, such
    as intrusion and event log analysis, are very important to track the activities
    of the intruder. In others, such as employee misuse, they present extra artifacts,
    which prove the case with significant information, such as time of log on, installation
    programs, and access to specific files. Unfortunately, audit policies don't have
    rules and event logs don't contain useful information. So, it is important to
    configure an audit policy, such that Windows records only what we need.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 调查过程中最令人失望的事情之一就是走到死胡同。这种情况常常发生，因为我们缺少事件日志。有些调查，如入侵和事件日志分析，对于追踪入侵者的活动非常重要。而在其他一些调查中，如员工滥用，事件日志提供了额外的证据，这些证据包含了重要的信息，比如登录时间、安装的程序以及对特定文件的访问。不幸的是，审计策略没有规则，事件日志也不包含有用的信息。因此，配置审计策略非常重要，以确保
    Windows 仅记录我们需要的信息。
- en: Also, the settings on systems executing various roles could be different. Audit
    policies and the number of event logs turned on by default on Workstations, Servers,
    and Domain Controllers will differ. The Event Logs system on Windows 7 or Windows
    8 has minimal logs and it is turned off at all times on Windows XP and Vista by
    default. Due to the fact that Windows 7 and Windows 8 are becoming more and more
    common, we can expect more systems with Security, System, and Application event
    logs. It should be noted that in the corporate network, there are domain policies.
    Local policies will be rewritten by group policies and, thus, increase logging
    information.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: Many investigators mistakenly believe that server versions of Windows have good
    settings for event logging out of the box. However, similar workstations standard
    configuration of server have a minimal set of logged data.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: From Windows 2008 onward, every event category is divided into a subcategory
    called **extended audit policies** . These detailed options were introduced to
    allow better control over events that need to be monitored by administrators.
    This became available in Windows 7 and later.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: Event types give us reasons as to why an event was recorded into an event log
    file. Also, they can provide important information about the severity of the event,
    allowing the administrator to focus on more critical events.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: 'We have the following types of events:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
- en: '**Error**: These are significant problems, such as loss of data or functionality;
    for example, the server fails to load'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Warning**: These are not significant problems but they can be a problem in
    the future; for example, low disk space'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Information**: These are successful operations of applications or services;
    for example, a service was started'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Success Audit**: These are notifications that audited events completed successfully,
    for example, successful user logon'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Failure Audit**: These are notifications that the audited event did not complete
    successfully, for example, failed access to device'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Extracting Event Logs
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: When event logs are analyzed, the most common approach is to export logs and
    then review them on the forensics workstation. There are a few reasons for such
    an approach. Often, we need to analyze a few event logs (for example, System,
    Security, and Application) from several workstations and Domain Controller. So,
    it is very convenient to have all event log files in one place. Also, many forensics
    tools not enough good work with event logs.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: 'There are two main approaches to export event logs:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
- en: Live systems
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Offline systems
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Both of them have their own set of features; let's see what they are.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: Live systems
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: While working with live systems, remember that event log files are always used,
    which creates some additional challenges. One way of exporting data from a live
    system is using Event Viewer. If you right-click on the event log file, the  **Save
    All Events As...** option will appear. Logs can be saved in various formats, including
    `.evtx`, `.csv`, `.xml`, or `.txt` . If you are concerned about possible log corruption,
    this is the safest way.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
- en: Another alternative for live systems is using FTK Imager so that you can mount
    the drive as a Physical Disk and export event log files. In practice, there may
    occur a situation when the event file is corrupted. However, it is still possible
    to analyze it. The MS Event Viewer may refuse to open such files. The situation
    with new `.evtx` format is a little bit better, as new file log corruption happens
    much more rarely, and MS Event Viewer is more tolerant of this format.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
- en: 'The MS Resource Kit includes the elogdump utility, which allows keeping containment
    of the event log from a local or remote computer. The PsLogList utility is the
    analog of elogdump with one difference: PsLogList allows logging in on a remote
    system and receives the message from the remote system in case the attempt failed.
    It is the best alternative to the live system, and it is a free tool from SysInternals.
    This command line tool has a lot of features. It can dump live event logs to `.csv`
    file, read, and output exported data in the native `.evt`/`.evtx` format, filter
    output and dump event logs from a remote system. By default, it outputs the system
    event log file.'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
- en: Offline system
  id: totrans-77
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Event logs are binary databases, so to review `.evt/.evtx` files, we need tools
    that can parse these formats. There are a few good free tools which allow converting
    binary format of event logs to human readable text formats.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: TZWorks released `evtwalk` and `evtx_viewer` . Harlan Carvey wrote a few Perl
    scripts to parse event log files, and Andreas Schuster released `evtx_parser`
    .
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
- en: Extraction of event logs from an offline system is often the last hope for investigators
    who encounter corrupted event logs, but this approach has some benefits. For example,
    there is data stored in event logs, access to which is difficult using standard
    log viewers. The most important one of these is the *number of records* in an
    event log file. The number of records is assigned sequentially to an event within
    the log file. So, a missed number will be a marker for manipulation with events
    in the event log. The best way to get access to this data is to extract the specific
    events and sort it with a database or spreadsheet.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-81
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The TZWorks evtwalk tool can be used for both live and offline systems. For
    a live system, we can use the `-livesys` option; it will examine all the event
    logs on the host. The evtwalk tool will determine the version of operating system
    and scan the appropriate event log directory for that version of Windows.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: For offline analysis, when event logs are gathered as part of an investigation,
    the evtwalk tool can be invoked with `-pipe`. The `-pipe` option allows `evtwalk`
    to receive a separate path or filename per line as input and process each of them
    separately.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
- en: 'For Windows, one can use the built-in `dir` command along with some of its
    companion switches to get the desired result. The following is an example of using
    this option:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The `evtwalk` command can work with one or multiple event files specified with
    the -log option and is separated by the | character.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: Another unique feature of the evtwalk tool is its ability to output data to
    the timeline format with the  `cvsl2t` (log2timeline) and  `bodyfile` (mactime)
    options. Due to this fact, we have the ability to combine event log activity with
    filesystem and registry activity that allows determining what happened on the
    computer.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: Instead of displaying all the records that are presented in an event log, it
    is possible to filter a certain class of event data.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: 'For evtwalk, the following report categories are available:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
- en: Password changes
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Clock changes or updates
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: User logon and logoff events
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: System start and stop times
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: User credential or permission changes
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: USB events
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: An analyst may want their own report template. In this case, they can determine
    the report template and specify it using the cmdfile option. It should be noted
    that if you want to run evtwalk on a live system, you should run it with administrator
    permissions.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
- en: Evtx_view is the GUI version of the evtwalk tool. This is a good tool to exactly
    understand how events are recorded and what data is available. Both tools have
    unique features, allowing them to filter specific types of events according to
    the action which they represent. Investigators can make a request to report only
    particular events, for example logons, password changes, times of modifications,
    USB usage, and so on. TZWorks tools are nice, but they are not free.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
- en: Event Viewer
  id: totrans-98
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'One tool that you can use for free is Event Viewer. One of the most interesting
    features of Event Viewer is that you can review events from remote PCs in a corporate
    network. This could be a good alternative to usage of Remote Desktop. This may
    be very useful in a live response when it is necessary to check something specific
    very fast. For example, if we need to know whether the compromised user account
    was used or whether some malware-specific service was started. The ability to
    have a quick answer for critically important questions has big value for effective
    incident response:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
- en: To review event logs from other computers, right-click on Event Viewer (Local)
    and choose Connect to Another Computer.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select Another Computer, input IP Address or Hostname, and click on OK.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  id: totrans-102
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Starting from Windows 7, Event Viewer allows specifying different accounts for
    remote authentication (similar to "run as").
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: Keep in mind that when your review event logs on a live system, all events with
    your activities will be recorded to event logs, including remote logons executed
    for review of logs. You may also see new 4624, 4776, 4769, and 4674 events in
    event logs, depending on network settings and audit policies.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: The built-in Windows Event Viewer has significant disadvantages. It is very
    tedious to review a lot of events in the Event Viewer interface. There is no ability
    to load a few logs from different systems and to filter them and search in parallel.
    Besides this, Event Viewer has strict requirements for the format of event log
    files. In practice, you may have corrupted files, and some unexperienced analysts
    may give up an analysis of event logs when they cannot open them with Event Viewer.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
- en: Event Log Explorer
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'One more utility for Event Log analysis is Event Log Explorer. This is event
    log management software, which works over built-in Microsoft tools. It provides
    all the features that are needed by analysts to quickly analyze event logs. It
    supports all the current versions of MS Windows and the `.evt` and `.evtx` formats.
    However, what is more important is that it works with corrupted files. It has
    two options:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
- en: To open event logs with API
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To open event files in direct parsing mode
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Event Log Explorer allows opening a few event log files simultaneously and using
    an event to combine them. Moreover, it has rich filtering features, including
    access to the Event Description text field where significant forensics artifacts
    are. Also very useful is the feature of marking various Event IDs by different
    color. Event Log Explorer is free for personal use and costs around $100 for commercial
    use.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
- en: Useful resources
  id: totrans-111
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: It is not possible to describe all events in one chapter, so you can find out
    more information about events that you are interested in some internet resources.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
- en: 'Here are useful resources with information related to the event logs topic:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: A good resource of information about a lot of forensics topics is the SANS Reading
    Room ( [https://www.sans.org/reading-room/](https://www.sans.org/reading-room/)
    ). Here, are you can find many useful white papers and written analysts, students
    and forensics investigators. One of these is a white paper written by Russ Antony
    ([http://www.sans.org/reading-room/whitepapers/logging/detecting-security-incidents-windows-workstation-event-logs-34262](http://www.sans.org/reading-room/whitepapers/logging/detecting-security-incidents-windows-workstation-event-logs-34262)).
    It describes how useful Event Logs can be to detect anomalies in system and for
    investigations of security incidents.
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  id: totrans-115
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: It is impossible and also not necessary to remember all Event ID and error codes
    that are related to them. Fortunately, we have a few online resources with such
    information.
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: A good place to search for information about events is MS TechNet ([https://www.microsoft.com/technet/support/ee/ee_advanced.aspx](https://www.microsoft.com/technet/support/ee/ee_advanced.aspx)).
    This resource contains a lot of information on various Event IDs for numbers and
    different MS operation systems and applications.
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Event ID.net ( [http://www.eventid.net/](http://www.eventid.net/) ) is another
    very good resource related to this topic. It contains useful information about
    different Event Logging issues.
  id: totrans-118
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Ultimate Windows Security ([www.ultimatewindowssecurity.com](http://www.ultimatewindowssecurity.com/))
    contains databases which are supported and updated by the community.
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Analyzing the event log – an example
  id: totrans-120
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Let''s take a look at a small example, how we can use the Event Log Explorer
    to analyze an event log. Assume that we have event log files from the analyzed
    system:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
- en: First, load the Security log. This displays all events relating to login, the
    creation of new accounts, and more. Let's try to display all the users who log
    in to the system. A login event has the 4,624 identifier. We can apply an Event
    ID = 4,624 filter. Note that we should adjust the time. Choose **Time Correction...**
    from View according to the offset from GMT on the forensics station. For instance,
    if you work on a system with GMT + 3, you need to input -3 to get time of events
    in the GMT time zone:![Analyzing the event log – an example](img/image_08_001.jpg)
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, we can sort out user accounts. We see that we have an unusual user, `SYSTEMSERVICE`.
    Let''s filter all events with this account. We can filter by `SYSTEMSERVICE` in
    the **Description** field:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Analyzing the event log – an example](img/image_08_002.jpg)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
- en: 'After applying this filter, we will have the following result:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
- en: 'We can see the following events with this account with a chronological timeline:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
- en: '| **Event ID** | **Description** |'
  id: totrans-127
  prefs: []
  type: TYPE_TB
- en: '| 4624 | This is a successful log in to the system |'
  id: totrans-128
  prefs: []
  type: TYPE_TB
- en: '| 4634 | This is a log off from the system |'
  id: totrans-129
  prefs: []
  type: TYPE_TB
- en: '| 4647 | This is a log off from the system |'
  id: totrans-130
  prefs: []
  type: TYPE_TB
- en: '| 4648 | This is an unsuccessful log in attempt |'
  id: totrans-131
  prefs: []
  type: TYPE_TB
- en: '| 4672 | This is an assignment of new privileges |'
  id: totrans-132
  prefs: []
  type: TYPE_TB
- en: '| 4720 | This is an account creation |'
  id: totrans-133
  prefs: []
  type: TYPE_TB
- en: '| 4722 | This is an account activation |'
  id: totrans-134
  prefs: []
  type: TYPE_TB
- en: '| 4724 | This is an attempt to change password |'
  id: totrans-135
  prefs: []
  type: TYPE_TB
- en: '| 4726 | This is an account deletion |'
  id: totrans-136
  prefs: []
  type: TYPE_TB
- en: '| 4738 | This is an account modification |'
  id: totrans-137
  prefs: []
  type: TYPE_TB
- en: We can see that the account was created on April 8, 2014 at 12:40:52 UTC.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s view the types of login (login using RDP has type 10); to do this, just
    filter Logon Type equal 10:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
- en: '![Analyzing the event log – an example](img/image_08_003.jpg)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
- en: 'After applying the filter, we will have the following result:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
- en: This user remotely accessed the system on April 8, 2014 at 12:10:18 UTC.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
- en: So now, we can figure out this is a malicious account, when it was created,
    and when and how it logged in to the system.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-144
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we have seen that event logs can be a useful source of evidence
    for forensic investigations. We examined the structure of event logs and looked
    at the features of event log systems for various Windows operating systems. We
    looked at some tools, which you can use to analyze event logs.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will look at some files with which the Windows OS works.
    These files are artifacts of Windows live, and they reflect what occurred in the
    system. We will learn to analyze prefetch, links, and jobs files.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
