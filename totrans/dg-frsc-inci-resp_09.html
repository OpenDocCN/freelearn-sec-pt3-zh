<html><head></head><body>
<div id="_idContainer174">
<h1 class="chapter-number" id="_idParaDest-153"><a id="_idTextAnchor156"/><span class="koboSpan" id="kobo.1.1">9</span></h1>
<h1 id="_idParaDest-154"><a id="_idTextAnchor157"/><span class="koboSpan" id="kobo.2.1">Analyzing Network Evidence</span></h1>
<p><a href="B18571_05.xhtml#_idTextAnchor084"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.3.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.4.1"> explored how incident responders and security analysts can acquire network-based evidence for later evaluation. </span><span class="koboSpan" id="kobo.4.2">That chapter focused on two primary sources of that evidence: network log files and network packet captures. </span><span class="koboSpan" id="kobo.4.3">This chapter will show you which tools and techniques are available to examine the evidence acquired. </span><span class="koboSpan" id="kobo.4.4">Incorporating these techniques into an incident response investigation can provide incident response analysts with insight into the network activity of </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">possible threats.</span></span></p>
<p><span class="koboSpan" id="kobo.6.1">In this chapter, the following main topics will </span><span class="No-Break"><span class="koboSpan" id="kobo.7.1">be addressed:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.8.1">Network </span><span class="No-Break"><span class="koboSpan" id="kobo.9.1">evidence overview</span></span></li>
<li><span class="koboSpan" id="kobo.10.1">Analyzing firewall and </span><span class="No-Break"><span class="koboSpan" id="kobo.11.1">proxy logs</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.12.1">Analyzing NetFlow</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Analyzing </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">packet captures</span></span></li>
</ul>
<h1 id="_idParaDest-155"><a id="_idTextAnchor158"/><span class="koboSpan" id="kobo.15.1">Network evidence overview</span></h1>
<p><span class="koboSpan" id="kobo.16.1">Adversaries</span><a id="_idIndexMarker765"/><span class="koboSpan" id="kobo.17.1"> are </span><a id="_idIndexMarker766"/><span class="koboSpan" id="kobo.18.1">bound to the same network protocols that govern normal network traffic. </span><span class="koboSpan" id="kobo.18.2">Here, adversarial techniques that can be identified by analyzing network data properly </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">are addressed.</span></span></p>
<p><span class="koboSpan" id="kobo.20.1">In </span><a href="B18571_05.xhtml#_idTextAnchor084"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.21.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.22.1"> we focused on the various sources of evidence that network devices produce. </span><span class="koboSpan" id="kobo.22.2">Most of this evidence is contained within the variety of log files produced by switches, routers, and firewalls. </span><span class="koboSpan" id="kobo.22.3">Depending on the type of environment that responders find themselves in, this evidence source can be augmented with NetFlow data and full </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">packet captures.</span></span></p>
<p><span class="koboSpan" id="kobo.24.1">Once the various sources have been understood, it is important to focus on what logs, NetFlow, and packet captures can tell us about an incident. </span><span class="koboSpan" id="kobo.24.2">The following are several areas of focus where proper logging and evidence collection may provide additional context surrounding an</span><a id="_idIndexMarker767"/><span class="koboSpan" id="kobo.25.1"> incident, as well as potential data points when deriving </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">root cause:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.27.1">Reconnaissance and scanning behavior</span></strong><span class="koboSpan" id="kobo.28.1">: There are a plethora of tools available to</span><a id="_idIndexMarker768"/><span class="koboSpan" id="kobo.29.1"> adversaries to automate the process of scanning perimeter devices such as firewalls and routers. </span><span class="koboSpan" id="kobo.29.2">These scanners attempt to ascertain open ports, vulnerabilities, or authentication protocols such </span><a id="_idIndexMarker769"/><span class="koboSpan" id="kobo.30.1">as </span><strong class="bold"><span class="koboSpan" id="kobo.31.1">Secure Shell</span></strong><span class="koboSpan" id="kobo.32.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.33.1">SSH</span></strong><span class="koboSpan" id="kobo.34.1">) that can be exploited. </span><span class="koboSpan" id="kobo.34.2">These scans do leave a trace as they will often require connections to the devices. </span><span class="koboSpan" id="kobo.34.3">Depending on the level of logging and the retention period, responders may be able to identify the external infrastructure that is attempting to compromise the </span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">perimeter systems.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.36.1">Initial infection</span></strong><span class="koboSpan" id="kobo.37.1">: Adversaries </span><a id="_idIndexMarker770"/><span class="koboSpan" id="kobo.38.1">have become very sophisticated in compromising systems. </span><span class="koboSpan" id="kobo.38.2">They will often make use of multi-stage exploits and malware. </span><span class="koboSpan" id="kobo.38.3">The first stage will call out to an external infrastructure through a URL and download additional exploits. </span><span class="koboSpan" id="kobo.38.4">Web proxies and firewalls may have connection data contained within the log files that record </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">this activity.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.40.1">Lateral movement</span></strong><span class="koboSpan" id="kobo.41.1">: Once </span><a id="_idIndexMarker771"/><span class="koboSpan" id="kobo.42.1">inside a network, adversaries will often attempt to conduct reconnaissance, exploit other systems, and move data around. </span><span class="koboSpan" id="kobo.42.2">NetFlow logs provide insight into this type </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">of behavior.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.44.1">Command and control</span></strong><span class="koboSpan" id="kobo.45.1">: Once a</span><a id="_idIndexMarker772"/><span class="koboSpan" id="kobo.46.1"> foothold has been established in the network, adversaries require the ability to maintain control over compromised systems. </span><span class="koboSpan" id="kobo.46.2">Logs, packet captures, and NetFlow data may be leveraged to identify this type </span><span class="No-Break"><span class="koboSpan" id="kobo.47.1">of behavior.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.48.1">Data exfiltration</span></strong><span class="koboSpan" id="kobo.49.1">: One of the goals </span><a id="_idIndexMarker773"/><span class="koboSpan" id="kobo.50.1">of an adversary may be to compromise and exfiltrate data. </span><span class="koboSpan" id="kobo.50.2">Proxy logs may identify the destination of such data. </span><span class="koboSpan" id="kobo.50.3">NetFlow may show the flow of data from the internal systems to any external systems. </span><span class="koboSpan" id="kobo.50.4">Finally, packet captures may be leveraged to identify the exfiltrated files, the source of the data, and </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">the destination.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.52.1">In </span><a href="B18571_05.xhtml#_idTextAnchor084"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.53.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.54.1"> we discussed the three main types of network evidence that can be leveraged in an incident. </span><span class="koboSpan" id="kobo.54.2">It is often hard for responders that do not know about network traffic to understand its various aspects. </span><span class="koboSpan" id="kobo.54.3">Think about network traffic as a letter that is sent from one individual to another. </span><span class="koboSpan" id="kobo.54.4">Log data records the sender’s and receiver’s addresses and mailbox numbers at a central location, such as the local post office. </span><span class="koboSpan" id="kobo.54.5">This is akin to the source and destination IP addresses </span><span class="No-Break"><span class="koboSpan" id="kobo.55.1">and ports.</span></span></p>
<p><span class="koboSpan" id="kobo.56.1">NetFlow records much of the same information about the letter but can also tell the individual the weight or relative size of the letter, along with the sender’s and receiver’s addresses and mailbox numbers. </span><span class="koboSpan" id="kobo.56.2">Finally, a packet capture tells us all the same information that’s obtained through logs and NetFlow but will also tell the individual the contents of the letter, including (so long as it is not encrypted) the actual data </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">contained within.</span></span></p>
<p><span class="koboSpan" id="kobo.58.1">Identifying a root cause </span><a id="_idIndexMarker774"/><span class="koboSpan" id="kobo.59.1">with network evidence is largely dependent on the evidence itself. </span><span class="koboSpan" id="kobo.59.2">One major drawback to evidence such as packet captures and log files is the sheer volume of data that normal network operations create. </span><span class="koboSpan" id="kobo.59.3">Often, an incident is identified days or even weeks after it has occurred. </span><span class="koboSpan" id="kobo.59.4">During this intervening period, these log files and packet captures become unavailable. </span><span class="koboSpan" id="kobo.59.5">Therefore, it is incumbent on responders to fully understand what their organization’s capabilities are regarding </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">network evidence.</span></span></p>
<h1 id="_idParaDest-156"><a id="_idTextAnchor159"/><span class="koboSpan" id="kobo.61.1">Analyzing firewall and proxy logs</span></h1>
<p><span class="koboSpan" id="kobo.62.1">Adversaries</span><a id="_idIndexMarker775"/><span class="koboSpan" id="kobo.63.1"> need to </span><a id="_idIndexMarker776"/><span class="koboSpan" id="kobo.64.1">make initial and continued connections to their infrastructure. </span><span class="koboSpan" id="kobo.64.2">Network devices such as firewalls and proxies may provide a source of evidence from </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">log files.</span></span></p>
<p><a href="B18571_05.xhtml#_idTextAnchor084"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.66.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.67.1"> contained a good deal of information concerning the acquisition of network-based evidence and the types of log files that are of importance to an incident responder or security analyst. </span><span class="koboSpan" id="kobo.67.2">Aside from the previously covered packet capture, we focused on the acquisition of log files from a variety of sources. </span><span class="koboSpan" id="kobo.67.3">These log files can provide some insight into the potential indicators of compromise that can aid in an incident investigation. </span><span class="koboSpan" id="kobo.67.4">The main challenge for analysts, though, is sifting through all of the irrelevant logs to find those that have some </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">evidential value.</span></span></p>
<p><span class="koboSpan" id="kobo.69.1">Log file analysis</span><a id="_idIndexMarker777"/><span class="koboSpan" id="kobo.70.1"> can be performed in a variety of ways. </span><span class="koboSpan" id="kobo.70.2">The specific method that is used may often depend on the type of incident, the tools available, and the amount of log data that has to be analyzed. </span><span class="koboSpan" id="kobo.70.3">The following are some of the methods that can </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">be utilized:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.72.1">Manual log review</span></strong><span class="koboSpan" id="kobo.73.1">: In a </span><a id="_idIndexMarker778"/><span class="koboSpan" id="kobo.74.1">manual log review, raw log files are dumped into a tool such as a text editor. </span><span class="koboSpan" id="kobo.74.2">From there, the analyst will review the logs line by line. </span><span class="koboSpan" id="kobo.74.3">This is a low-cost solution, but it is only useful with a limited amount of data. </span><span class="koboSpan" id="kobo.74.4">For example, an analyst would not be able to perform this type of analysis on a large enterprise firewall connection log. </span><span class="koboSpan" id="kobo.74.5">Rather, it may be useful to determine which users logged into a seldom-used web application on a </span><span class="No-Break"><span class="koboSpan" id="kobo.75.1">particular day.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.76.1">Filtered log review</span></strong><span class="koboSpan" id="kobo.77.1">: Log </span><a id="_idIndexMarker779"/><span class="koboSpan" id="kobo.78.1">review tools allow analysts to filter out log files in terms of specific parameters. </span><span class="koboSpan" id="kobo.78.2">This can include showing a list of any known malicious activity. </span><span class="koboSpan" id="kobo.78.3">The one drawback is that logs may not immediately indicate known malicious activity, but rather are innocuous at </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">the onset.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.80.1">Log file searching</span></strong><span class="koboSpan" id="kobo.81.1">: Another key feature in most log analysis tools is the ability to search log files for</span><a id="_idIndexMarker780"/><span class="koboSpan" id="kobo.82.1"> specific expressions. </span><span class="koboSpan" id="kobo.82.2">Tools for searching can utilize both regex and Boolean expressions and allow the analyst to limit logs to a specific period, source IP address, or other specific condition. </span><span class="koboSpan" id="kobo.82.3">This allows analysts to quickly isolate specific log files. </span><span class="koboSpan" id="kobo.82.4">Depending on the search terms, this may return a good deal of information that has to then be </span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">reviewed manually.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.84.1">Log file correlation</span></strong><span class="koboSpan" id="kobo.85.1">: Separate </span><a id="_idIndexMarker781"/><span class="koboSpan" id="kobo.86.1">log activity can be correlated with other logs based on either preconfigured rules or algorithms. </span><span class="koboSpan" id="kobo.86.2">Log correlation is often made part of log management tools or </span><strong class="bold"><span class="koboSpan" id="kobo.87.1">Security Information and Event Management</span></strong><span class="koboSpan" id="kobo.88.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.89.1">SIEM</span></strong><span class="koboSpan" id="kobo.90.1">) platforms</span><a id="_idIndexMarker782"/><span class="koboSpan" id="kobo.91.1"> with rulesets that have been created. </span><span class="koboSpan" id="kobo.91.2">This method is very powerful as it automates the process, but it does require a good deal of upfront labor to configure and tune the </span><span class="No-Break"><span class="koboSpan" id="kobo.92.1">specific environment.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.93.1">Log file data mining</span></strong><span class="koboSpan" id="kobo.94.1">: The </span><a id="_idIndexMarker783"/><span class="koboSpan" id="kobo.95.1">next step up from correlation is the ability to mine log files and extract meaning from them. </span><span class="koboSpan" id="kobo.95.2">This gives greater context and insight into the specific activity. </span><span class="koboSpan" id="kobo.95.3">At the time of writing, there are several tools, such as Elasticsearch and Logstash, that can be integrated into a platform for more </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">useful information.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.97.1">The number of logs that are produced in a network over a month or so can be staggering. </span><span class="koboSpan" id="kobo.97.2">This quantity only increases with the addition of new sources. </span><span class="koboSpan" id="kobo.97.3">Sorting through these manually is nearly impossible. </span><span class="koboSpan" id="kobo.97.4">In terms of log review, it is better to have a solution that provides some measure of automation, even in small networks. </span><span class="koboSpan" id="kobo.97.5">These tools give analysts the ability to sort through the proverbial haystack for that </span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">critical needle.</span></span></p>
<h2 id="_idParaDest-157"><a id="_idTextAnchor160"/><span class="koboSpan" id="kobo.99.1">SIEM tools</span></h2>
<p><span class="koboSpan" id="kobo.100.1">SIEM tools are critical to</span><a id="_idIndexMarker784"/><span class="koboSpan" id="kobo.101.1"> gaining situational awareness of activity across the network. </span><span class="koboSpan" id="kobo.101.2">These platforms not only serve as an aggregation point for log files from network devices, but they also allow analysts to perform queries on the logs that have been aggregated. </span><span class="koboSpan" id="kobo.101.3">For example, let’s say that IP addresses associated with potential malicious activity were discovered during the analysis of the packet capture file. </span><span class="koboSpan" id="kobo.101.4">This file was limited to a single host on the internal network. </span><span class="koboSpan" id="kobo.101.5">One question that analysts would like to answer is, how many other hosts could be infected? </span><span class="koboSpan" id="kobo.101.6">If the SIEM aggregates connection log files from devices such as the exterior facing firewall and web proxy, the analyst would be able to determine whether any other internal hosts are connected to those suspect </span><span class="No-Break"><span class="koboSpan" id="kobo.102.1">IP addresses.</span></span></p>
<p><span class="koboSpan" id="kobo.103.1">A wide variety of SIEM platforms are available, from freeware solutions to enterprise security management platforms. </span><span class="koboSpan" id="kobo.103.2">Most of these platforms allow analysts to conduct filtered searching and correlation log reviews. </span><span class="koboSpan" id="kobo.103.3">Many of the more robust commercial platforms provide rulesets for detecting specific types of attacks and updates to these rulesets as new attacks become known. </span><span class="koboSpan" id="kobo.103.4">Analysts could also query the SIEM tool for connection logs for the host IP address to any other systems. </span><span class="koboSpan" id="kobo.103.5">This would normally be the behavior seen in an incident where malware has infected a machine and an attacker is attempting to compromise </span><span class="No-Break"><span class="koboSpan" id="kobo.104.1">other machines.</span></span></p>
<p><span class="koboSpan" id="kobo.105.1">In organizations where incident response personnel are separate from those who are responsible for maintaining the SIEM tool, it is a good idea to review the communications structure so that incident response analysts have access to these platforms. </span><span class="koboSpan" id="kobo.105.2">The wealth of information and data that is available can be leveraged to determine what activity on the internal network is connected to a possible incident, as well as evidence that can be utilized to determine the </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1">root cause.</span></span></p>
<h2 id="_idParaDest-158"><a id="_idTextAnchor161"/><span class="koboSpan" id="kobo.107.1">The Elastic Stack</span></h2>
<p><span class="koboSpan" id="kobo.108.1">Alongside the SIEM technology, incident response analysts can also leverage a bundle of applications for log analysis. </span><span class="koboSpan" id="kobo.108.2">This bundle, referred to as the Elastic Stack, combines three tools that allow large sets of data to be analyzed. </span><span class="koboSpan" id="kobo.108.3">The first of these is Elasticsearch. </span><span class="koboSpan" id="kobo.108.4">Elasticsearch is a log-searching tool that allows near real-time searching of log data. </span><span class="koboSpan" id="kobo.108.5">This is accomplished through full-text searching, powered by Lucene. </span><span class="koboSpan" id="kobo.108.6">This allows analysts to perform queries against log files for elements such as user IDs, IP addresses, or log entry numbers. </span><span class="koboSpan" id="kobo.108.7">Another key feature of Elasticsearch</span><a id="_idIndexMarker785"/><span class="koboSpan" id="kobo.109.1"> is the ability of the platform to expand the solution as the enterprise grows larger and gains more data sources. </span><span class="koboSpan" id="kobo.109.2">This is useful for organizations that may want to test this capability and then add data sources and log </span><span class="No-Break"><span class="koboSpan" id="kobo.110.1">files incrementally.</span></span></p>
<p><span class="koboSpan" id="kobo.111.1">The next component in the </span><a id="_idIndexMarker786"/><span class="koboSpan" id="kobo.112.1">Elastic Stack is </span><a id="_idIndexMarker787"/><span class="koboSpan" id="kobo.113.1">Logstash. </span><span class="koboSpan" id="kobo.113.2">Logstash is the mechanism that handles the intake of log files from the sources across the network, processes log entries, and, finally, allows them to be output through a visualization platform. </span><span class="koboSpan" id="kobo.113.3">Logstash can be configured and deployed easily. </span><span class="koboSpan" id="kobo.113.4">The integration of Logstash with Elasticsearch allows the incident response analyst to conduct fast queries against a large amount of </span><span class="No-Break"><span class="koboSpan" id="kobo.114.1">log data.</span></span></p>
<p><span class="koboSpan" id="kobo.115.1">The final component of the Elastic Stack is Kibana. </span><span class="koboSpan" id="kobo.115.2">Kibana </span><a id="_idIndexMarker788"/><span class="koboSpan" id="kobo.116.1">serves as the visual interface or dashboard of the Elastic Stack. </span><span class="koboSpan" id="kobo.116.2">This platform allows analysts to gain insight into the data through the use of dashboards. </span><span class="koboSpan" id="kobo.116.3">Kibana also allows analysts to drill down into specific key data points for detailed analysis. </span><span class="koboSpan" id="kobo.116.4">Incident response analysts can customize these dashboards so that the most critical information, such as intrusion detection logs or connection logs, is immediately available </span><span class="No-Break"><span class="koboSpan" id="kobo.117.1">for review.</span></span></p>
<p><span class="koboSpan" id="kobo.118.1">For example, the Kibana dashboard utilizes several pie charts to display log activity. </span><span class="koboSpan" id="kobo.118.2">Utilizing these provides an overview of what information is available to </span><span class="No-Break"><span class="koboSpan" id="kobo.119.1">an analyst.</span></span></p>
<p><span class="koboSpan" id="kobo.120.1">A good tool to augment logs is NetFlow analysis, which we will </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">cover next.</span></span></p>
<h1 id="_idParaDest-159"><a id="_idTextAnchor162"/><span class="koboSpan" id="kobo.122.1">Analyzing NetFlow</span></h1>
<p><span class="koboSpan" id="kobo.123.1">NetFlow </span><a id="_idIndexMarker789"/><span class="koboSpan" id="kobo.124.1">describes the data about connections between devices in the network. </span><span class="koboSpan" id="kobo.124.2">Used primarily to troubleshoot connectivity and bandwidth issues, NetFlow can be used by responders to gain insight into the movement of data precipitating </span><span class="No-Break"><span class="koboSpan" id="kobo.125.1">an incident.</span></span></p>
<p><span class="koboSpan" id="kobo.126.1">NetFlow is a feature that was first introduced by Cisco Systems in the 1990s. </span><span class="koboSpan" id="kobo.126.2">NetFlow collects specific data about packets as they enter or exit an interface of a router or switch. </span><span class="koboSpan" id="kobo.126.3">This data is then sent to a NetFlow Collector via a NetFlow Exporter, which is often made part of switches or routers. </span><span class="koboSpan" id="kobo.126.4">The NetFlow Collector then aggregates and stores the flow data for analysis. </span><span class="koboSpan" id="kobo.126.5">This data is often leveraged by network and systems administrators to troubleshoot bandwidth issues, identify network congestion, and observe the flow </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">of data.</span></span></p>
<p><span class="koboSpan" id="kobo.128.1">A sample NetFlow output can be seen in the following screenshot. </span><span class="koboSpan" id="kobo.128.2">What is included with flow data can vary between network device manufacturers as there are several versions in the commercial market. </span><span class="koboSpan" id="kobo.128.3">The following screenshot shows some of the basic information that is captured as part of a </span><span class="No-Break"><span class="koboSpan" id="kobo.129.1">NetFlow dataset:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer147">
<span class="koboSpan" id="kobo.130.1"><img alt="" src="image/Image_B18571_09_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.131.1">Figure 9.1 – Sample NetFlow data</span></p>
<p><span class="koboSpan" id="kobo.132.1">The following components of a </span><a id="_idIndexMarker790"/><span class="koboSpan" id="kobo.133.1">NetFlow record can be seen in the </span><span class="No-Break"><span class="koboSpan" id="kobo.134.1">preceding screenshot:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.135.1">Src Addr</span></strong><span class="koboSpan" id="kobo.136.1">: This is the source address that has initiated the connection or is </span><span class="No-Break"><span class="koboSpan" id="kobo.137.1">sending traffic.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.138.1">Dst Addr</span></strong><span class="koboSpan" id="kobo.139.1">: The destination addresses for </span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">the connection.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.141.1">Sport</span></strong><span class="koboSpan" id="kobo.142.1">: This is the source port for the </span><span class="No-Break"><span class="koboSpan" id="kobo.143.1">source address.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.144.1">Dport</span></strong><span class="koboSpan" id="kobo.145.1">: This is the destination port. </span><span class="koboSpan" id="kobo.145.2">In terms of analyzing NetFlow as part of an incident investigation, this is one of the key data points to focus on as this often tells responders the service that the source address is </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">connecting to.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.147.1">Proto</span></strong><span class="koboSpan" id="kobo.148.1">: This is the protocol </span><span class="No-Break"><span class="koboSpan" id="kobo.149.1">in use.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.150.1">Packets</span></strong><span class="koboSpan" id="kobo.151.1">: The number of packets that are made as part of </span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">the flow.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.153.1">Bytes</span></strong><span class="koboSpan" id="kobo.154.1">: The total number </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">of bytes.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.156.1">Flows</span></strong><span class="koboSpan" id="kobo.157.1">: This indicates how many flows have been recorded. </span><span class="koboSpan" id="kobo.157.2">Flows can be thought of as separate TCP connections. </span><span class="koboSpan" id="kobo.157.3">For example, a packet capture analyzed with a tool such as Wireshark will show individual packets. </span><span class="koboSpan" id="kobo.157.4">Flows indicate the TCP session that was established. </span><span class="koboSpan" id="kobo.157.5">In this circumstance, if an SSH session is interrupted and </span><a id="_idIndexMarker791"/><span class="koboSpan" id="kobo.158.1">established, two flows would </span><span class="No-Break"><span class="koboSpan" id="kobo.159.1">be recorded.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.160.1">When examining the</span><a id="_idIndexMarker792"/><span class="koboSpan" id="kobo.161.1"> NetFlow data shown in the preceding example, two significant data points may be important. </span><span class="koboSpan" id="kobo.161.2">The first is the number of SSH connections between devices. </span><span class="koboSpan" id="kobo.161.3">Secure Shell is a common way for systems to communicate with each other, but if this is outside the bounds of normal network behavior, it warrants a follow-up. </span><span class="koboSpan" id="kobo.161.4">In addition, connections via SMB (port </span><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">445</span></strong><span class="koboSpan" id="kobo.163.1">) are commonly abused by adversaries to access other systems, deliver ransomware, or access file shares. </span><span class="koboSpan" id="kobo.163.2">Even in this short example, it becomes very clear that responders gain a great deal of insight by just having visibility of the connections that occur on the </span><span class="No-Break"><span class="koboSpan" id="kobo.164.1">internal network.</span></span></p>
<h1 id="_idParaDest-160"><a id="_idTextAnchor163"/><span class="koboSpan" id="kobo.165.1">Analyzing packet captures</span></h1>
<p><span class="koboSpan" id="kobo.166.1">One of the best </span><a id="_idIndexMarker793"/><span class="koboSpan" id="kobo.167.1">sources of evidence during an incident is packet captures. </span><span class="koboSpan" id="kobo.167.2">Dissecting them can uncover data exfiltration, exploits, and command </span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">and control.</span></span></p>
<p><span class="koboSpan" id="kobo.169.1">A great deal of </span><a href="B18571_05.xhtml#_idTextAnchor084"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.170.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.171.1"> covered the various methods to obtain packet captures from a range of sources and a variety of locations. </span><span class="koboSpan" id="kobo.171.2">Packet captures contain a great deal of information that is potentially valuable to incident response analysts. </span><span class="koboSpan" id="kobo.171.3">Some of this information includes source and destination IP addresses, domains and ports, and the content of communications between hosts. </span><span class="koboSpan" id="kobo.171.4">In some instances, incident response analysts can reconstruct actual files, such as text documents and images. </span><span class="koboSpan" id="kobo.171.5">The main drawback is the sheer amount of data that </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">is involved.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.173.1">Sample packet captures</span></p>
<p class="callout"><span class="koboSpan" id="kobo.174.1">This chapter refers to several preconfigured packet captures. </span><span class="koboSpan" id="kobo.174.2">These packet captures have been taken directly from </span><a href="http://malware-traffic-analysis.net/"><span class="koboSpan" id="kobo.175.1">http://malware-traffic-analysis.net/</span></a><span class="koboSpan" id="kobo.176.1"> by permission of the author. </span><span class="koboSpan" id="kobo.176.2">This site contains several packet capture exercises, where incident response analysts can practice locating indicators of compromise. </span><span class="koboSpan" id="kobo.176.3">It should be noted, though, that these captures may contain malware. </span><span class="koboSpan" id="kobo.176.4">You should only examine the live packet captures in a properly configured sandbox (see </span><a href="B18571_16.xhtml#_idTextAnchor284"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.177.1">Chapter 16</span></em></span></a><span class="koboSpan" id="kobo.178.1">) or another system not connected to a </span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">production environment.</span></span></p>
<h2 id="_idParaDest-161"><a id="_idTextAnchor164"/><span class="koboSpan" id="kobo.180.1">Command-line tools</span></h2>
<p><span class="koboSpan" id="kobo.181.1">Several </span><a id="_idIndexMarker794"/><span class="koboSpan" id="kobo.182.1">command-line tools can be utilized </span><a id="_idIndexMarker795"/><span class="koboSpan" id="kobo.183.1">when analyzing network packet captures. </span><span class="koboSpan" id="kobo.183.2">During more in-depth or lengthy incident response engagements, analysts may gather several packet capture files. </span><span class="koboSpan" id="kobo.183.3">It may be beneficial to combine these multiple packet captures into a single file to make analysis easier. </span><span class="koboSpan" id="kobo.183.4">The Mergecap application does just that by combining several packet capture files. </span><span class="koboSpan" id="kobo.183.5">Mergecap is offered as part of the SANS SIFT workstation and can be executed using the </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.185.1">
sansforensics@siftworkstation: ~$ mergecap packetcapture1.pcap packetcapture2.pcap</span></pre>
<p><span class="koboSpan" id="kobo.186.1">Another command-line tool that is useful in analyzing packet captures is Editcap. </span><span class="koboSpan" id="kobo.186.2">Editcap allows analysts to manipulate the packet capture files into smaller segments for easier review. </span><span class="koboSpan" id="kobo.186.3">For example, an analyst may only want to look at captures that are broken up into 50,000 packet segments. </span><span class="koboSpan" id="kobo.186.4">This would be helpful if an analyst has a large packet capture and dividing would make searching easier. </span><span class="koboSpan" id="kobo.186.5">To do this, the analyst would type the following into the </span><span class="No-Break"><span class="koboSpan" id="kobo.187.1">command line:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.188.1">
sansforensics@siftworkstation: ~$ editcap -F pcap -c evidence.pcap split.pcap</span></pre>
<p><span class="koboSpan" id="kobo.189.1">In the preceding command, </span><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">editcap</span></strong><span class="koboSpan" id="kobo.191.1"> took the </span><strong class="source-inline"><span class="koboSpan" id="kobo.192.1">evidence.pcap</span></strong><span class="koboSpan" id="kobo.193.1"> evidence file and divided it into 50,000 packet segments. </span><span class="koboSpan" id="kobo.193.2">Another technique that Editcap can be leveraged for is to divide a larger packet capture into time segments. </span><span class="koboSpan" id="kobo.193.3">For example, if analysts want to divide a packet capture into 10-minute segments, they can type </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.195.1">
sansforensics@siftworkstation: ~$ editcap -F pcap-t+600 evidence.pcap split.pcap</span></pre>
<p><span class="koboSpan" id="kobo.196.1">Analysts may also find that, in some circumstances, they may want to isolate domain name registration traffic. </span><span class="koboSpan" id="kobo.196.2">This is due in large part to a variety of adversarial actions such as C2 traffic, data exfiltration, and the possible redirection to compromised websites, often leveraging vulnerabilities in the DNS system. </span><span class="koboSpan" id="kobo.196.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">dnstop</span></strong><span class="koboSpan" id="kobo.198.1"> application parses packet capture files and ascertains the sources and count of DNS queries from internal hosts. </span><span class="koboSpan" id="kobo.198.2">To install it on a Linux system, you can use the </span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.200.1">
dfir@ubuntu:~$ sudo apt-get install dnstop</span></pre>
<p><span class="koboSpan" id="kobo.201.1">This command will download and install </span><strong class="source-inline"><span class="koboSpan" id="kobo.202.1">dnstop</span></strong><span class="koboSpan" id="kobo.203.1">. </span><span class="koboSpan" id="kobo.203.2">In the following example, the packet capture was taken from the Malware Traffic Analysis site located at </span><a href="https://www.malware-traffic-analysis.net/2022/03/21/index2.html"><span class="koboSpan" id="kobo.204.1">https://www.malware-traffic-analysis.net/2022/03/21/index2.html</span></a><span class="koboSpan" id="kobo.205.1">. </span><span class="koboSpan" id="kobo.205.2">If an incident response analyst wants to determine whether any IP addresses were sending outbound DNS queries </span><a id="_idIndexMarker796"/><span class="koboSpan" id="kobo.206.1">for packet capture, they</span><a id="_idIndexMarker797"/><span class="koboSpan" id="kobo.207.1"> can simply execute the </span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.209.1">
dfir@ubuntu:~/Documents/Packet Captures$ dnstop 2022-03-21-Hancitor-with-Cobalt-Strike-and-Mars-Stealer.pcap</span></pre>
<p><span class="koboSpan" id="kobo.210.1">The output of the preceding command is </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer148">
<span class="koboSpan" id="kobo.212.1"><img alt="" src="image/Image_B18571_09_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.213.1">Figure 9.2 – DNS query count</span></p>
<h2 id="_idParaDest-162"><a id="_idTextAnchor165"/><span class="koboSpan" id="kobo.214.1">Real Intelligence Threat Analytics</span></h2>
<p><span class="koboSpan" id="kobo.215.1">One</span><a id="_idIndexMarker798"/><span class="koboSpan" id="kobo.216.1"> challenge with working with</span><a id="_idIndexMarker799"/><span class="koboSpan" id="kobo.217.1"> packet captures is the sheer amount of data that is involved. </span><span class="koboSpan" id="kobo.217.2">A 24-hour packet capture from even a modest-sized network presents problems. </span><span class="koboSpan" id="kobo.217.3">One technique is to use tools that focus on key data points. </span><span class="koboSpan" id="kobo.217.4">For example, beaconing traffic associated with Command and Control is a critical piece of data to find as it is the link the adversary has to the </span><span class="No-Break"><span class="koboSpan" id="kobo.218.1">internal network.</span></span></p>
<p><span class="koboSpan" id="kobo.219.1">One tool that can</span><a id="_idIndexMarker800"/><span class="koboSpan" id="kobo.220.1"> assist is Active Countermeasure’s </span><strong class="bold"><span class="koboSpan" id="kobo.221.1">Real Intelligence Threat Analytics</span></strong><span class="koboSpan" id="kobo.222.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.223.1">RITA</span></strong><span class="koboSpan" id="kobo.224.1">). </span><span class="koboSpan" id="kobo.224.2">This command-line tool uses behavioral analytics to identify patterns that are indicative of beaconing behavior so that an analyst can focus on a specific IP address or domain name. </span><span class="koboSpan" id="kobo.224.3">A key feature of this tool is its ability to process large packet captures, such as one obtained over 24 hours. </span><span class="koboSpan" id="kobo.224.4">This allows analysts to locate even very low and slow Command and </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1">Control traffic.</span></span></p>
<p><span class="koboSpan" id="kobo.226.1">Installing RITA is </span><a id="_idIndexMarker801"/><span class="koboSpan" id="kobo.227.1">very straightforward. </span><span class="koboSpan" id="kobo.227.2">In this </span><a id="_idIndexMarker802"/><span class="koboSpan" id="kobo.228.1">case, RITA has been installed on an Ubuntu desktop. </span><span class="koboSpan" id="kobo.228.2">First, make a directory for RITA. </span><span class="koboSpan" id="kobo.228.3">Second, download the installation script from the GitHub site at </span><a href="https://github.com/activecm/rita/releases/tag/v4.5.1"><span class="koboSpan" id="kobo.229.1">https://github.com/activecm/rita/releases/tag/v4.5.1</span></a><span class="koboSpan" id="kobo.230.1">. </span><span class="koboSpan" id="kobo.230.2">Next, make the file executable by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.231.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.232.1">
dfir@ubuntu:~/rita$ sudo chmod +x ./install.sh</span></pre>
<p><span class="koboSpan" id="kobo.233.1">Next, execute the install script by running </span><span class="No-Break"><span class="koboSpan" id="kobo.234.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.235.1">
dfir@ubuntu:~/rita$ ./install.sh</span></pre>
<p><span class="koboSpan" id="kobo.236.1">The installation script will install the necessary dependencies, such as the Mongo database structure and the packet capture analysis </span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">tool Zeek.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.238.1">Zeek</span></p>
<p class="callout"><span class="koboSpan" id="kobo.239.1">Zeek</span><a id="_idIndexMarker803"/><span class="koboSpan" id="kobo.240.1"> is a network monitoring and analysis tool that is used with RITA. </span><span class="koboSpan" id="kobo.240.2">For more information regarding Zeek, go </span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">to </span></span><a href="https://docs.zeek.org/en/lts/"><span class="No-Break"><span class="koboSpan" id="kobo.242.1">https://docs.zeek.org/en/lts/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.243.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.244.1">The next step is processing the packet capture. </span><span class="koboSpan" id="kobo.244.2">In this case, two packet captures were taken from the Malware Traffic Analysis post at </span><a href="https://malware-traffic-analysis.net/2022/01/27/index.html"><span class="koboSpan" id="kobo.245.1">https://malware-traffic-analysis.net/2022/01/27/index.html</span></a><span class="koboSpan" id="kobo.246.1"> and were merged into a single file. </span><span class="koboSpan" id="kobo.246.2">This file was moved into the RITA directory. </span><span class="koboSpan" id="kobo.246.3">The following command points Zeek to the packet capture so that it can be processed into the various </span><span class="No-Break"><span class="koboSpan" id="kobo.247.1">log files:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.248.1">
dfir@ubuntu:~/rita$ zeek -C -r IcedId.pcap </span></pre>
<p><span class="koboSpan" id="kobo.249.1">Checking </span><a id="_idIndexMarker804"/><span class="koboSpan" id="kobo.250.1">the files in the</span><a id="_idIndexMarker805"/><span class="koboSpan" id="kobo.251.1"> directory shows the processed </span><span class="No-Break"><span class="koboSpan" id="kobo.252.1">log files:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer149">
<span class="koboSpan" id="kobo.253.1"><img alt="" src="image/Image_B18571_09_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.254.1">Figure 9.3 – Zeek log files</span></p>
<p><span class="koboSpan" id="kobo.255.1">After processing the packet capture with Zeek, the log files need to be imported into a database, </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">IcedID</span></strong><span class="koboSpan" id="kobo.257.1">, that RITA can read with the </span><span class="No-Break"><span class="koboSpan" id="kobo.258.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.259.1">
dfir@ubuntu:~/rita$ rita import *.log IcedID</span></pre>
<p><span class="koboSpan" id="kobo.260.1">Once this command is run, the results should look </span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer150">
<span class="koboSpan" id="kobo.262.1"><img alt="" src="image/Image_B18571_09_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.263.1">Figure 9.4 – RITA Zeek log import</span></p>
<p><span class="koboSpan" id="kobo.264.1">To </span><a id="_idIndexMarker806"/><span class="koboSpan" id="kobo.265.1">access the help</span><a id="_idIndexMarker807"/><span class="koboSpan" id="kobo.266.1"> menu for RITA, enter </span><span class="No-Break"><span class="koboSpan" id="kobo.267.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.268.1">
dfir@ubuntu:~/rita$ rita</span></pre>
<p><span class="koboSpan" id="kobo.269.1">This will produce the following commands and </span><span class="No-Break"><span class="koboSpan" id="kobo.270.1">associated results:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer151">
<span class="koboSpan" id="kobo.271.1"><img alt="" src="image/Image_B18571_09_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.272.1">Figure 9.5 – RITA features</span></p>
<p><span class="koboSpan" id="kobo.273.1">Let’s go </span><a id="_idIndexMarker808"/><span class="koboSpan" id="kobo.274.1">ahead and see if</span><a id="_idIndexMarker809"/><span class="koboSpan" id="kobo.275.1"> there are any packets indicating beaconing behavior. </span><span class="koboSpan" id="kobo.275.2">Run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.276.1">show-beacons</span></strong><span class="koboSpan" id="kobo.277.1"> command against the database that was previously created by running the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.278.1">IcedID</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.279.1"> database:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.280.1">
dfir@ubuntu:~/rita$ rita show-beacons IcedID</span></pre>
<p><span class="koboSpan" id="kobo.281.1">This produces </span><span class="No-Break"><span class="koboSpan" id="kobo.282.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer152">
<span class="koboSpan" id="kobo.283.1"><img alt="" src="image/Image_B18571_09_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.284.1">Figure 9.6 – RITA Beacon analysis</span></p>
<p><span class="koboSpan" id="kobo.285.1">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.286.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.287.1">.6</span></em><span class="koboSpan" id="kobo.288.1">, RITA is indicating that the internal IP address </span><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">10.1.28.101</span></strong><span class="koboSpan" id="kobo.290.1"> has established 234 connections to the IP address </span><strong class="source-inline"><span class="koboSpan" id="kobo.291.1">149.255.35.174</span></strong><span class="koboSpan" id="kobo.292.1">. </span><span class="koboSpan" id="kobo.292.2">One result that is of note is the first number, </span><strong class="source-inline"><span class="koboSpan" id="kobo.293.1">0.838</span></strong><span class="koboSpan" id="kobo.294.1">, found at the beginning of the results line. </span><span class="koboSpan" id="kobo.294.2">This score indicates the confidence level RITA has in these results, from 0 to 1. </span><span class="koboSpan" id="kobo.294.3">In this case, there’s nearly 84% confidence that the traffic is </span><span class="No-Break"><span class="koboSpan" id="kobo.295.1">beaconing behavior.</span></span></p>
<p><span class="koboSpan" id="kobo.296.1">Another option is to run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">show-beacons-fqdn</span></strong><span class="koboSpan" id="kobo.298.1"> command, which will show the domain names </span><span class="No-Break"><span class="koboSpan" id="kobo.299.1">of systems:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.300.1">
dfir@ubuntu:~/rita$ rita show-beacons-fqdn IcedID</span></pre>
<p><span class="koboSpan" id="kobo.301.1">This produces much of the same results but indicates that the Command and Control server has a domain name of </span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">driverpackcdn.com</span></strong><span class="koboSpan" id="kobo.303.1">, as </span><span class="No-Break"><span class="koboSpan" id="kobo.304.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer153">
<span class="koboSpan" id="kobo.305.1"><img alt="" src="image/Image_B18571_09_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.306.1">Figure 9.7 – RITA Beacon Fully Qualified Domain Name</span></p>
<p><span class="koboSpan" id="kobo.307.1">As we can see, RITA </span><a id="_idIndexMarker810"/><span class="koboSpan" id="kobo.308.1">allows</span><a id="_idIndexMarker811"/><span class="koboSpan" id="kobo.309.1"> analysts to focus on specific IP addresses and domain names as potentially malicious without having to dig through gigabytes of packet data. </span><span class="koboSpan" id="kobo.309.2">From here, they can pivot directly to the connections that are critical in GUI-based tools, which we will focus </span><span class="No-Break"><span class="koboSpan" id="kobo.310.1">on next.</span></span></p>
<h2 id="_idParaDest-163"><a id="_idTextAnchor166"/><span class="koboSpan" id="kobo.311.1">NetworkMiner</span></h2>
<p><span class="koboSpan" id="kobo.312.1">GUI-based </span><a id="_idIndexMarker812"/><span class="koboSpan" id="kobo.313.1">tools that</span><a id="_idIndexMarker813"/><span class="koboSpan" id="kobo.314.1"> separate </span><a id="_idIndexMarker814"/><span class="koboSpan" id="kobo.315.1">packet capture data are easier to navigate than command-line tools. </span><span class="koboSpan" id="kobo.315.2">One such tool is</span><a id="_idIndexMarker815"/><span class="koboSpan" id="kobo.316.1"> NetworkMiner, which is available at </span><a href="https://www.netresec.com/?page=NetworkMiner"><span class="koboSpan" id="kobo.317.1">https://www.netresec.com/?page=NetworkMiner</span></a><span class="koboSpan" id="kobo.318.1">. </span><span class="koboSpan" id="kobo.318.2">This tool is available as a commercial or community tool, with the community tool having more limited functionality. </span><span class="koboSpan" id="kobo.318.3">Despite this, the community edition does have some key features that are useful in analyzing </span><span class="No-Break"><span class="koboSpan" id="kobo.319.1">packet captures.</span></span></p>
<p><span class="koboSpan" id="kobo.320.1">In this demonstration, we will examine the PCAP file associated with a Hancitor infection, which can be downloaded from </span><a href="https://malware-traffic-analysis.net/2022/03/21/index2.html"><span class="koboSpan" id="kobo.321.1">https://malware-traffic-analysis.net/2022/03/21/index2.html</span></a><span class="koboSpan" id="kobo.322.1">. </span><span class="koboSpan" id="kobo.322.2">Load the PCAP data by going to </span><strong class="bold"><span class="koboSpan" id="kobo.323.1">File</span></strong><span class="koboSpan" id="kobo.324.1"> and selecting </span><strong class="bold"><span class="koboSpan" id="kobo.325.1">Open</span></strong><span class="koboSpan" id="kobo.326.1">. </span><span class="koboSpan" id="kobo.326.2">Navigate to the packet capture and click </span><strong class="bold"><span class="koboSpan" id="kobo.327.1">Open</span></strong><span class="koboSpan" id="kobo.328.1">. </span><span class="koboSpan" id="kobo.328.2">NetworkMiner will process the PCAP and display the hosts found in the </span><span class="No-Break"><span class="koboSpan" id="kobo.329.1">packet capture:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer154">
<span class="koboSpan" id="kobo.330.1"><img alt="" src="image/Image_B18571_09_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.331.1">Figure 9.8 – NetworkMiner GUI</span></p>
<p><span class="koboSpan" id="kobo.332.1">The next </span><a id="_idIndexMarker816"/><span class="koboSpan" id="kobo.333.1">tab, </span><strong class="bold"><span class="koboSpan" id="kobo.334.1">Files</span></strong><span class="koboSpan" id="kobo.335.1">, shows the files that were </span><a id="_idIndexMarker817"/><span class="koboSpan" id="kobo.336.1">contained within the </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">packet capture:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer155">
<span class="koboSpan" id="kobo.338.1"><img alt="" src="image/Image_B18571_09_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.339.1">Figure 9.9 – NetworkMiner’s Files tab</span></p>
<p><span class="koboSpan" id="kobo.340.1">If you drill </span><a id="_idIndexMarker818"/><span class="koboSpan" id="kobo.341.1">down further into the </span><strong class="bold"><span class="koboSpan" id="kobo.342.1">Files</span></strong><span class="koboSpan" id="kobo.343.1"> tab, you</span><a id="_idIndexMarker819"/><span class="koboSpan" id="kobo.344.1"> will see there are a few entries that stand out. </span><span class="koboSpan" id="kobo.344.2">The far-left column indicates the frame number. </span><span class="koboSpan" id="kobo.344.3">In this case, frame number </span><strong class="bold"><span class="koboSpan" id="kobo.345.1">47</span></strong><span class="koboSpan" id="kobo.346.1"> contains an entry for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.347.1">b123.exe</span></strong><span class="koboSpan" id="kobo.348.1"> file that was downloaded from </span><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">bor4omkin.ru</span></strong><span class="koboSpan" id="kobo.350.1"> with an IP address </span><span class="No-Break"><span class="koboSpan" id="kobo.351.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.352.1">45.8.124.233</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer156">
<span class="koboSpan" id="kobo.354.1"><img alt="" src="image/Image_B18571_09_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.355.1">Figure 9.10 – Suspect files</span></p>
<p><span class="koboSpan" id="kobo.356.1">In addition to visualizing files that were contained within the packet capture, NetworkMiner also extracts them and places them in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.357.1">AssembledFiles</span></strong><span class="koboSpan" id="kobo.358.1"> directory, broken down by IP address. </span><span class="koboSpan" id="kobo.358.2">This allows analysts to quickly identify suspect files and </span><span class="No-Break"><span class="koboSpan" id="kobo.359.1">analyze them.</span></span></p>
<p><span class="koboSpan" id="kobo.360.1">NetworkMiner is a </span><a id="_idIndexMarker820"/><span class="koboSpan" id="kobo.361.1">useful tool for an initial review of packet</span><a id="_idIndexMarker821"/><span class="koboSpan" id="kobo.362.1"> captures. </span><span class="koboSpan" id="kobo.362.2">It provides details about the files, DNS queries, sessions, and other key data points. </span><span class="koboSpan" id="kobo.362.3">The main advantage that can be leveraged is its ability to quickly focus on key data points so that analysts can focus on specific areas, without having to dig through an entire packet capture to find the key </span><span class="No-Break"><span class="koboSpan" id="kobo.363.1">evidence items.</span></span></p>
<h2 id="_idParaDest-164"><a id="_idTextAnchor167"/><span class="koboSpan" id="kobo.364.1">Arkime</span></h2>
<p><span class="koboSpan" id="kobo.365.1">Arkime</span><a id="_idIndexMarker822"/><span class="koboSpan" id="kobo.366.1"> is an open source packet capture and search system that allows analysts and responders to examine large network packet captures. </span><span class="koboSpan" id="kobo.366.2">By default, Arkime organizes the packet captures into the various sessions contained within the capture. </span><span class="koboSpan" id="kobo.366.3">Arkime</span><a id="_idIndexMarker823"/><span class="koboSpan" id="kobo.367.1"> can be utilized as a network monitoring</span><a id="_idIndexMarker824"/><span class="koboSpan" id="kobo.368.1"> system that can be leveraged by importing packets into the Elasticsearch infrastructure. </span><span class="koboSpan" id="kobo.368.2">From here, responders can examine network activity in near-real time. </span><span class="koboSpan" id="kobo.368.3">Another method that Arkime can be leveraged for is loading offline packet captures </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">for indexing.</span></span></p>
<p><span class="koboSpan" id="kobo.370.1">Installation instructions for Arkime can be found on GitHub at </span><a href="https://raw.githubusercontent.com/arkime/arkime/master/release/README.txt"><span class="koboSpan" id="kobo.371.1">https://raw.githubusercontent.com/arkime/arkime/master/release/README.txt</span></a><span class="koboSpan" id="kobo.372.1">. </span><span class="koboSpan" id="kobo.372.2">Arkime can be installed on a variety of Linux desktop or server platforms. </span><span class="koboSpan" id="kobo.372.3">The server option provides larger teams with the ability to share data concerning packet captures, as well as evaluate running captures. </span><span class="koboSpan" id="kobo.372.4">Desktop installations are an option for responders that will be handling offline data and who do not need to share </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">the results.</span></span></p>
<p><span class="koboSpan" id="kobo.374.1">In this section, we will use Arkime to analyze a packet capture from a system related to a phishing attack. </span><span class="koboSpan" id="kobo.374.2">This packet capture can be found </span><span class="No-Break"><span class="koboSpan" id="kobo.375.1">at </span></span><a href="https://malware-traffic-analysis.net/2022/02/25/2022-02-25-Emotet-epoch4-with-spambot-activity.pcap.zip"><span class="No-Break"><span class="koboSpan" id="kobo.376.1">https://malware-traffic-analysis.net/2022/02/25/2022-02-25-Emotet-epoch4-with-spambot-activity.pcap.zip</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.377.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.378.1">First, create a directory in Arkime for offline packet captures. </span><span class="koboSpan" id="kobo.378.2">This can be done in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">home</span></strong><span class="koboSpan" id="kobo.380.1"> directory. </span><span class="koboSpan" id="kobo.380.2">Next, transfer the packet capture using SFTP to the offline packet capture directory. </span><span class="koboSpan" id="kobo.380.3">Finally, use the Arkime capture binary, which can be found in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">/opt/arkime/bin</span></strong><span class="koboSpan" id="kobo.382.1"> directory, to process the packet capture using the </span><span class="No-Break"><span class="koboSpan" id="kobo.383.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.384.1">
arkime@arkime:/opt/arkime/bin$ sudo ./capture -r /home/offlinecaps/2022-02-25-Emotet-epoch4-with-spambot-activity.pcap</span></pre>
<p><span class="koboSpan" id="kobo.385.1">The preceding command takes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.386.1">2022-02-25-Emotet-epoch4-with-spambot-activity.pcap</span></strong><span class="koboSpan" id="kobo.387.1"> file and processes it so that it can be reviewed with the GUI. </span><span class="koboSpan" id="kobo.387.2">An important thing to note is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.388.1">-r</span></strong><span class="koboSpan" id="kobo.389.1"> parameter, which only processes a single capture. </span><span class="koboSpan" id="kobo.389.2">If there are multiple captures, the binary can be run with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.390.1">-R</span></strong><span class="koboSpan" id="kobo.391.1"> parameter set, which recursively processes all the packet captures in the directory. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.392.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.393.1">.11</span></em><span class="koboSpan" id="kobo.394.1"> shows the packet capture</span><a id="_idIndexMarker825"/> <span class="No-Break"><span class="koboSpan" id="kobo.395.1">being </span></span><span class="No-Break"><a id="_idIndexMarker826"/></span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">processed:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer157">
<span class="koboSpan" id="kobo.397.1"><img alt="" src="image/Image_B18571_09_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.398.1">Figure 9.11 – Arkime PCAP import</span></p>
<p><span class="koboSpan" id="kobo.399.1">Once completed, open a web browser and navigate to the IP address of the server or workstation with port </span><strong class="source-inline"><span class="koboSpan" id="kobo.400.1">8005</span></strong><span class="koboSpan" id="kobo.401.1">. </span><span class="koboSpan" id="kobo.401.2">This will open the Arkime interface. </span><span class="koboSpan" id="kobo.401.3">In the top left, set the time to </span><strong class="bold"><span class="koboSpan" id="kobo.402.1">All</span></strong><span class="koboSpan" id="kobo.403.1">. </span><span class="koboSpan" id="kobo.403.2">Once the time has been set, the following view </span><span class="No-Break"><span class="koboSpan" id="kobo.404.1">will appear:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer158">
<span class="koboSpan" id="kobo.405.1"><img alt="" src="image/Image_B18571_09_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.406.1">Figure 9.12 – Arkime GUI dashboard</span></p>
<p><span class="koboSpan" id="kobo.407.1">Arkime is a </span><a id="_idIndexMarker827"/><span class="koboSpan" id="kobo.408.1">feature-rich platform. </span><span class="koboSpan" id="kobo.408.2">The following steps provide </span><a id="_idIndexMarker828"/><span class="koboSpan" id="kobo.409.1">an overview of some of the features available in examining offline </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">packet captures:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.411.1">An examination of the packet capture from the dashboard identifies several different sessions where the internal system at </span><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">10.2.25.101</span></strong><span class="koboSpan" id="kobo.413.1"> is communicating with external IP addresses. </span><span class="koboSpan" id="kobo.413.2">To narrow down the search results to internet traffic over HTTP, the following search query should be entered into the </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">search bar:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer159">
<span class="koboSpan" id="kobo.415.1"><img alt="" src="image/Image_B18571_09_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.416.1">Figure 9.13 – HTTP port 80 query</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.417.1">This shows that there were two TCP sessions with a destination port of </span><strong class="source-inline"><span class="koboSpan" id="kobo.418.1">80</span></strong><span class="koboSpan" id="kobo.419.1">. </span><span class="koboSpan" id="kobo.419.2">These sessions can be sorted by any of the fields present in the dashboard. </span><span class="koboSpan" id="kobo.419.3">One key piece of data that is useful is the bytes that are transferred as part of the session. </span><span class="koboSpan" id="kobo.419.4">Large deltas between bytes sent and received may indicate data exfiltration if the bytes sent are larger or, in the case of this capture, bytes received, which can indicate a file transfer, as seen in </span><span class="No-Break"><span class="koboSpan" id="kobo.420.1">these entries:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer160">
<span class="koboSpan" id="kobo.421.1"><img alt="" src="image/Image_B18571_09_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.422.1">Figure 9.14 – HTTP session data</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.423.1">The</span><a id="_idIndexMarker829"/><span class="koboSpan" id="kobo.424.1"> far right of the dashboard contains URIs and </span><a id="_idIndexMarker830"/><span class="koboSpan" id="kobo.425.1">associated information concerning the sessions. </span><span class="koboSpan" id="kobo.425.2">For example, a check of the sessions over HTTP indicates that the local host navigated to what appears to be a Windows </span><span class="No-Break"><span class="koboSpan" id="kobo.426.1">update site:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer161">
<span class="koboSpan" id="kobo.427.1"><img alt="" src="image/Image_B18571_09_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.428.1">Figure 9.15 – Arkime URI data</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.429.1">Arkime provides additional information for the session in the same session row as the information URI related to the Windows Update. </span><span class="koboSpan" id="kobo.429.2">Clicking on the green plus sign box opens the </span><span class="No-Break"><span class="koboSpan" id="kobo.430.1">following page:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer162">
<span class="koboSpan" id="kobo.431.1"><img alt="" src="image/Image_B18571_09_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.432.1">Figure 9.16 – Session data</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.433.1">Further </span><a id="_idIndexMarker831"/><span class="koboSpan" id="kobo.434.1">down, under the </span><strong class="bold"><span class="koboSpan" id="kobo.435.1">HTTP</span></strong><span class="koboSpan" id="kobo.436.1"> heading, is</span><a id="_idIndexMarker832"/><span class="koboSpan" id="kobo.437.1"> valuable data concerning </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">the connection:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer163">
<span class="koboSpan" id="kobo.439.1"><img alt="" src="image/Image_B18571_09_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.440.1">Figure 9.17 – HTTP session data</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.441.1">Another </span><a id="_idIndexMarker833"/><span class="koboSpan" id="kobo.442.1">feature that is useful with Arkime is the</span><a id="_idIndexMarker834"/><span class="koboSpan" id="kobo.443.1"> ability to visualize connections. </span><span class="koboSpan" id="kobo.443.2">At the top of the Arkime web application is </span><strong class="bold"><span class="koboSpan" id="kobo.444.1">Connections</span></strong><span class="koboSpan" id="kobo.445.1">. </span><span class="koboSpan" id="kobo.445.2">If you click on </span><strong class="bold"><span class="koboSpan" id="kobo.446.1">Connections</span></strong><span class="koboSpan" id="kobo.447.1">, the following </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">will appear:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer164">
<span class="koboSpan" id="kobo.449.1"><img alt="" src="image/Image_B18571_09_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.450.1">Figure 9.18 – Arkime connections graph</span></p>
<p><span class="koboSpan" id="kobo.451.1">Next, let’s have a look at how to </span><span class="No-Break"><span class="koboSpan" id="kobo.452.1">reset Arkime.</span></span></p>
<h3><span class="koboSpan" id="kobo.453.1">How do I reset Arkime?</span></h3>
<p><span class="koboSpan" id="kobo.454.1">At the end of the</span><a id="_idIndexMarker835"/><span class="koboSpan" id="kobo.455.1"> analysis, there are two ways to clear the existing data in preparation for subsequent analysis. </span><span class="koboSpan" id="kobo.455.2">The first is to deploy Arkime on a virtualization platform such as VMware. </span><span class="koboSpan" id="kobo.455.3">Here, you can create a new installation and then capture a snapshot of the new installation. </span><span class="koboSpan" id="kobo.455.4">Once the analysis is complete, you can revert to the fresh </span><span class="No-Break"><span class="koboSpan" id="kobo.456.1">installation snapshot.</span></span></p>
<p><span class="koboSpan" id="kobo.457.1">Another method is to either rerun the </span><strong class="source-inline"><span class="koboSpan" id="kobo.458.1">init</span></strong><span class="koboSpan" id="kobo.459.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.460.1">wipe</span></strong><span class="koboSpan" id="kobo.461.1"> command. </span><span class="koboSpan" id="kobo.461.2">The steps are </span><span class="No-Break"><span class="koboSpan" id="kobo.462.1">as follows:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.463.1">Leave </span><span class="No-Break"><span class="koboSpan" id="kobo.464.1">Elasticsearch running.</span></span></li>
<li><span class="koboSpan" id="kobo.465.1">Shut down all running viewer or capture processes so that no new data </span><span class="No-Break"><span class="koboSpan" id="kobo.466.1">is recorded.</span></span></li>
<li><span class="koboSpan" id="kobo.467.1">To delete all the SPI data stored in Elasticsearch, use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.468.1">db.pl</span></strong><span class="koboSpan" id="kobo.469.1"> script with either the </span><strong class="source-inline"><span class="koboSpan" id="kobo.470.1">init</span></strong><span class="koboSpan" id="kobo.471.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.472.1">wipe</span></strong><span class="koboSpan" id="kobo.473.1"> command. </span><span class="koboSpan" id="kobo.473.2">The only difference between the two commands is that </span><strong class="source-inline"><span class="koboSpan" id="kobo.474.1">wipe</span></strong><span class="koboSpan" id="kobo.475.1"> leaves the added users so that they don’t need to </span><span class="No-Break"><span class="koboSpan" id="kobo.476.1">be re-added:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.477.1">/opt/arkime/db/db.pl http://ESHOST:9200 wipe</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.478.1">Delete the PCAP files. </span><span class="koboSpan" id="kobo.478.2">The PCAP files are stored on the filesystem in </span><strong class="source-inline"><span class="koboSpan" id="kobo.479.1">raw</span></strong><span class="koboSpan" id="kobo.480.1"> format. </span><span class="koboSpan" id="kobo.480.2">You need to do this on all of the </span><span class="No-Break"><span class="koboSpan" id="kobo.481.1">capture machines:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.482.1">/bin/rm -f /opt/arkime/raw/*</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.483.1">The major advantage to </span><a id="_idIndexMarker836"/><span class="koboSpan" id="kobo.484.1">Arkime is the ability to view the network traffic in a flow view. </span><span class="koboSpan" id="kobo.484.2">For a more detailed packet-by-packet view, the best tool to leverage is Wireshark, which we will cover next. </span></p>
<h2 id="_idParaDest-165"><a id="_idTextAnchor168"/><span class="koboSpan" id="kobo.485.1">Wireshark</span></h2>
<p><span class="koboSpan" id="kobo.486.1">Wireshark</span><a id="_idIndexMarker837"/><span class="koboSpan" id="kobo.487.1"> is one of the most popular packet capture analysis tools available to incident response analysts. </span><span class="koboSpan" id="kobo.487.2">In addition to the ability to capture packets, a great many other features are available. </span><span class="koboSpan" id="kobo.487.3">As entire volumes and training courses are built around this platform, it is impossible to identify every feature. </span><span class="koboSpan" id="kobo.487.4">Therefore, this chapter will focus on</span><a id="_idIndexMarker838"/><span class="koboSpan" id="kobo.488.1"> some of the key features of Wireshark</span><a id="_idIndexMarker839"/><span class="koboSpan" id="kobo.489.1"> that are most applicable to an </span><span class="No-Break"><span class="koboSpan" id="kobo.490.1">incident investigation.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.491.1">Wireshark resources</span></p>
<p class="callout"><span class="koboSpan" id="kobo.492.1">Arguably, Wireshark</span><a id="_idIndexMarker840"/><span class="koboSpan" id="kobo.493.1"> is the packet analyzer of choice for IT and security professionals. </span><span class="koboSpan" id="kobo.493.2">Due to the ubiquity of the application, there are a wide variety of resources available for additional training on Wireshark and its capabilities. </span><span class="koboSpan" id="kobo.493.3">The Wireshark </span><a id="_idIndexMarker841"/><span class="koboSpan" id="kobo.494.1">site at </span><a href="https://www.wireshark.org/"><span class="koboSpan" id="kobo.495.1">https://www.wireshark.org/</span></a><span class="koboSpan" id="kobo.496.1"> contains a great deal of information. </span><span class="koboSpan" id="kobo.496.2">Furthermore, the site at </span><a href="https://www.chappell-university.com/"><span class="koboSpan" id="kobo.497.1">https://www.chappell-university.com/</span></a><span class="koboSpan" id="kobo.498.1"> contains exercises and training packet captures to hone skills </span><span class="No-Break"><span class="koboSpan" id="kobo.499.1">regarding analysis.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.500.1">Additionally, Lisa Bock, who authored </span><em class="italic"><span class="koboSpan" id="kobo.501.1">Learn Wireshark</span></em><span class="koboSpan" id="kobo.502.1">, provided an in-depth treatment of Wireshark in her book, which is available </span><span class="No-Break"><span class="koboSpan" id="kobo.503.1">at </span></span><a href="https://www.packtpub.com/product/learn-wireshark-fundamentals-of-wireshark/9781789134506"><span class="No-Break"><span class="koboSpan" id="kobo.504.1">https://www.packtpub.com/product/learn-wireshark-fundamentals-of-wireshark/9781789134506</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.505.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.506.1">Because</span><a id="_idIndexMarker842"/><span class="koboSpan" id="kobo.507.1"> Wireshark is a feature-rich tool, some</span><a id="_idIndexMarker843"/><span class="koboSpan" id="kobo.508.1"> settings lend themselves more to network traffic analysis that are outside incident response activities. </span><span class="koboSpan" id="kobo.508.2">As a result, some changes need to be made to better assist the incident response analyst with performing packet capture analysis concerning an </span><span class="No-Break"><span class="koboSpan" id="kobo.509.1">incident investigation:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.510.1">Time</span></strong><span class="koboSpan" id="kobo.511.1">: The time setting in Wireshark provides several options. </span><span class="koboSpan" id="kobo.511.2">These include the time of the packet since 1/1/1970 or since the start of the packet capture. </span><span class="koboSpan" id="kobo.511.3">One of these options, which can be useful in an incident investigation, is the date and time when the individual packets were captured. </span><span class="koboSpan" id="kobo.511.4">This allows analysts to correlate the date and time of other suspicious or malicious activity with the date and time of specific traffic within the packet capture. </span><span class="koboSpan" id="kobo.511.5">To enable this, navigate to </span><strong class="bold"><span class="koboSpan" id="kobo.512.1">View</span></strong><span class="koboSpan" id="kobo.513.1"> and then to </span><strong class="bold"><span class="koboSpan" id="kobo.514.1">Time Display Format</span></strong><span class="koboSpan" id="kobo.515.1">. </span><span class="koboSpan" id="kobo.515.2">From there, choose one of the time options, such as </span><strong class="bold"><span class="koboSpan" id="kobo.516.1">Date and Time</span></strong><span class="koboSpan" id="kobo.517.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.518.1">Day or Time of Day</span></strong><span class="koboSpan" id="kobo.519.1">. </span><span class="koboSpan" id="kobo.519.2">Another option to consider is utilizing the UTC options. </span><span class="koboSpan" id="kobo.519.3">This is very useful if the internal network utilizes UTC rather than local time. </span><span class="koboSpan" id="kobo.519.4">The time can also be set </span><span class="No-Break"><span class="koboSpan" id="kobo.520.1">to nanoseconds.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.521.1">Name resolution</span></strong><span class="koboSpan" id="kobo.522.1">: The name resolution setting allows analysts to toggle between seeing the IP addresses of the source and destination hosts and hostname resolution. </span><span class="koboSpan" id="kobo.522.2">This is useful if an analyst is examining a packet capture and wants to determine if any suspicious hostnames have been found. </span><span class="koboSpan" id="kobo.522.3">For example, if the packet capture is open, you will see various </span><span class="No-Break"><span class="koboSpan" id="kobo.523.1">IP addresses:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer165">
<span class="koboSpan" id="kobo.524.1"><img alt="" src="image/Image_B18571_09_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.525.1">Figure 9.19 – Wireshark IP address view</span></p>
<p><span class="koboSpan" id="kobo.526.1">To</span><a id="_idIndexMarker844"/><span class="koboSpan" id="kobo.527.1"> determine the hostnames, navigate</span><a id="_idIndexMarker845"/><span class="koboSpan" id="kobo.528.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.529.1">View</span></strong><span class="koboSpan" id="kobo.530.1"> and then </span><strong class="bold"><span class="koboSpan" id="kobo.531.1">Name Resolution</span></strong><span class="koboSpan" id="kobo.532.1">. </span><span class="koboSpan" id="kobo.532.2">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.533.1">Resolve Network Addresses</span></strong><span class="koboSpan" id="kobo.534.1">. </span><span class="koboSpan" id="kobo.534.2">Wireshark will then resolve the IP addresses </span><span class="No-Break"><span class="koboSpan" id="kobo.535.1">to hostnames:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer166">
<span class="koboSpan" id="kobo.536.1"><img alt="" src="image/Image_B18571_09_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.537.1">Figure 9.20 – Wireshark domain name view</span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.538.1">Colorize packet list</span></strong><span class="koboSpan" id="kobo.539.1">: This </span><a id="_idIndexMarker846"/><span class="koboSpan" id="kobo.540.1">feature </span><a id="_idIndexMarker847"/><span class="koboSpan" id="kobo.541.1">allows analysts to toggle between a blank background of the packet list or to allow Wireshark to color-code </span><span class="No-Break"><span class="koboSpan" id="kobo.542.1">the packets:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer167">
<span class="koboSpan" id="kobo.543.1"><img alt="" src="image/Image_B18571_09_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.544.1">Figure 9.21 – Wireshark – Coloring Rules Classic</span></p>
<p><span class="koboSpan" id="kobo.545.1">For this chapter, an</span><a id="_idIndexMarker848"/><span class="koboSpan" id="kobo.546.1"> exploration of Wireshark will be done while utilizing a packet capture that can be found on Malware Traffic Analysis </span><a id="_idIndexMarker849"/><span class="koboSpan" id="kobo.547.1">at </span><a href="https://malware-traffic-analysis.net/2022/04/14/index.html"><span class="koboSpan" id="kobo.548.1">https://malware-traffic-analysis.net/2022/04/14/index.html</span></a><span class="koboSpan" id="kobo.549.1">. </span><span class="koboSpan" id="kobo.549.2">This packet capture includes downloading a copy of the Qakbot malware, along with Cobalt Strike. </span><span class="koboSpan" id="kobo.549.3">For this chapter, several key elements of the packet capture will be identified. </span><span class="koboSpan" id="kobo.549.4">Before examining the packet capture, Wireshark was configured so that the date and time are visible, and so that the hostnames </span><span class="No-Break"><span class="koboSpan" id="kobo.550.1">were identified.</span></span></p>
<p><span class="koboSpan" id="kobo.551.1">The following are some of the features in Wireshark that provide key pieces of information from the </span><span class="No-Break"><span class="koboSpan" id="kobo.552.1">packet capture:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.553.1">Display filters</span></strong><span class="koboSpan" id="kobo.554.1">: One of the most important features is the ability to filter packet captures on a wide range of services and ports. </span><span class="koboSpan" id="kobo.554.2">Filters can also be utilized on the source and destination IP addresses. </span><span class="koboSpan" id="kobo.554.3">For example, an incident response analyst would like to filter traffic on the system’s source domain name: </span><strong class="bold"><span class="koboSpan" id="kobo.555.1">DESKTOP-S9U1NBH.local</span></strong><span class="koboSpan" id="kobo.556.1">. </span><span class="koboSpan" id="kobo.556.2">By right-clicking on the IP address in the packet capture window and navigating to </span><strong class="bold"><span class="koboSpan" id="kobo.557.1">Apply as Filter</span></strong><span class="koboSpan" id="kobo.558.1"> and then </span><strong class="bold"><span class="koboSpan" id="kobo.559.1">Selected</span></strong><span class="koboSpan" id="kobo.560.1">, the analyst can select the IP address as a filter. </span><span class="koboSpan" id="kobo.560.2">This filter then appears in the filter bar with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.561.1">ip.src==10.4.14.101</span></strong><span class="koboSpan" id="kobo.562.1"> syntax, which displays </span><span class="No-Break"><span class="koboSpan" id="kobo.563.1">the following:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer168">
<span class="koboSpan" id="kobo.564.1"><img alt="" src="image/Image_B18571_09_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.565.1">Figure 9.22 – Source address filter</span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.566.1">Host identification</span></strong><span class="koboSpan" id="kobo.567.1">: Another</span><a id="_idIndexMarker850"/><span class="koboSpan" id="kobo.568.1"> key aspect of analyzing</span><a id="_idIndexMarker851"/><span class="koboSpan" id="kobo.569.1"> packet captures is to identify the localhost, if applicable. </span><span class="koboSpan" id="kobo.569.2">Considering that this packet capture is from a single host, identifying the hostname, IP address, and MAC address is straightforward. </span><span class="koboSpan" id="kobo.569.3">By double-clicking on the individual packet, a great deal of information can </span><span class="No-Break"><span class="koboSpan" id="kobo.570.1">be found:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer169">
<span class="koboSpan" id="kobo.571.1"><img alt="" src="image/Image_B18571_09_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.572.1">Figure 9.23 – Packet data</span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.573.1">Physical connection identification</span></strong><span class="koboSpan" id="kobo.574.1">: In this packet, the analyst can identify the source of the </span><a id="_idIndexMarker852"/><span class="koboSpan" id="kobo.575.1">traffic from the Ethernet II and </span><strong class="bold"><span class="koboSpan" id="kobo.576.1">Internet Protocol Version 4</span></strong><span class="koboSpan" id="kobo.577.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.578.1">IPV4</span></strong><span class="koboSpan" id="kobo.579.1">) lines. </span><span class="koboSpan" id="kobo.579.2">Examination of the packet indicates both the source and destination </span><a id="_idIndexMarker853"/><span class="koboSpan" id="kobo.580.1">MAC addresses as well. </span><span class="koboSpan" id="kobo.580.2">The preceding </span><a id="_idIndexMarker854"/><span class="koboSpan" id="kobo.581.1">data also shows that this is an HTTP packet with the destination port set to the standard </span><span class="No-Break"><span class="koboSpan" id="kobo.582.1">port </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.583.1">80</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.584.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.585.1">Protocol identification</span></strong><span class="koboSpan" id="kobo.586.1">: In this case, there was a good deal of HTTP connections, due to the activity of the user. </span><span class="koboSpan" id="kobo.586.2">As a result, the primary transmission of the malware was quite possibly through an HTTP connection. </span><span class="koboSpan" id="kobo.586.3">Wireshark has several filters that allow analysts to limit the packet capture results with specific parameters. </span><span class="koboSpan" id="kobo.586.4">In the top green dialog box, enter </span><strong class="source-inline"><span class="koboSpan" id="kobo.587.1">http</span></strong><span class="koboSpan" id="kobo.588.1">. </span><span class="koboSpan" id="kobo.588.2">Pay attention while entering this in the filter, as several different filters will be available. </span><span class="koboSpan" id="kobo.588.3">Once the filter has been typed in, click the right-facing arrow located at the far right of the dialog box. </span><span class="koboSpan" id="kobo.588.4">Wireshark will now limit the view of packets to those that are utilizing the </span><span class="No-Break"><span class="koboSpan" id="kobo.589.1">HTTP protocol:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer170">
<span class="koboSpan" id="kobo.590.1"><img alt="" src="image/Image_B18571_09_24.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.591.1">Figure 9.24 – HTTP packet view</span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.592.1">Hostname identification</span></strong><span class="koboSpan" id="kobo.593.1">: After </span><a id="_idIndexMarker855"/><span class="koboSpan" id="kobo.594.1">parsing through </span><a id="_idIndexMarker856"/><span class="koboSpan" id="kobo.595.1">the packet capture source and destination hostnames, one hostname appears to be suspicious. </span><span class="koboSpan" id="kobo.595.2">This host, </span><strong class="source-inline"><span class="koboSpan" id="kobo.596.1">geobram.com</span></strong><span class="koboSpan" id="kobo.597.1">, may be a suspect URL. </span><span class="koboSpan" id="kobo.597.2">Another feature of Wireshark is the ability to follow the TCP or HTTP stream of communication between the source and destination hosts. </span><span class="koboSpan" id="kobo.597.3">If you right-click on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.598.1">rozhan-hse.com</span></strong><span class="koboSpan" id="kobo.599.1"> hostname, the following </span><span class="No-Break"><span class="koboSpan" id="kobo.600.1">will appear:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer171">
<span class="koboSpan" id="kobo.601.1"><img alt="" src="image/Image_B18571_09_25.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.602.1">Figure 9.25 – Follow HTTP Stream</span></p>
<p><span class="koboSpan" id="kobo.603.1">A </span><a id="_idIndexMarker857"/><span class="koboSpan" id="kobo.604.1">second window will appear; click on </span><strong class="bold"><span class="koboSpan" id="kobo.605.1">HTTP Stream</span></strong><span class="koboSpan" id="kobo.606.1"> and </span><a id="_idIndexMarker858"/><span class="koboSpan" id="kobo.607.1">a third window will appear. </span><span class="koboSpan" id="kobo.607.2">This window contains the HTTP packets in a format that can be read. </span><span class="koboSpan" id="kobo.607.3">The incident response analyst can review this output to determine what types of files may have been sent </span><span class="No-Break"><span class="koboSpan" id="kobo.608.1">or received:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer172">
<span class="koboSpan" id="kobo.609.1"><img alt="" src="image/Image_B18571_09_26.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.610.1">Figure 9.26 – HTTP packet data</span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.611.1">Packet stream examination</span></strong><span class="koboSpan" id="kobo.612.1">: An</span><a id="_idIndexMarker859"/><span class="koboSpan" id="kobo.613.1"> examination of the Follow TCP Stream output indicates that an HTTP </span><strong class="source-inline"><span class="koboSpan" id="kobo.614.1">GET</span></strong><span class="koboSpan" id="kobo.615.1"> command is reaching out to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.616.1">NO_2950435796.zip</span></strong><span class="koboSpan" id="kobo.617.1"> file. </span><span class="koboSpan" id="kobo.617.2">An analyst may want to extract</span><a id="_idIndexMarker860"/><span class="koboSpan" id="kobo.618.1"> this file for analysis. </span><span class="koboSpan" id="kobo.618.2">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.619.1">File</span></strong><span class="koboSpan" id="kobo.620.1"> and then </span><strong class="bold"><span class="koboSpan" id="kobo.621.1">Export Objects</span></strong><span class="koboSpan" id="kobo.622.1">, and then </span><strong class="bold"><span class="koboSpan" id="kobo.623.1">HTTP</span></strong><span class="koboSpan" id="kobo.624.1">; a window will appear listing all of the files associated with the HTTP connections. </span><span class="koboSpan" id="kobo.624.2">This list can be sorted on any of the fields at the top of the window. </span><span class="koboSpan" id="kobo.624.3">In this case, select the hostname and scroll down until the suspected URL </span><span class="No-Break"><span class="koboSpan" id="kobo.625.1">is located:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer173">
<span class="koboSpan" id="kobo.626.1"><img alt="" src="image/Image_B18571_09_27.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.627.1">Figure 9.27 – Wireshark – Export – HTTP object list</span></p>
<p><span class="koboSpan" id="kobo.628.1">From here, the analyst can click on the file and save it onto the local system for later analysis. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.629.1">Chapter 12</span></em></span><span class="koboSpan" id="kobo.630.1"> will take select files and evaluate them for </span><span class="No-Break"><span class="koboSpan" id="kobo.631.1">malicious code.</span></span></p>
<p><span class="koboSpan" id="kobo.632.1">Wireshark is a </span><a id="_idIndexMarker861"/><span class="koboSpan" id="kobo.633.1">powerful tool for conducting a detailed </span><a id="_idIndexMarker862"/><span class="koboSpan" id="kobo.634.1">analysis of packet captures. </span><span class="koboSpan" id="kobo.634.2">The ability to drill down to individual packets and dissect them allows analysts to gain a very detailed sense of what is contained within the traffic running to and from external hosts, as well as to and from internal hosts. </span><span class="koboSpan" id="kobo.634.3">This visibility can afford the analyst possible insight into how an infected host communicates with an external host, or even identify other hosts that may have </span><span class="No-Break"><span class="koboSpan" id="kobo.635.1">become compromised.</span></span></p>
<h1 id="_idParaDest-166"><a id="_idTextAnchor169"/><span class="koboSpan" id="kobo.636.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.637.1">Security incidents not only produce trace evidence on host systems but also leave traces throughout the devices and traffic flows within a network. </span><span class="koboSpan" id="kobo.637.2">The ability to analyze this trace evidence will allow incident response analysts to have a better understanding of what type of incident they are investigating, as well as potential actions that can be taken. </span><span class="koboSpan" id="kobo.637.3">This chapter addressed how to evaluate log files through the rapid process of blacklist comparison or DNS analysis to log analysis utilizing the Elastic Stack or other SIEM systems. </span><span class="koboSpan" id="kobo.637.4">To augment this primary method of network evidence evaluation, we covered NetFlow analysis, and examined packet captures with Arkime and Wireshark. </span><span class="koboSpan" id="kobo.637.5">Network evidence is a critical component of incident investigation. </span><span class="koboSpan" id="kobo.637.6">This trace evidence, taken in conjunction with evidence obtained from potentially compromised websites, goes a long way in allowing analysts to reconstruct the events of </span><span class="No-Break"><span class="koboSpan" id="kobo.638.1">an incident.</span></span></p>
<p><span class="koboSpan" id="kobo.639.1">The next chapter will move the focus from network traffic to the host, and memory analysis will </span><span class="No-Break"><span class="koboSpan" id="kobo.640.1">be explored.</span></span></p>
<h1 id="_idParaDest-167"><a id="_idTextAnchor170"/><span class="koboSpan" id="kobo.641.1">Questions</span></h1>
<p><span class="koboSpan" id="kobo.642.1">Answer the following questions to test your knowledge of </span><span class="No-Break"><span class="koboSpan" id="kobo.643.1">this chapter:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.644.1">A filtered log review is one where the responder or analyst filters out specific logs based on a </span><span class="No-Break"><span class="koboSpan" id="kobo.645.1">set parameter.</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.646.1">True</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.647.1">False</span></span></li></ol></li>
<li><span class="koboSpan" id="kobo.648.1">What is not a component of the </span><span class="No-Break"><span class="koboSpan" id="kobo.649.1">Elastic Stack?</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.650.1">Elasticsearch</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.651.1">Log forwarder</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.652.1">Logstash</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.653.1">Kibana</span></span></li></ol></li>
<li><span class="koboSpan" id="kobo.654.1">Which packet analysis tool places the packet capture into sessions as the </span><span class="No-Break"><span class="koboSpan" id="kobo.655.1">default view?</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.656.1">Wireshark</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.657.1">NetFlow</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.658.1">Elastic Stack</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.659.1">Arkime</span></span></li></ol></li>
<li><span class="koboSpan" id="kobo.660.1">Wireshark does not allow for DNS </span><span class="No-Break"><span class="koboSpan" id="kobo.661.1">name resolution.</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.662.1">True</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.663.1">False</span></span></li></ol></li>
</ol>
<h1 id="_idParaDest-168"><a id="_idTextAnchor171"/><span class="koboSpan" id="kobo.664.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.665.1">Refer to the following links for more information about the topics covered in </span><span class="No-Break"><span class="koboSpan" id="kobo.666.1">this chapter:</span></span></p>
<ul>
<li><em class="italic"><span class="koboSpan" id="kobo.667.1">Elasticsearch 7.0 Cookbook - Fourth </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.668.1">Edition</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.669.1">: </span></span><a href="https://www.packtpub.com/big-data-and-business-intelligence/elasticsearch-70-cookbook-fourth-edition"><span class="No-Break"><span class="koboSpan" id="kobo.670.1">https://www.packtpub.com/big-data-and-business-intelligence/elasticsearch-70-cookbook-fourth-edition</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.671.1">.</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.672.1">Malware traffic </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.673.1">analysis</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.674.1">: </span></span><a href="https://www.malware-traffic-analysis.net"><span class="No-Break"><span class="koboSpan" id="kobo.675.1">https://www.malware-traffic-analysis.net</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.676.1">.</span></span></li>
<li><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.677.1">Arkime</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.678.1">: </span></span><a href="https://arkime.com/"><span class="No-Break"><span class="koboSpan" id="kobo.679.1">https://arkime.com/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.680.1">.</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.681.1">Chappell </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.682.1">University</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.683.1">: </span></span><a href="https://www.chappell-university.com/"><span class="No-Break"><span class="koboSpan" id="kobo.684.1">https://www.chappell-university.com/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.685.1">.</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.686.1">Cisco IOS </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.687.1">NetFlow</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">: </span></span><a href="https://www.cisco.com/c/en/us/products/ios-nx-os-software/ios-netflow/index.html"><span class="No-Break"><span class="koboSpan" id="kobo.689.1">https://ww</span><span id="_idTextAnchor172"/><span class="koboSpan" id="kobo.690.1">w.cisco.com/c/en/us/products/ios-nx-os-software/ios-netflow/index.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.691.1">.</span></span></li>
</ul>
</div>
<div>
<div id="_idContainer175">
</div>
</div>
</body></html>