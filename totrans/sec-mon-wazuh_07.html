<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-192"><a id="_idTextAnchor191"/>7</h1>
<h1 id="_idParaDest-193"><a id="_idTextAnchor192"/>Vulnerability Detection and Configuration Assessment</h1>
<p>A security vulnerability is a weakness in the program code or a configuration error in the system, such as Log4Shell, code injection and so on, that allows an attacker to directly and uninvitedly access a system or network. The <em class="italic">Hacker-Powered Security Report</em> from HackerOne in 2022 revealed that over 65,000 vulnerabilities were discovered by ethical hackers in 2022 alone—a 21% increase from 2021. We know that a threat is an adverse or malicious occurrence that exploits a vulnerability. So, why are we so bothered by vulnerabilities? Why can’t we work on threats directly? Why can’t we prevent threats from happening? The simplest answer is we can’t control threats due to their rapidly evolving nature. We can only control and manage vulnerabilities, hence, organizations spend their time and resources on patching security vulnerabilities.</p>
<p>There is a <a id="_idIndexMarker757"/>related concept called <strong class="bold">security configuration management</strong>. This is the process of identifying misconfigurations of a system’s default settings and, as a result, bringing down the number of security vulnerabilities in the network. Vulnerability monitoring and security configuration management are critical for maintaining regulatory compliance such as PCI DSS, NIST, HIPPA, and so on. Wazuh has built-in capabilities to look after both vulnerability detection and security configuration monitoring.</p>
<p>In this chapter, we will get hands-on with vulnerability detection and security configuration assessment modules of the Wazuh platform. We will also learn how to monitor and maintain regulatory compliance.</p>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Introduction to vulnerability detection and security configuration monitoring</li>
<li>PCI DSS</li>
<li>NIST</li>
<li>HIPPA</li>
</ul>
<h1 id="_idParaDest-194"><a id="_idTextAnchor193"/>Introduction to vulnerability detection and security configuration management</h1>
<p>Vulnerability scanning or detection and security configuration management are critical to keeping the <a id="_idIndexMarker758"/>overall security posture of an organization under control. By discovering and fixing vulnerabilities, vulnerability management reduces the <a id="_idIndexMarker759"/>likelihood of cyberattacks. By ensuring that systems are configured securely, security configuration assessment helps to prevent data breaches and unauthorized access. Both strategies strengthen the organization’s defenses, reducing risks and maintaining trust with stakeholders. Wazuh has modules called Vulnerability Detector to fulfill the requirement of vulnerability <a id="_idIndexMarker760"/>scanning and <strong class="bold">Security Configuration Assessment</strong> (<strong class="bold">SCA</strong>) to maintain the baseline security configuration of endpoints in the network. Let’s understand how Wazuh can deliver both services with its built-in features.</p>
<h2 id="_idParaDest-195"><a id="_idTextAnchor194"/>Vulnerability Detector</h2>
<p>The <strong class="bold">Wazuh Vulnerability Detector</strong> module enables the security team to identify operating <a id="_idIndexMarker761"/>system and application vulnerabilities on the endpoints <a id="_idIndexMarker762"/>being monitored. All valid vulnerabilities are named by <strong class="bold">Common Vulnerabilities and Exposures</strong> (<strong class="bold">CVE</strong>). You can view the list of all the vulnerabilities on the <a href="http://cvedetails.com">cvedetails.com</a> website and <a href="http://nvd.nist.gov">nvd.nist.gov</a>. Both sites are managed by the MITRE Corporation. Wazuh is natively integrated <a id="_idIndexMarker763"/>with different vulnerability feed providers, such as Canonical, Debian, Red Hat, Arch Linux, <strong class="bold">Amazon Linux Advisories Security</strong> (<strong class="bold">ALAS</strong>), Microsoft, and the <strong class="bold">National Vulnerability Database</strong> (<strong class="bold">NVD</strong>). Let’s talk <a id="_idIndexMarker764"/>about how Wazuh can detect any new vulnerabilities.</p>
<h2 id="_idParaDest-196"><a id="_idTextAnchor195"/>How to set up vulnerability detection using Wazuh</h2>
<p>Wazuh agents periodically share a list of installed applications from monitored endpoints <a id="_idIndexMarker765"/>to the Wazuh server. This inventory of installed applications is stored in local SQLite databases on the Wazuh server.</p>
<p>Let’s find <a id="_idIndexMarker766"/>out how vulnerability detection works and what needs to be configured to enable vulnerability detection in Wazuh. The workings of Wazuh’s vulnerability detection can be explained in three steps:</p>
<ol>
<li><code>ossec.conf</code> file:</p><pre class="source-code">
&lt;!-- System inventory --&gt;
   &lt;wodle name="syscollector"&gt;
     &lt;disabled&gt;no&lt;/disabled&gt;
     &lt;interval&gt;1h&lt;/interval&gt;
     &lt;scan_on_start&gt;yes&lt;/scan_on_start&gt;
     &lt;hardware&gt;yes&lt;/hardware&gt;
     &lt;os&gt;yes&lt;/os&gt;
     &lt;network&gt;yes&lt;/network&gt;
     &lt;packages&gt;yes&lt;/packages&gt;
     &lt;ports all="no"&gt;yes&lt;/ports&gt;
     &lt;processes&gt;yes&lt;/processes&gt;
     &lt;!-- Database synchronization settings --&gt;
     &lt;synchronization&gt;
       &lt;max_eps&gt;10&lt;/max_eps&gt;
     &lt;/synchronization&gt;
   &lt;/wodle&gt;</pre><p class="list-inset">Let’s <a id="_idIndexMarker768"/>break this down:</p><ul><li><code>&lt;wodle name="syscollector"&gt;</code>: A wodle is a module in Wazuh that allows <a id="_idIndexMarker769"/>users to perform syscollector, Command, Osquery, Docker-Listener, and other tasks.</li><li><code>&lt;interval&gt;1h&lt;/interval&gt;</code>: This represents the interval at which the syscollector module runs. In this case, it is set to 1 hour.</li><li><code>&lt;hardware&gt;yes&lt;/hardware&gt;</code>: This talks about monitoring hardware-related information.</li><li><code>&lt;os&gt;yes&lt;/os&gt;</code>: This represents the monitoring of the operating system</li><li><code>&lt;network&gt;yes&lt;/network&gt;</code>: This represents the monitoring of network-related information.</li><li><code>&lt;packages&gt;yes&lt;/packages&gt;</code>: This talks about the monitoring of packages or the software of endpoints.</li><li><code>&lt;processes&gt;yes&lt;/processes&gt;</code>: This talks about the monitoring of all processes of endpoints.</li><li><code>&lt;synchronization&gt;</code>: This contains information related to database synchronization.</li><li><code>&lt;max_eps&gt;10&lt;/max_eps&gt;</code>: This specifies the maximum number of events per second (EPS) for database synchronization. In this case, it is set to 10 events per second.</li></ul></li> <li><code>ossec.conf</code> file.</p><p class="list-inset">Specify <code>yes</code> as the value for the <code>enabled&gt;</code> tag for each operating system you intend to scan and the Vulnerability Detector module. For example, if you want to enable the Vulnerability Detector for the Ubuntu OS, here is what you should do:</p><pre class="source-code">
&lt;vulnerability-detector&gt;
   &lt;enabled&gt;yes&lt;/enabled&gt;
   &lt;interval&gt;5m&lt;/interval&gt;
   &lt;min_full_scan_interval&gt;6h&lt;/min_full_scan_interval&gt;
   &lt;run_on_start&gt;yes&lt;/run_on_start&gt;
   &lt;!-- Ubuntu OS vulnerabilities --&gt;
   &lt;provider name="canonical"&gt;
      &lt;enabled&gt;yes&lt;/enabled&gt;
      &lt;os&gt;trusty&lt;/os&gt;
      &lt;os&gt;xenial&lt;/os&gt;
      &lt;os&gt;bionic&lt;/os&gt;
      &lt;os&gt;focal&lt;/os&gt;
      &lt;os&gt;jammy&lt;/os&gt;
      &lt;update_interval&gt;1h&lt;/update_interval&gt;
   &lt;/provider&gt;
<strong class="bold">systemctl restart wazuh-manager</strong></pre></li> <li><strong class="bold">Step 3: Vulnerability </strong><strong class="bold">alerts generated</strong><p class="list-inset">When <a id="_idIndexMarker772"/>the version of packages <a id="_idIndexMarker773"/>in the inventory database matches the vulnerability database (list of CVEs), the package will be labeled as <em class="italic">vulnerable</em> and the Vulnerability Detector module will organize all these vulnerabilities against every agent. You can check the vulnerable packages or applications by navigating to the vulnerabilities module of the Wazuh manager, as shown in the following screenshot.</pre></li>
</ol>
<div><div><img alt="Figure 7.1 – Vulnerable packages or applications in Wazuh manager" src="img/B19549_7_01.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.1 – Vulnerable packages or applications in Wazuh manager</p>
<p class="callout-heading">Note</p>
<p class="callout">When we enable vulnerability detection for the first time, it performs a baseline scan wherein it performs a full scan of the operating system and every package installed. After that, it performs a partial scan where it only scans new packages.</p>
<h2 id="_idParaDest-197"><a id="_idTextAnchor196"/>Security configuration assessment</h2>
<p>The <strong class="bold">Security Configuration Assessment</strong> (<strong class="bold">SCA</strong>) procedure validates that every system <a id="_idIndexMarker774"/>adheres to a predetermined set of regulations concerning configuration settings and authorized application usage.</p>
<p>Here are a couple of examples:</p>
<ul>
<li>Verifying that all the unnecessary open ports (TCP or UDP) are disabled or blocked</li>
<li>Ensuring that default credentials have been modified</li>
</ul>
<p>These are some of the most common approaches to bringing down the vulnerability surface of endpoints in the network. Wazuh has a built-in SCA module to scan such misconfigured endpoints and recommend remediation steps. The scanning is conducted based on the SCA policy file, which contains a set of rules. SCA policies can check for the existence of files, directories, registry keys/values, running processes, and so on, as illustrated in the following diagram.</p>
<div><div><img alt="Figure 7.2 – Wazuh SCA check" src="img/B19549_7_02.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.2 – Wazuh SCA check</p>
<p>Wazuh SCA checks that every Wazuh agent maintains a local database in which it keeps the present status of every SCA check. SCA scan results are shown as alerts whenever a particular <a id="_idIndexMarker775"/>check changes its status from its last scan.</p>
<p>The Wazuh <a id="_idIndexMarker776"/>team and community have built the SCA rules based on the CIS Benchmark. <strong class="bold">Center for Internet Security</strong> (<strong class="bold">CIS</strong>) is a non-profit, community-driven organization, responsible for building security controls and benchmarks for numerous operating systems and platforms. CIS Controls and CIS Benchmarks are globally recognized best practices for security network infrastructure.</p>
<h3>How to set up Wazuh SCA</h3>
<p>Wazuh SCA <a id="_idIndexMarker777"/>policies are derived from the CIS Benchmark. To configure Wazuh for SCA, start by turning on SCA policies on Wazuh agents. If you have a custom SCA policy, you can push it from the Wazuh manager to all the Wazuh agents. The process is explained as follows:</p>
<ol>
<li><code>/var/ossec/ruleset/sca</code> directory for Linux and the <code>C:\\Program Files (x86)\\ossec-agent\\ruleset\\sca</code> folder for Windows. You can also create a custom SCA script by utilizing a YML file structure with four sections: <code>policy</code>, <code>requirements</code>, <code>variables</code>, and <code>checks</code>, as shown here:</p><pre class="source-code">
<strong class="bold">policy:</strong>
<strong class="bold">  id: "rdp_audit"</strong>
<strong class="bold">  file: "sca_rdp_audit.yml"</strong>
  name: "System audit for Windows based system"
  description: "Guidance for establishing a secure configuration for Unix based systems."
  references: <a href="https://www.cisecurity.org/">https://www.cisecurity.org/</a>
    -
requirements:
  title: "Check that the RDP service is not using the default port (3389)"
  description: "Requirements for running the SCA scan against the RDP service on Windows."
  condition: any
  rules:
    - 'r:HKEY_LOCAL_MACHINE\System\CurrentControlSet'
variables:
  $rdp_registry_path: HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp
checks:
  - id: 3000
    title: "RDP Port: Check that RDP is not running on the default port (3389)"
    description: "The RDP service should not be listening on the default port 3389 for incoming connections."
    rationale: "Changing the default RDP port can help reduce the risk of unauthorized access to the system."
    remediation: "Change the RDP port to a non-standard port for added security."
    compliance:
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'r:HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp -&gt; PortNumber -&gt; d3d'</pre><p class="list-inset">Let’s <a id="_idIndexMarker778"/>break this down:</p><ul><li><code>policy</code> is a required section.</li><li><code>id</code>, <code>file</code>, <code>name</code>, <code>description</code>, and <code>references</code> are some basic metadata for the preceding SCA script.</li><li><code>requirements</code> is an optional section.</li><li><code>variables</code> is again an optional section. It’s important for simplifying the rule creation by creating variables for the path or file name and so on.</li><li><code>checks</code> is a required section. This is where we define rules and conditions.</li><li><code>'r:HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp -&gt; PortNumber</code>: This represents the registry value of the RDP port. In this case, the rule checks whether it is <code>d3d</code>, which means <code>3389</code>.</li></ul></li> <li><code>agent.conf</code> file to push the configurations to all Wazuh agents. </p><p class="list-inset">To complete the setup, we need to follow these steps:</p><ol><li class="upper-roman">Enable remote command execution. Set <code>sca.remote_commands</code> to <code>1</code>:<pre class="l2-source"><code>/var/ossec/etc/shared/default</code> folder of the Wazuh manager and set the ownership to <code>wazuh:wazuh</code>:<pre class="l2-source"><code>agent.conf</code> file:<pre class="l2-source">&lt;agent_config&gt;
  &lt;!-- Shared agent configuration here --&gt;
  &lt;sca&gt;
    &lt;policies&gt;
        &lt;policy&gt;etc/shared/sca_rdp_audit.yml&lt;/policy&gt;
    &lt;/policies&gt;
  &lt;/sca&gt;
&lt;/agent_config&gt;</pre></li></ol></li>
</ol>
<p>We have learned how SCA policies are created and how they are pushed to Wazuh agents. In the next section, we will learn about PCI DSS compliance and how can you use the Wazuh Vulnerability Detector and Security Configuration Assessment modules to meet its requirements.</p>
<h1 id="_idParaDest-198"><a id="_idTextAnchor197"/>PCI DSS</h1>
<p>Credit card <a id="_idIndexMarker780"/>fraud is one of the most common types of bank fraud. A record $34.36 billion was lost to fraud on credit and debit cards in 2022, up almost 5% from the previous year (<a href="http://tinyurl.com/4dymuc8d">http://tinyurl.com/4dymuc8d</a>). <strong class="bold">Payment Card Industry Data Security Standard</strong> (<strong class="bold">PCI DSS</strong>) compliance plays an important role because it forces organizations to safely and securely store and process payment card information. This protects both companies and their customers from data breaches and financial losses. For any organization to become PCI DSS compliant, it needs to fulfill 12 requirements drafted by PCI DSS. The Wazuh platform plays a crucial role in fulfilling some of the most critical PCI DSS requirements. In this chapter, we will address some of the important PCI DSS requirements:</p>
<ul>
<li>What is PCI DSS compliance?</li>
<li>Requirements of PCI DSS compliance</li>
<li>Wazuh use cases for PCI DSS compliance</li>
</ul>
<h2 id="_idParaDest-199"><a id="_idTextAnchor198"/>What is PCI DSS compliance?</h2>
<p><strong class="bold">PCI DSS compliance</strong> was developed by Visa, MasterCard, Discover Financial Services, JCB International, and American Express in 2004 as a set of security standards. This compliance <a id="_idIndexMarker781"/>scheme is overseen by the <strong class="bold">Payment Card Industry Security Standards Council</strong> (<strong class="bold">PCI SSC</strong>), with the objective of safeguarding credit and debit card transactions from fraudulent activities and data theft. PCI SSC is an international body that regulates the payment card industry.</p>
<p>PCI DSS is a set of twelve requirements and checklists to ensure that cardholder data is protected and prevent data breaches in organizations. Organizations complying with PCI DSS must meet all 12 requirements, covering the installation and use of firewalls, encryption, endpoint security, network security monitoring, log management, file integrity, access controls, and so on. Let’s learn about each PCI DSS requirement in detail and the corresponding security controls.</p>
<h2 id="_idParaDest-200"><a id="_idTextAnchor199"/>Requirements of PCI DSS compliance</h2>
<p>There are a total of 12 requirements to achieve PCI DSS certification. Each requirement has a few <a id="_idIndexMarker782"/>sub-requirements. I will explain each of the PCI DSS requirements with its main points, security controls, and the tools used to fulfill the corresponding requirements, and what Wazuh capabilities or modules can be used to address the same requirements.</p>
<ul>
<li><strong class="bold">Requirement #1: Install and maintain a firewall configuration to protect </strong><strong class="bold">cardholder data</strong><table class="No-Table-Style _idGenTablePara-1" id="table001-3"><colgroup><col/><col/><col/></colgroup><thead><tr class="No-Table-Style"><td class="No-Table-Style"><p><strong class="bold">Main Points</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Security Controls </strong><strong class="bold">and Tools</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Wazuh Capabilities</strong></p></td></tr></thead><tbody><tr class="No-Table-Style"><td class="No-Table-Style"><ul><li>Install and maintain a firewall configuration to protect cardholder data.</li><li>Do not use vendor-supplied defaults for system passwords and other security parameters.</li><li>Protect stored cardholder data.</li></ul></td><td class="No-Table-Style"><ul><li>Firewall</li><li>Next-gen Firewall</li><li>IPS/IDS: Suricata, Snort, Cisco Firepower</li></ul></td><td class="No-Table-Style"><ul><li>Security Configuration Assessment (SCA) module</li></ul></td></tr></tbody></table></li>
</ul>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.1 – Security controls and Wazuh modules for PCI DSS Requirement 1</p>
<ul>
<li><strong class="bold">Requirement #2: Do not use vendor-supplied defaults when it comes to system passwords and other </strong><strong class="bold">security elements</strong><table class="No-Table-Style _idGenTablePara-1" id="table002-1"><colgroup><col/><col/><col/></colgroup><thead><tr class="No-Table-Style"><td class="No-Table-Style"><p><strong class="bold">Main Points</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Security Controls </strong><strong class="bold">and Tools</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Wazuh Capabilities</strong></p></td></tr></thead><tbody><tr class="No-Table-Style"><td class="No-Table-Style"><ul><li>Encrypt transmission of cardholder data across open, public networks.</li><li>Do not store sensitive authentication data after authorization.</li><li>Encrypt stored cardholder data.</li></ul></td><td class="No-Table-Style"><ul><li>Two-factor authentication: Google Authenticator, Cisco DUO</li></ul></td><td class="No-Table-Style"><ul><li>Security Configuration Assessment (SCA)</li><li>Vulnerability detection</li><li>Log analysis</li></ul></td></tr></tbody></table></li>
</ul>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.2 – Security controls and Wazuh modules for PCI DSS Requirement 2</p>
<ul>
<li><strong class="bold">Requirement #3: Protect </strong><strong class="bold">cardholder data</strong></li>
</ul>
<table class="No-Table-Style _idGenTablePara-1" id="table003">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">Main Points</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Security Controls </strong><strong class="bold">and Tools</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Wazuh Capabilities</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<ul>
<li>Keep anti-virus software updated and actively running.</li>
<li>Develop and maintain secure systems and applications.</li>
<li>Protect against malware.</li>
</ul>
</td>
<td class="No-Table-Style">
<p>SSL/TLS</p>
<p>Encryption solutions: BitLocker</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Security Configuration Assessment (SCA)</li>
<li>File integrity monitoring</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.3 – Security controls and Wazuh modules for PCI DSS Requirement 3</p>
<ul>
<li><strong class="bold">Requirement #4: Encrypt Transmission of Cardholder Data Across Open, </strong><strong class="bold">Public Networks</strong><table class="No-Table-Style _idGenTablePara-1" id="table004"><colgroup><col/><col/><col/></colgroup><thead><tr class="No-Table-Style"><td class="No-Table-Style"><p><strong class="bold">Main Points</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Security Controls </strong><strong class="bold">and Tools</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Wazuh Capabilities</strong></p></td></tr></thead><tbody><tr class="No-Table-Style"><td class="No-Table-Style"><ul><li>Use strong encryption over public networks.</li><li>Avoid sending unprotected PANs.</li></ul></td><td class="No-Table-Style"><ul><li>SSL/TLS Certificates</li><li>Remote Access VPN: Cisco AnyConnect, Palo Alto Global Protect etc</li></ul></td><td class="No-Table-Style"><ul><li>Security Configuration Assessment (SCA)</li></ul></td></tr></tbody></table></li>
</ul>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.4 – Security controls and Wazuh modules for PCI DSS Requirement 4</p>
<ul>
<li><strong class="bold">Requirement #5: Protect all systems against malware and regularly update anti-virus software </strong><strong class="bold">or programs</strong><table class="No-Table-Style _idGenTablePara-1" id="table005"><colgroup><col/><col/><col/></colgroup><thead><tr class="No-Table-Style"><td class="No-Table-Style"><p><strong class="bold">Main Points</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Security Controls </strong><strong class="bold">and Tools</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Wazuh Capabilities</strong></p></td></tr></thead><tbody><tr class="No-Table-Style"><td class="No-Table-Style"><ul><li>Use updated anti-virus software.</li><li>Ensure regular updates and scans.</li></ul></td><td class="No-Table-Style"><ul><li>Endpoint protection or anti-virus software: Carbon Black, Kaspersky, CrowdStrike, and so on.</li></ul></td><td class="No-Table-Style"><ul><li>Security Configuration Assessment (SCA)</li><li>Malware detection</li><li>Rootkit detection</li><li>Threat intelligence</li><li>Log analysis</li></ul></td></tr></tbody></table></li>
</ul>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.5 – Security controls and Wazuh modules for PCI DSS Requirement 5</p>
<ul>
<li><strong class="bold">Requirement #6: Develop and maintain secure systems </strong><strong class="bold">and applications</strong><table class="No-Table-Style _idGenTablePara-1" id="table006"><colgroup><col/><col/><col/></colgroup><thead><tr class="No-Table-Style"><td class="No-Table-Style"><p><strong class="bold">Main Points</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Security Controls </strong><strong class="bold">and Tools</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Wazuh Capabilities</strong></p></td></tr></thead><tbody><tr class="No-Table-Style"><td class="No-Table-Style"><ul><li>Identify security vulnerabilities.</li><li>Protect systems from known vulnerabilities.</li><li>Follow secure software development practices.</li></ul></td><td class="No-Table-Style"><ul><li>Security testing tools: Checkmarx, Veracode SonarQube, OWASP ZAP, Burp-Suite, Sonatype Nexus, Mend SCA</li></ul></td><td class="No-Table-Style"><ul><li>Security Configuration Assessment (SCA)</li><li>Vulnerability detection</li><li>Log analysis</li><li>Active response,</li><li>File integrity monitoring</li></ul></td></tr></tbody></table></li>
</ul>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.6 – Security controls and Wazuh modules for PCI DSS Requirement 6</p>
<ul>
<li><strong class="bold">Requirement #7: Restrict access to cardholder data by business need </strong><strong class="bold">to know</strong><table class="No-Table-Style _idGenTablePara-1" id="table007"><colgroup><col/><col/><col/></colgroup><thead><tr class="No-Table-Style"><td class="No-Table-Style"><p><strong class="bold">Main Points</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Security Controls </strong><strong class="bold">and Tools</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Wazuh Capabilities</strong></p></td></tr></thead><tbody><tr class="No-Table-Style"><td class="No-Table-Style"><ul><li>Limit access based on job necessity.</li><li>Implement access control.</li><li>Restrict physical access.</li></ul></td><td class="No-Table-Style"><ul><li>Identity and access management: Okta, SailPoint, CyberArk</li></ul></td><td class="No-Table-Style"><ul><li>Security Configuration Assessment (SCA)</li></ul></td></tr></tbody></table></li>
</ul>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.7 – Security controls and Wazuh modules for PCI DSS Requirement 7</p>
<ul>
<li><strong class="bold">Requirement #8: Identify and authenticate access to </strong><strong class="bold">system components</strong><table class="No-Table-Style _idGenTablePara-1" id="table008"><colgroup><col/><col/><col/></colgroup><thead><tr class="No-Table-Style"><td class="No-Table-Style"><p><strong class="bold">Main Points</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Security Controls </strong><strong class="bold">and Tools</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Wazuh Capabilities</strong></p></td></tr></thead><tbody><tr class="No-Table-Style"><td class="No-Table-Style"><ul><li>Use unique IDs for system access.</li><li>Assign access by job role.</li></ul></td><td class="No-Table-Style"><ul><li>Network access controls: Cisco ISE, Aruba ClearPass</li><li>Remote access VPN: Cisco AnyConnect, Palo Alto Global Protect, and so on</li></ul></td><td class="No-Table-Style"><ul><li>Security Configuration Assessment (SCA)</li><li>Log analysis</li><li>File integrity monitoring</li></ul></td></tr></tbody></table></li>
</ul>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.8 – Security controls and Wazuh modules for PCI DSS Requirement 8</p>
<ul>
<li><strong class="bold">Requirement #9: Restrict physical access to </strong><strong class="bold">cardholder data</strong><table class="No-Table-Style _idGenTablePara-1" id="table009"><colgroup><col/><col/><col/></colgroup><thead><tr class="No-Table-Style"><td class="No-Table-Style"><p><strong class="bold">Main Points</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Security Controls </strong><strong class="bold">and Tools</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Wazuh Capabilities</strong></p></td></tr></thead><tbody><tr class="No-Table-Style"><td class="No-Table-Style"><ul><li>Employ entry controls for physical access.</li><li>Differentiate between personnel and visitors.</li></ul></td><td class="No-Table-Style"><ul><li>Physical access control system</li><li>Surveillance cameras</li><li>Biometric access system</li></ul></td><td class="No-Table-Style"><ul><li>Security Configuration Assessment (SCA)</li><li>Log analysis</li></ul></td></tr></tbody></table></li>
</ul>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.9 – Security controls and Wazuh modules for PCI DSS Requirement 9</p>
<ul>
<li><strong class="bold">Requirement #10: Track and monitor all access to network resources and </strong><strong class="bold">cardholder data</strong><table class="No-Table-Style _idGenTablePara-1" id="table010"><colgroup><col/><col/><col/></colgroup><thead><tr class="No-Table-Style"><td class="No-Table-Style"><p><strong class="bold">Main Points</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Security Controls </strong><strong class="bold">and Tools</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Wazuh Capabilities</strong></p></td></tr></thead><tbody><tr class="No-Table-Style"><td class="No-Table-Style"><ul><li>Monitor all network and data access.</li><li>Implement automated audit trails.</li></ul></td><td class="No-Table-Style"><ul><li>Security Information and Event Management (SIEM) tools: Splunk SIEM, IBM QRadar, LogRhythm, and so on</li><li>IDS solutions: Snort, Suricata</li><li>Log management: Graylog</li></ul></td><td class="No-Table-Style"><ul><li>Security Configuration Assessment (SCA)</li><li>Log data analysis</li><li>Active response</li></ul></td></tr></tbody></table></li>
</ul>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.10 – Security controls and Wazuh modules for PCI DSS Requirement 10</p>
<ul>
<li><strong class="bold">Requirement #11: Regularly test security systems </strong><strong class="bold">and processes</strong><table class="No-Table-Style _idGenTablePara-1" id="table011"><colgroup><col/><col/><col/></colgroup><thead><tr class="No-Table-Style"><td class="No-Table-Style"><p><strong class="bold">Main Points</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Security Controls </strong><strong class="bold">and Tools</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Wazuh Capabilities</strong></p></td></tr></thead><tbody><tr class="No-Table-Style"><td class="No-Table-Style"><ul><li>Conduct regular security tests.</li><li>Perform internal and external vulnerability scans.</li></ul></td><td class="No-Table-Style"><ul><li>Vulnerability scanning: Tenable, Qualys, Rapid7, and so on</li><li>Penetration testing: Metasploit framework, Burp-Suite</li></ul></td><td class="No-Table-Style"><ul><li>Security Configuration Assessment (SCA)</li><li>Vulnerability detection</li><li>Log data analysis</li><li>Active response</li></ul></td></tr></tbody></table></li>
</ul>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.11 – Security controls and Wazuh modules for PCI DSS Requirement 11</p>
<ul>
<li><strong class="bold">Requirement #12: Regularly test security systems </strong><strong class="bold">and processes</strong><table class="No-Table-Style _idGenTablePara-1" id="table012"><colgroup><col/><col/><col/></colgroup><thead><tr class="No-Table-Style"><td class="No-Table-Style"><p><strong class="bold">Main Points</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Security Controls </strong><strong class="bold">and Tools</strong></p></td><td class="No-Table-Style"><p><strong class="bold">Wazuh Capabilities</strong></p></td></tr></thead><tbody><tr class="No-Table-Style"><td class="No-Table-Style"><ul><li>Establish and disseminate a security policy.</li><li>Ensure personnel awareness of security policy.</li></ul></td><td class="No-Table-Style"><ul><li>Governance risk and compliance software: RSA Archer</li><li>Security awareness platform: KnowBe4, Cofence PhishMe, and so on.</li></ul></td><td class="No-Table-Style"><ul><li>Security Configuration Assessment (SCA)</li></ul></td></tr></tbody></table></li>
</ul>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.12 – Security controls and Wazuh modules for PCI DSS Requirement 12</p>
<p>When it comes <a id="_idIndexMarker783"/>to Wazuh modules to address most of the PCI DSS requirements, <strong class="bold">SCA</strong> and Vulnerability Detector are the most common Wazuh modules listed in the preceding tables. Let’s understand the use cases of both Wazuh modules to fulfill some of the important PCI DSS requirements as explained in the next section onward.</p>
<h2 id="_idParaDest-201"><a id="_idTextAnchor200"/>Vulnerability detection use cases for PCI DSS</h2>
<p>As we <a id="_idIndexMarker784"/>learned in the <em class="italic">Introduction to vulnerability detection and security configuration management</em> section, Wazuh detects vulnerabilities in the applications or packages installed on agents using the Vulnerability Detector module. The vulnerability scanning or checks are performed by integrating <a id="_idIndexMarker785"/>vulnerability feeds from Debian, Red Hat, Arch Linux, <strong class="bold">Amazon Linux Advisories Security</strong> (<strong class="bold">ALAS</strong>), Microsoft, the National Vulnerability Database, and many more. Wazuh Vulnerability Detector <a id="_idIndexMarker786"/>can be confidently used for Requirement 6 and Requirement 11 of PCI DSS compliance. Use cases for PCI DSS requirements that the vulnerability detection module can fulfill are as follows:</p>
<h3>Use case #1: Ensure the detection of and address security vulnerabilities on Windows machines</h3>
<p>As per PCI DSS requirement 6, we need to ensure that we detect and address security vulnerabilities. In this use case, we will focus on a Windows machine to detect and address vulnerabilities using a Wazuh module. We can schedule a Vulnerability Detector scan to discover security vulnerabilities. This will require the following steps:</p>
<ol>
<li>Requirements</li>
<li>Set up the syscollector wodle on the endpoint</li>
<li>Enable Vulnerability Detector on the Wazuh server and restart</li>
<li>Visualize the alerts</li>
</ol>
<h4>Requirements</h4>
<p>To set <a id="_idIndexMarker787"/>up the lab environment to run vulnerability detection on a Windows machine, you require the following systems:</p>
<ul>
<li>Windows machine (with the Wazuh agent installed)</li>
<li>Wazuh server</li>
</ul>
<h4>Set up the syscollector wodle on the Windows endpoint</h4>
<p>The <a id="_idIndexMarker788"/>Wazuh syscollector wodle manages the information related to hardware, applications, the operating system, and so on. To customize our Windows endpoint, add the syscollector wodle in the <code>ossec.config</code> file located at <code>/var/ossec/etc</code> in the Wazuh agent, as shown here:</p>
<pre class="source-code">
&lt;wodle name="syscollector"&gt;
   &lt;disabled&gt;no&lt;/disabled&gt;
   &lt;interval&gt;1h&lt;/interval&gt;
   &lt;packages&gt;yes&lt;/packages&gt;
&lt;/wodle&gt;</pre> <h4>Enable Vulnerability Detector on the Wazuh server and restart</h4>
<p>To <a id="_idIndexMarker789"/>enable vulnerability detection for the Windows platform, you need to edit the <code>ossec.conf</code> file in the Wazuh server located at <code>/var/ossec/etc</code>. You are required to set <code>&lt;enabled&gt;</code> tab to <code>yes</code> under the <code>Windows OS vulnerabilities</code> section, as shown here:</p>
<pre class="source-code">
&lt;vulnerability-detector&gt;
   &lt;enabled&gt;yes&lt;/enabled&gt;
   &lt;interval&gt;5m&lt;/interval&gt;
   &lt;run_on_start&gt;yes&lt;/run_on_start&gt;
   &lt;!-- Windows OS vulnerabilities --&gt;
   &lt;provider name="msu"&gt;
      &lt;enabled&gt;yes&lt;/enabled&gt;
      &lt;update_interval&gt;1h&lt;/update_interval&gt;
   &lt;/provider&gt;</pre> <p>Restart and test the Wazuh manager:</p>
<pre class="console">
systemctl restart wazuh-manager</pre> <p>Once the Wazuh manager is finished with the restart, you can see the vulnerability alerts on the <strong class="bold">Modules</strong> &gt; <strong class="bold">Vulnerabilities</strong> &gt; <strong class="bold">Events</strong> tab. The top two vulnerabilities are about the Google Chrome application on the Windows machine.</p>
<p class="callout-heading">Note</p>
<p class="callout">Once you select Google Chrome Vulnerability CVE-2023-5472, the Wazuh dashboard gives <a id="_idIndexMarker790"/>an overview of the alert and the current status of the agent. To know more about all the active CVEs, including information on the affected software, severity rating, links to adversaries, and patches released by the vendor, you can visit <a href="http://cvedetails.com">cvedetails.com</a>. This website is managed by the SecurityScorecard organization.</p>
<div><div><img alt="Figure 7.3 – Vulnerability detection for Google Chrome CVE-2023-5472" src="img/B19549_7_03.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.3 – Vulnerability detection for Google Chrome CVE-2023-5472</p>
<h3>Use case #2: Identify, prioritize, and address security vulnerabilities regularly</h3>
<p>As <a id="_idIndexMarker791"/>per <em class="italic">PCI DSS Requirement 11</em>, we <a id="_idIndexMarker792"/>need to <a id="_idIndexMarker793"/>identify, prioritize, and address security vulnerabilities. You can apply a filter with <code>severity=Critical</code> and you can see all Windows vulnerabilities with critical severity.</p>
<div><div><img alt="Figure 7.4 – Finding critical vulnerabilities with Vulnerability Detector" src="img/B19549_7_04.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.4 – Finding critical vulnerabilities with Vulnerability Detector</p>
<h2 id="_idParaDest-202"><a id="_idTextAnchor201"/>Security configuration assessment use cases for PCI DSS</h2>
<p>Security configuration assessment is an essential Wazuh module, helping you to address <a id="_idIndexMarker794"/>multiple PCI DSS requirements. In fact, many of the PCI DSS requirements can be fulfilled by using the Wazuh SCA module. We will address two important PCI DSS requirements using some sample SCA scripts. Please note, both the mentioned use cases are already present in the <code>cis_win2012r2.yml</code> file located at <code>C:\\Program </code><code>Files (x86)\\ossec-agent\\ruleset\\sca</code>.</p>
<h3>Use case #1: Do not display the last user name on interactive login</h3>
<p><em class="italic">PCI DSS Requirement 2</em> requires enabling only necessary services, protocols, and daemons, and <a id="_idIndexMarker795"/>removing or disabling all unnecessary functionality. Let’s audit a specific service on Windows Server 2012 R2. We will run an SCA check on whether the account name of the last user to log on to the computer will be displayed on each computer’s respective Windows logon screen. It’s recommended the feature is disabled.</p>
<p>In the <em class="italic">Security configuration assessment</em> section, we already covered how to create a custom SCA and the components of each SCA script (policy, requirements, checks). Following is a PCI DSS requirement use case wherein we check if <code>cis_win2012r2.yml</code> file located at <code>C:\\Program </code><code>Files (x86)\\ossec-agent\\ruleset\\sca</code>.</p>
<p>One of the sub-requirements under <em class="italic">PCI DSS Requirement 2</em> requires disabling all unwanted services, protocols, daemons, and functionalities. In this use case, we will run an SCA <a id="_idIndexMarker796"/>check to ensure <em class="italic">‘Do not display last user name in the interactive Windows logon</em>’ is enabled on the Windows machine. The SCA script has already been built by the Wazuh team and compiled by them in the <code>cis_win2012r2.yml</code> file located at <code>C:\\Program Files (x86)\\ossec-agent\\ruleset\\sca</code>. This will require the following steps:</p>
<ol>
<li>Requirements</li>
<li>Reviewing the SCA policy</li>
<li>Visualizing alerts</li>
</ol>
<h4>Requirements</h4>
<p>In order to complete the use case of performing an SCA check for <em class="italic">Do not display last user name on Interactive login,</em> the requirements are as follows:</p>
<ul>
<li>Windows machine (with the Wazuh agent installed)</li>
<li>Wazuh server</li>
</ul>
<h4>Reviewing the SCA policy</h4>
<p>We don’t need to make any changes in this step. Wazuh has a built-in SCA policy for <em class="italic">‘Interactive logon: Do not display last user name’</em>, set to <code>C:\\Program Files (x86)\\ossec-agent\\ruleset\\sca</code> file as shown here:</p>
<pre class="source-code">
- id: 15015
    title: "Ensure 'Interactive logon: Do not display last user name' is set to 'Enabled'"
    description: "This policy setting determines whether the account name of the last user to log on to the client computers in your organization will be displayed in each computer's respective Windows logon screen. Enable this policy setting to prevent intruders from collecting account names visually from the screens of desktop or laptop computers in your organization. The recommended state for this setting is: Enabled."
    rationale: "An attacker with access to the console (for example, someone with physical access or someone who is able to connect to the server through Remote Desktop Services) could view the name of the last user who logged on to the server. The attacker could then try to guess the password, use a dictionary, or use a brute-force attack to try and log on."
    remediation: "To establish the recommended configuration via GP, set the following UI path to Enabled: Computer Configuration\\Policies\\Windows Settings\\Security Settings\\Local Policies\\Security Options\\Interactive logon: Do not display last user name."
    compliance:
      - cis: [«2.3.7.1»]
      - cis_csc: [«13»]
      - pci_dss: [«2.2.3»]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    references:
      - 'CCE-36056-0'
    condition: all
    rules:
      - 'r:HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System -&gt; DontDisplayLastUserName -&gt; 1'</pre> <p>Here, we <a id="_idIndexMarker797"/>see the following:</p>
<ul>
<li><code>condition</code> is set to <code>all</code>.</li>
<li><code>r:HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System</code> represents the registry value by using the <code>r</code> parameter at the beginning. In our case, we have set the registry value to <code>1</code>.</li>
</ul>
<h4>Visualizing the alerts</h4>
<p>To verify whether our Windows Server 2012 R2 passed or failed the SCA check, you can go to <strong class="bold">Modules</strong> &gt; <strong class="bold">Security configuration assessment</strong> and then select the agent. As per the SCA alert shown here, the check has failed.</p>
<div><div><img alt="Figure 7.5 –SCA check – Do not display last user name on Interactive login" src="img/B19549_7_05.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.5 –SCA check – Do not display last user name on Interactive login</p>
<p>In order to ensure our Windows machine passes the SCA check for <code>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System -&gt; DontDisplayLastUserName</code> registry location and set it to <code>1</code>.</p>
<h3>Use case #2: Disable anonymous enumeration of SAM accounts and shares</h3>
<p>According to <em class="italic">PCI DSS Requirement 7</em>, businesses should restrict access to the cardholder <a id="_idIndexMarker799"/>data environment based on a business need-to-know basis. This simply means that only authorized personnel (engineer/technician/manager) should be able to access cardholder-related data, and that access should be limited based on the job responsibilities and business requirements. One such use case for a Windows machine is to disable the anonymous enumeration <a id="_idIndexMarker800"/>of SAM accounts and shares. <code>cis_win2012r2.yml</code> file located at <code>C:\\Program Files (x86)</code>\\ossec-agent\\ruleset\\sca in the Windows agent.</p>
<p>The following topics will be covered in this use case:</p>
<ul>
<li>Requirements</li>
<li>Reviewing the SCA policy</li>
<li>Visualizing the alerts</li>
</ul>
<h4>Requirements</h4>
<p>In order to complete the use case to perform an SCA check for <strong class="bold">Disable Anonymous enumeration of SAM accounts and shares</strong>, the requirements are as follows:</p>
<ul>
<li>Kali Linux (with the Wazuh agent installed)</li>
<li>Wazuh server</li>
</ul>
<h4>Reviewing the SCA policy</h4>
<p>The following example is a use case where we ensure that anonymous users can’t scan SAM <a id="_idIndexMarker801"/>accounts and shares. Enabling this policy setting will prevent anonymous users from enumerating network share names and domain account user names on the systems in your environment:</p>
<pre class="source-code">
- id: 15031
    title: "Ensure 'Network access: Do not allow anonymous enumeration of SAM accounts and shares' is set to 'Enabled'"
    description: "This policy setting controls the ability of anonymous users to enumerate SAM accounts as well as shares. If you enable this policy setting, anonymous users will not be able to enumerate domain account user names and network share names on the systems in your environment. The recommended state for this setting is: Enabled. Note: This policy has no effect on Domain Controllers."
    rationale: "An unauthorized user could anonymously list account names and shared resources and use the information to attempt to guess passwords or perform social engineering attacks. (Social engineering attacks try to deceive users in some way to obtain passwords or some form of security information)"
    remediation: "To establish the recommended configuration via GP, set the following U path to Enabled: Computer Configuration\\Policies\\Windows Settings\\Security Settings\\Local Policies\\Security Options\\Network access: Do not allow anonymous enumeration of SAM accounts and shares."
    compliance:
      - cis: [«2.3.10.3»]
      - cis_csc: [«16»]
      - pci_dss: [«7.1»]
      - tsc: ["CC6.4"]
    references:
      - 'CCE-36316-8'
    condition: all
    rules:
      - 'r:HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa -&gt; RestrictAnonymous -&gt; 1'</pre> <p>Here, we <a id="_idIndexMarker802"/>see the following:</p>
<ul>
<li><code>condition</code> is set to <code>all</code>.</li>
<li><code>r:HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa</code> represents the registry value of <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa</code>. In our case, it is set to <code>1</code>.</li>
</ul>
<h4>Visualizing the alerts</h4>
<p>To verify whether our Windows Server 2012 R2 passed or failed the SCA check, you can go to <strong class="bold">Modules</strong> &gt; <strong class="bold">Security Configuration Assessment</strong> and then select the agent.  You can verify whether the SCA check is passed or failed as shown in the following screenshot:</p>
<div><div><img alt="Figure 7.6 – SCA check – Disable Anonymous enumeration of SAM accounts and shares" src="img/B19549_7_06.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.6 – SCA check – Disable Anonymous enumeration of SAM accounts and shares</p>
<p>As per the SCA output, the check failed because the registry value of <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa</code> is not set to <code>1</code> on our Windows machine. This means an attacker could list account names and shared resources and use that information to perform a social engineering attack.</p>
<p>The <a id="_idIndexMarker803"/>remediation is shown in the above diagram and requires you to set the registry value to 1, then our SCA check will be marked as passed.</p>
<p>In this section, we have learned about PCI DSS compliance and its requirements and utilized Wazuh’s Vulnerability Detector and SCA modules to fulfill some of the popular PCI Compliance requirements. In the next section, we will learn about NIST 800-53 controls and how Wazuh modules can be used for some of the NIST 800-53 controls.</p>
<h1 id="_idParaDest-203"><a id="_idTextAnchor202"/>NIST 800-53</h1>
<p>Over 30,000 cyber <a id="_idIndexMarker804"/>security incidents were reported to federal agencies in the United States in the fiscal year 2022-23 – a five percent reduction from the year before (<a href="http://tinyurl.com/2s3msja8">http://tinyurl.com/2s3msja8</a>). All federal agencies need to be compliant <a id="_idIndexMarker805"/>with the <strong class="bold">Federal Information Security Management Act</strong> (<strong class="bold">FISMA</strong>). FISMA is a federal law that requires US government agencies to create, document, and implement an information security and protection program. <strong class="bold">NIST 800-53</strong> is a cybersecurity standard and guidelines that help federal agencies meet the requirements set by FISMA. The NIST 800-53 framework is developed by the National Institute of Standards in Technology. To summarize, the NIST 800-53 framework helps federal agencies to become FISMA compliant. In this <a id="_idIndexMarker806"/>section, we will cover the following topics:</p>
<ul>
<li>What is the NIST 800-53 framework?</li>
<li>List of control families in the NIST 800-53 framework</li>
<li>Vulnerability detection use case</li>
</ul>
<h2 id="_idParaDest-204"><a id="_idTextAnchor203"/>What is the NIST 800-53 framework?</h2>
<p>The NIST 800-53 <a id="_idIndexMarker807"/>framework is a cybersecurity standard and <a id="_idIndexMarker808"/>compliance framework developed by the <strong class="bold">National Institute of Standards and Technology</strong> (<strong class="bold">NIST</strong>). It provides a set of guidelines on the security controls needed to build secure and resilient information systems.</p>
<h3>What is the goal of NIST 800-53?</h3>
<p>The goals <a id="_idIndexMarker809"/>of NIST Special Publication 800-53 are the following:</p>
<ul>
<li><strong class="bold">Offer a thorough framework</strong>: The goal of NIST 800-53 is to provide an extensive and organized framework for choosing and putting security policies in place to safeguard information systems</li>
<li><strong class="bold">Enhance information security</strong>: By implementing a set of security controls and best practices, its main objective is to improve the security and privacy of federal information systems and organizations</li>
<li><strong class="bold">Encourage risk management</strong>: NIST 800-53 advises businesses to recognize, evaluate, and control cybersecurity risks in accordance with their particular requirements and threat environments</li>
<li><strong class="bold">Facilitate compliance and regulation</strong>: It acts as a guide for companies doing business with the United States government and assists firms in conforming to federal rules and compliance obligations, such as FISMA</li>
<li><strong class="bold">Encourage continuous improvement</strong>: Organizations can adjust and improve their cybersecurity procedures over time as a result of NIST 800-53’s evolution to address new threats and technology</li>
</ul>
<p>The NIST 800-53 <a id="_idIndexMarker810"/>framework provides a number of different controls across multiple security and system access control families. The controls are then organized into 20 security and control families.</p>
<h2 id="_idParaDest-205"><a id="_idTextAnchor204"/>List of control families in the NIST 800-53 framework</h2>
<p>NIST 800-53 controls are categorized into 20 different security and control families. Each control <a id="_idIndexMarker811"/>family has a unique ID and multiple sub-controls. In the following table, we will focus on a wider control family only. Additionally, I’m adding two additional columns to showcase enterprise tools and Wazuh capabilities (modules) available for each NIST 800-53 control.</p>
<table class="No-Table-Style _idGenTablePara-1" id="table013">
<colgroup>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">ID</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Family Name</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Examples </strong><strong class="bold">of Controls</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Wazuh Capabilities</strong></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>AC</p>
</td>
<td class="No-Table-Style">
<p>Access Control</p>
</td>
<td class="No-Table-Style">
<p>Account management and monitoring; least privilege; separation of duties</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Wazuh log data analysis</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>AT</p>
</td>
<td class="No-Table-Style">
<p>Awareness and Training</p>
</td>
<td class="No-Table-Style">
<p>User training on security threats; technical training for privileged users</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Log data analysis</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>AU</p>
</td>
<td class="No-Table-Style">
<p>Audit and Accountability</p>
</td>
<td class="No-Table-Style">
<p>Content of audit records; analysis and reporting; record retention</p>
</td>
<td class="No-Table-Style">
<ul>
<li>None</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>CA</p>
</td>
<td class="No-Table-Style">
<p>Assessment, Authorization, and Monitoring</p>
</td>
<td class="No-Table-Style">
<p>Connections to public networks and external systems; penetration testing</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Vulnerability detector</li>
<li>File integrity monitoring</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>CM</p>
</td>
<td class="No-Table-Style">
<p>Configuration Management</p>
</td>
<td class="No-Table-Style">
<p>Authorized software policies; configuration change control</p>
</td>
<td class="No-Table-Style">
<ul>
<li>SCA</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>CP</p>
</td>
<td class="No-Table-Style">
<p>Contingency Planning</p>
</td>
<td class="No-Table-Style">
<p>Alternate processing and storage sites; business continuity strategies; testing</p>
</td>
<td class="No-Table-Style">
<ul>
<li>None</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>IA</p>
</td>
<td class="No-Table-Style">
<p>Identification and Authentication</p>
</td>
<td class="No-Table-Style">
<p>Authentication policies for users, devices, and services; credential management</p>
</td>
<td class="No-Table-Style">
<ul>
<li>SCA</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>IP</p>
</td>
<td class="No-Table-Style">
<p>Individual Participation</p>
</td>
<td class="No-Table-Style">
<p>Consent and privacy authorization</p>
</td>
<td class="No-Table-Style">
<ul>
<li>None</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>IR</p>
</td>
<td class="No-Table-Style">
<p>Incident Response</p>
</td>
<td class="No-Table-Style">
<p>Incident response training, monitoring, and reporting</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Active response</li>
<li>Threat intelligence</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>MA</p>
</td>
<td class="No-Table-Style">
<p>Maintenance</p>
</td>
<td class="No-Table-Style">
<p>System, personnel, and tool maintenance</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Log data analysis</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>MP</p>
</td>
<td class="No-Table-Style">
<p>Media Protection</p>
</td>
<td class="No-Table-Style">
<p>Access, storage, transport, sanitization, and use of media</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Log data analysis</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>PA</p>
</td>
<td class="No-Table-Style">
<p>Privacy Authorization</p>
</td>
<td class="No-Table-Style">
<p>Collection, use, and sharing of personally identifiable information (PII)</p>
</td>
<td class="No-Table-Style">
<ul>
<li>None</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>PE</p>
</td>
<td class="No-Table-Style">
<p>Physical and Environment Protection</p>
</td>
<td class="No-Table-Style">
<p>Physical access; emergency power; fire protection; temperature control</p>
</td>
<td class="No-Table-Style">
<ul>
<li>None</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>PL</p>
</td>
<td class="No-Table-Style">
<p>Planning</p>
</td>
<td class="No-Table-Style">
<p>Social media and networking restrictions; defense-in-depth security architecture</p>
</td>
<td class="No-Table-Style">
<ul>
<li>None</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>PM</p>
</td>
<td class="No-Table-Style">
<p>Program Management</p>
</td>
<td class="No-Table-Style">
<p>Risk management strategy; enterprise architecture</p>
</td>
<td class="No-Table-Style">
<ul>
<li>None</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>PS</p>
</td>
<td class="No-Table-Style">
<p>Personnel Security</p>
</td>
<td class="No-Table-Style">
<p>Personnel screening, termination, and transfer; external personnel; sanctions</p>
</td>
<td class="No-Table-Style">
<ul>
<li>None</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>RA</p>
</td>
<td class="No-Table-Style">
<p>Risk Assessment</p>
</td>
<td class="No-Table-Style">
<p>Risk assessment; vulnerability scanning; privacy impact assessment</p>
</td>
<td class="No-Table-Style">
<ul>
<li>None</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>SA</p>
</td>
<td class="No-Table-Style">
<p>System and Services Acquisition</p>
</td>
<td class="No-Table-Style">
<p>System development lifecycle; acquisition process; supply chain risk management</p>
</td>
<td class="No-Table-Style">
<ul>
<li>None</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>SC</p>
</td>
<td class="No-Table-Style">
<p>System and Communications Protection</p>
</td>
<td class="No-Table-Style">
<p>Application partitioning; boundary protection; cryptographic key management</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Threat intelligence</li>
<li>Active response</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>SI</p>
</td>
<td class="No-Table-Style">
<p>System and Information Integrity</p>
</td>
<td class="No-Table-Style">
<p>Flaw remediation; system monitoring and alerting</p>
</td>
<td class="No-Table-Style">
<ul>
<li>File integrity monitoring</li>
<li>Active response</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.13 – List of NIST 800-53 framework controls and Wazuh capabilities</p>
<h2 id="_idParaDest-206"><a id="_idTextAnchor205"/>Vulnerability detection use cases for NIST 800-53</h2>
<p>The Vulnerability Detector module of Wazuh helps to discover the vulnerabilities of different <a id="_idIndexMarker812"/>operating systems. As per the <em class="italic">List of NIST 800-53 framework controls and Wazuh capabilities</em> table, the <em class="italic">Assessment, Authorization, and Monitoring </em>control family, with control ID <em class="italic">CA</em>, uses the Vulnerability Detector module of the Wazuh platform.</p>
<h3>Use case: Detect vulnerabilities on Debian-based endpoints</h3>
<p>In this <a id="_idIndexMarker813"/>use case of vulnerability <a id="_idIndexMarker814"/>detection for the NIST 800-53 <em class="italic">Assessment, Authorization, and Monitoring</em>, control family, we will set up the Wazuh platform to discover vulnerabilities on a Kali Linux machine. Kali Linux is a Debian-based Linux operating system. We will cover the following points in this section:</p>
<ol>
<li>Requirements</li>
<li>Setting up the syscollector wodle on endpoint</li>
<li>Enabling Vulnerability Detector on the Wazuh server and restarting</li>
<li>Visualizing the alerts</li>
</ol>
<h4>Requirements</h4>
<p>In order to complete the use case to perform vulnerability detection on a Kali Linux machine, the requirements are as follows:</p>
<ul>
<li>Kali Linux machine (with the Wazuh agent installed)</li>
<li>Wazuh server</li>
</ul>
<h4>Setting up the syscollector wodle on endpoint</h4>
<p>Wazuh’s syscollector module is responsible for collecting information about the Wazuh agent such as hardware, the operating system, installed applications, packages, and so on. To customize our Debian endpoint, add the syscollector wodle in the <code>ossec.config</code> file located at <code>/var/ossec/etc</code> in the Wazuh agent:</p>
<pre class="source-code">
&lt;wodle name="syscollector"&gt;
   &lt;disabled&gt;no&lt;/disabled&gt;
   &lt;interval&gt;1h&lt;/interval&gt;
   &lt;packages&gt;yes&lt;/packages&gt;
&lt;/wodle&gt;</pre> <h4>Enabling Vulnerability Detector on the Wazuh server and restarting</h4>
<p>To enable <a id="_idIndexMarker815"/>vulnerability detection <a id="_idIndexMarker816"/>for a Debian-based platform, you need to edit the <code>ossec.conf</code> file in the Wazuh server located at <code>/var/ossec/etc</code>. You are required to set <code>&lt;enable&gt;</code> tab to <code>yes</code> under the <code>Debian OS vulnerabilities</code> section, as shown here:</p>
<pre class="source-code">
-- Debian OS vulnerabilities --&gt;
    &lt;provider name="debian"&gt;
      &lt;enabled&gt;yes&lt;/enabled&gt;
      &lt;os allow="Kali GNU/Linux-2023"&gt;buster&lt;/os&gt;
      &lt;os&gt;bullseye&lt;/os&gt;
     &lt;os&gt;bookworm&lt;/os&gt;
      &lt;update_interval&gt;1h&lt;/update_interval&gt;
    &lt;/provider&gt;</pre> <p>Note the following:</p>
<ul>
<li><code>&lt;os allow="Kali GNU/Linux-2023"&gt;buster&lt;/os&gt;</code> indicates what operating system should be allowed to be monitored for vulnerability scanning. In this case, it is Kali GNU/Linux-2023</li>
</ul>
<p>Next, restart the Wazuh manager:</p>
<pre class="console">
systemctl restart wazuh-manager</pre> <h4>Visualizing the alerts</h4>
<p>To visualize <a id="_idIndexMarker817"/>the vulnerability events, navigate <a id="_idIndexMarker818"/>to the <strong class="bold">Vulnerabilities</strong> module in the Wazuh manager and check for alerts.</p>
<div><div><img alt="Figure 7.7 – Visualizing vulnerability events of Kali Linux" src="img/B19549_7_07.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.7 – Visualizing vulnerability events of Kali Linux</p>
<h2 id="_idParaDest-207"><a id="_idTextAnchor206"/>SCA use cases for NIST 800-53</h2>
<p>The Wazuh SCA module scans monitored endpoints to <a id="_idIndexMarker819"/>see whether they fulfill secure configuration and hardening standards. Let’s cover a use case of Wazuh SCA to support NIST 800-53 controls. We can use Wazuh’s SCA module to address multiple NIST 800-53 control requirements. One such use case will be covered in this section.</p>
<h2 id="_idParaDest-208"><a id="_idTextAnchor207"/>Use case</h2>
<p>We need <a id="_idIndexMarker820"/>to change the default SSH port. The <code>sca_unix_audit.yml</code> file located at <code>C:\\Program Files (x86)\\ossec-agent\\ruleset\\sca</code>. The following topics will be covered in this use case:</p>
<ul>
<li>Requirements</li>
<li>Reviewing the SCA policy</li>
<li>Visualizing the alerts</li>
</ul>
<h3>Requirements</h3>
<p>In order <a id="_idIndexMarker821"/>to complete the use case to perform an SCA check for <em class="italic">Change the default SSH port</em>, the requirements are as follows:</p>
<ul>
<li>Kali Linux (with the Wazuh agent installed)</li>
<li>Wazuh server</li>
</ul>
<h3>Reviewing the SCA policy</h3>
<p>We are not required to make any changes to this set. Wazuh has already built tons of SCA policies based on CIS Benchmarks for multiple operating systems. The SCA policy named <code>sca_unix_audit.yml</code> will be automatically installed while downloading the Wazuh agent packages. To view the SCA policy for <em class="italic">SSH Hardening: Port Should not be 22</em>, you can open the <code>sca_unix_audit.yml</code> file located at <code>/var/ossec/ruleser/sca</code> in the Kali Linux Wazuh agent. You can find the required SCA policy under <code>rule id: 3000</code>, as shown here:</p>
<pre class="source-code">
- id: 3000
    title: "SSH Hardening: Port should not be 22"
    description: "The ssh daemon should not be listening on port 22 (the default value) for incoming connections."
    rationale: "Changing the default port you may reduce the number of successful attacks from zombie bots, an attacker or bot doing port-scanning can quickly identify your SSH port."
    remediation: "Change the Port option value in the sshd_config file."
    compliance:
      - pci_dss: [«2.2.4»]
      - nist_800_53: [«CM.1»]
    condition: all
    rules:
      - 'f:$sshd_file -&gt; !r:^# &amp;&amp; r:Port &amp;&amp; !r:\s*\t*22$'</pre> <p>Note <a id="_idIndexMarker822"/>the following:</p>
<ul>
<li><code>Condition</code> is <code>all</code></li>
<li><code>Rules: 'f:$sshd_file -&gt; !r:^# &amp;&amp; r:Port &amp;&amp; !r:\s*\t*22$</code> checks for non-command lines indicating the SSH port, excluding lines representing default port 22</li>
</ul>
<h3>Visualizing the alerts</h3>
<p>To visualize the SCA check for <em class="italic">SSH Hardening: Port should not be 22</em>, you can navigate to the SCA module on the Wazuh manager and search for <em class="italic">SSH Hardening: Port should not be 22</em>. You should see the result as shown in the following screenshot:</p>
<div><div><img alt="Figure 7.8 – Visualizing SCA check for SSH hardening" src="img/B19549_7_08.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.8 – Visualizing SCA check for SSH hardening</p>
<p>Note <a id="_idIndexMarker823"/>the following:</p>
<ul>
<li><strong class="bold">Title</strong>: <strong class="bold">SSH Hardening: Port should not be 22</strong> represents the name of the SCA check.</li>
<li><strong class="bold">Target</strong>: <strong class="bold">/etc/ssh/sshd_config</strong> is the target file location that SCA will validate for the SSH configuration.</li>
<li><strong class="bold">Result</strong>: <strong class="bold">Failed</strong> represents the status of the SCA check. In this case, it is failed.</li>
<li><strong class="bold">Remediation</strong>: <strong class="bold">Change the Port option value in the sshd_config file</strong> explains how to modify the target configuration file if the SCA check fails.</li>
<li><strong class="bold">Compliance</strong>: <strong class="bold">nist_800_53</strong> represents the list of regulatory compliance meeting this requirement.</li>
</ul>
<p>In this section, we have learned about NIST 800-53 controls and use cases of the Vulnerability Detector and SCA modules to fulfill the requirements of NIST 800-53 controls. In the next section, we will learn about HIPAA compliance in detail.</p>
<h1 id="_idParaDest-209"><a id="_idTextAnchor208"/>HIPAA</h1>
<p>The HHS <strong class="bold">Office for Civil Rights</strong> (<strong class="bold">OCR</strong>) data leak portal says that there were about 295 breaches <a id="_idIndexMarker824"/>in the healthcare sector in just the first half of 2023. In the first half of the year, healthcare data leaks were linked to more than 39 million <a id="_idIndexMarker825"/>people. The <strong class="bold">Health Insurance Portability and Accountability Act</strong> (<strong class="bold">HIPAA</strong>) is important for many reasons, but the main one is to keep healthcare data private and secure. Wazuh can help health organizations to maintain HIPPA compliance using its in-built capabilities. In this chapter, we will cover the following topics:</p>
<ul>
<li>HIPAA compliance rules</li>
<li>HIPAA security rules</li>
<li>Vulnerability Detector use cases</li>
<li>SCA use cases</li>
</ul>
<h2 id="_idParaDest-210"><a id="_idTextAnchor209"/>What is HIPAA compliance?</h2>
<p><strong class="bold">HIPAA</strong> establishes <a id="_idIndexMarker826"/>protection standards for sensitive patient health information. HIPAA violations are mainly related to unauthorized access, use, or <a id="_idIndexMarker827"/>disclosure of <strong class="bold">Protected Health </strong><strong class="bold">Information</strong> (<strong class="bold">PHI</strong>).</p>
<p>Any personally identifiable health information that is communicated or maintained electronically, on paper, or orally is considered PHI. Any information pertaining to a person’s past, present, or future health, as well as specifics about medical treatments and payment <a id="_idIndexMarker828"/>information that could be used to identify the individual is included in <strong class="bold">Health Information</strong> (<strong class="bold">HI</strong>). PHI examples are as follows:</p>
<ul>
<li>Social Security number</li>
<li>Name</li>
<li>Dates of birth, death or treatment, and other dates relating to patient care</li>
<li>Photographs</li>
<li>Contact information</li>
<li>Medical record numbers</li>
</ul>
<h2 id="_idParaDest-211"><a id="_idTextAnchor210"/>HIPAA security rules</h2>
<p>The HIPAA <a id="_idIndexMarker829"/>Security Rule checklist includes criteria for ensuring the confidentiality, integrity, and availability of PHI created, received, maintained, or transmitted electronically (ePHI). The HIPAA security rules consist of five sections:</p>
<ul>
<li><strong class="bold">General rules</strong>: These lay the groundwork for HIPAA compliance, highlighting the importance of privacy and security policies, processes, and worker training</li>
<li><strong class="bold">Administrative safeguards</strong>: These concentrate on organizational safeguards for ePHI, such as risk assessments, security management, and employee training</li>
<li><strong class="bold">Physical safeguards</strong>: These cover workstation security, facility security measures, and access controls as they relate to the physical security of data centers and equipment</li>
<li><strong class="bold">Technical safeguards</strong>: These encompass technical security protocols, including audit controls, encryption, and access controls, which are implemented to safeguard electronic health</li>
<li><strong class="bold">Organizational requirements</strong>: These focus on the necessity of contracts, agreements, and oversight of business partners’ HIPAA compliance and are related to requirements while working with them</li>
</ul>
<p>As per the scope of this book, we will focus on two categories of HIPAA security rules: administrative safeguards and technical safeguards.</p>
<h3>Administrative safeguards</h3>
<p>The administrative <a id="_idIndexMarker830"/>safeguards, which mandate the designation of a security officer in charge of workforce training, risk analysis, risk and vulnerability implementation, IT continuity supervision, and business associate agreements, form the foundation of security rule compliance.</p>
<table class="No-Table-Style _idGenTablePara-1" id="table014">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">Standards</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Description</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Wazuh Capabilities</strong></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Security Management Process</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Risk analysis to detect vulnerabilities regularly</li>
<li>Implementing risk minimization</li>
</ul>
</td>
<td class="No-Table-Style">
<ul>
<li>Vulnerability detection</li>
<li>Configuration assessment</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Assign Security Responsibility</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Designation of a HIPAA security officer</li>
<li>They can also serve as privacy officer</li>
</ul>
</td>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Workforce Security</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Implement access control for employees</li>
<li>Ensure monitoring for role change and termination access</li>
</ul>
</td>
<td class="No-Table-Style">
<ul>
<li>Log data analysis</li>
<li>File integrity monitoring</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Information Access Management</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Restrict ePHI access to “covered” organizations’ workforces</li>
<li>Block parent and connected entities from accessing ePHI</li>
</ul>
</td>
<td class="No-Table-Style">
<ul>
<li>File integrity monitoring</li>
<li>Configuration assessment</li>
<li>Malware detection</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Security Awareness and Training</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Conduct employee security awareness training</li>
<li>Include security reminders and password guidance</li>
</ul>
</td>
<td class="No-Table-Style">
<ul>
<li>Log data analysis</li>
<li>Action response</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Security Incident Procedures</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Implement policies and procedures for incident reporting</li>
<li>Not limited to cybersecurity incidents</li>
</ul>
</td>
<td class="No-Table-Style">
<ul>
<li>Log data analysis</li>
<li>Active response</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Contingency Plan</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Emergency response policies, including data backup and recovery</li>
<li>Routine drill exercise</li>
</ul>
</td>
<td class="No-Table-Style">
<p>None</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Periodic Evaluations</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Periodic review of policies, procedures, and measures</li>
</ul>
</td>
<td class="No-Table-Style">
<ul>
<li>Configuration assessment</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.14 – Security controls and Wazuh modules for administrative safeguards of HIPAA compliance</p>
<h3>Technical safeguards</h3>
<p>The HIPAA <a id="_idIndexMarker831"/>technical safeguards ensure that people accessing ePHI are who they say they are, do what they should, and correct issues caused by accidental or malicious actions as soon as possible.</p>
<table class="No-Table-Style _idGenTablePara-1" id="table015">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">Standards</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Description</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Wazuh Capabilities</strong></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Access Control</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Restrict ePHI access</li>
<li>Ensure authorized users have access rights</li>
</ul>
</td>
<td class="No-Table-Style">
<ul>
<li>Log data analysis</li>
<li>Configuration assessment</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Audit Controls</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Implement system activity recording and analysis</li>
<li>Store ePHI access and modification audit logs</li>
</ul>
</td>
<td class="No-Table-Style">
<ul>
<li>Log data analysis</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Integrity Controls</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Prevent ePHI modification</li>
<li>Implement data integrity checks</li>
</ul>
</td>
<td class="No-Table-Style">
<ul>
<li>File integrity monitoring</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Transmission Security</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Transmit ePHI encrypted</li>
<li>Protect electronic communication</li>
</ul>
</td>
<td class="No-Table-Style">
<ul>
<li>File integrity monitoring</li>
<li>Configuration assessment</li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Person or Entity Authentication</p>
</td>
<td class="No-Table-Style">
<ul>
<li>Verify ePHI users’ identities</li>
<li>Secure system access with rigorous authentication</li>
</ul>
</td>
<td class="No-Table-Style">
<ul>
<li>Log data analysis</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.15 – Security controls and Wazuh modules for technical safeguards of HIPAA compliance</p>
<h2 id="_idParaDest-212"><a id="_idTextAnchor211"/>Vulnerability Detector use cases</h2>
<p>Vulnerability <a id="_idIndexMarker832"/>detection plays a critical role in the security management process standard under administrative safeguards. It is about risk analysis and thorough assessment of the potential risks and vulnerabilities. Wazuh’s Vulnerability Detector module can be used to address multiple HIPAA requirements under administrative and technical safeguards.</p>
<h3>Use case: Detect vulnerabilities on Ubuntu endpoints</h3>
<p>In this use <a id="_idIndexMarker833"/>case of vulnerability detection for HIPAA compliance, we are addressing the <em class="italic">Security Management Process</em> standard under administrative safeguards. We will set up the Wazuh platform to discover vulnerabilities on an Ubuntu machine. We will cover the following points in this section:</p>
<ul>
<li>Requirements</li>
<li>Setting up the syscollector wodle on endpoint</li>
<li>Enabling Vulnerability Detector on the Wazuh server and restarting</li>
<li>Visualizing the alerts</li>
</ul>
<h4>Requirements</h4>
<p>In order to complete the use case to perform vulnerability detection on an Ubuntu machine, the requirements are as follows:</p>
<ul>
<li>Ubuntu machine (with the Wazuh agent installed)</li>
<li>Wazuh server</li>
</ul>
<h4>Setting up the syscollector wodle on endpoint</h4>
<p>To customize our Ubuntu endpoint, add the <code>syscollector</code> wodle in the <code>ossec.config</code> file located at <code>/var/ossec/etc</code> in the Wazuh agent, as shown here:</p>
<pre class="source-code">
&lt;wodle name="syscollector"&gt;
   &lt;disabled&gt;no&lt;/disabled&gt;
   &lt;interval&gt;1h&lt;/interval&gt;
   &lt;packages&gt;yes&lt;/packages&gt;
&lt;/wodle&gt;</pre> <h4>Enabling Vulnerability Detector on the Wazuh server and restarting</h4>
<p>To enable vulnerability detection for the Ubuntu operating system, you need to edit the <code>ossec.conf</code> file on the Wazuh server located at <code>/var/ossec/etc</code>. You are required <a id="_idIndexMarker834"/>to set the <code>&lt;enable&gt;</code> tab to <code>yes</code> under the <em class="italic">Ubuntu OS vulnerabilities</em> section, as shown:</p>
<pre class="source-code">
&lt;vulnerability-detector&gt;
    &lt;enabled&gt;yes&lt;/enabled&gt;
    &lt;interval&gt;5m&lt;/interval&gt;
    &lt;run_on_start&gt;yes&lt;/run_on_start&gt;
    &lt;provider name="canonical"&gt;
       &lt;enabled&gt;yes&lt;/enabled&gt;
       &lt;os&gt;bionic&lt;/os&gt;
       &lt;update_interval&gt;1h&lt;/update_interval&gt;
    &lt;/provider&gt;
 &lt;/vulnerability-detector&gt;</pre> <p>Next, restart the Wazuh manager:</p>
<pre class="console">
systemctl restart wazuh-manager</pre> <h4>Visualizing the alerts</h4>
<p>To visualize the vulnerability events, navigate to the <strong class="bold">Vulnerabilities</strong> module in the Wazuh manager and check the alerts, as shown here:</p>
<div><div><img alt="Figure 7.9 – Visualizing the CVE-2021-41617 Ubuntu vulnerability on the Wazuh manager" src="img/B19549_7_09.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.9 – Visualizing the CVE-2021-41617 Ubuntu vulnerability on the Wazuh manager</p>
<h2 id="_idParaDest-213"><a id="_idTextAnchor212"/>SCA use case</h2>
<p>In this use case, we will go through SCA scripts on Ubuntu machines. As we have already learned, the <a id="_idIndexMarker835"/>SCA feature conducts scans on the monitored endpoints to ascertain whether they are properly configured and hardened. These scans evaluate the endpoint’s setup by comparing the endpoint’s actual configuration to the settings in a policy file.</p>
<h3>Use case: Ensure audit tools are 755 or more restrictive</h3>
<p>The <em class="italic">HIPAA 164.308(a)(3)(i)</em> and <em class="italic">164.308(a)(3)(ii)(A)</em> sections talk about administrative safeguards. All members of a workforce should have appropriate access to electronic PHI to prevent unauthorized access. It is primarily concerned with controlling and managing access to PHI by employees. Let’s run SCA checks on an Ubuntu 22.04 machine. In this use case, we will check whether auditd and audit logs are protected with sufficient permissions:</p>
<ul>
<li>Requirements</li>
<li>Reviewing the SCA policy</li>
<li>Visualizing the alerts</li>
</ul>
<h4>Requirements</h4>
<p>In order to complete the use case to perform an SCA check to <em class="italic">Ensure Audit tools are 755 or more restrictive</em>, the requirements are as follows:</p>
<ul>
<li>Ubuntu machine (with the Wazuh agent installed)</li>
<li>Wazuh server</li>
</ul>
<h4>Reviewing the SCA policy</h4>
<p>The SCA policy file called <code>cis_ubuntu22-04.yml</code> gets installed while installing the Wazuh <a id="_idIndexMarker836"/>agent package on an Ubuntu machine. This file consists of all the SCA policies related to Ubuntu version 22.04. To view the SCA policy for <code>Ensure audit tools are 755 or more restrictive</code>, you can open the <code>cis_ubuntu22-04.yml</code> file located at <code>/var/ossec/ruleser/sca</code> in the Ubuntu Wazuh agent. You can find the required SCA policy under <code>rule id: 28610</code>, as shown here:</p>
<pre class="source-code">
  - id: 28610
    title: "Ensure audit tools are 755 or more restrictive."
    description: "Audit tools include, but are not limited to, vendor-provided and open source audit tools n&gt;    rationale: "Protecting audit information includes identifying and protecting the tools used to view and &gt;    remediation: "Run the following command to remove more permissive mode from the audit tools: # chmod go-&gt;    compliance:
      - cis: [«4.1.4.8»]
      - cis_csc_v7: [«14.6»]
      - cis_csc_v8: [«3.3»]
      - mitre_techniques: [«T1070», «T1070.002», «T1083»]
      - mitre_tactics: [«TA0007»]
      - cmmc_v2.0: [«AC.L1-3.1.1», «AC.L1-3.1.2», «AC.L2-3.1.5», «AC.L2-3.1.3», «MP.L2-3.8.2»]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: none
    rules:
      - 'c:stat -c "%n %a" /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/aug&gt;</pre> <p>Note <a id="_idIndexMarker837"/>the following:</p>
<ul>
<li><code>condition</code> is set to <code>none</code></li>
<li>The <code>'c:stat -c "%n %a" /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/aug&gt;</code> rule checks for the permissions of auditd and related permissions</li>
</ul>
<h4>Visualizing the alerts</h4>
<p>To visualize the SCA check for <code>Ensure audit tools are 755 or more restrictive</code>, you can navigate to the SCA module on the Wazuh manager and search for <code>Ensure audit tools are 755 or more restrictive</code>. You should see the result shown in the following screenshot:</p>
<div><div><img alt="Figure 7.10 – SCA check – Ensure audit tools are 755 or more restrictive" src="img/B19549_7_10.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.10 – SCA check – Ensure audit tools are 755 or more restrictive</p>
<p>Note <a id="_idIndexMarker838"/>the following:</p>
<ul>
<li><strong class="bold">Title</strong>: <strong class="bold">Ensure audit tools are 755 or more restrictive</strong> represents the name of the SCA check.</li>
<li><strong class="bold">Target</strong>: <strong class="bold">/etc/ssh/sshd_config</strong> is the target file location that SCA will validate for the SSH configuration.</li>
<li><code>/</code><code>sbin</code> directory.</li>
<li><strong class="bold">hipaa: 164.308(a) (3)(1), 164.308(a)(3 (MA).164.312(a)(1</strong>): HIPAA requirements under <em class="italic">164.308(a)(3)(i)</em> emphasize conducting risk analysis, while <em class="italic">164.312(a)(1)</em> focuses <a id="_idIndexMarker839"/>on implementing access controls to safeguard <strong class="bold">electronic protected health </strong><strong class="bold">information</strong> (<strong class="bold">ePHI</strong>).</li>
<li><strong class="bold">Result</strong>: <strong class="bold">Passed</strong> represents the status of the SCA check. </li>
</ul>
<p>With this, we have come to the end of the chapter.</p>
<h1 id="_idParaDest-214"><a id="_idTextAnchor213"/>Summary</h1>
<p>This chapter has shed light on the critical role of the Vulnerability Detector and SCA modules of the Wazuh platform. We have learned how to configure vulnerability detection with different customizations of packages, operating systems, applications, and so on. We also went through the workings of the Wazuh SCA module and how to create a custom SCA script from scratch. We learned how to fulfill requirements of the regulatory compliance framework such as PCI DSS, NIST 800-53 Controls, and HIPAA using the Vulnerability Detector and SCA modules.</p>
<p>In the next chapter, we will cover some important rules and custom Wazuh rules for different security use cases.</p>
</div>
</body></html>