<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Windows File System Analysis</h1>
                </header>
            
            <article>
                
<p class="mce-root CDPAlignLeft CDPAlign">In this chapter, we will cover the following recipes:</p>
<ul>
<li>NTFS analysis with The Sleuth Kit</li>
<li><span>Undeleting files from NTFS with Autopsy</span></li>
<li><span><span>Undeleting files from ReFS with ReclaiMe File Recovery</span></span></li>
<li><span>File carving with PhotoRec</span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>As mentioned in the introductory section, Windows machines run on NTFS (<strong>New Technology File System</strong>).</p>
<p>Using the tools that we will discuss in this chapter, you will be able to uncover information not only about the files, but also about the layout of the disk itself, including deleted files and unallocated space. This can be of the utmost importance in a forensic investigation, particularly in cases where a user may have tried to cover up their actions using anti-forensic methods.</p>
<p>Some tools allow you to undelete files as well, thus restoring them, in whole or in part, to how they looked before they were deleted. This does, of course, depend on the extent to which a file has been overwritten, however it can be a useful way to find out about things a suspect doesn't want you to see.</p>
<p>In cases where the metadata about the files has been deleted, file carving is employed as a method of trying to recover the data within the files. This requires several steps, most of which will be performed by your investigative tool set of choice. Generally, it will begin by working out what type of file the item was (usually by looking at the headers), and then building up fragments of the file to form a more accurate picture of what used to be stored on the machine.</p>
<p>There are several solutions which deal with file system analysis, file carving, and the undeleting of files. In this chapter, we will be looking specifically at Autopsy, The Sleuth Kit, ReclaiMe, and PhotoRec.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">NTFS Analysis with The Sleuth Kit</h1>
                </header>
            
            <article>
                
<p>The Sleuth Kit is a collection of command-line tools (and also a library) for the forensic analysis of drive images. These tools can help you with analysis of both volume and file system data (in a non-intrusive fashion, of course). It's cross-platform, so you can use any operating system you like to work with this toolkit. It supports both RAW and E01 images, so you can use any image that you acquired while following the previous recipes. This collection of tools will be very useful in your future digital forensic examinations: it supports a wide range of file systems, including <span>NTFS, FAT, ExFAT, EXT2, EXT3, EXT4, HFS, and so on.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You can download Windows binaries from The Sleuth Kit's official website. Go to <span class="packt_screen">The Sleuth Kit</span> section and click on the <span class="packt_screen">Download</span> hyperlink. Now, click on <span class="packt_screen">Windows Binaries</span> and the downloading will start. At the time of writing, the most recent version of The Sleuth Kit is 4.4.0, so the archive we downloaded has the name: <span class="packt_screen">sleuthkit-4.4.0.tar.gz</span>. So, now all you need to do is to unpack it and you are ready to go.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Open Windows Command Prompt and change the directory to <strong>bin</strong> (you can find it in the folder where you unpacked the archive you downloaded). Let's start from the Media Management Layer Tools:</p>
<ol>
<li>The first thing you should do is to figure out which system volume type you have. Of course, there is a tool for this in The Sleuth Kit. It's called <kbd>mmstat</kbd>. Let's use it <span>on one of the images we acquired in the previous recipes</span>:</li>
</ol>
<pre style="padding-left: 60px">
mmstat X:146-2017.E01
</pre>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/4e34db5a-4573-4c53-9cb3-689e751425d4.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><em>Figure 4.1. mmstat output</em></div>
<ol start="2">
<li>We now know the system volume type and are ready to use the next tool <kbd>mmls</kbd>. This tool can help an examiner to determine the layout of a disk, including the unallocated space. Let's use it:</li>
</ol>
<pre style="padding-left: 60px">
mmls -t dos X:146-2017.E01
</pre>
<p style="padding-left: 60px" class="CDPAlignLeft CDPAlign">The output of the preceding command is as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/3fe31d50-907d-44a2-8e1e-177f126bcf82.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 4.2. mmls output</div>
<p style="padding-left: 60px" class="CDPAlignLeft CDPAlign">As you can see, we have gathered a lot of valuable information about our disk (as you remember, we imaged a drive in the previous recipes). Now you know the starting sectors, ending sectors, and lengths of all partitions and unallocated spaces.</p>
<ol start="3">
<li>Let's change to File System Layer Tools. To learn more about each of the partitions, we have the <kbd>fsstat</kbd> tool. To use it, we need the partition offset. You can get it from the <kbd>mmls</kbd> output. Let's learn more about the largest partition we have, which starts at sector 1435658:</li>
</ol>
<pre style="padding-left: 60px">
fsstat -o 1435648 X:146-2017.E01
</pre>
<p style="padding-left: 60px" class="CDPAlignLeft CDPAlign">The output of the preceding command is as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img height="467" width="436" class="image-border" src="assets/d7fe328f-e31e-465b-8235-603f975760d3.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><em><em>Figure 4.3. fsstat output</em></em></div>
<p style="padding-left: 60px" class="CDPAlignLeft CDPAlign">As you can see in the preceding figure, <kbd>fsstat</kbd> collects lots of useful information about a partition: <span class="packt_screen">Volume Serial Number</span>, <span class="packt_screen">Cluster Size</span>, <span class="packt_screen">First Cluster of MFT</span>, <span class="packt_screen">First Cluster of MFT mirror,</span> and so on.</p>
<div class="packt_infobox">The MFT, or Master File Table, contains information about all files, directories, and metafiles in NTFS, including their names, creation timestamps, sizes, and access permissions.</div>
<ol start="4">
<li>Let's now look at FileName Layer Tools. For example, the <kbd>fls</kbd> tool allows examiners to list allocated and deleted file names in a directory. Again, we need the partition offset to use this tool:</li>
</ol>
<pre style="padding-left: 60px">
fls -o 1435648 X:146-2017.E01
</pre>
<p style="padding-left: 60px" class="CDPAlignLeft CDPAlign">The output for the preceding command is as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img height="369" width="408" class="image-border" src="assets/7f676dfc-6b34-4a26-900a-19672cbb8e10.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><em><em>Figure 4.4. A part of fls output</em></em></div>
<ol start="5">
<li>Let's go further and create a <kbd>bodyfile</kbd> with <kbd>fls</kbd>. It's truly an amazing feature that helps Windows forensic examiners to create timelines of file activity. Here is how we create it:</li>
</ol>
<pre style="padding-left: 60px">
fls -r -m "/" -o 1435648 X:146-2017.E01 &gt; bodyfile.txt
</pre>
<p style="padding-left: 60px" class="CDPAlignLeft CDPAlign"><span>The output for the preceding command is as follows:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="380" width="831" class="image-border" src="assets/95dfa63d-f040-446d-a53e-0a131e9f868e.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><em>Figure 4.5. A part of bodyfile created with fls</em></div>
<p style="padding-left: 60px" class="CDPAlignLeft CDPAlign">As you can see, we added two switches in the command: <kbd>-r</kbd> and <kbd>-m</kbd>. The first one tells <kbd>fls</kbd> to recurse the directory entries. The second tells it to use <span><kbd>mactime</kbd> input format with <em>/</em> as the mount point.</span></p>
<ol start="6">
<li>We now have the body file, so we are ready to run <kbd>mactime</kbd> and create a timeline of file activity. Such timelines are very useful in Windows forensic examinations, especially in cases involving malware incidents. Here is how to create it:</li>
</ol>
<pre style="padding-left: 60px">
mactime.pl -b bodyfile.txt -d &gt; timeline.csv
</pre>
<div class="CDPAlignCenter CDPAlign"><img height="343" width="811" class="image-border" src="assets/afcd1357-e82d-4c62-8aee-f2823c89ace6.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><em>Figure 4.6. The timeline file opened in Microsoft Excel</em></div>
<p style="padding-left: 30px" class="CDPAlignLeft CDPAlign">Again, in the last command we have two switches which need to be explained. The first one, <kbd>-b</kbd>, points to the bodyfile for <kbd>mactime</kbd> to use. The second, <kbd>-d</kbd>, stands for delimited output and means we can save it as a CSV file and use <span>Microsoft Excel or OpenOffice Spreadsheets to work with it later (see the figure above). Also, if you want to specify the time zone, you can use the <kbd>-z</kbd> switch.</span></p>
<div class="CDPAlignLeft CDPAlign"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Below is a list of the main commands used and their functions:</p>
<ul>
<li><span><kbd>mmstat</kbd>:</span>extracts information about the system volume type</li>
<li><kbd>mmls</kbd>: extracts information about disk layout, including unallocated spaces</li>
<li><kbd>fsstat</kbd>: extracts information about a file system, including <span>volume serial number, cluster size, and so on</span></li>
<li><kbd>fls</kbd>: extracts information about both allocated and deleted file names in a directory</li>
<li><kbd>mactime</kbd>: creates <span>a timeline of file activity based on a body file created with <kbd>fls</kbd></span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<p class="CDPAlignLeft CDPAlign">The Sleuth Kit download page: <a href="https://www.sleuthkit.org/sleuthkit/download.php">https://www.sleuthkit.org/sleuthkit/download.php</a></p>
<p class="CDPAlignLeft CDPAlign">The Sleuth Kit wiki: <a href="http://wiki.sleuthkit.org/index.php?title=Main_Page">http://wiki.sleuthkit.org/index.php?title=Main_Page</a></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Undeleting files from NTFS with Autopsy</h1>
                </header>
            
            <article>
                
<p class="CDPAlignLeft CDPAlign">Originally,<strong>Autopsy</strong> was just a graphical interface for The Sleuth Kit. You have already learnt about the collection of command-line tools for file system forensic analysis in the previous recipe. Since the third version however, it has been totally rewritten and is now available as a standalone digital forensics platform. It is very widely used and forms part of the digital forensic toolkit of both law enforcement and corporate examiners. Why? It's easy to use, fast, and free. Also, if you enjoy programming, you can write your own modules for Autopsy - all the documentation you will need is freely available online, on The Sleuth Kit's website. Basis Technology even holds Autopsy module writing contests, so feel free to participate.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready...</h1>
                </header>
            
            <article>
                
<p>Go to The Sleuth Kit's website again, but now choose <span class="packt_screen"><span class="packt_screen">Autopsy</span>,</span> and after that, <span class="packt_screen">Download</span>. The most recent version at the time of writing is 4.3.0. Both 32- and 64-bit versions are available; you should choose the right one according to your system (we have already shown you how to collect this piece of information in one of the previous recipes). You will be redirected to SourceForge, and the downloading process will start automatically. In our case, the file we downloaded is named <strong>autopsy-4.3.0-64bit.msi.</strong> All you need now is to double-click it and follow the installation instructions, which are quite straightforward. Once the installation process is complete, you are ready to go.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>After starting your freshly installed digital forensics tool, the first window you see is <span class="packt_screen">Welcome</span>. Here we have three main options:</p>
<ul>
<li><span class="packt_screen">Create New Case</span> - this option will create a new case for you</li>
<li><span class="packt_screen">Open Recent Case</span> - this option will open the last case you worked on</li>
<li><span class="packt_screen">Open Existing Case</span> - this option allows you to choose one of the cases present on your workstation</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img height="224" width="319" class="image-border" src="assets/35ca9cea-7cc2-4d80-aec1-463cfd28a4a8.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 4.7. Autopsy Welcome window</div>
<p class="CDPAlignLeft CDPAlign">As we just installed Autopsy, we don't have any cases, so our choice is the <span class="packt_screen">Create New Case</span> option. Now you will see a <span class="packt_screen">New Case Information</span> window.</p>
<ol>
<li>In the first step, <span class="packt_screen">Case Info</span>, we have two fields to fill in; the third will be completed automatically. You should type your case number or name in the first field, <span class="packt_screen">Case Name</span>, and choose the directory for your case files in the second, <span class="packt_screen">Base Directory</span> (use the <span class="packt_screen">Browse</span> button). The third field will show the path to your case files (base directory + case name).</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/386c3276-523c-483b-8c99-c63e06ec419c.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 4.8. Autopsy New Case Information (Case Info) window</div>
<ol start="2">
<li>The second step, <span class="packt_screen">Additional Information</span>, is optional: you can leave both fields blank. However, it is usually better to fill them in. The first field should contain your case number, the second your name.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/ccc30c2b-19ea-4dea-bb9e-0f9968d0ebf4.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 4.9. Autopsy New Case Information (Additional Information) window</div>
<ol start="3">
<li>Click <span class="packt_screen">Finish</span> and the case will be created.</li>
<li>It's time to select the data source, here is the <strong><span class="packt_screen">Add Data Source</span></strong> window. The first thing you should do is select the data source type. Three options are available:</li>
</ol>
<ul>
<li style="list-style-type: none">
<ul>
<li><span class="packt_screen">Image or VM File</span> - this option allows you to choose a forensic image in one of the supported formats, or a virtual machine disk, for example, that was found during the examination of an image</li>
<li><span class="packt_screen">Local Disk</span> - this option allows you to choose a physical drive connected to your workstation, or a mounted logical drive (for example, D:)</li>
</ul>
</li>
</ul>
<ul>
<li style="list-style-type: none">
<ul>
<li><span class="packt_screen">Logical Files</span> - this option allows you to choose files and folders for analysis, for example, from a mounted forensic image</li>
</ul>
</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/68d9a3a6-8daa-48e9-957c-128ea4b409ab.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 4.10. Autopsy Select Data Source window</div>
<ol start="5">
<li>Don't forget to choose the right time zone.</li>
<li>In the next step, you should choose ingest modules to run. Autopsy ingest modules <span>analyze the files on the data source and parse their contents. As the main aim of this recipe is to show you how to undelete files from NTFS, we have chosen just a few modules, including:</span></li>
</ol>
<ul>
<li style="list-style-type: none">
<ul>
<li><span class="packt_screen">File type identification</span> - identifies files based not on their extensions, but their internal signatures</li>
<li><span class="packt_screen">Extension mismatch detector</span> - uses File Type Identification Module results to flag the files with an extension that is not usually associated with the detected file type</li>
<li><span class="packt_screen">Embedded file extractor</span> - extracts data from different archive formats, including DOCX, XLSX, PPTX, and others</li>
</ul>
</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/92bfdb33-897d-4ff5-88a0-cfea658d1752.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 4.11. Autopsy Select Data Source (Configure Ingest Modules) window</div>
<ol start="7">
<li>Click <span class="packt_screen">Next</span> and data source processing will start.</li>
<li>After some time, depending on the size of the data source, the <span class="packt_screen">Finish</span> button will become active: click it and you are ready to analyze the file system(s).</li>
</ol>
<p class="CDPAlignLeft CDPAlign">The point of this recipe is to teach you how to undelete files from NTFS. The thing is, when a file is deleted, it's not erased; it is simply marked as deleted in the MFT entry for the file. So, until the file is overwritten, it can be recovered, and Autopsy can help digital forensic examiners with this. It even sorts out all the deleted files for you: just go to <span class="packt_screen">Views - Deleted Files</span> on the left pane (the Tree Viewer).</p>
<div class="CDPAlignCenter CDPAlign"><img height="268" width="236" class="image-border" src="assets/73cde85e-21e6-46fb-a77a-90a0c1bb71ce.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 4.12. Deleted Files option in the Tree Viewer</div>
<p class="CDPAlignLeft CDPAlign">You can use this option to recover files, or browse the file system(s) via the <span class="packt_screen">Data Sources</span> option. Deleted files have red cross icons on the left. To recover a file or files:</p>
<ol>
<li>
<p>Right-click on the file or files (mark all the files you want to recover beforehand)</p>
</li>
<li>
<p>Choose <strong>Extract File(s)</strong></p>
</li>
<li>
<p>Choose the destination folder</p>
</li>
<li>
<p>Click <span class="packt_screen">Save</span></p>
</li>
</ol>
<p class="CDPAlignLeft CDPAlign">Yes, it is that easy!</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p class="CDPAlignLeft CDPAlign">Autopsy detects files marked as deleted in the MFT and sorts them all out, so a digital forensic examiner can locate such files and recover them.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<p class="CDPAlignLeft CDPAlign">Autopsy download page: <a href="http://sleuthkit.org/autopsy/download.php">http://sleuthkit.org/autopsy/download.php</a></p>
<p class="CDPAlignLeft CDPAlign">Autopsy User's Guide: <a href="http://sleuthkit.org/autopsy/docs/user-docs/3.1/index.html">http://sleuthkit.org/autopsy/docs/user-docs/3.1/index.html</a></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Undeleting files from ReFS with ReclaiMe File Recovery</h1>
                </header>
            
            <article>
                
<p class="CDPAlignLeft CDPAlign"><span>ReclaiMe File Recovery is a piece of data recovery software capable of undeleting files from a wide range of devices including hard drives, memory cards, RAID arrays, and multi-disk NAS devices. Also, it supports data recovery from most file systems, including the latest Windows file systems - <strong>ReFS</strong> or the <strong>Resilient File System</strong>.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Go to ReClaiMe's website and click on the green <span class="packt_screen">DOWNLOAD</span> button on the left. It brings you to the ReclaiMe File Recovery download page and the downloading process starts automatically. After this, just run the setup file and follow the installation instructions. You are ready to go!</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Before you start, it's a good idea to find the right data source. ReFS is an active development, and is used usually on Windows servers only. Thankfully, Willi Ballenthin has created a bunch of ReFS images for testing purposes, which are now publically available. Let's use one of them.</p>
<ol>
<li>Start ReclaiMe File Recovery. It takes some time for the tool to scan all available drives. After this, you will be taken to the main window, like the one in the following figure:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="401" width="667" class="image-border" src="assets/9f8f0d0b-8f2a-4391-9658-0bdb4bae009a.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 4.13. ReclaiMe File Recovery main window</div>
<p style="padding-left: 60px" class="CDPAlignLeft CDPAlign"><span>ReclaiMe File Recovery doesn't support E01 images, but this is not a problem because</span> <span>we have an image in RAW format.</span></p>
<ol start="2">
<li>
<p>Let's go to <span class="packt_screen">Disks</span> - <span class="packt_screen">Open disk image...</span> Choose the disk image and click Open. Now there should also be an image in the main window, like the one in the following figure:</p>
</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="463" width="676" class="image-border" src="assets/c72c3dde-031b-42ef-ba6e-f6e5735a9d4a.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Figure 4.14. ReclaiMe File Recovery main window (Disk image is added)</div>
<ol start="3">
<li>Double-click the image to start the recovery process. Of course, it will take some time, depending on the size of the image. In our case, the image is small enough, so it doesn't take a lot of time. The recovery is shown in the following figure:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="498" width="670" class="image-border" src="assets/f8c7b542-1002-469a-b03a-490cdf0fe56e.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 4.15. ReclaiMe File Recovery image processing results</div>
<ol start="4">
<li>Now you can save recovered files or even folders using the blue <span class="packt_screen">Save</span> button.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p class="mce-root">ReclaiMe File Recovery processes the image and lists the files and folders available, giving a computer forensic examiner the ability to extract deleted files.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<p><span>The ReclaiMe File Recovery website:</span> <a href="http://www.reclaime.com/">http://www.reclaime.com/</a></p>
<p class="title">The ReFS sample images: <a href="http://www.williballenthin.com/forensics/refs/test_images/">http://www.williballenthin.com/forensics/refs/test_images/</a></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">File carving with PhotoRec</h1>
                </header>
            
            <article>
                
<p>PhotoRec is a file carving tool that is widely used by digital forensic examiners. This tool is even built into the previously mentioned digital forensic platform, Autopsy, as a module. <span>PhotoRec can recover a diverse range of file types (more than 480 file formats), but if you think this will not be enough, you can add your own custom signatures, which will help the tool to recover even more data.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Go to CGSecurity's website and click the <span class="packt_screen">download</span> hyperlink on the left. You will be redirected to the Download page. Now click on the big green button on the right, and the downloading process will be initiated. At the time of writing, the most recent version of PhotoRec is 7.0, so the archive we downloaded is called <strong>testdisk-7.0.win.zip</strong>. Unpack it and you are ready to go.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Before we start, it's important to note that PhotoRec supports disk images: not only RAW, but also E01. As we are carving data for forensic purposes, let's use an E01 image that we acquired in one of the previous recipes.</p>
<ol>
<li>Start the Windows Command Prompt <span>from an account in the Administrator group, and change the directory to <strong>testdisk-7.0</strong>. Use the following command:</span></li>
</ol>
<pre>
         photorec_win.exe X:52.E01
</pre>
<ol start="2">
<li>Make sure you typed the path to the image you acquired, as it can have a different name and location.</li>
<li>The first dialog box that you see is 'Select a media'. In our case we are dealing with an E01 image, so we have only one option, and all we need to do is press <em>Enter</em> to proceed.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/7a69c570-2beb-41a8-9bec-85bd3d7bc9ed.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 4.16. PhotoRec Select a media dialog</div>
<ol start="4">
<li>Now we have the Partition selection dialog box. In our case, we have only one partition of unknown type - a perfect example for file carving.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="348" width="523" class="image-border" src="assets/bddf62aa-b739-4d27-bf49-aa4701315a3b.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 4.17. PhotoRec Partition selection dialog</div>
<ol start="5">
<li>Also, four options are seen at the bottom:</li>
</ol>
<ul>
<li style="list-style-type: none">
<ul>
<li><span class="packt_screen">Search</span> - to start recovery</li>
<li><span class="packt_screen">Options</span> - to modify recovery options</li>
<li><span class="packt_screen">File Opt</span> - to modify file types to be recovered</li>
<li><span class="packt_screen">Quit</span> - to cancel recovery</li>
</ul>
</li>
</ul>
<ol start="6">
<li>Let's go to <span class="packt_screen">Options</span>. Here, we have the following:</li>
</ol>
<ul>
<li style="list-style-type: none">
<ul>
<li><span class="packt_screen">Paranoid</span> - if enabled, verifies recovered files, and invalid files are rejected. Another option here, <strong>bruteforce</strong>, if enabled, tries to recover fragmented JPG files.</li>
<li><span class="packt_screen">Keep corrupted files</span> - if enabled, keeps invalid files. Use it if you want to try to repair them with other tools.</li>
<li><span class="packt_screen">Expert mode</span> - if enabled, allows an examiner to force the block size and the offset.</li>
<li><span class="packt_screen">Low memory</span> - use it if your workstation doesn't have enough memory to avoid recovery crashes.</li>
</ul>
</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/f47b55f6-75e1-44a8-9d2c-2d0c3d927664.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 4.18. PhotoRec Options</div>
<ol start="7">
<li>Now let's check <span class="packt_screen">File Opt</span>. Here, we have a long list of file types supported by the tool. Use the <em>s</em> button to check all file types or to disable all. Use spacebar if you want to enable or disable some of the types. To save changes use b.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/ec38425c-b815-492f-954f-5b0a0368ec5c.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 4.19. PhotoRec File Opt option</div>
<p style="padding-left: 60px" class="CDPAlignLeft CDPAlign">Now we have looked through the available options, and are ready to start recovery.</p>
<ol start="8">
<li>Choose <span class="packt_screen">Search</span> and press <em>Enter</em>. It's time to choose the file system type. We know that there are only two options, and that there are no EXT partitions on our image, so we choose <strong>Other</strong>.
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/f9cb5e24-e47e-4c6f-ac84-628bf8338a9a.png"/></div>
</li>
</ol>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 4.20. PhotoRec Filesystem type dialog</div>
<ol start="9">
<li>Now we need to choose the destination path for the files being recovered. We recommend creating one before starting the file carving process. In our case, the destination folder is <kbd>X:52-Carved</kbd>, as you can see in the following figure:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/a8f02e8b-cf7b-4eab-8a4d-417df85e4a05.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><em>Figure 4.21. PhotoRec Select destination dialog</em></div>
<ol start="10">
<li>Use the <em>C</em> button to start the file carving process.</li>
<li>Once the process is finished, you will have one or more folders (<span><kbd>recup_dir.1</kbd>, <kbd>recup_dir.2</kbd>...</span>) with recovered files. It's important to note that these folders can be accessed before the recovery is finished.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>PhotoRec reads the data source sector by sector, and finds the first ten files. It uses them to calculate the block/cluster size after each block is checked by the tool against a signature database.</p>
<p>If the file system is not corrupted, PhotoRec can get <span>the block/cluster size from volume boot record, or superblock.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See more</h1>
                </header>
            
            <article>
                
<p>The PhotoRec download page: <a href="http://www.cgsecurity.org/wiki/TestDisk_Download">http://www.cgsecurity.org/wiki/TestDisk_Download</a></p>
<p>The PhotoRec wiki page: <a href="http://www.cgsecurity.org/wiki/PhotoRec">http://www.cgsecurity.org/wiki/PhotoRec</a></p>


            </article>

            
        </section>
    </body></html>