<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;Analyzing iOS Devices"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Analyzing iOS Devices</h1></div></div></div><p>The goal of this chapter is to guide you through the analysis of important artifacts that are present on an iDevice. In the first part, the focus will be on the artifacts generated by the system's features or by the interaction of the user with it, referring mainly to the iOS configuration files and to the iOS native applications. In the second part, we will go through the manual analysis of some of the most common third-party applications, with the goal of giving you a general approach that you will be able to apply to all the different apps you will encounter in your way. About this topic, there are also several publications available, some of which are referenced also in the <a class="link" href="apa.html" title="Appendix A. References">Appendix A</a>, <span class="emphasis"><em>References</em></span>. We will conclude with a case study to provide you also with a proprietary analysis software example. All of this focuses on the two main formats used to store data, the <span class="strong"><strong>SQLite</strong></span> databases and the property list (<code class="literal">plist</code>) files.</p><div class="section" title="How data is stored"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec49"/>How data is stored</h1></div></div></div><p>Before actually starting the analysis of the artifacts we can find inside an iDevice, let's take a look at how data is structured and in which format it is stored. Inside the Apple filesystem, most of the user data are stored under <code class="literal">/private/var/mobile/</code>, or simply <code class="literal">/User/</code> that is a symlink pointing to the previous folder. For the tests in this chapter, we used an iPhone 4s running iOS 9.0.2:</p><pre class="programlisting">
<span class="strong"><strong># tree -d -L 2 /private/var/mobile/&#13;
&#13;
|-- Applications</strong></span>
<span class="strong"><strong>|-- Containers</strong></span>
<span class="strong"><strong>|   |-- Bundle</strong></span>
<span class="strong"><strong>|   |-- Data</strong></span>
<span class="strong"><strong>|   `-- Shared</strong></span>
<span class="strong"><strong>|-- Documents</strong></span>
<span class="strong"><strong>|   `-- com.apple.springboard.settings</strong></span>
<span class="strong"><strong>|-- Library</strong></span>
<span class="strong"><strong>|   |-- Accounts</strong></span>
<span class="strong"><strong>|   |-- AddressBook</strong></span>
<span class="strong"><strong>|   |-- AggregateDictionary</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>|   |-- Keyboard</strong></span>
<span class="strong"><strong>|   |-- Logs</strong></span>
<span class="strong"><strong>|   |-- Mail</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>|   |-- Preferences</strong></span>
<span class="strong"><strong>|   |-- SMS</strong></span>
<span class="strong"><strong>|   |-- Safari</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>|   |-- SoftwareUpdate</strong></span>
<span class="strong"><strong>|   |-- Spotlight</strong></span>
<span class="strong"><strong>|   |-- SpringBoard</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>|-- Media</strong></span>
<span class="strong"><strong>|   |-- AirFair</strong></span>
<span class="strong"><strong>|   |-- Books</strong></span>
<span class="strong"><strong>|   |-- DCIM</strong></span>
<span class="strong"><strong>|   |-- Downloads</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>`-- MobileSoftwareUpdate</strong></span>
</pre><p>Prior to iOS 8, the applications and their data were all stored under <code class="literal">/private/var/mobile/Applications/</code> while now, starting from iOS 8, the filesystem layout has changed and the application data has been separated from its bundles. The current folder structure is as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/private/var/mobile/Containers/Bundle/Application/&lt;UUID&gt;/</code>: This path is the actual path where the application bundle is stored.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/private/var/mobile/Containers/Data/Application/&lt;UUID&gt;/</code>: This path is the actual path where most of the application data is stored.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/private/var/mobile/Containers/Shared/AppGroup/&lt;UUID&gt;/</code>: As the name of the folder suggests, this path is the path where applications can store data with the aim of sharing it with other apps or extensions. This folder is also very important because you will find crucial data of some very popular apps, such as WhatsApp, Chat db, and so on.</li></ul></div><p>While you may easily guess the meaning of most of the folders from the previous <code class="literal">tree</code> command line output, you may wonder what those names inside the <code class="literal">Application</code> folder are. These are the names of the apps represented by their <span class="strong"><strong>Universally Unique ID</strong></span> (<span class="strong"><strong>UUID</strong></span>). Inside each application folder, you will see, most of the time, the same structure that appears something like the following:</p><pre class="programlisting">
<span class="strong"><strong># tree -L 1 FAA3360F-18A5-4EA2-A331-53F2A49C5A8E/</strong></span>
<span class="strong"><strong>FAA3360F-18A5-4EA2-A331-53F2A49C5A8E/</strong></span>
<span class="strong"><strong>|-- Documents</strong></span>
<span class="strong"><strong>|-- Library</strong></span>
<span class="strong"><strong>|-- StoreKit</strong></span>
<span class="strong"><strong>`-- tmp</strong></span>
</pre><p>The following structure is of particular importance:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;Application_Bundle_Home&gt;/AppName.app</code>: This file is the application bundle, which will not be backed up</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;Application_Data_Home&gt;/Documents/</code>: This path contains application-specific data files</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;Application_Data_Home&gt;/Library/</code>: This path contains application-specific files</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;Application_Data_Home&gt;/Library/Preferences/</code>: This path contains application-preference files</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;Application_Data_Home&gt;/Library/Caches/</code>: This path contains application-specific support files, which will not be backed up</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;Application_Data_Home&gt;/tmp/</code>: This path contains temporary files not persistent between application launches, which will not be backed up</li></ul></div><p>Within the Bundle application folder, the <code class="literal">iTunesMetadata.plist</code> file contains, among others, information related to the product, the Apple account name, and the date of purchase, which may be useful in some cases. You will find one of these files in each application bundle folder.</p><p>Within each Data application folder, there is a hidden file named <code class="literal">.com.apple.mobile_container_manager.metadata.plist</code> , This contains the name identifier corresponding to the UUID. It may prove to be quite handy if you are working on your analysis on a shell and need to identify quickly which applications are there:</p><pre class="programlisting">
<span class="strong"><strong>iLab1:/private/var/mobile/Containers/Data/Application root# find . - type f -name ".com.apple.mobile_container_manager.metadata.plist" - exec plutil {} \; | grep "MCMMetadataIdentifier"</strong></span>
<span class="strong"><strong>    ...</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "com.facebook.Messenger";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "com.apple.Maps";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "com.apple.mobilenotes";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "org.mozilla.ios.Firefox";</strong></span>
<span class="strong"><strong>   MCMMetadataIdentifier = "com.facebook.Facebook";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "com.apple.mobilemail";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "net.whatsapp.WhatsApp";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "com.google.chrome.ios";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "com.skype.skype";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "com.getdropbox.Dropbox";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "com.apple.ServerDocuments";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "com.apple.SafariViewService";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "com.google.Gmail";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "com.toyopagroup.picaboo";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "com.apple.mobilesafari";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "ph.telegra.Telegraph";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "com.apple.iCloudDriveApp";</strong></span>
<span class="strong"><strong>    MCMMetadataIdentifier = "com.google.Drive";</strong></span>
<span class="strong"><strong>    ...</strong></span>
</pre><p>It is also useful especially, to identify which is your folder of interest, by matching the UUID with the application name you are looking for:</p><pre class="programlisting">
<span class="strong"><strong>iLab1:/private/var/mobile/Containers/Data/Application root# find . - type f -name ".com.apple.mobile_container_manager.metadata.plist" - exec grep -iF "Skype" {} \;</strong></span>
<span class="strong"><strong>Binary file ./86212B35-B575-4E69-89F1- 81F0CD8886A2/.com.apple.mobile_container_manager.metadata.plist  matches</strong></span>
</pre><p>Last but not least, regarding the format that Apple uses to store its files, you will encounter mostly two types, <code class="literal">plist</code>, which is mainly used for configuration files, and <code class="literal">SQLite databases</code>. We will look more into details about both formats in the next section.</p><div class="section" title="Timestamps"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec44"/>Timestamps</h2></div></div></div><p>A very important aspect that an analyst has to pay attention to is the timestamp convention used. This is crucial, especially if you are analyzing the artifacts manually without one of the specialized commercial tools. Instead of the classical <span class="strong"><strong>UNIX Epoch Time</strong></span>, which represents the number of seconds elapsed since January 1, 1970 00:00:00, the iOS devices adopt the <span class="strong"><strong>MAC Absolute Time</strong></span>, which represents the number of seconds elapsed since January 1, 2001 00:00:00. The difference between the two is 978, 307, 200 seconds. There are several resources available online that you could use to calculate it, or else you can do it on your Mac by adding the preceding value to the MAC Absolute Time value, as in the following example:</p><pre class="programlisting">
<span class="strong"><strong>$ date -u -r `echo '314335349 + 978307200' | bc`</strong></span>
<span class="strong"><strong>Sat Dec 18 03:22:29 UTC 2010</strong></span>
</pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note11"/>Note</h3><p>Remember to insert the <code class="literal">-u</code> switch in order to display it in UTC time or else the system will give you an output on your local time (or whatever is set as the local time on your machine).</p></div></div></div><div class="section" title="Databases"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec45"/>Databases</h2></div></div></div><p>The most common type of data storage on the iOS devices (just like on other mobile platforms in general) is the use of the SQLite databases. Both native as well as third-party applications heavily use SQLite database files to store their data, as we will see in more detail later.</p><p>There are several tools available, both free/open source and commercial, such as <span class="emphasis"><em>SQLite Database Browser</em></span>, that offer a GUI interface, as well as the SQLite command-line utility, available from the official SQLite website at <a class="ulink" href="http://www.sqlite.org/">http://www.sqlite.org/</a>. If you are using a Mac OS X machine for the analysis, it will come with the <code class="literal">sqlite3</code> utility preinstalled.</p></div><div class="section" title="The property list files"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec46"/>The property list files</h2></div></div></div><p>The property list files, or <code class="literal">plist</code>, are the other most common data formats used in the iOS devices (and in Mac OS X as well). The <code class="literal">plist</code> files are mainly used to store configuration information, preferences, and settings. Their format can be compared to the XML format and they are usually represented as binary or plain text files.</p><p>A common tool used for parsing a <code class="literal">plist</code> file under Windows is <span class="emphasis"><em>plist Editor Pro</em></span>, whereas if you are using Mac OS X you can either use XCode to view the <code class="literal">plist</code> files or the command-line utility, <code class="literal">plutil</code>.</p></div></div></div>
<div class="section" title="The iOS configuration files"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec50"/>The iOS configuration files</h1></div></div></div><p>iOS has many preference and configuration files where it stores tons of data that may turn valuable during an investigation. This section provides you with a detailed (although not exhaustive) list of some of those files that are useful to keep in mind:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Account and device information</strong></span>: Check out <code class="literal">/private/var/root/Library/Lockdown/data_ark.plist</code>. This contains various information about the device and about its account holder.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Account information</strong></span>: Have a look at <code class="literal">/private/var/mobile/Library/Accounts/Accounts3.sqlite</code>. This file contains account information.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Account information</strong></span>: Go to <code class="literal">/private/var/mobile/Library/DataAccess/AccountInformation.plist</code>. You'll find account information used to set up apps here.</li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Airplane Mode</strong></span>: Check <code class="literal">/private/var/root/Library/Preferences/com.apple.preferences.network.plist</code>. This specifies whether Airplane Mode is presently enabled on the device.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Configuration information and settings</strong></span>: Go to <code class="literal">/private/var/mobile/Library/Preferences/</code>. This contains the <code class="literal">plist</code> files with the system configuration and the settings of the Apple apps.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Lockdown certificate info</strong></span>: Navigate to <code class="literal">/private/var/root/Library/Lockdown/pair_records/</code>. This contains information about the lockdown/pairing certificates and also the computers the iOS device has been paired with.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Network information</strong></span>: Go to <code class="literal">/private/var/preferences/SystemConfiguration/com.apple.network.identification.plist</code>. This contains a cache of the IP networking information as the previous network addresses, router addresses, and name servers used. A timestamp for each network is also provided. This file is not present anymore on iOS 9, but you may still find it in case the device has been restored from an older iOS version.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Passwords</strong></span>: Go to <code class="literal">/private/var/Keychains/</code>. This contains the password saved in the iDevice.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>SIM card info</strong></span>: Now have a look at <code class="literal">/private/var/wireless/Library/Preferences/com.apple.commcenter.plist</code>. This contains the ICCID and IMSI of the SIM card last used in the device.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Springboard</strong></span>: Go to <code class="literal">/private/var/mobile/Library/Preferences/com.apple.springboard.plist</code>. This contains the order of applications in each screen.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Wi-Fi networks</strong></span>: Now see <code class="literal">/private/var/preferences/SystemConfiguration/com.apple.wifi.plist</code>. This contains the list of the known Wi-Fi networks, the timestamp of last joined, and other useful information. For more information on this and a deeper analysis, you can have a look at the article available at <a class="ulink" href="http://articles.forensicfocus.com/2013/09/03/from-iphone-to-access-point/">http://articles.forensicfocus.com/2013/09/03/from-iphone-to-access-point/</a>.</li></ul></div></div>
<div class="section" title="Native iOS apps"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec51"/>Native iOS apps</h1></div></div></div><p>iDevices come with some native applications already installed by Apple, such as Safari browser, e-mail client, calendar, and utilities linked to some basic phone functionalities, such as the Camera, Call History, or the SMS/iMessage. Most of the evidence produced by these native applications and functionalities are located, other than in the application folders themselves, in the <code class="literal">Library</code> folder:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/private/var/mobile/Library/</code>: In case of physical acquisition or inside the device</li><li class="listitem" style="list-style-type: disc"><code class="literal">Backup Service/mobile/Library/</code>: In case of filesystem acquisition</li><li class="listitem" style="list-style-type: disc"><code class="literal">Library</code>: In case of logical acquisition</li></ul></div><p>Here, we can find data related to communication, preferences, Internet history and cache, keyboard keystrokes, and much more. Other than the <code class="literal">Library</code> folder, the other very important location is the <code class="literal">Media</code> folder, <code class="literal">/private/var/mobile/Media/</code>, where user-created pictures and audio files are usually stored among other things.</p><div class="section" title="Address book"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec47"/>Address book</h2></div></div></div><p>As one could imagine, the <code class="literal">AddressBook</code> folder under <code class="literal">Library</code> refers to the information present in the Contact application related to the personal contacts and is stored in SQLite database format. There are two databases of interest, <code class="literal">AddressBook.sqlitedb</code> and <code class="literal">AddressBookImages.sqlitedb</code>.</p><p><code class="literal">AddressBook.sqlitedb</code> contains the actual information saved for each contact, such as name, surname, phone number, e-mail address, and so on. In this database, the tables of interest containing the information mentioned are mainly <code class="literal">ABPerson</code> and <code class="literal">ABMultiValue</code>.</p><p><code class="literal">AddressBookImages.sqlitedb</code> is the database containing the images that the user may have associated to a contact, which is basically the image appearing every time a call to that contact is made or received. The main table of interest in this database is <code class="literal">ABFullSizeImage</code>.</p></div><div class="section" title="Audio recordings"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec48"/>Audio recordings</h2></div></div></div><p>The Voice Memos app, preinstalled on the iDevices, lets the user record voice memos. These memos are stored in <code class="literal">/private/var/mobile/Media/Recordings/</code>. In this folder, there is the <code class="literal">Recordings.db</code> database that contains information about each voice memo stored, such as the date, duration, memo name, and filename of the actual audio file, which is stored in the same folder.</p></div><div class="section" title="Calendar"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec49"/>Calendar</h2></div></div></div><p>The Calendar application allows the user to manually create events, as well as sync them with other applications, such as the related Mac OS X version of the app or other third-party applications and services. Such information is stored in the following two databases:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/private/var/mobile/Library/Calendar/Calendar.sqlitedb</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">/private/var/mobile/Library/Calendar/Extras.db</code></li></ul></div><p>The <code class="literal">Calendar.sqlitedb</code> database is the main one and contains basically all the information related to the events present in the Calendar, while <code class="literal">Extras.db</code> contains other information such as the Calendar settings.</p></div><div class="section" title="Call history"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec50"/>Call history</h2></div></div></div><p>When we press the phone application icon, we see a lot of information, almost all coming from one database, <code class="literal">/private/var/wireless/Library/CallHistoryDB/CallHistory.storedata</code>. Here we can find tracks about incoming, outgoing, and missed calls along with the time and date they occurred and their duration. This database refers to both standard calls and FaceTime calls. As we can see in the following example, the table of interest is <code class="literal">call</code>:</p><pre class="programlisting">
<span class="strong"><strong># ls -l</strong></span>
<span class="strong"><strong>-rw-r--r-- 1 mobile mobile  36864 Oct 22  2015 CallHistory.storedata</strong></span>
<span class="strong"><strong># sqlite3 CallHistory.storedata </strong></span>
<span class="strong"><strong>SQLite version 3.8.10.2</strong></span>
<span class="strong"><strong>Enter ".help" for instructions</strong></span>
<span class="strong"><strong>sqlite&gt; .mode line</strong></span>
<span class="strong"><strong>sqlite&gt; .tables</strong></span>
<span class="strong"><strong>ZCALLDBPROPERTIES  Z_METADATA         Z_PRIMARYKEY     </strong></span>
<span class="strong"><strong>ZCALLRECORD        Z_MODELCACHE     </strong></span>
<span class="strong"><strong>sqlite&gt; select * from ZCALLRECORD;</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>           ZANSWERED = 0</strong></span>
<span class="strong"><strong>           ZCALLTYPE = 1</strong></span>
<span class="strong"><strong> ZDISCONNECTED_CAUSE = </strong></span>
<span class="strong"><strong>     ZFACE_TIME_DATA = </strong></span>
<span class="strong"><strong>ZNUMBER_AVAILABILITY = 0</strong></span>
<span class="strong"><strong>         ZORIGINATED = 1</strong></span>
<span class="strong"><strong>               ZREAD = 1</strong></span>
<span class="strong"><strong>               ZDATE = 490357911.066614</strong></span>
<span class="strong"><strong>           ZDURATION = 0.0</strong></span>
<span class="strong"><strong>          ZDEVICE_ID = </strong></span>
<span class="strong"><strong>   ZISO_COUNTRY_CODE = ch</strong></span>
<span class="strong"><strong>           ZLOCATION = Switzerland</strong></span>
<span class="strong"><strong>               ZNAME = </strong></span>
<span class="strong"><strong>          ZUNIQUE_ID = E49FF4D0-8AF7-4A74-9D8D-43E2B5D7A574</strong></span>
<span class="strong"><strong>            ZADDRESS = +4179******4</strong></span>
<span class="strong"><strong>...</strong></span>
</pre><p>The most interesting fields are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">ZANSWERED</code>: This indicates if the call has been accepted (<code class="literal">1</code>) or rejected (0).</li><li class="listitem" style="list-style-type: disc"><code class="literal">ZCALLTYPE</code>: This indicates if it was a standard phone call (<code class="literal">1</code>), a FaceTime audio only call (<code class="literal">16</code>), or a full audio/video FaceTime call (<code class="literal">8</code>).</li><li class="listitem" style="list-style-type: disc"><code class="literal">ZORIGINATED</code>: This indicates whether the call was outgoing (<code class="literal">1</code>) or incoming (0).</li><li class="listitem" style="list-style-type: disc"><code class="literal">ZDATE</code>: This indicates the date and time of when the call happened. Note that this value is expressed in Mac Absolute time, which represents the number of seconds elapsed since 1/1/2001 00:00:00 GMT. Therefore, if you don't have an application that converts the time for you, simply add 978307200 and use the <code class="literal">date</code> command as follows (example from a Mac):<pre class="programlisting">
<span class="strong"><strong>$ echo '490357911.066614+978307200' | bc  1468665111.066614</strong></span>
<span class="strong"><strong>$ date -ur 1468665111</strong></span>
<span class="strong"><strong>Sat Jul 16 10:31:51 UTC 2016</strong></span>
</pre></li><li class="listitem" style="list-style-type: disc"><code class="literal">ZISO_COUNTRY_CODE</code>: This indicates, as the name suggests, the two letter ISO country code according to the prefix of the phone number indicated in the <code class="literal">ZADDRESS</code> field.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ZLOCATION</code>: This indicates the full name of the country according to the preceding field.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ZADDRESS</code>: Last but not least, this field indicates the phone number where the call came from or went to.</li></ul></div><p>Starting from iOS 8, the path has slightly changed from <code class="literal">/private/var/wireless/Library/CallHistory/call_history.db</code> to <code class="literal">/private/var/wireless/Library/CallHistoryDB/CallHistory.storedata</code>. If a device has been upgraded from iOS 7 to iOS 8, you will find both the old and the new databases, with the call history data prior the upgrade.</p><p>There are yet two other important files related to the phone application to be analyzed. The plist file, <code class="literal">/private/var/mobile/Library/Preferences/com.apple.mobile
phone.plist</code>, has the <code class="literal">DialerSavedNumber</code> value, which is the last phone number manually entered into the dialer and actually dialed. The important thing to note here is that this value will remain even if the user deletes the last call placed from the call history list, which will of course be also deleted from the <code class="literal">CallHistory.storedata</code> database we have just analyzed. The second file that may also be of interest during an investigation is <code class="literal">/private/var/mobile/Library/Preferences/com.apple.mobilephone.speeddial.plist</code>, which contains the phone numbers added to the phone favorites list.</p></div><div class="section" title="E-mail"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec51"/>E-mail</h2></div></div></div><p>Apple Mail client-related data is stored at <code class="literal">/private/var/mobile/Library/Mail/</code>, which contains databases storing the e-mail messages sent, received, and drafted that are stored on the device, as well as a folder for each separate account (POP/IMAP) that has been configured within the Mail application. So, you may want to take a look at all the content you find in there. To give you an example, the folder content may look like the following command:</p><pre class="programlisting">
<span class="strong"><strong># ls -l&#13;
</strong></span>
<span class="strong"><strong>drwxr-xr-x 2 mobile mobile     68 Oct 26  2015  AttachmentPlaceholders/</strong></span>
<span class="strong"><strong>-rw-r--r-- 1 mobile mobile     42 Jul 17 19:24 AutoFetchEnabled</strong></span>
<span class="strong"><strong>-rw-r--r-- 1 mobile mobile 196608 Jul 17 19:24 Envelope\ Index</strong></span>
<span class="strong"><strong>-rw-r--r-- 1 mobile mobile  32768 Jul 17 19:24 Envelope\ Index-shm</strong></span>
<span class="strong"><strong>-rw-r--r-- 1 mobile mobile      0 Jul 17 19:24 Envelope\ Index-wal</strong></span>
<span class="strong"><strong>drwx------ 3 mobile mobile    136 Jul 17 19:24 IMAP-   demo.room.004\@gmail.com\@imap.gmail.com/</strong></span>
<span class="strong"><strong>-rw-r--r-- 1 mobile mobile    468 Jul 17 19:24 MailboxCollections.plist</strong></span>
<span class="strong"><strong>drwx------ 2 mobile mobile    102 Jul 17 19:24 Mailboxes/</strong></span>
<span class="strong"><strong>-rw-r--r-- 1 mobile mobile  86016 Jul 17 19:24 Protected\ Index</strong></span>
<span class="strong"><strong>-rw-r--r-- 1 mobile mobile  32768 Jul 17 19:24 Protected\ Index-shm</strong></span>
<span class="strong"><strong>-rw-r--r-- 1 mobile mobile      0 Jul 17 19:24 Protected\ Index-wal</strong></span>
<span class="strong"><strong>-rw-r--r-- 1 mobile mobile   4096 Jul 13 21:18 Recents</strong></span>
<span class="strong"><strong>-rw-r--r-- 1 mobile mobile  32768 Jul 17 19:11 Recents-shm</strong></span>
<span class="strong"><strong>-rw-r--r-- 1 mobile mobile 366712 Jul 17 19:24 Recents-wal</strong></span>
<span class="strong"><strong>drwxr-xr-x 2 mobile mobile     68 Jul 17 19:24 SceneThumbnailCache/</strong></span>
<span class="strong"><strong>drwx------ 2 mobile mobile     68 Oct 20  2015 Vault/</strong></span>
<span class="strong"><strong>-rw-r--r-- 1 mobile mobile    462 Jul 17 19:24 metadata.plist</strong></span>
</pre><p>Although without any extension, most of these files are SQLite databases (as you may guess from the presence of the <code class="literal">-shm</code> and <code class="literal">-wal</code> files). For example, the Envelope Index database contains the list of mailboxes and metadata, while the Protected Index database contains the list of the e-mails present in the Inbox, where the last one is the most recent:</p><pre class="programlisting">
<span class="strong"><strong># sqlite3 Protected\ Index</strong></span>
<span class="strong"><strong>SQLite version 3.8.10.2</strong></span>
<span class="strong"><strong>Enter ".help" for instructions</strong></span>
<span class="strong"><strong>sqlite&gt; .mode line</strong></span>
<span class="strong"><strong>sqlite&gt; .tables</strong></span>
<span class="strong"><strong>message_data  messages    </strong></span>
<span class="strong"><strong>sqlite&gt; SELECT * FROM messages;</strong></span>
<span class="strong"><strong>message_id = 9</strong></span>
<span class="strong"><strong>    sender = "Facebook" &lt;update@facebookmail.com&gt;</strong></span>
<span class="strong"><strong>   subject = You have more friends on Facebook than you think</strong></span>
<span class="strong"><strong>       _to = Demo &lt; &lt;account_username&gt;@gmail.com&gt;</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>message_id = 130</strong></span>
<span class="strong"><strong>    sender = "PayPal" &lt;paypal@e.paypal.it&gt;</strong></span>
<span class="strong"><strong>   subject = Accordi legali PayPal</strong></span>
<span class="strong"><strong>       _to = &lt;account_username&gt;@gmail.com</strong></span>
<span class="strong"><strong>...</strong></span>
</pre></div><div class="section" title="Images and photos"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec52"/>Images and photos</h2></div></div></div><p>User photos inside an iDevice are stored at <code class="literal">/private/var/mobile/Media/</code>, where the two main folders are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">DCIM</code>: This folder contains the user-created photos via the built-in camera (usually in the <code class="literal">.jpg</code> format) and screenshots taken by the user by pressing the Power and Home buttons together (usually in the <code class="literal">.png</code> format)</li><li class="listitem" style="list-style-type: disc"><code class="literal">PhotoData</code>: This folder contains, among other data, the photo albums synced with a computer or the cloud</li></ul></div><p>Moreover, it is very important not to forget the <span class="emphasis"><em>thumbnails</em></span>. In fact, for each photo, iOS will generate a thumbnail, store it in <code class="literal">/private/var/mobile/Media/PhotoData/Thumbnails/</code>, and save any information about the original image in the <code class="literal">Photos.sqlite</code> database within the <code class="literal">PhotoData</code> folder. This is important because thumbnails and information related to the original picture may still be available or recoverable from the SQLite deleted entries (refer to the related section later on in this chapter) even if the original picture is not available anymore.</p><p>When analyzing photos, it is important to remember to check for the Exif metadata, which may contain other precious information such as geographical coordinates of where the photo was taken.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note12"/>Note</h3><p>For an in-depth analysis of this topic, we advise the reader to have a look at the article available at <a class="ulink" href="http://linuxsleuthing.blogspot.it/2013/05/ios6-photo-streams-recover-deleted.html">http://linuxsleuthing.blogspot.it/2013/05/ios6-photo-streams-recover-deleted.html</a></p></div></div></div><div class="section" title="Maps"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec53"/>Maps</h2></div></div></div><p>Since the release of iOS 6 in 2012, Apple includes its own Maps application. Files and locations of interest are located within the main folder <code class="literal">/private/var/mobile/Containers/Data/Application/2EA1D4AC-1C04-4CA5-8A77-349D47468457/</code>, which contains the history of the searches made by the users as well as the list of locations bookmarked, and also the <code class="literal">Library/Preferences/com.apple.Maps.plist</code> file, which contains information related to the last search that has been made by the user, such as longitude and latitude coordinates as well as the search query made.</p><div class="mediaobject"><img src="graphics/image_06_001.jpg" alt="Maps"/></div></div><div class="section" title="Notes"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec54"/>Notes</h2></div></div></div><p>The Notes application stores information about the user-created notes in <code class="literal">/private/var/mobile/Library/Notes/notes.sqlite</code>. The main tables of interest are <code class="literal">ZNOTE</code> and <code class="literal">ZNOTEBODY</code>; they contain note title, content, creation and modification date, and so on.</p><pre class="programlisting">
<span class="strong"><strong># sqlite3 notes.sqlite&#13;
</strong></span>
<span class="strong"><strong>SQLite version 3.8.10.2</strong></span>
<span class="strong"><strong>Enter ".help" for instructions</strong></span>
<span class="strong"><strong>sqlite&gt; .mode line</strong></span>
<span class="strong"><strong>sqlite&gt; .tables</strong></span>
<span class="strong"><strong>ZACCOUNT         ZNOTEATTACHMENT  ZPROPERTY        Z_MODELCACHE   </strong></span>
<span class="strong"><strong>ZNEXTID          ZNOTEBODY        ZSTORE           Z_PRIMARYKEY   </strong></span>
<span class="strong"><strong>ZNOTE            ZNOTECHANGE      Z_METADATA      </strong></span>
</pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note13"/>Note</h3><p>Starting from iOS 9.3, Apple introduced the possibility of protecting/locking notes via a password. Since the user has to choose each note that has to be password protected (it is not an <span class="emphasis"><em>all or nothing</em></span> model), you may not be able to access those notes directly.</p></div></div></div><div class="section" title="Safari"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec55"/>Safari</h2></div></div></div><p>Safari is the Apple browser that comes preinstalled with every iDevice. It allows the user to browse websites, save bookmarks, and so on. All these activities are stored in the two locations, <code class="literal">/private/var/mobile/Library/Safari/</code> and the Safari main application folder, <code class="literal">/private/var/mobile/Containers/Data/Application/C6254D15-92CE-4989-9427-26A589DFA8B7/</code>. In particular, the folder detail is given as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Safari Bookmarks</strong></span>: This information is stored in <code class="literal">/private/var/mobile/Library/Safari/Bookmarks.db</code>. It contains the database with the saved bookmarks.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Safari Cookies</strong></span>: This information is stored at <code class="literal">/private/var/mobile/Library/Cookies/Cookies.binarycookies</code>. Website cookies are stored here. To parse this binary file you can use the <code class="literal">BinaryCookieReader.py</code> Python script available on GitHub (<a class="ulink" href="https://gist.github.com/sh1n0b1/4bb8b737370bfe5f5ab8">https://gist.github.com/sh1n0b1/4bb8b737370bfe5f5ab8</a>).</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Safari Temporary Files</strong></span>: This information is stored at <code class="literal">&lt;app_folder&gt;/Library/Caches/WebKit/NetworkCache/Version 4/</code>. This folder contains another two subfolders, <code class="literal">Blob</code> and <code class="literal">Record</code>, where temporary files and code of the visited pages are stored. This is important because it will be possible to see/rebuild the same page as it was seen/visited by the user. Another important thing to remember is that when the user deletes their browser cache, these folders will be cleared.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Safari search history</strong></span>: This information is stored in <code class="literal">&lt;app_folder&gt;/Library/Preferences/com.apple.mobilesafari.plist</code>. It contains a list of recent searches made through Safari. An important thing to remember is that when the user deletes their browser cache or history, this file will not be erased, but in iOS 9 its content will be cleared.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Safari Suspended State</strong></span>: This information is stored in <code class="literal">&lt;app_folder&gt;/Library/Safari/SuspendState.plist</code>. It contains the last state of Safari at the time when the user pressed the Home button, the iPhone was powered off, or the browser crashed. In order to be able to restore such a state when the browser resumes, this file contains the list of windows and websites that were open when one of the previously-mentioned events occurred and the browser closed.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Safari Thumbnails</strong></span>: This information is stored at <code class="literal">&lt;app_folder&gt;/Library/Caches/Safari/Thumbnails/</code>. This folder contains screenshots of the last active browser pages viewed via WebKit, for example, by the third-party apps.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Safari Web Cache</strong></span>: This information is stored in <code class="literal">Library/Caches/com.apple.mobilesafari/Cache.db</code>. It contains objects that are recently downloaded and cached in the Safari browser.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Safari History</strong></span>: This information is stored in <code class="literal">&lt;app_folder&gt;/Library/Safari/History.db</code>. It contains the Safari web browser history. Of course, if it has been cleared by the user, it will not contain the history prior to that.</li></ul></div></div><div class="section" title="SMS/iMessage"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec56"/>SMS/iMessage</h2></div></div></div><p>Similar to the Call History, there is one database storing SMSes, MMSes, and iMessages sent or received by the user. The database is at <code class="literal">/private/var/mobile/Library/SMS/sms.db</code>, and it also contains the information related to attachments eventually present in MMSes or iMessages. In such cases, the files part of MMSes or iMessages are stored in the subfolder, <code class="literal">Library/SMS/Attachments/</code>. Finally, the last folder of interest regarding SMS is <code class="literal">Library/SMS/Drafts</code>, where each draft contains its own folder as the <code class="literal">plist</code> file, which is timestamped, identifying when the message was typed and then abandoned.</p><div class="section" title="Voicemail"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec47"/>Voicemail</h3></div></div></div><p>The <code class="literal">Voicemail</code> folder at <code class="literal">/private/var/mobile/Library/</code> contains both the audio file of each voicemail recorded message stored as AMR codec audio files and the <code class="literal">voicemail.db</code> database, where information related to each voicemail audio message file is saved, such as the sender, the date, the duration, and so on.</p></div></div></div>
<div class="section" title="Other iOS forensic traces"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec52"/>Other iOS forensic traces</h1></div></div></div><p>In this section, we will list some other locations of interesting artifacts. Those listed here are not strictly related to a particular application, but are rather generated from the usage of the device by the interaction of the user with the system.</p><div class="section" title="Clipboard"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec57"/>Clipboard</h2></div></div></div><p>The <code class="literal">pasteboardDB</code> file under <code class="literal">/private/var/mobile/Library/Caches/com.apple.UIKit.pboard</code> is a binary file that contains a cached copy of the data stored on the device's clipboard, which means that the data that have been cut/copied and pasted by the user (that is, passwords or other portions of text that may become relevant) will also be present there.</p></div><div class="section" title="Keyboard"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec58"/>Keyboard</h2></div></div></div><p>Two of the iOS features are the auto correction and auto completion of the text while the user is typing. To do this, every time the user types, iOS caches their text in the <code class="literal">dynamic-text.dat</code> file:</p><div class="mediaobject"><img src="graphics/B05100_06_02-1.jpg" alt="Keyboard"/></div><p>This file is located at <code class="literal">/private/var/mobile/Library/Keyboard</code>. This is the default file, but of course, iOS creates one for each language used and configured in the keyboard and stores it in the same folder. In the following example, the second file is related to the Italian keyboard configuration:</p><pre class="programlisting">
<span class="strong"><strong>    # ls -l</strong></span>
<span class="strong"><strong>    drwxr-xr-x 4 mobile mobile 136 Oct 26  2015 CoreDataUbiquitySupport/&#13;
    drwxr-xr-x 2 mobile mobile 102 Oct 22  2015 de-dynamic.lm/&#13;
    -rw------- 1 mobile wheel  307 Jul 17 18:35 dynamic-text.dat&#13;
    drwxr-xr-x 2 mobile mobile 272 Jul 17 20:00 en-dynamic.lm/&#13;
    drwxr-xr-x 2 mobile mobile 272 Jul 17 20:00 it-dynamic.lm/&#13;
    -rw------- 1 mobile wheel   65 Jul 17 19:57 it_IT-dynamic-text.dat&#13;
</strong></span>
</pre></div><div class="section" title="Location"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec59"/>Location</h2></div></div></div><p>With iOS 4, there was the <span class="strong"><strong>Consolidated GPS cache</strong></span>, a database containing location information associated with every Wi-Fi hotspot and cell tower that the device had been in range with. In such a database located at <code class="literal">/private/var/root/Library/Caches/locationd/consolidated.db</code>, the <code class="literal">WifiLocation</code> and <code class="literal">CellLocation</code> tables contained information cached locally by the device and included the Wi-Fi access points and cellular towers that came within range of the device at a given time and included a horizontal accuracy (in meters), believed to be a guesstimate at the distance from the device. Such data, other than remaining forever in that database, was allegedly sent periodically to Apple. After the so-called <span class="strong"><strong>location gate</strong></span> scandal that arose after the discovery of such a database, Apple kind of dismissed it.</p><p>However, the new databases that took the place of <code class="literal">consolidated.db</code> are <code class="literal">cache_encryptedA.db</code>, <code class="literal">lockCache_encryptedA.db</code>, and <code class="literal">cache_encryptedB.db</code> stored under the <code class="literal">/private/var/root/Library/Caches/locationd/</code> folder. As for its predecessor, these databases contain geographical coordinates of frequent and recent locations, Wi-Fi access points, and apparently, cell towers that have been in the range of the device. The only differences in this case are that this data lasts only for 8 days before being cleared out. To dump these databases you may also use a Python script from Sarah Edwards (her Twitter handle is <code class="literal">@iamevltwin</code>), <span class="strong"><strong>iOS Location Scraper</strong></span>, which can be downloaded from the GitHub repository at <a class="ulink" href="https://github.com/mac4n6/iOS-Locations-Scraper">https://github.com/mac4n6/iOS-Locations-Scraper</a>.</p><p>The other very important point to keep in mind regarding the geolocation artifacts is that many other applications, especially third-party ones such as those about fitness that people may use to keep track of their path when running, may store geographical coordinates and related timestamps as well and in clear text.</p></div><div class="section" title="Snapshots"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec60"/>Snapshots</h2></div></div></div><p>Every time a user pushes the Home button to move from an application screen back to the desktop, iOS uses a <span class="strong"><strong>fade-out</strong></span> effect for the transition between the two screens. To do so, iOS creates screenshots of the current screen and then applies the fade-out effect to that picture. These screenshots are stored in the following locations:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/private/var/mobile/Library/Caches/Snapshots/</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">/private/var/mobile/Containers/Data/Applications/&lt;UUID&gt;/Library/Caches/Snapshots/</code></li></ul></div><p>The first path refers to the preinstalled Apple applications, while the second is the path where to find the snapshots for each application. It is clear that this feature could be a goldmine of information. For example, there could be screenshots containing SMSes or e-mail messages that are no longer available because they have been deleted.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note14"/>Note</h3><p>It is important to remember that only the last snapshot is taken for each application. Therefore, the analyst should interact and browse inside the device as little as possible in order not to overwrite and lose possible crucial evidence.</p></div></div></div><div class="section" title="Wallpaper"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec61"/>Wallpaper</h2></div></div></div><p>Current images used as wallpapers are stored in <code class="literal">/private/var/mobile/Library/SpringBoard/</code>. There are two different images:<code class="literal">HomeBackgroundThumbnail.jpg</code>, which refers to the wallpaper when the device is unlocked, and <code class="literal">LockBackgroundThumbnail.jpg</code>, which refers to the wallpaper of the device when it is locked.</p></div><div class="section" title="iOS crash reports"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec62"/>iOS crash reports</h2></div></div></div><p>The iOS operating system uses crash reports to keep track of errors and crashes of native as well as third-party applications. A crash log typically contains a description of the system state when the application generated the error or terminated it. Crash reports are managed by a service that is responsible for collecting and aggregating the logs. For an analysis of the operation of the crash report service and the crash log structure refer to the following web pages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Understanding and Analyzing iOS Application Crash Reports: <a class="ulink" href="https://developer.apple.com/library/ios/technotes/tn2151/_index.html">https://developer.apple.com/library/ios/technotes/tn2151/_index.html</a></li><li class="listitem" style="list-style-type: disc">Understanding Crash Reports on iPhone OS: <a class="ulink" href="https://developer.apple.com/videos/play/wwdc2010/317/">https://developer.apple.com/videos/play/wwdc2010/317/</a></li><li class="listitem" style="list-style-type: disc">Analyzing Crash Reports: <a class="ulink" href="https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/AppDistributionGuide/AnalyzingCrashReports/AnalyzingCrashReports.html">https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/AppDistributionGuide/AnalyzingCrashReports/AnalyzingCrashReports.html</a></li><li class="listitem" style="list-style-type: disc">Demystifying iOS Application Crash Logs: <a class="ulink" href="https://www.raywenderlich.com/23704/demystifying-ios-application-crash-logs">https://www.raywenderlich.com/23704/demystifying-ios-application-crash-logs</a></li></ul></div><p>Typically, the devices are configured to automatically synchronize crash logs with a PC/Mac, every time the device is connected and runs iTunes. For this reason, it is advisable to check, within a computer, if you have all the crash logs of devices that have been linked together in time. Depending on the operating system, crash logs are stored in different locations:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Windows XP</strong></span>: <code class="literal">C:\Documents and Settings\&lt;USERNAME&gt;\Application Data\Apple Computer\Logs\CrashReporter\MobileDevice\&lt;DEVICE_NAME&gt;</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Windows Vista/7/8/10</strong></span>: <code class="literal">C:\Users\&lt;USERNAME&gt;\AppData\Roaming\Apple Computer\Logs\CrashReporter\MobileDevice\&lt;DEVICE_NAME&gt;</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Mac OS X</strong></span>: <code class="literal">~/Library/Logs/CrashReporter/MobileDevice/&lt;DEVICE_NAME&gt;</code></li></ul></div><p>Crash reports can also be extracted from an iOS device directly dialoguing with the crash report service (yes, it has the same name) through iTunes on PC or Mac, or XCode on Mac. As explained in <a class="link" href="ch03.html" title="Chapter 3. Evidence Acquisition from iDevices">Chapter 3</a>, <span class="emphasis"><em>Evidence Acquisition from iDevices</em></span>, several third-party software offer the ability to remove the logs and save them for later analysis; among these we remember here are iBackupBot and iTools. They can be extracted from an unlocked device or from a turned on and locked device with a valid pairing certificate, and also if a backup password was set by the user. The following screenshot shows an example of a Crash Report extraction from an iPhone 6s using iBackupBot:</p><div class="mediaobject"><img src="graphics/image_06_003.jpg" alt="iOS crash reports"/></div><p>Various information of interest from a forensic point of view can be identified from the analysis of the crash logs, such as the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installed applications list and usage from various logs such as PowerLog, Security, and OnDemand<div class="mediaobject"><img src="graphics/image_06_004.jpg" alt="iOS crash reports"/></div></li><li class="listitem" style="list-style-type: disc">iTunes username from <code class="literal">itunesstored.2.log</code><div class="mediaobject"><img src="graphics/image_06_005.jpg" alt="iOS crash reports"/></div></li><li class="listitem" style="list-style-type: disc">Filename of e-mail attachments from MobileMail logs<div class="mediaobject"><img src="graphics/image_06_006.jpg" alt="iOS crash reports"/></div></li><li class="listitem" style="list-style-type: disc">List of Wi-Fi network and history of latest connections from Wi-Fi logs<div class="mediaobject"><img src="graphics/image_06_007.jpg" alt="iOS crash reports"/></div></li></ul></div></div><div class="section" title="Tracking device usage"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec63"/>Tracking device usage</h2></div></div></div><p>Sarah Edwards has made an extensive research work on artifacts that track the usage of the device. By linking applications, data and network usage, health information (for example, workouts), timestamps, and geolocation data, it is indeed possible to understand what a given user under investigation was doing and where at a given point in time. In particular, she looked at the following artifacts:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>CoreDuet</strong></span>: <code class="literal">/private/var/mobile/Library/CoreDuet/</code><p><code class="literal">coreduetd.db</code> (31 tables)</p><p><code class="literal">coreduetdClassA.db</code> (31 tables)</p><p><code class="literal">coreduetdClassD.db</code> (31 tables)</p><p><code class="literal">Knowledge/knowledgeC.db</code> (5 tables)</p><p><code class="literal">People/interactionC.db</code> (9 tables)</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Battery Life (PowerLog)</strong></span>: <code class="literal">/private/var/mobile/Library/BatteryLife/</code><p><code class="literal">CurrentPowerlog.PLSQL</code> (257 tables)</p><p><code class="literal">Archives/powerlog_YYYY-MM-DD_XXXXXXXX.PLQSQL.gz</code> (Previous ~5 Days)</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Health</strong></span>: <code class="literal">/private/var/mobile/Library/Health/</code><p><code class="literal">healthdb.sqlite</code> (11 tables)</p><p><code class="literal">healthdb_secure.sqlite</code> (16 tables)</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Aggregate Dictionary</strong></span>: <code class="literal">/private/var/mobile/Library/AggregateDictionary/</code><p><code class="literal">ADDataStore.sqlitedb</code> (4 tables)</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>networkd</strong></span>: <code class="literal">/private/var/networkd/</code><p><code class="literal">netusage.sqlite</code> (13 tables)</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>routined</strong></span>: <code class="literal">/private/var/mobile/Library/Caches/com.apple.routined/</code><p><code class="literal">cache_encryptedB.db</code> (5 tables)</p><p><code class="literal">StateModel1.archive</code></p><p><code class="literal">StateModel2.archive</code></p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>locationd</strong></span>: <code class="literal">/private/var/root/Library/Caches/locationd/</code><p><code class="literal">cache_encryptedA.db</code> (79 tables)</p><p><code class="literal">lockCache_encryptedA.db</code> (51 tables)</p><p><code class="literal">cache_encryptedB.db</code> (167 tables)</p><p><code class="literal">cache_encryptedC.db</code> (9 tables)</p><p>The details of Sarah's work mentioned here can be found at her website, more specifically the <span class="emphasis"><em>The iOS of Sauron: How iOS Tracks Everything You Do</em></span> talk (<a class="ulink" href="https://www.mac4n6.com/resources/">https://www.mac4n6.com/resources/</a>).</p></li></ul></div></div></div>
<div class="section" title="Third-party application analysis"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec53"/>Third-party application analysis</h1></div></div></div><p>In the previous paragraphs, you have seen where important artifacts related to the iOS system settings and preferences, native iOS applications, and device features are located. These are locations to be aware of, and it is important to know how to analyze them since they are common to all iDevices. Now, in the following paragraphs, we are going to show you a practical analysis of some of the most used third-party applications.</p><div class="section" title="Social Network and Instant Messaging applications"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec64"/>Social Network and Instant Messaging applications</h2></div></div></div><p>Probably the most widely used category, Social Network and Instant Messaging applications can represent a treasure trove for the analyst, as now they have become the main means for communication. In this section, we will give you an overview of the main artifacts you may find in some of the most popular applications, as in which location you should pay particular attention during the analysis.</p><div class="section" title="Skype"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec48"/>Skype</h3></div></div></div><p>Skype is probably the most known and used software for VoIP and chatting:</p><pre class="programlisting">
<span class="strong"><strong># tree -L 3 86212B35-B575-4E69-89F1-81F0CD8886A2/&#13;
&#13;</strong></span>
<span class="strong"><strong>|-- Documents&#13;</strong></span>
<span class="strong"><strong>|   |-- Skype.htrace0&#13;</strong></span>
<span class="strong"><strong>|   |-- Skype.htrace0.bak&#13;</strong></span>
<span class="strong"><strong>|   `-- _MediaStackETW.etl&#13;</strong></span>
<span class="strong"><strong>|-- Library&#13;</strong></span>
<span class="strong"><strong>|   |-- Application\ Support&#13;</strong></span>
<span class="strong"><strong>|   |   |-- RootTools&#13;</strong></span>
<span class="strong"><strong>|   |   `-- Skype&#13;</strong></span>
<span class="strong"><strong>|   |-- Caches&#13;</strong></span>
<span class="strong"><strong>|   |   |-- Snapshots&#13;</strong></span>
<span class="strong"><strong>|   |   |-- com.plausiblelabs.crashreporter.data&#13;</strong></span>
<span class="strong"><strong>|   |   |-- com.skype.skype&#13;</strong></span>
<span class="strong"><strong>|   |   |-- net.hockeyapp.sdk.ios&#13;</strong></span>
<span class="strong"><strong>|   |   |-- offline-storage-ecs.data&#13;</strong></span>
<span class="strong"><strong>|   |   |-- offline-storage.data&#13;</strong></span>
<span class="strong"><strong>|   |   |-- &lt;skype_name&gt;&#13;</strong></span>
<span class="strong"><strong>|   |   |-- skype-cache-501.&lt;skype_name&gt;.ContactsListAdapter-Contacts-SingleSelect.plist&#13;</strong></span>
<span class="strong"><strong>|   |   |-- skype-cache-501.&lt;skype_name&gt;.ContactsListAdapter-Favorites-SingleSelect.plist&#13;</strong></span>
<span class="strong"><strong>...&#13;</strong></span>
<span class="strong"><strong>|   |   |-- skype-cache-501.&lt;skype_name&gt;.chathistory-viewmodels&#13;
&lt;contact_name&gt;.plist&#13;</strong></span>
<span class="strong"><strong>...&#13;</strong></span>
<span class="strong"><strong>|   |   |-- skype-cache-501.&lt;skype_name&gt;.chatinput-saved-&lt;contact_name&gt;.plist&#13;</strong></span>
<span class="strong"><strong>|   |   `-- skype-cache-501.&lt;skype_name&gt;.conversations.plist&#13;</strong></span>
<span class="strong"><strong> |   |-- Cookies&#13;</strong></span>
<span class="strong"><strong>|   |   `-- Cookies.binarycookies&#13;</strong></span>
<span class="strong"><strong>|   `-- Preferences&#13;</strong></span>
<span class="strong"><strong>|       `-- com.skype.skype.plist&#13;</strong></span>
<span class="strong"><strong>|-- StoreKit&#13;</strong></span>
<span class="strong"><strong>|   `-- receipt&#13;</strong></span>
<span class="strong"><strong>`-- tmp</strong></span>
</pre><p>Starting from the <code class="literal">Library/Preferences</code> folder, we can find the first important information inside the <code class="literal">com.skype.skype.plist</code> file, the username, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/image_06_008.jpg" alt="Skype"/></div><p>However, the preceding screenshot shows only the last username that has logged in. If we want to know all the profiles that have been logged in from this device, we have to look for other folders under <code class="literal">Library/Application Support/Skype/</code>, where we will find one folder for each account logged in with that device:</p><div class="mediaobject"><img src="graphics/image_06_009.jpg" alt="Skype"/></div><p>Inside every user's folder, we find all the databases storing information such as contacts list, chats, and so on. Here, the structure is pretty much the same as the PC/desktop version. In fact, you can open the <code class="literal">main.db</code> file, where you can find all information clearly stored, as you can see from the interesting names of the tables as follows:</p><pre class="programlisting">
<span class="strong"><strong># sqlite3 main.db&#13;
&#13;</strong></span>
<span class="strong"><strong>SQLite version 3.8.10.2&#13;</strong></span>
<span class="strong"><strong>Enter ".help" for instructions&#13;</strong></span>
<span class="strong"><strong>sqlite&gt; .mode line&#13;</strong></span>
<span class="strong"><strong>sqlite&gt; .tables&#13;</strong></span>
<span class="strong"><strong>Accounts            Chats               MediaDocuments      Translators      &#13;</strong></span>
<span class="strong"><strong>Alerts              ContactGroups       MessageAnnotations  VideoMessages    &#13;</strong></span>
<span class="strong"><strong>AppSchemaVersion    Contacts            Messages            Videos           &#13;</strong></span>
<span class="strong"><strong>CallMembers         Conversations       Participants        Voicemails       &#13;</strong></span>
<span class="strong"><strong>Calls               DbMeta              SMSes               tracker_journal  &#13;</strong></span>
<span class="strong"><strong>ChatMembers         LegacyMessages      Transfers        </strong></span>
</pre><p>Refer to the following screenshot:</p><div class="mediaobject"><img src="graphics/image_06_010.jpg" alt="Skype"/></div><p>This means that you can use any of your favorite Skype analysis utilities to parse these files, such as <span class="strong"><strong>SkypeLogView</strong></span> from <span class="strong"><strong>Nirsoft</strong></span> and so on. Finally, within the application folder itself, you may also find the Voicemail messages and screenshots, as we have addressed previously in the <span class="emphasis"><em>Snapshots</em></span> section, in addition to files transferred via Skype, logs, and much more.</p></div><div class="section" title="WhatsApp"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec49"/>WhatsApp</h3></div></div></div><p>Although it is technically an Instant Messaging application, WhatsApp has almost completely replaced the classical SMS. Therefore, it is very likely that you will encounter it during a mobile forensics analysis. Let's have a look at its internal folder structure that, as you may have realized, differs really very little from one application to the other:</p><pre class="programlisting">
<span class="strong"><strong># tree -L 3 6E3B21B5-9E07-4F65-B7FD-57E12CEF9E2C/</strong></span>
<span class="strong"><strong>|-- Documents |   |-- StatusMessages.plist</strong></span>
<span class="strong"><strong>|   |-- SyncHistory.plist</strong></span>
<span class="strong"><strong>|   |-- blockedcontacts.dat</strong></span>
<span class="strong"><strong>|   |-- calls.backup.log</strong></span>
<span class="strong"><strong>|   `-- calls.log</strong></span>
<span class="strong"><strong>|-- Library</strong></span>
<span class="strong"><strong>|   |-- Caches</strong></span>
<span class="strong"><strong>|   |   |-- ProfilePictures</strong></span>
<span class="strong"><strong>|   |   |-- Snapshots</strong></span>
<span class="strong"><strong>|   |   `-- mmap-images</strong></span>
<span class="strong"><strong>|   |-- FieldStats</strong></span>
<span class="strong"><strong>|   |   `-- fieldstats.active</strong></span>
<span class="strong"><strong>|   |-- Logs</strong></span>
<span class="strong"><strong>|   |   |-- Handoff</strong></span>
<span class="strong"><strong>|   |   |-- whatsapp-2016-07-29-20-58-09.227.7.log</strong></span>
<span class="strong"><strong>|   |   `-- whatsapp-2016-07-30-18-50-21.581.8.log</strong></span>
<span class="strong"><strong>|   `-- Preferences</strong></span>
<span class="strong"><strong>|       `-- net.whatsapp.WhatsApp.plist</strong></span>
<span class="strong"><strong>|-- StoreKit</strong></span>
<span class="strong"><strong>|   `-- receipt</strong></span>
<span class="strong"><strong>`-- tmp</strong></span>
</pre><p>We have now understood that to get a first hint and useful information for starting with an application, we may want to start looking inside the <code class="literal">plist</code> configuration file under <code class="literal">Library/Preferences/</code>. In this case, we are looking for <code class="literal">net.whatsapp.WhatsApp.plist</code>. Here again, you will find some basic information, such as the username, the phone number the WhatsApp account was linked to, and so on.</p><p>However, what we may realize here is that we don't have the chat database, the famous <code class="literal">ChatStorage.sqlite</code> file. This is because Whatsapp is one of those applications that stores the data in the <code class="literal">/private/var/mobile/Containers/Shared/AppGroup/</code> folder:</p><pre class="programlisting">
<span class="strong"><strong>iLab1:/private/var/mobile/Containers/Shared/AppGroup root# tree 332A098D-368C-4378-A503-91BF33284D4B&#13;</strong></span>
<span class="strong"><strong>&#13;
|-- Axolotl.sqlite&#13;</strong></span>
<span class="strong"><strong>|-- ChatSearch.sqlite&#13;</strong></span>
<span class="strong"><strong>|-- ChatStorage.sqlite&#13;</strong></span>
<span class="strong"><strong>|-- Contacts.sqlite&#13;</strong></span>
<span class="strong"><strong>|-- Jobs.sqlite&#13;</strong></span>
<span class="strong"><strong>|-- Jobs.sqlite-shm&#13;</strong></span>
<span class="strong"><strong>|-- Jobs.sqlite-wal&#13;</strong></span>
<span class="strong"><strong>|-- Library&#13;</strong></span>
<span class="strong"><strong>|   |-- Caches&#13;</strong></span>
<span class="strong"><strong>|   `-- Preferences&#13;</strong></span>
<span class="strong"><strong>|       `-- group.net.whatsapp.WhatsApp.shared.plist&#13;</strong></span>
<span class="strong"><strong>|-- Media&#13;</strong></span>
<span class="strong"><strong>|   `-- Profile&#13;</strong></span>
<span class="strong"><strong>|       |-- 393205573087-1420495528.thumb&#13;</strong></span>
<span class="strong"><strong>|       |-- 393205573087-1456251558-1456251649.thumb&#13;</strong></span>
<span class="strong"><strong>|       |-- 393497320069-1432382263.thumb&#13;</strong></span>
<span class="strong"><strong>|       |-- 393930831043-1402697710.thumb&#13;</strong></span>
<span class="strong"><strong>|       |-- 41788236232-1467887746-1467901783.thumb&#13;</strong></span>
<span class="strong"><strong>|       `-- 41788236232-1468256570.jpg&#13;</strong></span>
<span class="strong"><strong>|-- cck.dat&#13;</strong></span>
<span class="strong"><strong>`-- connection.lock</strong></span>
</pre><p>Regarding the actual content of the messages exchanged, the main database is <code class="literal">Documents/ChatStorage.sqlite</code>, whose structure is as follows:</p><pre class="programlisting">
<span class="strong"><strong># sqlite3 ChatStorage.sqlite</strong></span>
<span class="strong"><strong>SQLite version 3.8.10.2</strong></span>
<span class="strong"><strong>Enter ".help" for instructions</strong></span>
<span class="strong"><strong>sqlite&gt; .mode line</strong></span>
<span class="strong"><strong>sqlite&gt; .tables</strong></span>
<span class="strong"><strong>ZWABLACKLISTITEM       ZWAGROUPMEMBER         ZWAMESSAGEINFO       </strong></span>
<span class="strong"><strong>ZWACHATPROPERTIES      ZWAGROUPMEMBERSCHANGE  ZWAPROFILEPICTUREITEM</strong></span>
<span class="strong"><strong>ZWACHATPUSHCONFIG      ZWAMEDIAITEM           Z_METADATA           </strong></span>
<span class="strong"><strong>ZWACHATSESSION         ZWAMESSAGE             Z_MODELCACHE         </strong></span>
<span class="strong"><strong>ZWAGROUPINFO           ZWAMESSAGEDATAITEM     Z_PRIMARYKEY         </strong></span>
</pre><p>The <code class="literal">ZWAMESSAGE</code> table is the one containing the messages exchanged, their timestamp, the name of who the user was chatting with, and so on, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/image_06_011.jpg" alt="WhatsApp"/></div><p>The <code class="literal">ZWACHATSESSION</code> table stores information about the open chats, both with a single user and group chats, and you can correlate these data with those in the <code class="literal">ZWAGROUPMEMBER</code> and <code class="literal">ZWAGROUPINFO</code> tables in order to find out which users belong to which group chat. Finally, in <code class="literal">ZWAMEDIAITEM</code> stores references to the multimedia files (pictures, audio messages, and videos) exchanged, with an indication of the user involved, timestamps, and the location where the multimedia file has been stored within an iDevice.</p><div class="mediaobject"><img src="graphics/image_06_012.jpg" alt="WhatsApp"/></div><p>However, you will also find the chat contents inside <code class="literal">Documents/ChatSearch.sqlite</code> within the <code class="literal">docs_content</code> tables, as shown in the preceding screenshot.</p></div><div class="section" title="Facebook and Messenger"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec50"/>Facebook and Messenger</h3></div></div></div><p>Facebook is the most known and widely used social network. For this reason, other than for the fact that it is now integrated with iOS, you will most likely have to analyze the Facebook app in almost all of your investigations. As you can imagine, the amount of information stored by Facebook is very high, and in particular, it concerns three areas, user personal information, a cache of images related to profiles and visited pages, and information related to the external sites visited within the Facebook app through the links present on the posts. Due to the obviously large amount of possible information retrievable in the Facebook app and the page limitation of a book, the goal of this section is to give you a glimpse and some hints on possible artifacts and where to find them.</p><p>The account information is saved inside <code class="literal">Library/Preferences/com.facebook.Facebook.plist</code>. Among other information, you will find the e-mail address and the Facebook ID of the profile configured within the app, as well as the date of the last time the app has been used.</p><p>Information related to contacts is saved in <code class="literal">Library/Caches/_store_&lt;ID&gt;/messender_contacts_v1/fbsyncstore.db</code> within the <code class="literal">people</code> table.</p><p>In <code class="literal">Library/Caches/_store_&lt;ID&gt;/image_cache_v7/</code> are stored images viewed while surfing through the pages of the social network (for example, posts of other users and so on), while inside the <code class="literal">Library/WebKit/WebsiteData/LocalStorage/StorageTracker.db</code> database and the <code class="literal">Library/Caches/WebKit/NetworkCache/</code> folder are stored contents of other websites visited through the application internal browser, including the related URL and the corresponding files (for example, the JPG image, the HTML page, the CSS style sheet, and so on).</p><p>Starting from April 2014, the instant messaging function has been completely moved from the Facebook app to Facebook Messenger app, launched by Facebook itself on August 2009. Therefore, all Facebook users have been forced to download and use Messenger to communicate among themselves.</p><p>Also in this case, interesting artifacts are stored in both the <code class="literal">.../Containers/Data/...</code> and <code class="literal">.../Containers/Shared/...</code> application folders. In particular, you will find the chat content database at <code class="literal">/private/var/mobile/Containers/Shared/AppGroup/&lt;UUID&gt;/_store_&lt;ID&gt;/messenger_messages_v1/orca2.db</code>. In this database, chats are saved as a blob data field within the tables.</p></div><div class="section" title="Telegram"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec51"/>Telegram</h3></div></div></div><p>Telegram is probably the second most used Instant Messaging application after Whatsapp, therefore chances of having to deal with it during an analysis are quite high as well. As always, the account information can be found at <code class="literal">&lt;App_folder&gt;/Library/Preferences/</code> within the <code class="literal">ph.telegra.Teleraph.plist</code> file.</p><p>Similar to WhatsApp, Facebook, and Messenger, Telegram stores many of its data in the <code class="literal">.../Container/Shared/AppGroup/</code> folder, as we can see from the following folder structure:</p><pre class="programlisting">
<span class="strong"><strong>-- 9C8C5F63-4EF3-4D6C-9F7F-6C71B9A0970A&#13;
&#13;</strong></span>
<span class="strong"><strong>|   |-- Caches&#13;</strong></span>
<span class="strong"><strong>|   |   |-- com.plausiblelabs.crashreporter.data&#13;</strong></span>
<span class="strong"><strong>|   |   |   `-- ph.telegra.Telegraph&#13;</strong></span>
<span class="strong"><strong>|   |   |       `-- queued_reports&#13;</strong></span>
<span class="strong"><strong>|   |   |-- net.hockeyapp.sdk.ios&#13;</strong></span>
<span class="strong"><strong>|   |   `-- ph.telegra.Telegraph&#13;</strong></span>
<span class="strong"><strong>|   |       `-- com.apple.opengl&#13;</strong></span>
<span class="strong"><strong>|   |           |-- compileCache.data&#13;</strong></span>
<span class="strong"><strong>|   |           |-- compileCache.maps&#13;</strong></span>
<span class="strong"><strong>|   |           |-- linkCache.data&#13;</strong></span>
<span class="strong"><strong>|   |           |-- linkCache.maps&#13;</strong></span>
<span class="strong"><strong>|   |           |-- shaders.data&#13;</strong></span>
<span class="strong"><strong>|   |           `-- shaders.maps&#13;</strong></span>
<span class="strong"><strong>|   |-- Documents&#13;</strong></span>
<span class="strong"><strong>|   |   |-- mtkeychain&#13;</strong></span>
<span class="strong"><strong>|   |   |   |-- Telegram_meta.bin&#13;</strong></span>
<span class="strong"><strong>|   |   |   |-- Telegram_persistent.bin&#13;</strong></span>
<span class="strong"><strong>|   |   |   |-- Telegram_primes.bin&#13;</strong></span>
<span class="strong"><strong>|   |   |   `-- Telegram_temp.bin&#13;</strong></span>
<span class="strong"><strong>|   |   |-- tgdata.db&#13;</strong></span>
<span class="strong"><strong>|   |   |-- tgdata.db-journal&#13;</strong></span>
<span class="strong"><strong>|   |   |-- tgdata_index.db&#13;</strong></span>
<span class="strong"><strong>|   |   |-- tgdata_index.db-journal&#13;</strong></span>
<span class="strong"><strong>|   |   `-- wallpaper-data&#13;</strong></span>
<span class="strong"><strong>|   |       `-- _currentWallpaper.jpg&#13;</strong></span>
<span class="strong"><strong>|   |-- Library&#13;</strong></span>
<span class="strong"><strong>|   |   `-- Caches&#13;</strong></span>
<span class="strong"><strong>|   `-- shared-auth-info</strong></span>
</pre><p>More specifically, under the <code class="literal">Documents</code> folder we find the <code class="literal">tgdata.db</code> database, which contains all information about contacts, conversations, exchanged files, and so on.<span class="strong"><strong> </strong></span>                  </p><p>Some of the tables of particular interest are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">users_v29</code>: This contains the contact list and related Telegram user ID (uid).</li><li class="listitem" style="list-style-type: disc"><code class="literal">contacts_v29</code>: This contains the list of all uid.</li><li class="listitem" style="list-style-type: disc"><code class="literal">messages_v29</code>: This contains the list of all messages exchanged, with to/from fields to identify who is the source and who is the destination, as well as a conversation ID (cid), so that it is easier to group messages belonging to the same conversation. Messages from secret chats are also clearly stored here.</li><li class="listitem" style="list-style-type: disc"><code class="literal">convesations_v29</code>: This contains the list of active conversations as seen in the <span class="strong"><strong>Chats</strong></span> screen of the app, and also the last message exchanged. The name of the table does not contain a typo from us, but it really misses the <span class="emphasis"><em>r</em></span> !</li><li class="listitem" style="list-style-type: disc"><code class="literal">encrypted_cids_v29</code>: This contains the conversation IDs of the secret chats. All cid related to secret chats start with the <code class="literal">-</code> (minus) symbol.</li></ul></div><p>Those listed here are just some of the interesting tables, to give you a glimpse of what you can find, but as you can see from the preceding <code class="literal">sqlite3</code> command output there are many more:</p><div class="mediaobject"><img src="graphics/Chapter-65100.jpg" alt="Telegram"/></div></div><div class="section" title="Signal"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec52"/>Signal</h3></div></div></div><p>Last but not least, we could not exclude <span class="strong"><strong>Signal</strong></span> from this list of IM apps analyzed. Unfortunately for the forensics analyst and fortunately for the end user, there is not much to say as Signal does indeed what it promises, all messages are securely encrypted within the device (data-at-rest) other than when sent/received through the network (data-in-transit). The folders structure is as follows:</p><pre class="programlisting">
<span class="strong"><strong>iLab1:/private/var/mobile/Containers/Data/Application/6B6D8B22-F0D1-47A2-8818-134AE95B2DEC root# tree&#13;</strong></span>
<span class="strong"><strong>|-- Documents&#13;</strong></span>
<span class="strong"><strong>|   |-- Attachments&#13;</strong></span>
<span class="strong"><strong>|   |   `-- 4034125268946418778.jpeg&#13;</strong></span>
<span class="strong"><strong>|   |-- Signal.sqlite&#13;</strong></span>
<span class="strong"><strong>|   |-- Signal.sqlite-shm&#13;</strong></span>
<span class="strong"><strong>|   `-- Signal.sqlite-wal&#13;</strong></span>
<span class="strong"><strong>|-- Library&#13;</strong></span>
<span class="strong"><strong>|   |-- Caches&#13;</strong></span>
<span class="strong"><strong>|   |   |-- Logs&#13;</strong></span>
<span class="strong"><strong>|   |   |   `-- org.whispersystems.signal\ 2016-07-31\ 15-59.log&#13;</strong></span>
<span class="strong"><strong>|   |   |-- Snapshots&#13;</strong></span>
<span class="strong"><strong>|   |   |   `-- org.whispersystems.signal&#13;</strong></span>
<span class="strong"><strong>|   |   |       |-- 52A21AE5-A070-40AF-B91B-711C86867100@2x.png&#13;</strong></span>
<span class="strong"><strong>|   |   |       |-- A8B33136-73B0-4FBB-9AA4-436A0557C595@2x.png&#13;</strong></span>
<span class="strong"><strong>|   |   |       `-- downscaled&#13;</strong></span>
<span class="strong"><strong>|   |   |           `-- 90479DEB-F853-4097-9C31-5F1B58617EBA@2x.png&#13;</strong></span>
<span class="strong"><strong>|   |   `-- org.whispersystems.signal&#13;</strong></span>
<span class="strong"><strong>|   |       |-- Cache.db&#13;</strong></span>
<span class="strong"><strong>|   |       |-- Cache.db-shm&#13;</strong></span>
<span class="strong"><strong>|   |       |-- Cache.db-wal&#13;</strong></span>
<span class="strong"><strong>|   |       `-- fsCachedData&#13;</strong></span>
<span class="strong"><strong>|   |           `-- 691B3FAC-2F2A-435D-9A23-B14DCB253298&#13;</strong></span>
<span class="strong"><strong>|   `-- Preferences&#13;</strong></span>
<span class="strong"><strong>|       `-- org.whispersystems.signal.plist&#13;</strong></span>
<span class="strong"><strong>|-- StoreKit&#13;</strong></span>
<span class="strong"><strong>`-- tmp</strong></span>
</pre><p>All of Signal's data (that is, chat messages, contact lists, and so on) is inside the <code class="literal">Document/Signal.sqlite</code> database that is, as we already said, encrypted. However, there are two things that are not encrypted. They are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Attachments</strong></span>: Oddly enough, the attachments exchanged are clearly stored and can be retrieved from the <code class="literal">Document/Attachments/</code> folder.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Snapshots</strong></span>: Signal has an <span class="strong"><strong>Enable Screen Security</strong></span> option that would prevent this, but for some reason is not set by default. Therefore, it is possible to find the screen snapshot (we have talked about snapshots in an earlier section of this chapter) in the <code class="literal">Library/Caches/Snapshots/</code> folder.</li></ul></div><p>As we said, not too much information is available, but keep in mind the attachments and the snapshots, as they may reveal important traces for your investigation.</p></div></div><div class="section" title="Cloud storage applications"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec65"/>Cloud storage applications</h2></div></div></div><p>Cloud storage applications are very popular on mobile devices, since the Cloud somewhat extends the device storage capability and allows the user to have access to their data anywhere and anytime. Therefore, it is very probable that you will encounter at least one on this class of apps during your analysis. In this section, we just want to give you a glimpse of some artifacts you can find in two of the most popular cloud storage services.</p><div class="section" title="Dropbox"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl4sec0"/>Dropbox</h3></div></div></div><p>The Dropbox iOS app is stored in <code class="literal">/private/var/mobile/Containers/Data/Applications/9238CCE2-5C38-4843-9F76-D73B7C0CAB23/</code>. In the <code class="literal">Documents/Users/&lt;user_id&gt;/</code> folder there are several databases of interest, in particular the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Dropbox.sqlite</code>: This database, within the <code class="literal">ZCACHEDFILE</code> table, contains information about all the files the user interacted with, such as opened, saved, or simply browsed</li><li class="listitem" style="list-style-type: disc"><code class="literal">Uploads.sqlite</code>: This database, within the <code class="literal">ZQUEUEDUPLOAD</code> table, contains the name/path of uploaded files, the file mime type, and timestamp of the upload</li></ul></div><p>The <code class="literal">Library/Caches/</code> folder contains a local copy of the <span class="emphasis"><em>opened files</em></span>, but it is <span class="emphasis"><em>available only if we can perform a physical acquisition</em></span> (not logical/backup acquisition).</p><p>Finally, another interesting folder is <code class="literal">Library/Application Support/Dropbox/&lt;hex_ID&gt;/Account/contact_cache/</code>, where two very interesting json files, among others, are present:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">me</code>: This contains information about the account holder such as name, surname, and e-mail address registered with the current account.</li><li class="listitem" style="list-style-type: disc"><code class="literal">all_searchable</code>: This contains account information such as name, surname, and e-mail address of every accounts the user has ever shared a file with. This list also has historical records referring to account the user does not currently share files with anymore, but have done so in the past.</li></ul></div></div><div class="section" title="Google Drive"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl4sec1"/>Google Drive</h3></div></div></div><p>The Google Drive iOS App is in <code class="literal">/private/var/mobile/Containers/Data/Application/F86EB4B3-5DB1-4C72-B576-546694440A5D/</code>. The folder structure is the usual, with <code class="literal">Documents</code> and <code class="literal">Library</code>, being the main folders where you can find interesting artifacts. More specifically, within <code class="literal">Documents/drivekit/users/&lt;user_ID&gt;/cello/cello.db</code>, you will find the database containing information about the Drive folders structure, files accessed, files moved to the Bin (with the timestamp) or definitely deleted (without the timestamp of when it happened), and so on, as well as a copy of the files saved into <span class="strong"><strong>My Drive</strong></span> or as <span class="strong"><strong>Available Offline</strong></span>.</p><p>The <code class="literal">Library/Caches/com.google.commmon.SSO/&lt;user_ID&gt;/</code> folder contains, among others, the <code class="literal">Profile.plist</code> file that, as the name suggests, shows where the used information is stored such as name, surname, username, and e-mail address.</p></div></div></div>
<div class="section" title="Deleted data recovery"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec54"/>Deleted data recovery</h1></div></div></div><p>In this section, we will give you a quick overview on the difficulties of performing file carving operations on an iOS device and will help you understand why and what are the possibilities. We will also see the particular case of recovering the SQLite deleted records.</p><div class="section" title="File carving - is it feasible?"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec66"/>File carving - is it feasible?</h2></div></div></div><p>Apple uses a technology called <span class="strong"><strong>Data Protection</strong></span> in order to further protect data stored in flash memory on iDevices. Every time a file is created, a new 256-bit <span class="emphasis"><em>per-file key</em></span> is generated and it is used to encrypt the file content using AES encryption. The <span class="emphasis"><em>per-file key</em></span> is then wrapped with one of the data protection class keys and then stored in the file's metadata, which is in turn encrypted with the filesystem key (the <span class="strong"><strong>EMF key</strong></span>), which is generated from the unique hardware UID. The following diagram, which is taken directly from the Apple iOS Security official paper (last update on May 2016, refer to <a class="link" href="apa.html" title="Appendix A. References">Appendix A</a>, <span class="emphasis"><em>References</em></span>), summarizes the entire process:</p><div class="mediaobject"><img src="graphics/image_06_013.jpg" alt="File carving - is it feasible?"/></div><p>With this premise, it is clear that the classic file carving procedure will not work, since in the unallocated space there will only be encrypted content. An interesting approach on how to carve deleted images from the iOS devices has been published by D'Orazio and others (refer to <a class="link" href="apa.html" title="Appendix A. References">Appendix A</a>, <span class="emphasis"><em>References</em></span>). What they suggest is to exploit the journaling feature of the iOS filesystem, HFS+. In fact, by analyzing and comparing both the catalog and journal files of the HFS+ filesystem, it could be possible to identify information about deleted files, such as file and metadata locations, their timestamp, and so on. Based on this information from the journal, the analyst should be able to search and recover the deleted files, locate the cryptography keys, and then decrypt the image file. Heather Mahalik (her Twitter handle is <code class="literal">@HeatherMahalik</code>) also describes a similar approach in her book, <span class="emphasis"><em>Practical Mobile Forensics</em></span>, by <span class="emphasis"><em>Heather Mahalik</em></span>, published by <span class="emphasis"><em>Packt Publishing</em></span>. Of course, such approaches require physical acquisition to be possible for the target device.</p><p>However, that approach may work only if the device has not been restored, wiped, or upgraded to a new OS version, because in such cases, the filesystem key (EMF) would be erased and a new key recreated. Therefore, without the original EMF key, all contents in the unallocated space referring to a period prior to the restoring/wiping/upgrading is gone forever.</p></div><div class="section" title="Carving SQLite deleted records"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec67"/>Carving SQLite deleted records</h2></div></div></div><p>We will not go into the details of the SQLite structure (for more information, refer to <a class="link" href="apa.html" title="Appendix A. References">Appendix A</a>, <span class="emphasis"><em>References</em></span>), since it is out of the scope of this book. However, it is important for you to know that other than deleted files, it is also possible to recover deleted records within the SQLite databases. Mari DeGrazia (her Twitter handle is <code class="literal">@maridegrazia</code>) has developed a useful Python script that parses the database file and carves out deleted entries. Its usage is as simple as running a single-line command as follows:</p><pre class="programlisting">
<span class="strong"><strong>$ python sqlparse.py -f mmssms.db -r -o report.txt</strong></span>
</pre><p>You can find it on her website and GitHub repository; she has also provided a GUI version of the tool (refer to <a class="link" href="apa.html" title="Appendix A. References">Appendix A</a>, <span class="emphasis"><em>References</em></span>, and <a class="link" href="apb.html" title="Appendix B. Tools for iOS Forensics">Appendix B</a>, <span class="emphasis"><em>Tools for iOS Forensics</em></span>). Moreover, it is always useful to run a <code class="literal">strings</code> command on the database file as well. You may be able to recover a portion of deleted entries content that may have been missed by the tools.</p></div></div>
<div class="section" title="Case study - iOS analysis with Oxygen Forensics"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec55"/>Case study - iOS analysis with Oxygen Forensics</h1></div></div></div><p>The acquisition of an iPhone made using Oxygen Forensics can be analyzed directly within the same tool. In fact, during the acquisition, all the files are parsed by the software, which offers the user a complete GUI to access and search for information in the data. The following screenshot used to show the different functionalities of the software, refers to a logical classic type of acquisition from an iPhone 6s with iOS 9.3. Some descriptions of the features of the Oxygen Forensics Suite have been taken directly from the vendor website at <a class="ulink" href="http://www.oxygen-forensic.com">http://www.oxygen-forensic.com</a>.</p><p>The following screenshot summarizes the main information related to the acquired device model, operating system version, serial number, acquisition type, extraction date, investigator name, case number, and evidence number:</p><div class="mediaobject"><img src="graphics/image_06_014.jpg" alt="Case study - iOS analysis with Oxygen Forensics"/></div><p>Moreover, two separate areas are also present, the first one refers to <span class="strong"><strong>Common sections</strong></span>, that is the information related to native applications and to the grouping functionalities offered by the software; the second one refers to the activities of the main applications installed on the device by the user.</p><div class="mediaobject"><img src="graphics/image_06_015.jpg" alt="Case study - iOS analysis with Oxygen Forensics"/></div><p>The analysis of native applications lets the analyst recover much information, such as the phonebook with assigned photos, calendar events and notes, call log (FaceTime, dialed, received, and missed calls), messages (SMS/MMS and iMessages), and voicemail. The following screenshot shows an example of a call history:</p><div class="mediaobject"><img src="graphics/5100_06_16.jpg" alt="Case study - iOS analysis with Oxygen Forensics"/></div><p>Moreover, with the Oxygen Forensics Suite, it is possible to recover information related to Wi-Fi access points, IP connections, and locations. The following screenshot shows the details of Wi-Fi networks stored in the device under analysis. For each network, the SSID, MAC address of the router/access point, and the connection timestamps (last joined time and last auto joined time) are listed. From websites such as <a class="ulink" href="https://www.wigle.net/">https://www.wigle.net/</a>, it is possible to trace the MAC addresses and find the physical position of where the device was.</p><div class="mediaobject"><img src="graphics/5100_06_17.jpg" alt="Case study - iOS analysis with Oxygen Forensics"/></div><p>Regarding the analysis of the applications installed by the user, the software extracts and interprets both databases and configuration files (usually in the <code class="literal">plist</code> format) for the most common applications present on the Apple Store. These applications are split in the following categories:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Messengers</strong></span>: Facebook, Skype, WhatsApp, Viber, Telegram, Facebook Messenger, ChatON, Fring, Kakao Talk, Tango, WeChat, Yahoo, Google Hangouts, KiK Messenger, QQ, testPlus, Line, and so on</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Navigations</strong></span>: Google Maps, Apple Maps, Waze, and so on</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Browser</strong></span>: Safari, Google Chrome, Mercury, Dolphin, Yandex, and so on</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Social networks</strong></span>: Facebook, LinkedIn, Twitter, Instagram, Google+, Tinder, Grindr, Foursqare, Snapchat, Vkontakte, Pokemon Go, and so on</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Travel</strong></span>: Booking, SkyScanner, TripAdvisor, and so on</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Productivity business</strong></span>: Google Drive, Dropbox, Google Mail, OneDrive, Yahoo Mail, iBooks, and so on</li></ul></div><p>The following screenshot shows an example of Kik Messenger analysis:</p><div class="mediaobject"><img src="graphics/5100_06_18.jpg" alt="Case study - iOS analysis with Oxygen Forensics"/></div><p>Finally, the software offers advanced functionalities for cross-searching data as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Aggregated Contacts</strong></span>: This section analyzes the contacts from multiple sources such as the Phonebook, Messages, Event Log, Skype, chat, and messaging applications in <span class="strong"><strong>Aggregated Contacts</strong></span>. This section automatically reveals the same people in different sources and groups them in one metacontact.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Dictionaries</strong></span>: This section shows all the words ever entered in device messages, notes, and calendars.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Links and Stats</strong></span>: This section reveals social connections between users of mobile devices under investigation and their contacts. The <span class="strong"><strong>Links and Stats</strong></span> section provides a tool to explore social connections between device users by analyzing calls, text, multimedia and e-mail messages, and Skype activities.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Timeline</strong></span>: This section organizes all calls, messages, calendar events, geo data, and other activities in a chronological way, so that the analyst can follow the conversation history without the need to switch between different sections.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Social Graph</strong></span>: This section is a workplace that allows the analyst to review connections between mobile device owners and their contacts, pinpoint connections between multiple device owners, and detect their common contacts.</li></ul></div><p>Other than the automated analysis, the Oxygen Forensics Suite also offers the ability to navigate inside the filesystem and view all the different file types (documents, images, videos, and audio). There are also two embedded tools to view SQLite databases and <code class="literal">plist</code> files. The first one also offers the possibility to recover deleted records from databases, therefore, giving the possibility to retrieve calls, messages, photo thumbnails, contact photos, applications databases, and so on.</p><p>The use of this software also made it very easy for users not having high technical skills. It allows performing searches of keywords in a very intuitive way, also applying filters on every field of the application analyzed. Finally, it also allows exporting findings and it automatically generates a report in different formats (Word, Excel, PDF, HTML, and so on).</p><p>A detailed list of the feature available for the iOS devices can be found at <a class="ulink" href="http://www.oxygen-forensic.com/en/compare/devices/software-for-iphone">http://www.oxygen-forensic.com/en/compare/devices/software-for-iphone</a>.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec56"/>Summary</h1></div></div></div><p>In this chapter, we showed how to approach the analysis of both native iOS applications that come with every iOS device, and third-party applications. We saw some of the most common applications, but the approach is the same for any other. The importance of being able to parse the <code class="literal">plist</code> files and SQLite databases, and to carve out deleted records from the latter also became clear, since these are the two main data structures an analyst will have to deal with in every analysis. Last but not least, this chapter provided you with a good amount of locations of interesting forensics artifacts, as well as tools to analyze them. Remember that in-depth analysis, references, and tools are available at <a class="link" href="apa.html" title="Appendix A. References">Appendix A</a>, <span class="emphasis"><em>References</em></span>, and <a class="link" href="apb.html" title="Appendix B. Tools for iOS Forensics">Appendix B</a>, <span class="emphasis"><em>Tools for iOS Forensics</em></span>.</p><p>The next chapter is dedicated to the analysis of mobile applications, whether they are malicious/suspicious or not. We will go through the setup of an analysis environment and then learn the application analysis principle, which will allow you to analyze the complete behavior of a mobile application.</p></div>
<div class="section" title="Self-test questions"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec57"/>Self-test questions</h1></div></div></div><p>Q1. In which iOS folder is most of the user's information of interest saved?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><code class="literal">/private/var/mobile/</code></li><li class="listitem"><code class="literal">/Users/mobile/</code></li><li class="listitem"><code class="literal">/private/var/user/mobile/</code></li><li class="listitem"><code class="literal">/private/user/mobile/</code></li></ol></div><p>Q2. Which is the timestamp convention used in iOS?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">UNIX Epoch Time</li><li class="listitem">Apple Time</li><li class="listitem">Windows Time</li><li class="listitem">MAC Absolute Time</li></ol></div><p>Q3. What does the file <code class="literal">/private/var/root/Library/Lockdown/data_ark.plist</code> contain?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Last store search</li><li class="listitem">Information about the device and about its account holder</li><li class="listitem">List of installed applications</li><li class="listitem">Password saved in the iDevice</li></ol></div><p>Q4. In which file is the information related to the SIM card used in the iDevice stored?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><code class="literal">ClearedSections.plist</code></li><li class="listitem"><code class="literal">com.apple.network.identification.plist</code></li><li class="listitem"><code class="literal">com.apple.commcenter.plist</code></li><li class="listitem"><code class="literal">com.apple.springboard.plist</code></li></ol></div><p>Q5. What is the name of the database containing the user address book?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><code class="literal">AddressBook.db</code></li><li class="listitem"><code class="literal">AddressBook.sqlited</code>b</li><li class="listitem"><code class="literal">AddressBook.sqlite</code></li><li class="listitem"><code class="literal">AB.db</code></li></ol></div><p>Q6. In which folder is the call history saved?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><code class="literal">/private/var/CallHistory</code></li><li class="listitem"><code class="literal">/private/var/wireless/Library/CallHistory/</code></li><li class="listitem"><code class="literal">/private/var/wireless/Library/CallHistoryDB/</code></li><li class="listitem"><code class="literal">/private/var/Library/CallHistory/</code></li></ol></div><p>Q7. What kind of file is used to store Safari browsing history?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">SQLite</li><li class="listitem">Txt</li><li class="listitem">Plist</li><li class="listitem">HTML</li></ol></div><p>Q8. How is the file containing the keyboard cache used for auto correction and auto completion called?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><code class="literal">UserDictionary.txt</code></li><li class="listitem"><code class="literal">Dict.dat</code></li><li class="listitem"><code class="literal">Dynamic-Text.dat</code></li><li class="listitem"><code class="literal">Text.dat</code></li></ol></div></div></body></html>