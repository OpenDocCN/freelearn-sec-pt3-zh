<html><head></head><body>
		<div><h1 id="_idParaDest-15" class="chapter-number"><a id="_idTextAnchor014"/>1 </h1>
			<h1 id="_idParaDest-16"><a id="_idTextAnchor015"/>Cybercrime, APT Attacks, and Research Strategies</h1>
			<p>Our modern world relies more and more on IT systems of various kinds. Being able to control them, as well as the information they may contain and process, is a strong power that attracts various types of criminals.</p>
			<p>In this chapter, we are going to discuss the evolution of the cybercrime landscape up until now and the role of malware analysis in fighting it. Then we will dive into various types of attacks and associated malware to get an idea of possible attack stages and the logic behind them. In addition, we will learn different research strategies and approaches universal to all platforms that help malware analysts do their job, from collecting relevant telemetry and samples to performing <strong class="bold">Reverse Engineering</strong> (<strong class="bold">RE</strong>) tasks and answering specific questions.</p>
			<p>In this chapter, the following topics will be covered:</p>
			<ul>
				<li>Why malware analysis?</li>
				<li>Exploring types of malware</li>
				<li>The MITRE ATT&amp;CK framework explained</li>
				<li>APT and zero-day attacks and fileless malware</li>
				<li>Choosing your analysis strategy</li>
				<li>Setting up the environment</li>
			</ul>
			<h1 id="_idParaDest-17"><a id="_idTextAnchor016"/>Why malware analysis?</h1>
			<p>Cyberattacks are undoubtedly <a id="_idIndexMarker000"/>on the rise, targeting governments, the military, and the public and private sectors. The actors behind them may have numerous motivations, such as exfiltrating valuable information as part of espionage campaigns, gaining money by various means such as demanding ransoms, or damaging assets and reputations as a form of sabotage. </p>
			<p>The growing dependency on digital systems, which accelerated immensely during the COVID-19 pandemic, also led to a massive increase in malware and particularly ransomware-related incidents in recent years.</p>
			<p>With adversaries becoming more and more sophisticated and carrying out increasingly advanced malware attacks, being able to quickly detect and respond to such intrusions is critical for cyber security professionals, and the knowledge, skills, and tools required to analyze malicious software are essential for the efficient performance of such tasks. </p>
			<p>In this section, we will discuss your potential impact as a malware analyst in fighting cybercrime by responding to such attacks, hunting for new threats, creating detections, or producing threat intelligence information to get your and other organizations better prepared for the upcoming threats.</p>
			<h2 id="_idParaDest-18"><a id="_idTextAnchor017"/>Malware analysis in collecting threat intelligence</h2>
			<p>Threat intelligence (aka cyber threat intelligence, commonly abbreviated as threat intel or CTI) is information, usually<a id="_idIndexMarker001"/> in the form of <strong class="bold">Indicators of Compromise</strong> (<strong class="bold">IoCs</strong>), that the cybersecurity<a id="_idIndexMarker002"/> community uses to identify and match threats. It serves multiple purposes, including attack detection and prevention, as well as attribution, allowing researchers to join up the dots and identify current and future threats that might originate from the same attacker. Examples of IoCs include sample hashes (most commonly MD5, SHA-1, and SHA-256) and network artifacts (primarily, domains, IP addresses, and URLs). There are multiple ways in which IoCs are exchanged within the community, including dedicated sharing<a id="_idIndexMarker003"/> programs and publications. <strong class="bold">Indicators of Attack</strong> (<strong class="bold">IoAs</strong>) are also commonly used to describe anomalous behavior very likely associated with malicious activity. A good example is a machine in a <strong class="bold">demilitarized zone</strong> (<strong class="bold">DMZ</strong>) that suddenly starts communicating with multiple internal hosts. As we <a id="_idIndexMarker004"/>can see, unlike raw IoCs that require additional context, IOAs more often reveal the intention behind the attack and can therefore be easily <a id="_idIndexMarker005"/>mapped to particular <strong class="bold">tactics, techniques, and procedures</strong> (<strong class="bold">TTPs</strong>).</p>
			<p>Malware analysis provides a very accurate and comprehensive list of IoCs compared to other methods such as log analysis or digital forensics. Some of these IoCs may be very difficult to identify using<a id="_idIndexMarker006"/> other digital investigation or forensics methods. For example, they might include a specific page, post, or an account on a legitimate website, such as Twitter, Dropbox, or others. Tracking down these IoCs can eventually help in taking down the corresponding malicious campaign faster.</p>
			<p>Malware analysis also adds invaluable context as to what each IoC represents and what it means if it is detected within an organization. Understanding this context may help in prioritizing the corresponding events.</p>
			<h2 id="_idParaDest-19"><a id="_idTextAnchor018"/>Malware analysis in incident response</h2>
			<p>Once an attack is<a id="_idIndexMarker007"/> detected within an organization, an incident response process<a id="_idIndexMarker008"/> is kicked off. It starts with containment of the infected machines and a forensic investigation aimed at understanding the cause and impact of malicious activities to follow the right remediation and prevention strategy.</p>
			<p>When malware is identified, the malware analysis process starts. First, it generally involves finding all the IoCs involved, which can help discover other infected machines or compromised assets and find any other related malicious samples. Second, malware analysis helps in understanding the capabilities of the payload. Does the malware spread across the network? Does it steal credentials and other sensitive information or include an exploit for an unpatched vulnerability? All this information helps evaluate the impact of the attack more precisely and find appropriate solutions to prevent it from happening in the future.</p>
			<p>Apart from that, malware analysis may help in decrypting and understanding the network communications that have occurred between the attacker and the malware on the infected machine. Some enterprise<a id="_idIndexMarker009"/> network security products, such as <strong class="bold">Network Detection Responses</strong> (<strong class="bold">NDRs</strong>), can record suspicious network traffic for later investigation. Decrypting this communication may allow the malware analysis and incident response teams to understand the attacker’s motivations and more precisely identify the compromised assets and stolen data.</p>
			<p>So, as you see, malware <a id="_idIndexMarker010"/>analysis plays an important role in responding to cyberattacks. It can involve a separate team within the organization or an<a id="_idIndexMarker011"/> individual within the incident response team equipped with the relevant malware analysis skills.</p>
			<h2 id="_idParaDest-20"><a id="_idTextAnchor019"/>Malware analysis in threat hunting</h2>
			<p>In contrast to incident<a id="_idIndexMarker012"/> response, threat hunting involves an active search for IOAs. It can be more proactive, taking place before the security alert has been triggered, or reactive, addressing an existing concern. Understanding possible attackers’ tactics and techniques is crucial in this case as it allows cybersecurity professionals to get a higher-level view and navigate the potential attack surface more efficiently. A great advancement in this area was the creation of the MITRE ATT&amp;CK framework, which we are going to cover in greater detail later.</p>
			<p>Malware analysis knowledge helps cybersecurity engineers to be more professional threat hunters who understand the attackers’ techniques and tactics on a deeper level and who are fully aware of the context. In particular, it helps understand how exactly the attacks may be<a id="_idIndexMarker013"/> implemented, for example, how the malware may communicate with the attacker/<strong class="bold">Command and Control</strong> (<strong class="bold">C&amp;C</strong>) server, disguise itself to bypass defenses, steal credentials and other sensitive information, escalate privileges, and so on, which will guide the threat-hunting process. Armed with this knowledge, you will better understand how to hunt efficiently for these techniques in the logs or in the systems’ volatile and non-volatile artifacts.</p>
			<h2 id="_idParaDest-21"><a id="_idTextAnchor020"/>Malware analysis in creating detections</h2>
			<p>Multiple companies across the<a id="_idIndexMarker014"/> world develop and distribute cybersecurity systems to protect their customers against all types of threats. There are multiple approaches to detecting malicious activity at different stages of the attack, for example, monitoring network traffic, exploring system logs and registry entries, or checking files both statically and during the execution. In many cases, it involves some sort of rules or signatures to be developed to distinguish malicious patterns from benign ones. Malware analysis is irreplaceable in this case as it allows security professionals to identify such patterns and create robust rules that don’t generate false positives.</p>
			<p>In the next section, we<a id="_idIndexMarker015"/> will discuss how malware can be classified depending on its functionality.</p>
			<h1 id="_idParaDest-22"><a id="_idTextAnchor021"/>Exploring types of malware</h1>
			<p>In this section, we <a id="_idIndexMarker016"/>are going to discuss why malware exists in general, what makes it different from other computer programs, and what different varieties we can encounter in the wild.</p>
			<h2 id="_idParaDest-23"><a id="_idTextAnchor022"/>A short history of malware development</h2>
			<p>Before the rise of <a id="_idIndexMarker017"/>personal computers, only a very limited number of software developers existed. Their goal was to make maximum use of the hardware available at that time to make people’s lives better, whether it was software for accounting, sending a man into space, or gaming. Rapidly developing networking connected multiple machines to each other and enabled machines and people to communicate over long distances. Around the same time, with the further spread of computers, making them more affordable to the general public, the first hacking communities started evolving around the globe. However, it was the academic sector where one of the most infamous incidents of malware with significant impact emerged – the Morris worm. It was capable of propagating via networks to other machines exploiting several vulnerabilities, mainly in the <code>sendmail</code> and <code>fingerd</code> software. However, the worm wasn’t checking whether the targeted machine was already infected or not and this way spawned multiple copies of itself on each machine, quickly consuming all the victim’s system resources and making them unusable. Created just for the sake of pure interest, it showed the world what consequences several lines of code could bring and led to the first-ever conviction for malware development. Many other types of malware began to emerge after this. The main goal of the authors at that time was to demonstrate their skills within the community.</p>
			<p>Later, the focus slowly started shifting toward making money. Programming became more and more popular, being taught at schools and universities, and the creation of new high-level programming languages made it easier for less experienced people to start writing their own code, including malicious code. Finally, professional cybercrime gangs began to emerge with a clear separation of responsibilities, making malware development a very lucrative organized illegal activity. These groups utilized all possible ways of money laundering available including, at first, money mules and later switching to cryptocurrencies to avoid <a id="_idIndexMarker018"/>tracing and subsequent arrests. These groups are generally called financially motivated actors.</p>
			<p>In the last few years, the focus of financially motivated groups gradually shifted from attacking the consumers to attacking big organizations and making big money in a single place. The most common example is the use of ransomware to encrypt victims’ files before demanding a ransom to restore access. In many cases, a double-extortion scheme is used, where the criminals also threaten to release sensitive materials to the public.</p>
			<p>Governments also started<a id="_idIndexMarker019"/> looking for possibilities to use malware for cyber espionage and sabotage purposes. It was the Stuxnet attack that really brought the public’s attention to its existence and its initial devastating capabilities. The malware-developing groups involved in this process are generally state-sponsored. Apart from this, there are companies that openly develop and sell advanced surveillance malware to governments. Examples include NSO Group, selling the Pegasus threat; Hacking Team with Da Vinci and Galileo platforms; and Lench IT Solutions (part of Gamma Group), selling FinFisher spyware.</p>
			<p>It is no surprise that malware follows the most commonly used platforms to have the best coverage possible. Therefore, it is Windows-based malware that is still most prevalent for workstations. In the mobile market, Android remains the market leader and thus is targeted by the biggest number of <a id="_idIndexMarker020"/>malware families. Finally, <strong class="bold">Internet of Things</strong> (<strong class="bold">IoT</strong>) malware is also on the rise, targeting historically less-protected smart devices (mostly Linux-based). And of course, it doesn’t mean that if a platform is less common it is more secure and malware-free.</p>
			<h2 id="_idParaDest-24"><a id="_idTextAnchor023"/>Malware categories</h2>
			<p>Malware categories are<a id="_idIndexMarker021"/> generally defined by either an impact or a propagation method. Different antivirus companies may use slightly different logic in defining or naming them. Here are some of the most common examples:</p>
			<ul>
				<li><strong class="bold">Trojan:</strong> The most <a id="_idIndexMarker022"/>universal malware category, simply defined by its performing of malicious <a id="_idIndexMarker023"/>activities in the unaware user’s environment, named for the legendary Trojan Horse used to conquer the city of Troy:<ul><li><strong class="bold">Downloader:</strong> The main goal<a id="_idIndexMarker024"/> here is to download and somehow execute<a id="_idIndexMarker025"/> the external payload (either explicitly or by adding it to autorun).</li><li><strong class="bold">Dropper:</strong> Here, additional <a id="_idIndexMarker026"/>payloads are not downloaded but extracted<a id="_idIndexMarker027"/> from the Trojan’s body.</li><li><strong class="bold">Backdoor</strong>, as known<a id="_idIndexMarker028"/> as <strong class="bold">Remote Access Trojan</strong> (<strong class="bold">RAT</strong>): In this case, the <a id="_idIndexMarker029"/>malware may receive<a id="_idIndexMarker030"/> remote commands to perform a range of actions.</li><li><strong class="bold">Ransomware:</strong> Here, attackers <a id="_idIndexMarker031"/>prevent users from performing their daily activities and demand a ransom to restore them. This can be done by<a id="_idIndexMarker032"/> various means, usually by either locking the whole system or locking access to particular files within it. Another <a id="_idIndexMarker033"/>common scenario when targeting individuals is accusing them of some criminal deed and demanding a “fine” to be paid, threatening escalation or public announcement in the case of non-compliance.</li><li><strong class="bold">Infostealer, aka</strong> <strong class="bold">Password Stealer</strong> (<strong class="bold">PWS</strong>): The main goal here is to steal sensitive information, such<a id="_idIndexMarker034"/> as saved<a id="_idIndexMarker035"/> credentials of any kind (from other machines, financial organizations, social networks, email and instant messenger accounts, videogames, and so on).</li><li><strong class="bold">Spyware</strong>: While spyware’s purpose is quite similar to infostealer’s, this category is broader and <a id="_idIndexMarker036"/>may also include video and audio recording <a id="_idIndexMarker037"/>capabilities or tracking the victim’s location with GPS.</li><li><strong class="bold">Banker</strong>: This category may<a id="_idIndexMarker038"/> commonly fall into the infostealer one but has a<a id="_idIndexMarker039"/> narrower purpose and bigger scope of potential functionality. Here, malware may be strongly focused on gaining access to money, so it can also support intercepting one-time tokens sent by the bank as part of <strong class="bold">two-factor authentication</strong> (<strong class="bold">2FA</strong>), modifying financial information to<a id="_idIndexMarker040"/> redirect payments, or injecting scripts to intercept entered banking credentials.</li><li><strong class="bold">DoS</strong>: The main <a id="_idIndexMarker041"/>goal here is <strong class="bold">Denial of Service</strong> (<strong class="bold">DoS</strong>), making the target<a id="_idIndexMarker042"/> system or service<a id="_idIndexMarker043"/> unusable; it is commonly used for sabotage, hacktivism, or vandalism purposes.</li><li><strong class="bold">Wiper</strong>: Here, malware is <a id="_idIndexMarker044"/>used to delete information that is either sensitive or <a id="_idIndexMarker045"/>critical to the system’s operation, making it another tool for a DoS attack.</li><li><strong class="bold">DDoS</strong>: In this case, a <strong class="bold">Distributed Denial of Service</strong> (<strong class="bold">DDoS</strong>) attack is launched, where<a id="_idIndexMarker046"/> multiple bots <a id="_idIndexMarker047"/>attack the victim via the network.</li><li><strong class="bold">Spammer, aka</strong> <strong class="bold">spambo:</strong> This threat <a id="_idIndexMarker048"/>can send spam on behalf <a id="_idIndexMarker049"/>of the victim.</li><li><strong class="bold">Clicker</strong>: Here, attackers <a id="_idIndexMarker050"/>may simulate real user clicks to get money from <a id="_idIndexMarker051"/>advertisements, search engine poisoning, or promoting fake accounts.</li><li><strong class="bold">Miner</strong>: In this case, the<a id="_idIndexMarker052"/> unwitting victim’s machine is used to mine<a id="_idIndexMarker053"/> cryptocurrencies, spending the machine’s precious resources.</li><li><strong class="bold">Packed</strong>: Not referring to the <a id="_idIndexMarker054"/>actual purpose of the associated threat, this detection<a id="_idIndexMarker055"/> name generally means that the corresponding sample is protected with some malicious packer.</li><li><strong class="bold">Injector</strong>: Not referring to the actual <a id="_idIndexMarker056"/>purpose of the threat, it means that the <a id="_idIndexMarker057"/>corresponding sample uses process injection for some reason (see the dedicated <a href="B18500_05.xhtml#_idTextAnchor446"><em class="italic">Chapter 5</em></a>, <em class="italic">Inspecting Process Injection and API Hooking,</em> for more information about potential use cases).</li></ul></li>
				<li><strong class="bold">Worm:</strong> This <a id="_idIndexMarker058"/>category of threat is defined by the ability to self-propagate<a id="_idIndexMarker059"/> between different machines. There are multiple variants of worms depending on the protocol (for example, IRC) or media (instant messenger, email, and so on) they utilize to propagate.</li>
				<li><strong class="bold">Virus</strong>: Unlike<a id="_idIndexMarker060"/> worms propagating between machines, the main goal of a file infector is to propagate within the current system by infecting other <a id="_idIndexMarker061"/>executables and documents. In this case, when the victim opens/launches a legitimate file, control is also given to the malicious code. There are several variants of how it can be used, from actually writing malicious code and data into executables and adding macro templates to documents to simply replacing victim files with their own body and storing a copy of an original file elsewhere to execute it later.</li>
				<li><strong class="bold">Rootkit</strong>: Nowadays, this name<a id="_idIndexMarker062"/> doesn’t have a single definition. Originally used to define tools elevating<a id="_idIndexMarker063"/> privileges (giving root access), it is most commonly used now to define threats that are either used to hide other ones or simply operate in the kernel mode. More information can be found in <a href="B18500_07.xhtml#_idTextAnchor669"><em class="italic">Chapter 7</em></a>, <em class="italic">Understanding Kernel-Mode Rootkits</em>.</li>
				<li><strong class="bold">Bootkit:</strong> Such threats<a id="_idIndexMarker064"/> insert themselves into the booting process (for example, by modifying <a id="_idIndexMarker065"/>the boot sector or boot loader) to gain access before the operating system.</li>
				<li><strong class="bold">Exploit:</strong> Here, malware <a id="_idIndexMarker066"/>abuses a vulnerability<a id="_idIndexMarker067"/> in the <a id="_idIndexMarker068"/>victim software to achieve its goal (elevate privileges, access sensitive information, perform <strong class="bold">arbitrary code execution</strong> (<strong class="bold">ACE</strong>), and so on). See <a href="B18500_08.xhtml#_idTextAnchor811"><em class="italic">Chapter 8</em></a>, <em class="italic">Handling Exploits and Shellcode,</em> to get more<a id="_idIndexMarker069"/> information about exploits.</li>
				<li><strong class="bold">FakeAV:</strong> This category <a id="_idIndexMarker070"/>of threats shows users various warnings about<a id="_idIndexMarker071"/> allegedly critical problems with their systems and aggressively demands that the “full version” of itself is bought to remediate it.</li>
				<li><strong class="bold">Hoax</strong>: Usually created <a id="_idIndexMarker072"/>as a joke or an act of hooliganism, this category<a id="_idIndexMarker073"/> of threats aims at simply scaring the user about some “critical” but actually non-existent problem.</li>
				<li><strong class="bold">PUAs:</strong> Standing for <strong class="bold">Potentially Unwanted Applications</strong>, these threats generally involve less<a id="_idIndexMarker074"/> devastating but still annoying activity, such <a id="_idIndexMarker075"/>as silently installing legitimate but unrequested applications.</li>
				<li><strong class="bold">Adware:</strong> Here, the <a id="_idIndexMarker076"/>threat displays non-requested advertisements<a id="_idIndexMarker077"/> to victims, in many cases aggressively and without an easy way to remove them.</li>
				<li><strong class="bold">Hacktool</strong>: This is a big<a id="_idIndexMarker078"/> category involving multiple tools that can be<a id="_idIndexMarker079"/> used by both attackers and cybersecurity professionals, for example, for red teaming purposes.</li>
				<li><code>psexec</code> tool by Sysinternals, which can be used to execute commands on remote machines, and various remote administration tools.</li>
			</ul>
			<p>In many cases, samples fall into multiple categories. For example, one sample can propagate as a worm by stealing credentials and downloading additional payloads, while another sample may execute custom commands like a backdoor; the list of commands will include infostealing capabilities, elevating privileges by using an exploit, and organizing DDoS attacks. The choice of the final single category is generally dictated by each antivirus company’s policy, where some categories are prioritized over others, usually based on the potential impact.</p>
			<p>Sometimes, the software may fall into the so-called grayware category. In this case, it may not be completely clear whether this software is legitimate or malicious. Examples are some forms of PUAs and adware software or FakeAV-style security programs offering extremely little benefit compared to the price demanded. Usually, it is up to each antivirus company to decide what should be detected as a virus.</p>
			<h2 id="_idParaDest-25"><a id="_idTextAnchor024"/>Naming conventions</h2>
			<p>Unfortunately, the cybersecurity community has not agreed on a single universal convention to name malicious <a id="_idIndexMarker082"/>samples and each antivirus vendor is free to use its own notation. Generally, the detection name will include the targeted platform, the malware category and family, and sometimes the version and the detection technology. Here are the detection names used by different vendors for the same malware sample 9e0a15a4318e3e788bad61398b8a40d4916d63ab27b47f3bdbe329c462193600 based on <strong class="bold">VirusTotal</strong> results:</p>
			<ul>
				<li>Avast: <em class="italic">ELF:CVE-2017-17215-A [Expl]</em></li>
				<li>DrWeb: <em class="italic">Linux.Packed.1037</em></li>
				<li>Kaspersky Lab:<em class="italic"> HEUR:Backdoor.Linux.Mirai.b</em></li>
				<li>Microsoft: <em class="italic">Trojan:Win32/Ceevee</em></li>
				<li>Sophos: <em class="italic">Linux/DDoS-CI</em></li>
				<li>Symantec: <em class="italic">Trojan.Gen.NPE</em></li>
			</ul>
			<p>As we can see here, different vendors commonly assign different names to the same malware family. Moreover, many companies have default names that they assign if identifying or creating the malware family name is too expensive or simply not worth it; examples are Agent, Generic, Gen, and others. In many cases, the situation also becomes complicated when the source code of some threat is leaked to the public, exchanged between hacker<a id="_idIndexMarker083"/> groups, or re-used in another project by the same author, resulting in the creation of threats that combine the code and functionality of multiple malware families. To choose a malware family name, follow the policy of your company or consider using the MITRE ATT&amp;CK notation, if you want something vendor-agnostic.</p>
			<h1 id="_idParaDest-26"><a id="_idTextAnchor025"/>The MITRE ATT&amp;CK framework explained</h1>
			<p>As we have<a id="_idIndexMarker084"/> mentioned before, different cybersecurity vendors commonly give different names to hacker groups and malware families. Therefore, knowledge exchange becomes more complicated, eventually affecting the performance of the community. The MITRE ATT&amp;CK framework was created to address this and other similar issues and let security experts speak the same language. This is a vendor-agnostic global knowledge base on various attack techniques grouped into tactics, which also provides examples of the attackers and malware utilizing them, giving the tactics widely accepted names.</p>
			<h2 id="_idParaDest-27"><a id="_idTextAnchor026"/>Basic terminology</h2>
			<p>Here are some of the most important terms used in this field:</p>
			<ul>
				<li><strong class="bold">Tactic</strong>: Represents a <a id="_idIndexMarker085"/>high-level goal of the attacker, a reason why the corresponding action is performed</li>
				<li><strong class="bold">Technique:</strong> The practical<a id="_idIndexMarker086"/> way in which the defined high-level goal is achieved</li>
				<li><strong class="bold">Sub-technique</strong>: A more detailed and granular description of how exactly a certain action is conducted</li>
				<li><strong class="bold">Procedure</strong>: An actual<a id="_idIndexMarker087"/> implementation of the technique/sub-technique</li>
				<li><strong class="bold">TTPs</strong>: Stands for<a id="_idIndexMarker088"/> tactics, techniques, and procedures: a summary of the methods used by attackers with an explanation of what is achieved by utilizing them</li>
				<li><strong class="bold">Group:</strong> Represents a set <a id="_idIndexMarker089"/>of related adversarial activities likely to be performed by a single entity known under this name</li>
				<li><strong class="bold">Mitigation</strong>: Technology <a id="_idIndexMarker090"/>and concepts that are used to circumvent or prevent an attack</li>
				<li><strong class="bold">Software</strong>: Code that can<a id="_idIndexMarker091"/> be used to conduct adversary actions, combining both publicly available tools and malware</li>
				<li><strong class="bold">Matrix:</strong> A combination <a id="_idIndexMarker092"/>of TTPs related to a particular industry secto</li>
			</ul>
			<p>There are several matrices<a id="_idIndexMarker093"/> within the framework for the enterprise, <strong class="bold">Industrial Control</strong> <strong class="bold">Systems</strong> (<strong class="bold">ICSs</strong>), and mobile<em class="italic"> </em>sectors. The most commonly used one is the Enterprise Matrix, so let’s talk about it in greater detail.</p>
			<h2 id="_idParaDest-28"><a id="_idTextAnchor027"/>Enterprise Matrix</h2>
			<p>At present, the Enterprise framework <a id="_idIndexMarker094"/>defines the following tactics:</p>
			<ul>
				<li><strong class="bold">Reconnaissance</strong>: This stage involves collecting relevant information about the victim to perform a<a id="_idIndexMarker095"/> successful attack, for example, about some organization’s infrastructure and personnel.</li>
				<li><strong class="bold">Resource development</strong>: Here, attackers<a id="_idIndexMarker096"/> establish all the required dependencies based on the collected information. This can be achieved by various means: buying/renting, creating, or stealing the prerequisites (for example, hosting or software).</li>
				<li><strong class="bold">Initial access</strong>: At this <a id="_idIndexMarker097"/>stage, attackers attempt to establish the first foothold within the victim’s environment. One of the most common examples of this tactic is sending spear-phishing messages (mainly emails).</li>
				<li><strong class="bold">Execution</strong>: Here, attackers execute code of any kind within the victim’s environment to achieve their <a id="_idIndexMarker098"/>goals.</li>
				<li><strong class="bold">Persistence</strong>: Includes everything attackers do to maintain their presence within the compromised <a id="_idIndexMarker099"/>environment. Common examples include adding malicious code to autorun or adding SSH keys to the list of authorized entries.</li>
				<li><strong class="bold">Privilege escalation</strong>: As the initial<a id="_idIndexMarker100"/> access is in many cases achieved by compromising low-access accounts, here, attackers attempt to gain higher-level permissions to have more control over the affected environment.</li>
				<li><strong class="bold">Defense evasion</strong>: The main goal of the attackers here is to avoid being detected until their objective is <a id="_idIndexMarker101"/>achieved. Examples include obfuscating malicious code or marking related files as hidden.</li>
				<li><strong class="bold">Credential access</strong>: This tactic<a id="_idIndexMarker102"/> involves stealing credentials to misuse them later. Some of the most common techniques here involve dumping saved credentials and intercepting them, for example, by logging pressed keys.</li>
				<li><strong class="bold">Discovery</strong>: Here, attackers <a id="_idIndexMarker103"/>collect information on the internals of the victim’s environment, starting with the network and the local systems. This information is generally used to facilitate other tactics, such as lateral movement.</li>
				<li><strong class="bold">Lateral movement</strong>: At this<a id="_idIndexMarker104"/> stage, attackers propagate upward to other machines until the systems of interest are reached.</li>
				<li><strong class="bold">Collection</strong>: Involves<a id="_idIndexMarker105"/> collecting various information of interest from the affected systems. Common examples include stealing proprietary source code and documents.</li>
				<li><strong class="bold">Command and control</strong>: This tactic covers the various ways attackers may remotely communicate with<a id="_idIndexMarker106"/> compromised systems.</li>
				<li><strong class="bold">Exfiltration</strong>: Techniques<a id="_idIndexMarker107"/> that attackers may utilize to actually move sensitive information out of the compromised environment.</li>
				<li><strong class="bold">Impact</strong>: Finally, this tactic <a id="_idIndexMarker108"/>describes other ways attackers may have a negative impact on compromised systems. Common examples include the manipulation, interruption, or destruction of critical systems and data.</li>
			</ul>
			<div><div><img src="img/Figure_1.1_B18500.jpg" alt="Figure 1.1 – Web representation of the MITRE ATT&amp;CK’s Enterprise Matrix&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.1 – Web representation of the MITRE ATT&amp;CK’s Enterprise Matrix</p>
			<p>It is worth mentioning that the framework is not static and constantly evolves, incorporating users’ feedback and addressing the new challenges the industry faces. Each version of the framework is shipped with a <strong class="bold">Structured Threat Information Expression</strong> (<strong class="bold">STIX</strong>) representation <a id="_idIndexMarker109"/>of itself: <a href="https://github.com/mitre-attack/attack-stix-data">https://github.com/mitre-attack/attack-stix-data</a>. It allows efficient integration with various software products and makes it possible to combine stability and efficiently oversee any changes introduced. STIX is a versatile format that is also commonly used by the cybersecurity community to exchange IoCs, where version 1 is XML-based and version 2 is JSON-based.</p>
			<h1 id="_idParaDest-29"><a id="_idTextAnchor028"/>APT and zero-day attacks and fileless malware</h1>
			<p>Here, we are going to explain the meaning of some terms commonly found in whitepapers and news articles related to malware.</p>
			<h2 id="_idParaDest-30"><a id="_idTextAnchor029"/>APT attack</h2>
			<p><strong class="bold">APT</strong> stands for <strong class="bold">Advanced Persistent Threat</strong>. Generally, malware receives such a title if the actors tailored it to <a id="_idIndexMarker110"/>target a particular entity, whether it was an organization or a particular individual. This means that the attackers chose a<a id="_idIndexMarker111"/> specific victim and won’t simply give up and go away if one approach doesn’t work. In addition, the threat should be relatively advanced – for example, it should have a complex structure, use non-standard techniques or zero-day exploits, and so on.</p>
			<p>Re-using IoCs for detection purposes in many cases is useless for APT malware as attackers register new network infrastructures and re-compile samples for each victim.</p>
			<p>In reality, there are no strict objective criteria to evaluate how advanced a particular threat is. As a result, news outlets and affected organizations often tend to overuse this term to make attacks look more sophisticated than they actually are. This way, pretty much anything that is either relatively new or has led to a successful breach can be called an APT.</p>
			<h2 id="_idParaDest-31"><a id="_idTextAnchor030"/>Zero-day attack</h2>
			<p>Many attacks involve the use of exploits targeting certain vulnerabilities to achieve particular goals, such as<a id="_idIndexMarker112"/> gaining initial access or performing privilege escalation. Usually, once the vulnerability becomes known to the public, the software vendor addresses the issue and releases a patch so that end users can update their systems and be protected against it. Zero-day attacks involve the use of zero-day exploits, which target vulnerabilities that were not previously known, thus defining a “day zero” upon which it happened. What that means for end users is that there is no solution for them to update the vulnerable systems and thereby address the threat. In this case, users are usually offered some partial workarounds to temporarily minimize the potential impact until the patch is ready, but they commonly have various drawbacks that affect the performance of the systems used.</p>
			<h2 id="_idParaDest-32"><a id="_idTextAnchor031"/>Fileless malware</h2>
			<p>There are many reasons for malware to stay below the radar. First, it assures that malware will successfully land in the victim environment and perform all the necessary attack stages. Second, it will <a id="_idIndexMarker113"/>complicate the detection and remediation process, prolonging the infection and increasing the chances of success.</p>
			<p><strong class="bold">Incident Response</strong> (<strong class="bold">IR</strong>) engineers use all possible places where malicious activity may be recorded to build up a<a id="_idIndexMarker114"/> full picture, efficiently eliminate the threat, and prevent the incident from happening again. The data science that this comprises is called digital forensics. As part <a id="_idIndexMarker115"/>of this, the analysts will collect various indicators throughout the system, including file artifacts.</p>
			<p>So-called fileless malware has emerged to prevent malicious activity and to bypass traditional antivirus products strongly focused on detecting malicious samples in the form of files. The idea here is that malicious code has no independent sample to detect and delete. Instead, the shell and inline script commands are used. An example of such a threat is Poweliks, which stores a malicious command in the registry key that provides autorun capabilities.</p>
			<p>With all the important terminology now clear, it is time to talk about how to approach new reverse-engineering tasks.</p>
			<h1 id="_idParaDest-33"><a id="_idTextAnchor032"/>Choosing your analysis strategy</h1>
			<p>Reverse engineering is<a id="_idIndexMarker116"/> a time-consuming process, and in many cases, there aren't the resources available to allow engineers to dive as deep as they would like to. Prioritizing the most important things and focusing on them will ensure that the best result is produced within the allocated time every time. Here is some advice that may help in this challenging task.</p>
			<h2 id="_idParaDest-34"><a id="_idTextAnchor033"/>Understand your audience</h2>
			<p>Depending on who is going to use<a id="_idIndexMarker117"/> the result of your work, the actionable deliverables may be very different. Examples of the potential use cases for reverse engineering include the following:</p>
			<ul>
				<li><strong class="bold">Threat intelligence</strong>: Here, the<a id="_idIndexMarker118"/> focus will be mainly on obtaining IoCs, such as hashes, filenames, and network artifacts. Therefore, extracting embedded payloads and downloading remote samples, as well as finding other related modules involved and extracting C&amp;C information from all of them, will likely be the top priority.</li>
				<li><strong class="bold">AV detection</strong>: In this case, the focus will be on anything unique enough to create a robust detection that doesn’t produce <strong class="bold">false positives</strong> (<strong class="bold">FPs</strong>). Examples are distinctive pieces<a id="_idIndexMarker119"/> of code and strings related to the malicious functionality and any custom encryption algorithms used. Understanding the main logic will help choose the right category, and code and data similarity will lead to assigning the malware family.</li>
				<li><strong class="bold">Technical article or conference presentation</strong>: Here, the most important part will be interesting novel technical<a id="_idIndexMarker120"/> details related to functionality, similarities with other malware families, and actor attribution.</li>
				<li><strong class="bold">Article for the general public</strong>: For non-technical <a id="_idIndexMarker121"/>people, it is common to provide a high-level description of functionality without many technical details, focusing mainly on<a id="_idIndexMarker122"/> impact.</li>
			</ul>
			<h2 id="_idParaDest-35"><a id="_idTextAnchor034"/>Answer your audience’s questions</h2>
			<p>It’s very important to answer the main questions your audience is asking. Make the answers clear and easy to find in your analysis report. </p>
			<p>Here is a list of possible questions your audience might need an answer to in your report:</p>
			<div><div><img src="img/B18500_Table_1.1.jpg" alt=""/>
				</div>
			</div>
			<p>As long as this part is <a id="_idIndexMarker123"/>clear, we can start prioritizing particular topics.</p>
			<h2 id="_idParaDest-36"><a id="_idTextAnchor035"/>Define your goals</h2>
			<p>Once the audience is confirmed, define your goals carefully based on the resources available: first, time and skillset. After this, prioritize the selected goals and focus on the most important ones first. It is very easy to get lost in assembly when doing static analysis, so having a checklist of what needs to be done and in what priority will help you get back on track.</p>
			<h2 id="_idParaDest-37"><a id="_idTextAnchor036"/>Avoid unnecessary technical details</h2>
			<p>Regardless of who is going to<a id="_idIndexMarker124"/> consume the result of your work, having too many extra details won’t show your level of expertise but will simply complicate the understanding of the work and result in wasted time. Common examples include executed instructions, WinAPIs used, standard registry keys accessed, or mutexes created. Therefore, you should do the following:</p>
			<ul>
				<li>Choose the level of detail required depending on the target audience.</li>
				<li>If some fact doesn’t help the reader, avoid elaborating on it.</li>
				<li>Don’t just mention technical details – explain their high-level purpose and why the attackers had to explicitly use them.</li>
			</ul>
			<p>Finally, make sure that the most important sections are covered in detail and are definitely correct. Never attempt to make statements based purely on gut feeling or prior knowledge without any material facts related to the current sample. You can always use the appropriate wording for something that you have spotted but don’t have time to dig deeper into (for example: “there are indications that... but more work is required to confirm it”).</p>
			<h2 id="_idParaDest-38"><a id="_idTextAnchor037"/>Example structures</h2>
			<p>Here are some of the details that are generally included in the resulting work, depending on its format and the audience.</p>
			<h3>Technical article</h3>
			<p>In most cases, the following information will be useful:</p>
			<ul>
				<li>Sample(s) details:<ul><li>Hashes (MD5, SHA1, SHA2)</li><li>Compilation timestamps</li><li>File types and sizes</li><li><strong class="bold">In-the-wild</strong> (<strong class="bold">ITW</strong>) filenames</li><li>AV vendors’ detections</li></ul></li>
				<li>Modules’ relationships (if there are several involved)</li>
				<li>For each module:<ul><li>A description of the main functionality</li><li>Persistence mechanisms</li><li>Network communications:<ul><li>Protocols</li><li>Encryption algorithms and keys</li><li>C&amp;C details (IP addresses, domains, URLs, unique whois details, host countries, and so on)</li></ul></li><li>Anti-reverse<a id="_idIndexMarker125"/> engineering techniques used</li></ul></li>
				<li>IoCs</li>
				<li>Detection rules (YARA, Snort, and others)</li>
			</ul>
			<h3>General-public article</h3>
			<ul>
				<li>High-level functionality description with a focus on the impact</li>
				<li>The scale of the attack</li>
				<li>Victim profile:<ul><li>Types of organizations targeted</li><li>Victims’ geolocation</li><li>Loss estimates</li></ul></li>
				<li>Actor attribution:<ul><li>Sample similarity</li><li>Matched IoCs (hashes, network artifacts, filenames, and so on)</li><li>Language codepages and strings used</li><li>Compilation timestamps</li></ul></li>
			</ul>
			<h2 id="_idParaDest-39"><a id="_idTextAnchor038"/>Typical analysis workflow</h2>
			<p>Now that we know what to<a id="_idIndexMarker126"/> focus on, the next question is: how do we organize the work to produce the best possible result in a timely fashion? The following steps are suggested for you to follow:</p>
			<ul>
				<li><strong class="bold">Triage</strong>: Here, collect<a id="_idIndexMarker127"/> the maximum amount of easily available information on the sample:<ul><li>Analyze the PE header.</li><li>Check whether the sample is likely to be packed or not (high-entropy blocks).</li><li>Check public resources for known IoCs (hashes, network artifacts, AV detection names, and so on).</li></ul></li>
				<li><strong class="bold">Behavioral analysis</strong>: Most of the information will be obtained from file, registry, and network operations. This <a id="_idIndexMarker128"/>way, we will have an idea about the capabilities of the potential sample.</li>
				<li><strong class="bold">Unpacking (if necessary)</strong>: Static analysis is impossible before the sample is unpacked as the actual malware’s code<a id="_idIndexMarker129"/> and data are not readily available yet.</li>
				<li><strong class="bold">Static analysis</strong>: Performed with<a id="_idIndexMarker130"/> the help of disassemblers and decompilers:<ul><li>Start from available strings and commonly misused WinAPIs.</li></ul></li>
				<li><strong class="bold">Dynamic analysis</strong>: Performed <a id="_idIndexMarker131"/>with the help of debuggers. May be quite expensive to set up and perform, so use it only when needed:<ul><li>Confirming certain functionality</li><li>Handling string/APIs/embedded payloads/communications encryption</li></ul></li>
			</ul>
			<h1 id="_idParaDest-40"><a id="_idTextAnchor039"/>Setting up the environment</h1>
			<p>Being able to safely analyze<a id="_idIndexMarker132"/> malicious samples is a prerequisite for any engineer performing reverse engineering, whether it is a one-time task or a daily routine. Usually, for this purpose, <strong class="bold">Virtual Machines</strong> (<strong class="bold">VMs</strong>) are used because it is easy to make copies of them, apply any changes, and save snapshots to restore some previous state of the machine. Another option is to have dedicated physical machines separated from critical networks; in this case, some backup software is generally used to quickly restore the previous state of the machine. In this section, we are going to talk about setting up a safe environment for malware analysis and the most important steps to focus on.</p>
			<h2 id="_idParaDest-41"><a id="_idTextAnchor040"/>Choosing the virtualization software</h2>
			<p>When you are ready<a id="_idIndexMarker133"/> to create a new VM, the first task is to choose what software will be used for this purpose. Generally, the top choices of reverse engineers are the following:</p>
			<ul>
				<li><strong class="bold">VMware</strong>: A very popular <a id="_idIndexMarker134"/>commercial solution that also provides a free player to run already existing VMs</li>
				<li><strong class="bold">VirtualBox</strong>: A free fully functional alternative<a id="_idIndexMarker135"/> that allows both the creation and running of VMs</li>
			</ul>
			<p>Both of the preceding options provide similar end-user-oriented functionality and features such as snapshot management, emulation of shared ports, devices, folders, a clipboard, and network access.</p>
			<p><strong class="bold">QEMU</strong> is another<a id="_idIndexMarker136"/> option here, but the project has historically been more focused on emulation than virtualization, and its <strong class="bold">user interface</strong> (<strong class="bold">UI</strong>) might be less user-friendly for daily reverse engineering work. Other projects worth mentioning here include the <strong class="bold">Kernel-Based Virtual Machine</strong> (<strong class="bold">KVM</strong>) virtualization<a id="_idIndexMarker137"/> module, commonly used together with QEMU, and the Xen and Hyper-V hypervisors.</p>
			<p>Regardless of what software you choose, the corresponding VM images can generally be converted from one type to another. However, each virtualization software has its own guest tools that make it possible to use features such as shared clipboards – in this case, they will need to be installed and set up separately.</p>
			<p>Finally, there are pre-built<a id="_idIndexMarker138"/> VM images with a set of RE tools already pre-installed:</p>
			<ul>
				<li><strong class="bold">FLARE VM</strong>: A free, open source, Windows-based<a id="_idIndexMarker139"/> solution supported by Mandiant/FireEye</li>
				<li><strong class="bold">REMnux</strong>: A free, open source, Linux-based <a id="_idIndexMarker140"/>distribution that also provides pre-built VMs</li>
			</ul>
			<h2 id="_idParaDest-42"><a id="_idTextAnchor041"/>Safety features</h2>
			<p>Here are the top safety features that should<a id="_idIndexMarker141"/> be respected when creating an RE-oriented VM lab:</p>
			<ul>
				<li><strong class="bold">Disabled network</strong></li>
			</ul>
			<p>As we know, many malware categories may misuse the network for malicious purposes. Whether it is sending spam, propagating to other machines, or stealing engineers’ proprietary licenses, the rule of thumb here is to disable the network by default. There are plenty of techniques and pieces of software that can be used to simulate a network connection for analysis purposes, such as INetSim and FakeNet.</p>
			<div><div><img src="img/Figure_1.2_B18500.jpg" alt="Figure 1.2 – Disabled network in the VirtualBox VM’s settings&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.2 – Disabled network in the VirtualBox VM’s settings</p>
			<ul>
				<li><strong class="bold">No shared devices</strong></li>
			</ul>
			<p>Many forms of <a id="_idIndexMarker142"/>virtualization software, by default, link connected peripheral physical devices to the VM. This can be extremely dangerous, for example, in the case of USB drives. In this case, malware can propagate there and this way escape the secure environment. Therefore, all such devices should be disabled.</p>
			<div><div><img src="img/Figure_1.3_B18500.jpg" alt="Figure 1.3 – Disabled USB controller in the VirtualBox VM’s settings&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.3 – Disabled USB controller in the VirtualBox VM’s settings</p>
			<ul>
				<li><strong class="bold">Be careful with shared folders</strong></li>
			</ul>
			<p>Shared folders map<a id="_idIndexMarker143"/> some folders present on the host machine to folders mapped on the guest (virtual) machine for easy file transfer. The main concern here is that viruses can infect files located there (namely, executables or documents) or replace existing files with malicious ones. And just like that, the malware has found a way to the host machine. So, shared folders should always be used with care. One way this can be done is to avoid storing any files there longer than necessary: once the files are copied there on the host machine, take them out of there on the guest VM and leave the folder empty until the next task. Making the shared folder read-only for the guest machine is another option.</p>
			<p>Once we have prepared our lab VM, the next question is – how can we copy our malicious samples there for analysis? There are multiple ways this can be done:</p>
			<ul>
				<li><strong class="bold">Private network</strong>: Ideally, this should be avoided as malware running on the guest machine may also have network access to the host machine.</li>
				<li><strong class="bold">Shared folders</strong>: As just discussed, use with care.</li>
				<li><strong class="bold">Shared clipboard</strong>: One of the safest solutions. Requires guest additions to be installed on the VM in order to work.</li>
			</ul>
			<p>As for moving files back from<a id="_idIndexMarker144"/> the VM to the production PC, the rule of thumb here is to exercise extreme caution. Consider doing it only for text files containing the result of your work and similar cases. If it is absolutely necessary to transfer anything containing malicious code and data (including memory dumps and network PCAPs), consider using password-protected archives to store them, which shouldn’t be extracted on the host machine.</p>
			<h1 id="_idParaDest-43"><a id="_idTextAnchor042"/>Summary</h1>
			<p>In this chapter, we have become familiar with various types of modern threats and shed some light on important terms used within the cybersecurity community. We discussed the MITRE ATT&amp;CK framework, provided an overview of its capabilities, and highlighted some of its important features. We also provided instructions on how to set up a safe environment to analyze malware. Finally, we provided recommendations on how to organize work when dealing with malicious samples by various means.</p>
			<p>In the next chapter, we are going to cover the basics of various assembly languages, which will give us the fundamental knowledge required to understand malware functionality and perform static and dynamic analyses of various types of threats.</p>
		</div>
		<div><div></div>
		</div>
	</body></html>