<html><head></head><body>

  <div class="chapter" title="Chapter 8. Acquisition &#x2013; Approaching Windows 8, 8.1, 10, and RT Tablets">

    <div class="titlepage">

      <div>

        <div>

          <h1 class="title"><a id="ch08"/>Chapter 8. Acquisition – Approaching Windows 8, 8.1, 10, and RT Tablets</h1>

        </div>

      </div>

    </div>

    <p>This is not a book on Windows forensics. Acquiring, imaging, and analyzing Windows data is one of the most developed areas in digital forensics. In this book, we'll be covering major points that make tablet forensics different from the traditional PC and laptop acquisition approach. In this chapter, we'll cover the new Connected Standby mode replacing traditional Sleep and Hibernate modes of Windows laptops, discuss <span class="strong"><strong>Secure Boot</strong></span> on various Windows tablet platforms, review UEFI BIOS settings, and learn how to start the tablet from a bootable USB media. We'll also cover techniques on capturing the content of the device's RAM and imaging non-removable eMMC media. But first let's have a look at what Windows tablets are and what they aren't.</p>

    <p>Things we will not be covering in this book include the general steps to create a bootable USB media (this is well covered elsewhere including official Microsoft sources) and the use of bootable USB media made with any particular forensic tool. We will, however, describe these steps for Windows RT devices as standard Windows recovery media cannot be used with RT devices.</p>

    <div class="section" title="Windows 8, 8.1, 10, and RT on portable touchscreen devices">

      <div class="titlepage">

        <div>

          <div>

            <h1 class="title" id="toc_1"><a id="ch08lvl1sec49"/>Windows 8, 8.1, 10, and RT on portable touchscreen devices</h1>

          </div>

        </div>

      </div>

      <p>Since the release of Windows 8 back in 2012, Microsoft has been targeting the market of portable electronics. The new tile-based user interface was optimized for touch use, and intended to be used mainly on tablets and portable computers with touchscreens.</p>

      <p>Microsoft wanted to be part of the tablet market so bad that they even built a special version of Windows called Windows RT to run on hardware with ARM instruction sets (Snapdragon 800 and NVIDIA Tegra 4 chip sets in Nokia Lumia 2520, Microsoft Surface RT, and Surface 2 among others). Today, Microsoft has officially stated that this was a stopgap measure, while many customers and the IT press have long considered it to be a dead end.</p>

      <p>Coincidentally, at about the same time, Intel decided to conquer the market of portable electronic devices and promote x86 architecture by subsidizing manufacturers who opted to use Intel CPUs in their phones and tablets instead of going for the then-prevailing ARM architecture. This lured manufacturers into building tablets and phones featuring Intel processors and running Android. Now, with many portable devices featuring x86 architecture, there was no longer need for Microsoft to go with RT and ARM architecture.</p>

      <p>In order to compete with Android being installed on tablets with x86 processors, Microsoft decided to give Windows away to manufacturers of small and inexpensive devices. As a result, Microsoft released a special edition of Windows called Windows 8.1 with Bing, giving it away free of charge to manufacturers of small tablets with display sizes of up to 8 inches. Additional incentives Microsoft offers to manufacturers who install Windows on their tablets are zero licensing fees for its exFAT file system (exFAT is the default file system on 64 GB and larger SDXC cards) and no licensing fees (which manufacturers of Android devices would otherwise have to pay Microsoft).</p>

      <p>These incentives actually worked. While there aren't that many Windows tablets around in absolute terms, there are more of those every year. HP Stream 7, Dell Venue 8 Pro, and many other 7" and 8" Windows tablets are available for extremely low prices.</p>

      <p>Today, there are hundreds of thousands of these devices sold all over the world. While most of these tablets run full Windows (with few Windows RT devices still around), the approach to their acquisition is very different compared to acquiring desktop and laptop computers of yesterday.</p>

    </div>

  </div>




  <div class="section" title="Acquisition of Windows tablets">

    <div class="titlepage">

      <div>

        <div>

          <h1 class="title"><a id="ch08lvl1sec50"/>Acquisition of Windows tablets</h1>

        </div>

      </div>

    </div>

    <p>Windows desktop and laptop computers can be relatively easy to acquire. The procedure is well known, and experts have long experience dealing with these machines. For example, in order to obtain a memory dump one can simply plug a USB drive and run a small utility. If that's not possible, one can always exploit a FireWire port (if installed), or even install an add-on FireWire adapter if no IEEE.1394 port is available. This same operation would involve a different technique as far as a tablet PC is concerned.</p>

    <p>The relatively new class of Windows devices consists of portable electronic devices, which includes tablets and convertibles (laptops with a detachable keyboard). From a forensic standpoint, these devices are similar to Windows desktops in some aspects, yet very different in other aspects. Let's see how one can approach a tablet computer.</p>

    <div class="section" title="Understanding Secure Boot">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_1"><a id="ch08lvl2sec85"/>Understanding Secure Boot</h2>

          </div>

        </div>

      </div>

      <p>Most computers and laptops manufactured during recent years, and pretty much every Windows 8, 8.1, and Windows 10 tablet ever marketed has a feature in their UEFI BIOS called Secure Boot. Secure Boot was developed by members of the PC industry to help secure devices' bootloader against booting non-trusted (or, rather, unsigned) systems. If configured, Secure Boot allows tablets to boot using only software that is trusted by the manufacturer.</p>

      <p>The concept of Secure Boot is similar to the concept of locked bootloaders that we've seen on Apple iOS and many Android devices, even if its operation and technical implementation is different. If Secure Boot is enabled in the computer's UEFI BIOS, the computer's firmware verifies digital signatures of each link of the boot chain, including firmware drivers and the operating system during the boot. The computer will only boot if the signatures pass the check.</p>

      <p>It is important to understand that disabling Secure Boot is <span class="emphasis"><em>not</em></span> required in order to boot into a Windows 8.x/Windows 10 recovery image, even if that image is stored on an external flash drive. The function of Secure Boot is preventing untrusted, unsigned code to run, so if enabled, it will prevent booting into Linux or another system.</p>

      <div class="note" title="Note" style="">

        <div class="inner">

          <h3 class="title" id="toc_2"><a id="note40"/>Note</h3>

          <p>Secure Boot is still an optional feature that is supported, but not required by Microsoft Windows 8, 8.1, and Windows 10. All Windows RT devices ship locked with non-removable Secure Boot protection, making forensic analysis of these machines much more difficult.</p>

        </div>

      </div>

    </div>

    <div class="section" title="Connected Standby (InstantGo)">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_3"><a id="ch08lvl2sec86"/>Connected Standby (InstantGo)</h2>

          </div>

        </div>

      </div>

      <p>Portable Windows devices such as tablets and convertibles are designed around the concept of <span class="strong"><strong>Connected Standby</strong></span>, which means the device never really sleeps or shuts down by itself unless the user specifically invokes the <span class="emphasis"><em>Power Off</em></span> command or the battery is nearly depleted.</p>

      <p>In Connected Standby mode, the device consumes as little as five percent of battery per 16 hours of sleep (according to Microsoft specifications). In this mode, the device remains connected to the wireless network, and performs most of the usual background activities such as checking and receiving e-mail, syncing social networks, and updating news feeds.</p>

      <p>For digital forensic purposes, this means that any Windows tablet being seized must be treated exactly like an active cell phone. In other words, one must take precautions and place the device immediately into a Faraday bag to block its wireless connectivity. However, it also means that the portable device being acquired is almost definitely in the <span class="emphasis"><em>On</em></span> state, and can be used to acquire a memory dump.</p>

      <p>Importantly, <span class="strong"><strong>InstantGo</strong></span> (Connected Standby) is one of the requirements for automatic activation of BitLocker device encryption on Windows tablets.</p>

    </div>

    <div class="section" title="BitLocker device encryption">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_4"><a id="ch08lvl2sec87"/>BitLocker device encryption</h2>

          </div>

        </div>

      </div>

      <p>BitLocker device encryption is an essential part of the Windows 8.x and Windows 10 security model. Device encryption is essentially a feature-limited version of BitLocker that encrypts the entire C drive partition. Unlike on desktop and laptop computers that are still mostly running on Windows 7, BitLocker device encryption is available to users of all versions of Windows 8.x and 10, including the core edition and Windows with Bing.</p>

      <p>Essentially for digital forensics, BitLocker device encryption is activated automatically when the user logs in with their Microsoft Account with administrative privileges. After the first login, the system automatically begins the encryption process. The encryption process runs in the background. The process is transparent and invisible to the end user. The Recovery Key is automatically saved in the user's Microsoft Account, and can be retrieved from that account in order to decrypt the device. In corporate environments, BitLocker escrow keys are saved in the active directory.</p>

      <div class="note" title="Note" style="">

        <div class="inner">

          <h3 class="title" id="toc_5"><a id="tip41"/>Tip</h3>

          <p> <span class="strong"><strong>Important:</strong></span> The Recovery Key (BitLocker escrow key) saved to the user's Microsoft Account can be deleted by the user at any time. Microsoft states that Recovery Keys deleted from the user's Microsoft Account are permanently destroyed and not retained by the company. As a result, consideration should be taken to prevent the suspect from accessing their Microsoft Account and deleting BitLocker Recovery Keys stored in that account.</p>

        </div>

      </div>

      <p>BitLocker device encryption is offered on all versions of 8.1 and Windows 10. However, unlike full BitLocker, device encryption requires that the device meet all of the following specifications:</p>

      <div class="itemizedlist">

        <ul class="itemizedlist">

          <li class="listitem" style="list-style-type: disc">InstantGo (formerly Connected Standby) support</li>

          <li class="listitem" style="list-style-type: disc">Solid-state drive or eMMC storage</li>

          <li class="listitem" style="list-style-type: disc">Soldered (non-removable) RAM to protect against cold boot attacks</li>

          <li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Trusted Platform Module</strong></span> (<span class="strong"><strong>TPM</strong></span>) 2.0 chip</li>

        </ul>

      </div>

      <p>All of the above specifications must be met in order for BitLocker device encryption to be activated. Notably, all Windows RT devices and most Windows 8.1 and Windows 10 tablets will naturally meet all of the above specifications, with the exception of a TPM chip that may be missing on some of the cheaper tablets. As a result, BitLocker device encryption is not automatically activated on budget Windows 8.1/Windows 10 devices without a TPM chip.</p>

      <div class="section" title="BitLocker and Encrypting File System">

        <div class="titlepage">

          <div>

            <div>

              <h3 class="title" id="toc_6"><a id="ch08lvl3sec38"/>BitLocker and Encrypting File System</h3>

            </div>

          </div>

        </div>

        <p>While BitLocker protects the entire operating system drive against offline attacks, <span class="strong"><strong>Encrypting File System</strong></span> (<span class="strong"><strong>EFS</strong></span>) can provide additional file level security by encrypting individual files and folders on per-user basis. In other words, while BitLocker encryption protects the entire computer contents against outside attacks, EFS helps maintain security separation between multiple users of the same computer. EFS can be used in combination with BitLocker to additionally encrypt files on a BitLocker-protected drive.</p>

      </div>

      <div class="section" title="BitLocker and hibernation">

        <div class="titlepage">

          <div>

            <div>

              <h3 class="title" id="toc_7"><a id="ch08lvl3sec39"/>BitLocker and hibernation</h3>

            </div>

          </div>

        </div>

        <p>As we already know, BitLocker stores its binary encryption/decryption keys in the computer's main RAM, which makes it susceptible to memory dumping attacks. However, the BitLocker decryption key may be available in the computer's hibernation file.</p>

        <p> <span class="emphasis"><em>Mike Halsey</em></span>, in his publication <span class="emphasis"><em>Will Bitlocker's Security Flaw Remain in Windows 8?</em></span> (<a class="ulink" href="http://www.ghacks.net/2012/03/15/will-bitlockers-security-flaw-remain-in-windows-8/">http://www.ghacks.net/2012/03/15/will-bitlockers-security-flaw-remain-in-windows-8/</a>) claims that hibernation is perhaps BitLocker's biggest security flaw. All versions of Windows (up to and including Windows 8.1) will store the hibernation file unencrypted at a certain location on the hard disk. This, in turn, allows using forensic tools (for example, Elcomsoft Forensic Disk Decryptor) to extract the binary decryption keys from the hibernation file itself, and use those keys to instantly unlock the encrypted volume. This is confirmed by Microsoft (<a class="ulink" href="https://technet.microsoft.com/en-us/library/ee449438(v=ws.10).aspx#BKMK_Sleep">https://technet.microsoft.com/en-us/library/ee449438(v=ws.10).aspx#BKMK_Sleep</a>) who recommend using additional authentication steps to secure BitLocker encrypted images if hibernate power management is enabled.</p>

        <p>Notably, many Windows 8 systems ship with hibernation disabled by default. However, Windows 8.x tablets usually have an option that Microsoft calls <span class="emphasis"><em>Fast Startup</em></span>, a new power management mode that is a method of a hybrid shutdown (or partial hibernate). Since Fast Startup is enabled by default, every time the user shuts down the tablet via the Power charm (as opposed to doing the same via the Windows + <span class="emphasis"><em>X</em></span> menu, which will, counter-intuitively, engage the full shutdown) the system will save its kernel and drivers into a smaller version of the hibernation file (<code class="literal">hiberfil.sys</code>). By using that file, the system will be able to start up faster when it's next booted.</p>

        <p>The partial hibernate file does not contain BitLocker decryption keys.</p>

        <div class="note" title="Note" style="">

          <div class="inner">

            <h3 class="title" id="toc_8"><a id="note42"/>Note</h3>

            <p> <span class="strong"><strong>Note:</strong></span> If the target computer was turned off or hibernated and the encrypted volume was dismounted during the hibernation, the hibernation file will not contain the encryption keys, and instant decryption of the BitLocker volume will not be possible.</p>

          </div>

        </div>

      </div>

      <div class="section" title="BitLocker acquisition summary">

        <div class="titlepage">

          <div>

            <div>

              <h3 class="title" id="toc_9"><a id="ch08lvl3sec40"/>BitLocker acquisition summary</h3>

            </div>

          </div>

        </div>

        <p>To sum up the content of the previous chapter, if the C drive of hard disk is protected with BitLocker, one has the following acquisition alternatives:</p>

        <p> <span class="strong"><strong>If you have the BitLocker escrow key (Recovery Key), you can do either of the following</strong></span>:</p>

        <div class="orderedlist">

          <ol class="orderedlist arabic">

            <li class="listitem">Unlock BitLocker partition and image decrypted volume.</li>

            <li class="listitem">Image <span class="emphasis"><em>as is</em></span>, decrypt captured image (for example, by saving the image onto a physical hard drive, using a Windows virtual machine or using a forensic product of your choice to decrypt the image).</li>

          </ol>

        </div>

        <p> <span class="strong"><strong>If you don't have the BitLocker escrow key (Recovery Key)</strong></span>:</p>

        <div class="orderedlist">

          <ol class="orderedlist arabic">

            <li class="listitem">Attempt to capture a memory dump (RAM dump) to acquire the binary decryption key:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">For this to work, the computer must be seized in the ON and unlocked state.</li><li class="listitem">If a FireWire (IEEE.1394) port is available, attempt capturing RAM via the FireWire attack.</li></ol></div><p> </p></li>

            <li class="listitem">If the tablet was locked, capturing a memory dump is not possible since memory chips are soldered to prevent cold-boot attacks and a FireWire port is usually unavailable on Windows tablets. However, hibernating (if available) or shutting down (if Windows fast startup is enabled) the tablet may produce a usable hibernation file from which the decryption key can be extracted.</li>

            <li class="listitem">If the device was seized in the hibernated state, attempt obtaining the hibernation file (<code class="literal">hiberfil.sys</code>).</li>

            <li class="listitem">Use Elcomsoft Forensic Disk Decryptor (<a class="ulink" href="https://www.elcomsoft.com/efdd.html">https://www.elcomsoft.com/efdd.html</a>) to analyze the memory dump or hibernation file, extract the BitLocker binary decryption key, and mount the encrypted volumes.</li>

            <li class="listitem">Image decrypted volume.</li>

          </ol>

        </div>

      </div>

    </div>

    <div class="section" title="Capturing a memory dump">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_10"><a id="ch08lvl2sec88"/>Capturing a memory dump</h2>

          </div>

        </div>

      </div>

      <p>Attempting to capture a memory dump of a Windows device is essential for digital investigations. It is also a recommended practice by ACPO Guidelines.</p>

      <p>Until recently, law enforcement officials would simply power down computers being seized, losing a large amount of potentially vital evidence stored in the computer's volatile memory. In the world of Windows, this information includes recent activities in social networks, data on running processes, open network connections, cached passwords, and private browsing sessions. Of particular interest are binary encryption keys that can be used to unlock access to encrypted volumes such as those maintained by BitLocker, TrueCrypt, and PGP WDE (Elcomsoft Forensic Disk Decryptor can be used to extract such keys and use them to mount encrypted volumes). These and many other types of evidence can be recovered if the investigator is able to capture and analyze the content of the computer's volatile memory.</p>

      <p>This is exactly the reason for ACPO to recommend the capturing and analysis of a computer's RAM at the time of acquisition. Dumping the content of volatile memory has already become a standard operating procedure when acquiring digital evidence just before imaging the computer's persistent storage.</p>

      <p>While dumping and analyzing the content of the computer's volatile memory is important, one must realize that due to its very nature RAM is highly volatile and highly fragmented. As a result, one may never find the complete conversation or the entire document being edited. Instead, there could be chunks, bits, and broken parts—which, in turn, can be reassembled into something usable with certain smart carving algorithms (such as Belkasoft Smart Carving). What can be realistically discovered in the computer's RAM?</p>

    </div>

    <div class="section" title="Types of evidence available in volatile memory">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_11"><a id="ch08lvl2sec89"/>Types of evidence available in volatile memory</h2>

          </div>

        </div>

      </div>

      <p>Certain types of evidence are available exclusively in the computer's RAM. This evidence includes:</p>

      <div class="itemizedlist">

        <ul class="itemizedlist">

          <li class="listitem" style="list-style-type: disc">Running processes and services</li>

          <li class="listitem" style="list-style-type: disc">Unpacked/decrypted versions of protected programs</li>

          <li class="listitem" style="list-style-type: disc">System information (for example, time lapsed since last reboot)</li>

          <li class="listitem" style="list-style-type: disc">Information about logged in users</li>

          <li class="listitem" style="list-style-type: disc">Registry information</li>

          <li class="listitem" style="list-style-type: disc">Open network connections and ARP cache</li>

          <li class="listitem" style="list-style-type: disc">Remnants of chats, communications in social networks, and MMORPG games</li>

          <li class="listitem" style="list-style-type: disc">Recent web browsing activities including IE InPrivate mode and similar privacy-oriented modes in other Web browsers</li>

          <li class="listitem" style="list-style-type: disc">Recent communications via Webmail systems</li>

          <li class="listitem" style="list-style-type: disc">Information from cloud services</li>

          <li class="listitem" style="list-style-type: disc">Decryption keys for encrypted volumes mounted at the time of the capture</li>

          <li class="listitem" style="list-style-type: disc">Recently viewed images</li>

          <li class="listitem" style="list-style-type: disc">Running malware/Trojans</li>

        </ul>

      </div>

    </div>

    <div class="section" title="Special case – Windows RT devices">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_12"><a id="ch08lvl2sec90"/>Special case – Windows RT devices</h2>

          </div>

        </div>

      </div>

      <p>While many say that Windows RT has never caught up, there were multiple devices sold featuring this little known platform. Microsoft Surface RT and Surface 2 and Nokia Lumia 2520 were among the most popular devices running on the RT platform. So what exactly is Windows RT, and what, if anything, can be done to acquire it?</p>

      <p>In fact, Windows RT is simply a variation of Windows 8 or 8.1 running on the ARM processor architecture instead of the familiar x86 or x64. RT features the same modern UI and runs most of the same Metro-style apps as the full Windows, and has access to all of the same system updates as the 'big' Windows. Windows RT has a desktop, and can technically run applications (<code class="literal">.exe</code> files) compiled for the ARM instruction set. What it can't do is run desktop applications compiled for the Intel x86 architecture.</p>

      <p>In addition, Microsoft decided to lock Windows RT desktop mode to only allow running .exe files signed by Microsoft, which means you cannot compile your own application with an ARM compiler and just run it in desktop mode. This effectively rules out live box analysis, and makes it next to impossible to capture live memory dumps with any known forensic tool.</p>

      <p>How can one deal with a Windows RT device then? Since we cannot install anything other than Metro-style apps downloaded from Windows Store, we're pretty much limited to offline analysis of its built-in storage.</p>

      <p>A live memory dump cannot be easily captured with built-in Windows tools (more information at <span class="emphasis"><em>How to generate a kernel or a complete memory dump file in Windows Server 2008 and Windows Server 2008 R2</em></span>: <a class="ulink" href="https://support.microsoft.com/en-us/kb/969028?wa=wsignin1.0">https://support.microsoft.com/en-us/kb/969028</a>; techniques described in this article equally apply to Windows RT). However, the system's default behavior is creating a full memory dump in the case of system failure. If one can make the system crash, there is a good chance that a memory dump will be created.</p>

      <p>If making a memory dump is impossible, your best bet is making the system hibernate instead of using connected standby, and even that may not be an option as described in <span class="emphasis"><em>Shut down, sleep, or hibernate your PC</em></span>: <a class="ulink" href="http://windows.microsoft.com/en-us/windows-8/how-shut-down-turn-off-pc">http://windows.microsoft.com/en-us/windows-8/how-shut-down-turn-off-pc</a>.</p>

      <p>However, if you manage to hibernate the device, you will be able to proceed to the next step: making a forensic disk image of the device's built-in storage.</p>

    </div>

    <div class="section" title="SD cards and Windows File History">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_13"><a id="ch08lvl2sec91"/>SD cards and Windows File History</h2>

          </div>

        </div>

      </div>

      <p>As a reminder, most Windows tablets including Windows RT devices come equipped with an SD card slot. A typical configuration allows using one micro SDHC (up to 32 GB) or one micro SDXC (64 GB and larger) memory card. By default, these memory cards are formatted with FAT32 (SDHC) or exFAT (SDXC) and are not encrypted with either BitLocker or built-in NTFS encryption. Therefore, these memory cards are usually an easy target for forensic analysis.</p>

      <p>On recent Android devices, memory cards are not normally used to contain application data. Instead, their intended use is storing multimedia files such as large amounts of music and video for offline access. This is not the case with Windows, where the entire content of an SD card is accessible and can be used to keep pretty much everything from user documents, OneDrive contents and data backups, to desktop applications and page files.</p>

      <p>The other factor contributing to the use of SD cards in Windows tablets is the fact that the majority of Windows tablets are sold with 32 GB of storage. Of those 32 GB, a measly 6 to 11 GB is available to the end user after the installation of all current Windows updates.</p>

      <p>As a result, the users of Windows tablets are more likely to actively use an SD card as secondary (or even primary) storage for their documents, camera roll, and other files.</p>

      <p>One Windows feature that's particularly interesting for experts investigating tablet devices is a little known feature called Windows <span class="strong"><strong>File History</strong></span>. If enabled, this feature (available in Windows 8, 8.1, and RT) automatically backs up versions of user files in the Documents, Music, Pictures, Videos, and Desktop folders as well as the OneDrive files available offline to a storage device other than the system partition. If the originals are lost, damaged, or deleted, users can restore them by using copies stored in the File History.</p>

      <p>File History contains different versions of user files such as working copies of documents, spreadsheets, old, deleted and unedited versions of pictures, and so on, arranged in a convenient timeline.</p>

      <p> </p>

      <div class="mediaobject">

        <img src="0143.jpeg" alt="SD cards and Windows File History"/>

      </div>

      <p> </p>

      <p>There are two important points here:</p>

      <div class="itemizedlist">

        <ul class="itemizedlist">

          <li class="listitem" style="list-style-type: disc">Windows File History uses a drive other than the system partition. On Windows tablets, this is almost inevitably the unprotected, unencrypted, and easily removable SD card.</li>

          <li class="listitem" style="list-style-type: disc">File History contains current and historic versions of user files.</li>

        </ul>

      </div>

      <p>You may find these quite handy for your investigation.</p>

    </div>

  </div>




  <div class="section" title="Imaging Built-in eMMC Storage">

    <div class="titlepage">

      <div>

        <div>

          <h1 class="title"><a id="ch08lvl1sec51"/>Imaging Built-in eMMC Storage</h1>

        </div>

      </div>

    </div>

    <p>In this chapter, we won't be talking about the use of forensic write-blocking hard drive imaging devices. We won't cover any disk imaging software, too, as such tools are readily available with all major forensic suites and you most probably have spent more time with one of those tools than either author of this book. Instead, we'll discuss how to approach a Windows tablet and make it available for imaging with the tool of your choice.</p>

    <div class="note" title="Note" style="">

      <div class="inner">

        <h3 class="title" id="toc_1"><a id="note43"/>Note</h3>

        <p> <span class="strong"><strong>Note</strong></span>: As with smartphones and Android/iOS tablets, eMMC chips used in Windows devices can be unsoldered and placed into an eMMC reader.</p>

        <p>This destructive method is called chip-off acquisition. Such techniques are widely covered elsewhere. In this book, we'll talk about non-destructive, software-based acquisition.</p>

      </div>

    </div>

    <p>Most Windows tablets (and all Windows RT devices) come with non-removable storage in the form of eMMC chips. <span class="strong"><strong>eMMC</strong></span> stands for <span class="strong"><strong>embedded MMC</strong></span>, or <span class="strong"><strong>embedded MultiMedia Card</strong></span>, and is closer in operation to a standard SD (Secure Digital) card rather than an SSD drive. In other words, eMMC is a non-removable, BGA flash memory chip soldered onto a circuit board. If the tablet features 32 GB of storage, those 32 GB are located in the eMMC chip.</p>

    <p> </p>

    <div class="mediaobject">

      <img src="0144.jpeg" alt="Imaging Built-in eMMC Storage"/>

    </div>

    <p> </p>

    <p>What does that mean for digital forensics?</p>

    <p>As we already know, most Windows tablets (with very few exceptions) feature built-in, non-removable (unless one uses a BGA soldering station) eMMC storage. Let's think for a moment about the fact that the eMMC chip is soldered onto the circuit board. It cannot be removed and put into a write-blocking imaging device. It cannot be connected to another computer. In order to image the built-in storage, the investigator will have to boot into the system and run an imaging tool on the very same device being investigated. This can present challenges due to security settings of some models.</p>

    <p>If we're talking about a full Windows tablet, best practice would be booting the system from an external bootable media. Most probably, you have one in your lab already. If not, there are plenty of tools and tutorials to help experts do exactly that, for example, <span class="emphasis"><em>Create installation media for Windows</em></span>: <a class="ulink" href="http://windows.microsoft.com/en-us/windows-8/create-reset-refresh-media">http://windows.microsoft.com/en-us/windows-8/create-reset-refresh-media</a> or <a class="ulink" href="http://windows.microsoft.com/en-us/windows-8/create-usb-recovery-drive">http://windows.microsoft.com/en-us/windows-8/create-usb-recovery-drive</a>.</p>

    <div class="note" title="Note" style="">

      <div class="inner">

        <h3 class="title" id="toc_2"><a id="tip44"/>Tip</h3>

        <p> <span class="strong"><strong>Note: </strong></span>Due to the bug in early builds of 64-bit versions of Windows 8 and 8.1 preventing Connected Standby from functioning properly, many manufacturers of Windows tablets chose to install 32-bit editions onto their devices and provide 32-bit versions of UEFI BIOS. This, in turn, can mean that the system may not be able to boot from a 64-bit recovery media even if the CPU and other hardware is fully 64-bit compatible. On such systems, investigators must use 32-bit recovery media.</p>

      </div>

    </div>

    <div class="section" title="eMMC and deleted data recovery">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_3"><a id="ch08lvl2sec92"/>eMMC and deleted data recovery</h2>

          </div>

        </div>

      </div>

      <p>While eMMC memory does not constitute a full replacement for SSD drives, the two types of storage have one thing in common: support for trimming deleted data.</p>

      <p>If you think for a moment about how Windows (and most other modern operating systems) manage deleted files, you'll realize that information such as deleted files and folders is not permanently erased. Instead, the system will simply mark files and folders being deleted with a corresponding attribute in the filesystem. Disk space originally occupied by these files will be released to the pool of available disk space. To reiterate, Windows won't do anything to actually wipe or erase data blocks that were previously occupied with deleted data.</p>

      <p>This behavior had to change with the introduction of solid-state storage media. NAND flash-based solid-state storage media is much slower to erase data compared to writing to an empty block. In addition, NAND flash cells can be only written to a limited number of times, which made some form of wear leveling necessary. In order to deal with the two issues, the industry adopted a certain protocol for dealing with released data blocks.</p>

      <p>A compatible operating system (Windows 7, 8, 8.1 or newer) working with a compatible SSD or eMMC storage formatted with the only compatible file system (NTFS) will issue the TRIM command to instruct the storage controller that certain data blocks no longer contain data. After receiving the TRIM command, the controller will add data blocks passed in that command to the list of <span class="emphasis"><em>dirty</em></span> blocks, while remapping them (assigning their logical addresses) to already erased blocks from the reserve pool. The <span class="emphasis"><em>dirty</em></span> blocks will be slowly erased in the background. Effectively, the TRIM command serves as a garbage collection tool, helping SSDs prevent future slowdowns to write operations.</p>

      <p>For the purpose of digital forensics, this means you can no longer count on deleted files being available for recovery after they've been deleted. Due to the use of the TRIM command by the operating system and the ongoing operation of wear leveling and garbage collection processes in the background, the empty blocks will, in most cases, be completely erased without any further interaction. In other words, if the user deletes certain files, they'll be truly gone—with a few exceptions.</p>

      <p>More information regarding solid-state storage and data recovery can be obtained from Belkasoft whitepaper <span class="emphasis"><em>SSD Forensics 2014. Recovering Evidence from SSD Drives: Understanding TRIM, Garbage Collection and Exclusions</em></span> at <a class="ulink" href="http://belkasoft.com/en/ssd-2014">http://belkasoft.com/en/ssd-2014</a>.</p>

    </div>

    <div class="section" title="Windows 8 and Windows 10 encryption – TRIM versus BitLocker">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_4"><a id="ch08lvl2sec93"/>Windows 8 and Windows 10 encryption – TRIM versus BitLocker</h2>

          </div>

        </div>

      </div>

      <p>Considering the nature of full-disk encryption and taking into account performance and lifespan issues of solid-state media such as SSD and eMMC storage, one inevitably arrives to a logical question: what happens to deleted data if full-disk encryption is enabled on a solid-state volume? Particularly, will the system sacrifice performance by keeping deleted data encrypted, or will it sacrifice security by exposing empty (erased) parts of the encrypted volume?</p>

      <p>The answer to this question depends on which combination of hardware and whole-disk encryption software is used in a particular system. However, in the case of BitLocker and eMMC storage, there is a simple—and official—answer. According to Microsoft (<a class="ulink" href="https://blogs.msdn.microsoft.com/e7/2009/05/05/support-and-qa-for-solid-state-drives/">https://blogs.msdn.microsoft.com/e7/2009/05/05/support-and-qa-for-solid-state-drives/</a>), <span class="emphasis"><em>Bitlocker's encryption process [is] optimized to work on SSDs [...] on NTFS. When Bitlocker is first configured on a partition, the entire partition is read, encrypted and written back out. As this is done, the NTFS file system will issue Trim commands to help the SSD optimize its behavior.</em></span> As we can see, in this particular case Microsoft has decided to go after performance while sacrificing a little bit of security. As a result, you will <span class="emphasis"><em>not</em></span> be able to recover deleted files even if you image the entire BitLocker volume.</p>

      <p>Historically, however, this has not always been the case. In the early days of SSD's, the then-current whole-disk encryption providers such as TrueCrypt went all the way after security, never letting TRIM commands reach the underlying physical storage. As a result, TrueCrypt used to have a hugely negative impact on performance if whole-disk encryption was used because the SSD controller could no longer tell the difference between free space and used up space because on an encrypted disk both free space and used space is treated as (encrypted) data. This approach defeated the very purpose of TRIM, and effectively disabled wear-leveling optimizations.</p>

      <p>In order to mitigate this issue, developers of whole-disk encryption products introduced so-called <span class="emphasis"><em>TRIM Pass-through</em></span>. With this feature enabled, the encryption product would pass information about free data blocks to the SSD controller, allowing it to trim released data blocks. This had a huge positive effect on performance and longevity of solid-state media, but exposed information about which data blocks were actually occupied by encrypted data to an outside attacker. This was seen as a security weakness, and for this reason alone, some WDE manufacturers chose not to enable the feature by default.</p>

      <p>After some years, self-encrypting SSDs became available. These SSDs encrypt data blocks before writing them at the physical level. The TGS Opal full disk encryption standard allows the keys to be set by the OS (providing that both the operating system and hardware support the system), effectively fixing the issue mentioned above. Therefore, if the Windows device being investigated has a storage device (whether SSD or eMMC) that meets the right encryption standards, BitLocker makes use of the hardware encryption engine, effectively bypassing the software-based encryption in favor of a hardware-based one.</p>

    </div>

  </div>




  <div class="section" title="Booting Windows tablets from recovery media">

    <div class="titlepage">

      <div>

        <div>

          <h1 class="title"><a id="ch08lvl1sec52"/>Booting Windows tablets from recovery media</h1>

        </div>

      </div>

    </div>

    <p>In order to boot from recovery media, one needs several things. Firstly, the tablet must hold enough charge to be able to survive through the recovery process. As most tablets share a single USB port for charging and for connecting peripherals such as USB flash drives, fully charging the tablet before the recovery is recommended.</p>

    <p>Secondly, only a few tablets offer full-size USB ports. One is more likely to encounter a micro USB port (USB2.0 or USB3.0 depending on the tablet). As a result, you'll need a matching USB <span class="strong"><strong>On-The-Go</strong></span> (<span class="strong"><strong>OTG</strong></span>) cable to connect the flash drive.</p>

    <p>Finally, the tablet will not boot from an external device unless it's instructed to do so in its UEFI BIOS.</p>

    <div class="section" title="Special case – recovery media for Windows RT">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_1"><a id="ch08lvl2sec94"/>Special case – recovery media for Windows RT</h2>

          </div>

        </div>

      </div>

      <p>Windows RT devices were supplied with UEFI Secure Boot permanently activated, which makes it impossible to boot these devices into anything other than Windows RT. Theoretically, with Secure Boot disabled, one could use an ARM version of Linux or a custom build of Android to boot and image the device. This, however, is not an option since Secure Boot cannot be disabled on any Windows RT device.</p>

      <p>As a result, one can either boot from the tablet's recovery partition or use custom recovery. Since Windows RT is a rather crippled OS, obtaining or making a usable recovery image is significantly more difficult compared to x86 or x64 Windows builds.</p>

      <p>If no recovery partition is available, one can usually obtain a Windows RT recovery image from the manufacturer. For example, Microsoft offers such images for its Surface RT and Surface 2 tablets at <a class="ulink" href="http://www.microsoft.com/surface/en-us/support/warranty-service-and-recovery/downloadablerecoveryimage">http://www.microsoft.com/surface/en-us/support/warranty-service-and-recovery/downloadablerecoveryimage</a>.</p>

      <p>After following the download instructions, one can make a bootable flash media.</p>

    </div>

    <div class="section" title="Steps to boot from recovery media">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_2"><a id="ch08lvl2sec95"/>Steps to boot from recovery media</h2>

          </div>

        </div>

      </div>

      <p>Microsoft published step-by-step instructions on how to boot a Windows tablet from USB recovery media at <a class="ulink" href="http://www.microsoft.com/surface/en-ca/support/storage-files-and-folders/boot-surface-pro-from-usb-recovery-device?lc=4105">http://www.microsoft.com/surface/en-ca/support/storage-files-and-folders/boot-surface-pro-from-usb-recovery-device?lc=4105</a>. While these instructions apply to Microsoft Surface RT devices, they work just as well for most other Windows tablets. If not, refer to the manufacturer's manual for the particular device being acquired.</p>

      <p> <span class="strong"><strong>How to start from a bootable USB device when the tablet is off:</strong></span> </p>

      <p>Microsoft published the following walkthroughs:</p>

      <div class="itemizedlist">

        <ul class="itemizedlist">

          <li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Boot Surface from a USB device</em></span> (<a class="ulink" href="https://www.microsoft.com/surface/en-us/support/storage-files-and-folders/boot-surface-from-usb-recovery-device?os=windows-10">https://www.microsoft.com/surface/en-us/support/storage-files-and-folders/boot-surface-from-usb-recovery-device?os=windows-10</a>)</li>

          <li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Using a Surface USB recovery drive</em></span> (<a class="ulink" href="https://www.microsoft.com/surface/en-us/support/warranty-service-and-recovery/usbrecovery?os=windows-10">https://www.microsoft.com/surface/en-us/support/warranty-service-and-recovery/usbrecovery?os=windows-10</a>)</li>

        </ul>

      </div>

      <p>While the two guides are mainly aimed at Microsoft Surface users, they are also applicable to users of other Windows-based tablets:</p>

      <div class="orderedlist">

        <ol class="orderedlist arabic">

          <li class="listitem">Attach a bootable USB device containing a Windows Recovery image to the USB port.<p>Use a USB OTG cable if no full-size USB port is available.</p></li>

          <li class="listitem">Press and hold the volume down button.</li>

          <li class="listitem">Press and release the power button.</li>

          <li class="listitem">When the logo appears, release the volume down button.<p>The tablet will start the software on your USB device.</p></li>

        </ol>

      </div>

      <p>If the tablet is on and you are logged in, the startup procedure is different.</p>

      <p> <span class="strong"><strong>How to start from a bootable USB device when the tablet is on:</strong></span> </p>

      <div class="orderedlist">

        <ol class="orderedlist arabic">

          <li class="listitem">Attach a bootable USB device to the USB port.<p>Use a USB OTG cable if no full-size USB port is available.</p></li>

          <li class="listitem">Swipe in from the right and then tap <span class="strong"><strong>Settings</strong></span> (if you're using a mouse, point to the upper-right corner of the screen, move the mouse pointer down, and then click <span class="strong"><strong>Settings</strong></span>).</li>

          <li class="listitem">Tap or click <span class="strong"><strong>Change PC Settings</strong></span>.</li>

          <li class="listitem">Tap or click <span class="strong"><strong>Update and recovery</strong></span>, and then tap or click <span class="strong"><strong>Recovery</strong></span>.</li>

          <li class="listitem">Under <span class="strong"><strong>Advanced Startup</strong></span>, tap or click <span class="strong"><strong>Restart now</strong></span>.</li>

          <li class="listitem">On the <span class="strong"><strong>Choose an option</strong></span> screen, tap or click <span class="strong"><strong>Use a device</strong></span>.</li>

          <li class="listitem">On the <span class="strong"><strong>Troubleshoot</strong></span> screen, tap or click <span class="strong"><strong>Advanced options</strong></span>.</li>

          <li class="listitem">On the <span class="strong"><strong>Advanced options</strong></span> screen, tap or click the name of the USB device. The tablet will restart and boot from the USB device.</li>

        </ol>

      </div>

    </div>

    <div class="section" title="Configuring UEFI BIOS to boot from recovery media">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_3"><a id="ch08lvl2sec96"/>Configuring UEFI BIOS to boot from recovery media</h2>

          </div>

        </div>

      </div>

      <p>Depending on the manufacturer (and user-performed adjustments) of a particular Windows tablet, UEFI setup changes may be necessary if booting from an external device. If this is the case, you'll have to enter its UEFI BIOS and enable external boot mode.</p>

      <p>Unlike Windows, which looks pretty much the same from one computer to another, there are endless variations of UEFI BIOS. Options and settings may be named differently across manufacturers.</p>

      <p>Windows tablets do not have BIOS. Instead, they feature UEFI firmware that can be accessed by holding the <span class="strong"><strong>volume down</strong></span> button while turning the tablet on with the <span class="strong"><strong>power</strong></span> key. Once you are in the UEFI, look for Startup options to specify the order of devices your tablet will be allowed to boot from (a comprehensive tutorial on how to boot any Windows tablet into UEFI is available at <a class="ulink" href="http://www.7tutorials.com/how-boot-uefi-bios-any-windows-81-tablet-or-device">http://www.7tutorials.com/how-boot-uefi-bios-any-windows-81-tablet-or-device</a>).</p>

      <p>If your external boot device contains a secure boot key (like Windows 8.1 or Windows PE 5.1), you won't need to change Secure Boot settings in the UEFI BIOS setup. If, however, you are using an unsigned bootable recovery image, you will need to disable Secure Boot first.</p>

      <p>Depending on the manufacturer, you may need to change the option called <span class="strong"><strong>Secure Boot</strong></span> to <span class="strong"><strong>disabled</strong></span> and the <span class="strong"><strong>UEFI Boot</strong></span> to <span class="strong"><strong>CSM Boot</strong></span> (or <span class="strong"><strong>Setup Mode</strong></span> in some tablets) in order to allow the system to boot from external devices. After this, you should be able to boot from custom (unsigned) recovery media.</p>

      <p>Note that disabling Secure Boot is not available on Windows RT devices.</p>

    </div>

  </div>




  <div class="section" title="Acquiring a BitLocker encryption key">

    <div class="titlepage">

      <div>

        <div>

          <h1 class="title"><a id="ch08lvl1sec53"/>Acquiring a BitLocker encryption key</h1>

        </div>

      </div>

    </div>

    <p>BitLocker encryption is optional on Windows devices. Moreover, many budget-oriented tablets (such as those equipped with Intel Z3735 and 1 GB RAM) lack TPM (Trusted Platform Module) support, which makes the use of BitLocker complicated on such devices. By default, BitLocker encryption is not enabled in Windows 8.x, and is only activated when (and if) the user signs in to their Windows 8 machine with their Microsoft Account (as opposed to using a local Windows account). If you are using a Surface RT/2 with a Microsoft account and admin rights then Bitlocker (or Device Encryption) was automatically turned on for you the first time you logged in.</p>

    <p>If enabled, BitLocker encryption will effectively prevent an investigator from accessing the content of the device - even if booting from a recovery drive.</p>

    <div class="note" title="Note" style="">

      <div class="inner">

        <h3 class="title" id="toc_1"><a id="note45"/>Note</h3>

        <p> <span class="strong"><strong>Important</strong></span>: BitLocker is an essential part of the Windows security model, and a major obstacle to an investigation. All efforts shall be taken in order to preserve and recover BitLocker keys. It is essential to attempt capturing the dump of the computer's volatile memory, which will contain binary decryption keys to BitLocker volumes (if used). Finally, BitLocker encryption is still optional, and will not automatically activate if the computer only has local Windows accounts and does not use an administrative Microsoft Account.</p>

      </div>

    </div>

    <p>When using a USB recovery drive, especially if that recovery drive was not created on the particular device being imaged, you may not be able to access the content of its storage because of BitLocker encryption. When using command prompt, you might be prompted to enter the encryption key. Without this key, the volume with all user data will remain securely encrypted.</p>

    <p>BitLocker protection can be unlocked with the correct Recovery Key. This key is unique per computer, and is stored in the user's Microsoft Account. You will need to have the user's Microsoft Account login and password in order to retrieve the Recovery Key. The following steps describe how to extract the Recovery Key from the user's Microsoft Account:</p>

    <div class="orderedlist">

      <ol class="orderedlist arabic">

        <li class="listitem">If prompted for a Recovery Key, make a note of the <span class="strong"><strong>Key ID</strong></span> mentioned on the screen of the device.</li>

        <li class="listitem">Use another computer to go to <a class="ulink" href="http://windows.microsoft.com/recoverykey">http://windows.microsoft.com/recoverykey</a>.</li>

        <li class="listitem">Locate the device with the same Key ID noted above.</li>

        <li class="listitem">Use the Recovery Key corresponding to the given Key ID to unlock the encrypted drive.</li>

      </ol>

    </div>

    <p> <span class="strong"><strong>Important</strong></span>: Microsoft holds Recovery Keys to users' BitLocker-encrypted storage devices. These keys are available in and can be obtained from the user's Microsoft Account unless explicitly deleted by the user. Consideration should be taken to prevent the suspect from destroying the Recovery Key after their encrypted device has been seized. If you know the user's Microsoft Account credentials, the Recovery Keys can be obtained in a matter of minutes. The Recovery Keys can be obtained directly from Microsoft by submitting a written request accompanied with a court order.</p>

    <p>More information about BitLocker Recovery Key is available at <a class="ulink" href="https://technet.microsoft.com/en-us/library/ee449438(v=ws.10).aspx">https://technet.microsoft.com/en-us/library/ee449438(v=ws.10).aspx</a>.</p>

    <p>Microsoft has also published instructions on regaining access to computers locked by BitLocker Drive Encryption here: <a class="ulink" href="https://technet.microsoft.com/en-us/library/cc732774(v=ws.11).aspx">https://technet.microsoft.com/en-us/library/cc732774(v=ws.11).aspx</a>.</p>

    <p>Note that you'll still need a Recovery Key to unlock the disk when using Microsoft instructions. Alternatively, you can use third-party software to mount BitLocker-encrypted volumes if you manage to capture the content of the tablet's volatile memory while the encrypted partition was mounted. More on that in the next chapter.</p>

    <div class="section" title="Breaking into Microsoft Account to acquire the BitLocker Recovery Key">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_2"><a id="ch08lvl2sec97"/>Breaking into Microsoft Account to acquire the BitLocker Recovery Key</h2>

          </div>

        </div>

      </div>

      <p>Acquiring BitLocker Recovery Key is easy once you have access to the user's Microsoft Account. A valid password is required in order to log in to Microsoft Account. If you don't know the password, brute-forcing your way into an online service is not going to work.</p>

      <p>Starting with Windows 8, users can opt to sign in to their computers with their online account credentials instead of using a local Windows account and password. By using Microsoft Account, they get automatic cloud backups, the ability to sync settings and data (such as browser passwords) across multiple devices, and, most importantly, the ability to back up their BitLocker Recovery Keys to the cloud.</p>

      <p>Signing in to Microsoft Account takes an e-mail and password (as opposed to a username and password). It is easy to see whether a local or Microsoft Account was used. Logins such as <code class="literal">username@live.com</code>, <code class="literal">username@hotmail.com</code>, or <code class="literal">username@outlook.com</code> are sure giveaways of Microsoft Account sign ins. Microsoft Account is used as a single sign-in solution for various Microsoft services such as Outlook.com, OneDrive, and Skype.</p>

      <p>Since Microsoft Account is a cloud-based online authentication service, normally you would not be able to break in. Trying more than a handful of wrong passwords would lock out subsequent login attempts. However (and this is great news), Microsoft Account password hash is cached locally on all computers using these credentials.</p>

      <p>This, in turn, allows for an interesting twist. You can acquire a local hash of that password and use it to brute-force your way into the online Microsoft Account by running an offline attack.</p>

      <p>In order to do that, you can use two tools: Elcomsoft System Recovery (<a class="ulink" href="https://www.elcomsoft.com/esr.html">https://www.elcomsoft.com/esr.html</a>) to create bootable media (for example, a USB drive) to export the locally cached Microsoft Account password hash, and Elcomsoft Distributed Password Recovery (<a class="ulink" href="https://www.elcomsoft.com/edpr.html">https://www.elcomsoft.com/edpr.html</a>) to actually brute-force the password using a GPU-assisted attack distributed among multiple computers. A combination of dictionary and brute-force attacks may result in the recovery of the original plain-text password to the user's Microsoft Account, unlocking access to BitLocker Recovery Keys saved in that account and allowing us to decrypt the BitLocker volume.</p>

    </div>

    <div class="section" title="Using Elcomsoft Forensic Disk Decryptor to unlock BitLocker partitions">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_3"><a id="ch08lvl2sec98"/>Using Elcomsoft Forensic Disk Decryptor to unlock BitLocker partitions</h2>

          </div>

        </div>

      </div>

      <p>Since many Windows tablets ship with BitLocker protection activated for the C drive partition, you will need a way to unlock protected volumes. BitLocker volumes can be unlocked automatically if you enter the correct user login and password. You can also unlock BitLocker volumes by supplying the correct Recovery Key which, in turn, can be often retrieved from the user's Microsoft Account.</p>

      <p>But what if you don't know either password, and don't have access to the Recovery Key? If this is the case, you still have the option to extract the key from the computer's volatile memory dump. This is one of the reasons why you absolutely must try your best to make a dump of the computer's RAM before trying anything else.</p>

      <p>If the Windows device you are about to acquire is active or sleeping (Connected Standby), do not allow it to power off. Try capturing a RAM image first. If the device uses BitLocker Device Protection, capturing a live memory dump can be the only chance to obtain the BitLocker decryption key. If you can extract that key, you will be able to use <span class="strong"><strong>Elcomsoft Forensic Disk Decryptor</strong></span> (<a class="ulink" href="https://www.elcomsoft.com/efdd.html">https://www.elcomsoft.com/efdd.html</a>) to mount BitLocker-protected partitions even if you cannot sign in to the device.</p>

    </div>

    <div class="section" title="BitLocker keys and Trusted Platform Module">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_4"><a id="ch08lvl2sec99"/>BitLocker keys and Trusted Platform Module</h2>

          </div>

        </div>

      </div>

      <p>While many budget tablets running Windows 8 and 8.1 (and some Windows 10 devices) lack <span class="strong"><strong>Trusted Platform Module</strong></span> (<span class="strong"><strong>TPM</strong></span>) support, one can encounter devices with and without the TPM module. It is important to realize that, because the keys needed to decrypt data remain locked by the TPM, one cannot read the data just by removing the storage device and installing it in another computer (source: <a class="ulink" href="https://technet.microsoft.com/library/cc732774.aspx">https://technet.microsoft.com/library/cc732774.aspx</a>). More importantly, the TPM has its own memory that is separate from the memory accessible by the operating system. This means that private portions of key pairs are kept separated from the memory controlled by the operating system, are not exposed to any part of the OS or software, and cannot be captured with memory dumping tools.</p>

      <p>The actual drive encryption key, however, is released to the operating system, stored in the system's RAM, and can be retrieved by capturing a snapshot of the computer's volatile memory and examining the snapshot with Elcomsoft Forensic Disk Decryptor.</p>

      <p> <span class="strong"><strong>TPM facts summary</strong></span>:</p>

      <div class="itemizedlist">

        <ul class="itemizedlist">

          <li class="listitem" style="list-style-type: disc">TPM is not available on many budget Windows tablets</li>

          <li class="listitem" style="list-style-type: disc">If TPM is not installed, BitLocker encryption is not immediately available (yet it can be manually activated by the user via <code class="literal">gpedit.msc</code> <span class="emphasis"><em>Allow BitLocker without a compatible TPM</em></span> option)</li>

          <li class="listitem" style="list-style-type: disc">If TPM is available, the drive remains locked until the key is released</li>

          <li class="listitem" style="list-style-type: disc">Once the encrypted drive is unlocked, the decryption key remains in the computer's RAM, is accessible to the OS, and can be acquired by capturing a memory dump and analyzing with Elcomsoft Forensic Disk Decryptor</li>

        </ul>

      </div>

    </div>

  </div>




  <div class="section" title="Imaging Windows RT tablets">

    <div class="titlepage">

      <div>

        <div>

          <h1 class="title"><a id="ch08lvl1sec54"/>Imaging Windows RT tablets</h1>

        </div>

      </div>

    </div>

    <p>While we said a lot about creating a bootable USB device for Windows RT tablets, how or even if it's possible to image one is still a big question. Windows RT is an inherently crippled platform with platform-level security measures that are extremely effective in disallowing anything but signed code to boot or execute on RT devices. Pre-activated Secure Boot that cannot be disabled, ARM architecture instead of x86, and system-level trusted signature checks for all desktop applications make traditional acquisition techniques ineffective.</p>

    <p>As all known Windows RT devices are using eMMC, a soldered-on BGA chip, it is technically possible to perform chip-off or ISP acquisition.</p>

    <p> </p>

    <div class="mediaobject">

      <img src="0145.jpeg" alt="Imaging Windows RT tablets"/>

    </div>

    <p> </p>

    <p>This, however, is a time-consuming, labor-intensive, and destructive process which is not always available as an option during routine investigations. BitLocker disk encryption, if enabled, can make the acquisition process difficult or impossible. Even in Windows RT, other imaging options are available.</p>

    <div class="section" title="BitLocker encryption">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_1"><a id="ch08lvl2sec100"/>BitLocker encryption</h2>

          </div>

        </div>

      </div>

      <p>Windows RT is a crippled and secure platform. By default, the C drive partition where all the user files reside is protected with BitLocker. Booting from the recovery media, accessing the <span class="strong"><strong>Windows Recovery Environment</strong></span> (<span class="strong"><strong>WinRE</strong></span>) Command Prompt or otherwise attempting to log in without supplying the correct account password or PIN code will result in being locked out and unable to access information stored on the partition of interest. As a result, Windows RT forensics requires you to know either a password to an administrative account (or, in a worst-case scenario, to any local account at all) or to have access to the BitLocker Recovery Key. More information about this in the <span class="emphasis"><em>Acquiring BitLocker Encryption Key</em></span> section.</p>

      <p>BitLocker To Go is partially supported in Windows RT. According to Microsoft (<a class="ulink" href="https://technet.microsoft.com/en-us/library/dn736041.aspx#BKMK_bitlockertogo">https://technet.microsoft.com/en-us/library/dn736041.aspx#BKMK_bitlockertogo</a>), <span class="emphasis"><em>"Although Windows RT 8.1 cannot create encrypted BitLocker To Go USB drives or SD cards, it is able to use these drives or cards after they have been encrypted from Windows 8 Pro or Windows 8 Enterprise (or even Windows 7) computers. When inserting the BitLocker To Go USB drive or SD card, the user will be prompted to provide the required password before they can access or update the data on the USB drive or SD card."</em></span> </p>

      <div class="note" title="Note" style="">

        <div class="inner">

          <h3 class="title" id="toc_2"><a id="note46"/>Note</h3>

          <p> <span class="strong"><strong>Important</strong></span>: By default, Windows RT will create BitLocker escrow keys and upload them to the user's Microsoft Account. Microsoft holds Recovery Keys to users' BitLocker-encrypted storage devices. These keys are available in and can be obtained from the user's Microsoft Account unless explicitly deleted by the user. If you know the user's Microsoft Account credentials, the Recovery Keys can be obtained in a matter of minutes via <a class="ulink" href="https://onedrive.live.com/recoverykey">https://onedrive.live.com/recoverykey</a>. The Recovery Keys can also be obtained directly from Microsoft by submitting a written request accompanied with a court order.</p>

        </div>

      </div>

    </div>

    <div class="section" title="DISM – a built-in tool to image Windows RT">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_3"><a id="ch08lvl2sec101"/>DISM – a built-in tool to image Windows RT</h2>

          </div>

        </div>

      </div>

      <p>As we know, Windows RT disallows booting into anything other than Windows RT. The system does not allow running any unsigned desktop apps either.</p>

      <p>So let's say you have a Microsoft Surface RT, Surface 2, Nokia Lumia 2520, or any other RT tablet. You managed to boot the device from a USB recovery media containing Windows RT, and have full access to the command line. As with Android or iOS tablets, there's not a lot you can do to image it since the tablet is running on an ARM CPU and is locked to only allow built-in desktop tools to run. Since Windows RT tablets can't execute x86 code (and can't run unsigned ARM code), support from manufacturers of forensic tools is non-existent. This all means that, in your forensic needs, you are limited to using command-line tools that are built into Windows.</p>

      <p>Fortunately, there is a tool that does exactly what we need. Microsoft's Deployment Image Servicing and Management (<code class="literal">DISM.exe</code>) is fully capable of creating images of Windows partitions and saving them in the WIM format.</p>

      <p>In order to image the tablet, do the following.</p>

      <div class="note" title="Note" style="">

        <div class="inner">

          <h3 class="title" id="toc_4"><a id="note47"/>Note</h3>

          <p> <span class="strong"><strong>Note</strong></span>: The preceding described techniques are not limited to Windows RT. They can be applied to any tablet running Windows 8, 8.1, Windows Server 2012, or Windows RT. However, better acquisition methods are available for non-RE systems. DISM imaging should only be used as a last-resort measure.</p>

        </div>

      </div>

    </div>

    <div class="section" title="Must be logged in with an administrative account">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_5"><a id="ch08lvl2sec102"/>Must be logged in with an administrative account</h2>

          </div>

        </div>

      </div>

      <p>If you are logged in already and have administrative privileges, you may skip directly to the <span class="emphasis"><em>Using DISM.exe to image the drive</em></span> section. If not, you'll need to boot your system into recovery mode to gain access to the administrative-level command prompt.</p>

    </div>

    <div class="section" title="Must be logged in">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_6"><a id="ch08lvl2sec103"/>Must be logged in</h2>

          </div>

        </div>

      </div>

      <p>Since Windows PE does not exist for RT architecture, you are limited to using Windows Recovery (Repair) Environment (WinRE) in order to gain administrative access to the computer. In particular, you'll need to access the command prompt. After booting to the command prompt, you'll have access to Windows built-in command-line tools. In particular, we'll be using the DISM tool to image partitions on the device.</p>

      <p>If you are logged in, you can configure your system to boot into Windows Recovery Environment with command prompt.</p>

    </div>

    <div class="section" title="Booting to  the WinRE command prompt">

      <div class="titlepage">

        <div>

          <div>

            <h2 class="title" id="toc_7"><a id="ch08lvl2sec104"/>Booting to  the WinRE command prompt</h2>

          </div>

        </div>

      </div>

      <p>In order to boot into WinRE Command Prompt, do the following:</p>

      <div class="orderedlist">

        <ol class="orderedlist arabic">

          <li class="listitem">Start the tablet.</li>

          <li class="listitem">At the login prompt, tap the Ease of Access icon.</li>

          <li class="listitem">Select <span class="strong"><strong>On-Screen Keyboard</strong></span>.</li>

          <li class="listitem">Tap the <span class="emphasis"><em>Shift</em></span> key, the <span class="emphasis"><em>Shift</em></span> key should remain lit.</li>

          <li class="listitem">In the lower right corner, tap the power key and select <span class="strong"><strong>Restart</strong></span>.</li>

          <li class="listitem">When the unit reboots, select the <span class="strong"><strong>Troubleshoot</strong></span> option.</li>

          <li class="listitem">From here, select <span class="strong"><strong>Advanced</strong></span> options.</li>

          <li class="listitem">Select <span class="strong"><strong>Command Prompt</strong></span>.</li>

        </ol>

      </div>

      <div class="section" title="Entering BitLocker Recovery Key">

        <div class="titlepage">

          <div>

            <div>

              <h3 class="title" id="toc_8"><a id="ch08lvl3sec41"/>Entering BitLocker Recovery Key</h3>

            </div>

          </div>

        </div>

        <p>You may be prompted for a Recovery Key for the primary partition. In case you see the message <span class="strong"><strong>Enter the recovery key to get going again</strong></span>, enter the Recovery Key and press Enter. If you don't have the Recovery Key, you will still have access to the command prompt by using the <span class="strong"><strong>Skip this drive</strong></span> option, but you won't be able to read the encrypted volume. More information in <span class="emphasis"><em>BitLocker recovery keys: Frequently asked questions</em></span>: <a class="ulink" href="http://windows.microsoft.com/en-us/windows-8/bitlocker-recovery-keys-faq">http://windows.microsoft.com/en-us/windows-8/bitlocker-recovery-keys-faq</a>.</p>

        <p>If you have your own bootable USB drive, you can similarly configure the system to boot from that drive.</p>

      </div>

      <div class="section" title="Using DISM.exe to image the drive">

        <div class="titlepage">

          <div>

            <div>

              <h3 class="title" id="toc_9"><a id="ch08lvl3sec42"/>Using DISM.exe to image the drive</h3>

            </div>

          </div>

        </div>

        <p>Microsoft TechNet has a comprehensive guide on how to capture Windows partitions using the DISM.exe tool (see the preceding link to <span class="emphasis"><em>Capture Images of Hard Disk Partitions Using DISM</em></span>):</p>

        <div class="orderedlist">

          <ol class="orderedlist arabic">

            <li class="listitem"><span class="strong"><strong>Determine which partitions to capture</strong></span>: Most commonly, Windows RT tablets are equipped with a single System partition, a single Primary partition, and one or more Reserved partitions (containing the recovery image). What you need is the Primary partition (and all Logical partitions, if any).</li>

            <li class="listitem"><span class="strong"><strong>Assign drive letters to partitions</strong></span>: If one or more partitions you want to capture don't already have a drive letter assigned, assign a letter using the DiskPart tool. The partition will be mounted in R/W mode.</li>

            <li class="listitem"><span class="strong"><strong>Capture </strong></span><span class="strong"><strong>images with the DISM command-line tool: </strong></span>You'll be using the DISM command together with the <code class="literal">/capture-Image</code> option. Example:</li>

          </ol>

        </div>

        <pre class="programlisting"> <span class="strong"><strong>Dism /Capture-Image /ImageFile:c:\partition0.wim /CaptureDir:C:\ /Name:"partition0"</strong></span> </pre>

        <div class="note" title="Note" style="">

          <div class="inner">

            <h3 class="title" id="toc_10"><a id="note48"/>Note</h3>

            <p> <span class="strong"><strong>Note</strong></span>: if your attached storage does not have the required amount of space to receive the entire partition, you may save images to the network disk by running the <code class="literal">net use n: \\Server\Share</code> command and substituting the path of the <code class="literal">/ImageFile</code> parameter with the newly mapped network drive.</p>

          </div>

        </div>

        <p>You can read more about DISM command-line tools and its options and parameters on Microsoft TechNet:</p>

        <div class="itemizedlist">

          <ul class="itemizedlist">

            <li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>DISM Image Management Command-Line Options</em></span>: <a class="ulink" href="https://technet.microsoft.com/en-in/library/hh825258.aspx">https://technet.microsoft.com/en-in/library/hh825258.aspx</a></li>

            <li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Capture Images of Hard Disk Partitions Using DISM</em></span>: <a class="ulink" href="https://technet.microsoft.com/en-us/library/hh825072.aspx">https://technet.microsoft.com/en-us/library/hh825072.aspx</a></li>

            <li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Capture and Apply Windows, System, and Recovery Partitions</em></span>: <a class="ulink" href="https://technet.microsoft.com/en-us/library/hh825041.aspx">https://technet.microsoft.com/en-us/library/hh825041.aspx</a></li>

          </ul>

        </div>

      </div>

    </div>

  </div>




  <div class="section" title="Cloud Acquisition">

    <div class="titlepage">

      <div>

        <div>

          <h1 class="title"><a id="ch08lvl1sec55"/>Cloud Acquisition</h1>

        </div>

      </div>

    </div>

    <p>Windows RT is a Windows 8/8.1-based OS. As such, the system has the ability to maintain cloud backups in Microsoft OneDrive. Information backed up into the cloud includes contacts, messages, synced Internet Explorer passwords, list of installed applications, and some application settings such as stored passwords (for example, reinstalling a previously installed Pocket client after a full factory reset does not require logging in; the app will work immediately. However, any downloaded content will be re-downloaded).</p>

    <p>The data is only automatically backed up if the user is logged in with a Microsoft Account (as opposed to using a local Windows account) and has the Backup option enabled in the settings. This, however, is a typical usage scenario for Windows RT tablets.</p>

    <p>In order to download Windows RT data, use the <span class="strong"><strong>Download Windows Phone data</strong></span> acquisition option in Elcomsoft Phone Breaker:</p>

    <p> </p>

    <div class="mediaobject">

      <img src="0146.jpeg" alt="Cloud Acquisition"/>

    </div>

    <p> </p>

    <p>You will need to specify the user's Microsoft Account login and password.</p>

    <p> </p>

    <div class="mediaobject">

      <img src="0147.jpeg" alt="Cloud Acquisition"/>

    </div>

    <p> </p>

    <p>The tool downloads information from Microsoft Live! servers (at this time, only Contacts, Notes, and Messages can be downloaded).</p>

    <p> <span class="strong"><strong>Note:</strong></span> Since the user may own more than a single Microsoft device, Elcomsoft Phone Breaker will download information synced by all devices where the user signed in with their Microsoft Account. This includes Windows Phone 8.1 and Windows 10 Mobile smartphones, Windows RT tablets, Windows 8, 8.1, and Windows 10 desktops, laptops, and tablet computers. The list of available backups can be viewed by signing into the user's OneDrive account and choosing <span class="strong"><strong>Settings</strong></span> | <span class="strong"><strong>Device Backups</strong></span> (<a class="ulink" href="https://onedrive.live.com/Options/DeviceBackups">https://onedrive.live.com/Options/DeviceBackups</a>).</p>

    <p> </p>

    <div class="mediaobject">

      <img src="0148.jpeg" alt="Cloud Acquisition"/>

    </div>

    <p> </p>

    <p>Elcomsoft Phone Breaker downloads information:</p>

    <p> </p>

    <div class="mediaobject">

      <img src="0149.jpeg" alt="Cloud Acquisition"/>

    </div>

    <p> </p>

    <p>After the extraction is finished, you'll be able to view the downloaded backup in Elcomsoft Phone Viewer. The following screenshot demonstrates information extracted from a cloud backup saved by a Lenovo ThinkPad 8 tablet (Windows 8.1):</p>

    <p> </p>

    <div class="mediaobject">

      <img src="0150.jpeg" alt="Cloud Acquisition"/>

    </div>

    <p> </p>

  </div>




  <div class="section" title="Summary">

    <div class="titlepage">

      <div>

        <div>

          <h1 class="title"><a id="ch08lvl1sec56"/>Summary</h1>

        </div>

      </div>

    </div>

    <p>In this chapter, we talked about acquiring Windows tablets. We covered the acquisition of Windows 8.x and Windows 10 tablets, and addressed the issues of ARM-based Windows tablets running the dedicated ARM-based version of Windows, Windows RT. We learned about automatic BitLocker encryption and reviewed methods of circumventing BitLocker protection by extracting BitLocker Recovery Keys from the user's Microsoft Account. Finally, we learned how to break in to Microsoft Account by executing an offline password recovery attack on the user's cached password. In the next chapter, we'll move back to smartphones and look into acquisition options available for BlackBerry smartphones.</p>

  </div>

</body></html>