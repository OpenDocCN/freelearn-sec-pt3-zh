<html><head></head><body>
		<div><h1 id="_idParaDest-118"><em class="italic">Chapter 7</em>: <a id="_idTextAnchor119"/>Azure Security Center</h1>
			<p>Azure Security Center is meant to be that one tool that gives you a unified overview of your hybrid cloud environment's current security configuration, and informs you about current threats and attacks against your services.</p>
			<p>In this chapter, we will cover the following topics:</p>
			<ul>
				<li>Introducing Azure Security Center</li>
				<li>Secure score and recommendations</li>
				<li>Automating responses</li>
				<li>Just-in-time access for Azure Virtual Machines</li>
				<li>Advanced Cloud Defense </li>
			</ul>
			<h1 id="_idParaDest-119"><a id="_idTextAnchor120"/>Introducing Azure Security Center</h1>
			<p>With cloud computing the main paradigm in the modern IT world, there are many benefits that come with this <a id="_idIndexMarker397"/>new way of working. IT is no longer an end in itself and employees are way more productive than they were back in the day. But there are also new challenges when it comes to protecting modern IT environments. </p>
			<p>In <a href="B15414_03_Final_JM_ePub.xhtml#_idTextAnchor060"><em class="italic">Chapter 3</em></a>, <em class="italic">Managing Cloud Identities</em>, we already covered advanced identity protection and that it is no longer enough to protect network boundaries, however, there are some other main security challenges that come with cloud computing.</p>
			<p>How can you make sure you protect your ever-changing cloud services and applications? This is one of the value propositions of cloud computing and, in fact, probably the main benefit is that you can easily change and adapt in cloud environments. Be it <strong class="bold">Define acronym continuous integration (CI)/ continuous delivery (CD), Virtual Machine (VM).</strong> Define acronym upscaling, or service decommissioning, cloud environments are dynamically changing. But at the same time, one of the main challenges is to keep track of these changes and to make sure that a company's services always adhere to their security baseline.</p>
			<p>The threat landscape is evolving, and attacks are becoming increasingly sophisticated. Bad actors are using attack automation and evasion techniques, and at the same time, they are leveraging tools that help them to conduct attacks across the cyber kill chain. So, they no longer need to be highly trained technology experts, which results in an increasing number of sophisticated attacks, some of which are spear-phishing and credential theft attacks. Also, attackers are using hijacked computers, tied to bot networks, to conduct widely spread password spray attacks, which can be hard to recognize.</p>
			<p>We need human expertise, creativity, and adaptability to combat human threat actors. The downside is that security skills are in short supply. Currently, there are about 3 million open positions in the cyber security sector out there worldwide, with that number increasing. This includes not only cyber threat hunters, but also security engineers and administrators with a focus on managing internal IT systems.</p>
			<p>Azure Security <a id="_idIndexMarker398"/>Center is a service that offers two main solutions:</p>
			<ol>
				<li value="1">As a <strong class="bold">Cloud Security Posture Management</strong> (<strong class="bold">CSPM</strong>) solution, Azure Security Center constantly <a id="_idIndexMarker399"/>provides information about the current configuration status of all your cloud resources to avoid misconfiguration with regard to security.</li>
				<li>As a <strong class="bold">Cloud Workload Protection Platform</strong> (<strong class="bold">CWPP</strong>), Azure Security Center provides protection <a id="_idIndexMarker400"/>against cyber threats aimed at servers, no matter whether they are running in Microsoft Azure, on premises, or in another cloud platform, as well as protection against threats aimed at your cloud-native workloads in Azure, for example key vaults, storage accounts, SQL databases, and more:</li>
			</ol>
			<div><div><img src="img/Fig._7.1.jpg" alt="Figure. 7.1 – Azure Security Center Overview dashboard&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.1 – Azure Security Center Overview dashboard</p>
			<p>The central <a id="_idIndexMarker401"/>Azure Security Center <strong class="bold">Overview</strong> dashboard is divided into three different areas:</p>
			<ul>
				<li><strong class="bold">Policy &amp; compliance</strong> </li>
				<li><strong class="bold">Resource security hygiene</strong></li>
				<li><strong class="bold">Threat protection</strong></li>
			</ul>
			<p>In the <strong class="bold">Policy &amp; compliance</strong> section, you'll find information about everything related to <em class="italic">compliance</em> and <em class="italic">governance</em>. For example, <strong class="bold">Subscription coverage</strong> gives you insights into the enrollment state of Azure Security Center over all your subscriptions. In other words, you can see whether there are Azure subscriptions in your tenant that are not covered by Azure Security Center. You also get a view of your <strong class="bold">Overall secure score</strong>, a number that reflects how well (or badly) your environment is protected. <strong class="bold">Regulatory compliance</strong>, finally, is a part of Azure Security Center that will help you to make sure that your cloud environment is compliant regarding regulations such as <strong class="bold">Azure CIS 1.1.0</strong> and <strong class="bold">ISO27001</strong>.</p>
			<p>The second section in Azure Security Center, <strong class="bold">Resource security hygiene</strong>, is the area that shows you recommendations <a id="_idIndexMarker402"/>regarding your current security configuration. By continuously assessing your environmental configuration, Azure Security Center gives you recommendations <a id="_idIndexMarker403"/>regarding security best practices to help you protect your environments.</p>
			<p>In the <strong class="bold">Threat protection</strong> section, the last of the three main sections, Azure Security Center shows you current security alerts and incidents (which are cumulations of single alerts that are brought into context):</p>
			<div><div><img src="img/Fig_7.2.jpg" alt="Figure. 7.2 – Security alerts and incidents&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.2 – Security alerts and incidents</p>
			<p>You can select an incident or an alert to get more information about the context and about remediation steps for every single alert and can trigger an Azure logic app as a response for the alert. For example, you could create a logic app that sends out an email or a post to a Microsoft Teams channel. </p>
			<p class="callout-heading">Note:</p>
			<p class="callout">Azure Security Center is a tool for security engineers and administrators that are responsible for protecting (hybrid) enterprise infrastructures. It is a tool that helps in implementing security best practices and gives a security overview. For threat hunting and digging deeper into alerts and incidents, you would be better off using Azure Sentinel, a SIEM/SOAR solution that we will talk about in <a href="B15414_08_Final_JM_ePub.xhtml#_idTextAnchor132"><em class="italic">Chapter 8</em></a>, <em class="italic">Azure Sentinel</em>.</p>
			<p>Now, that you <a id="_idIndexMarker404"/>have gotten a quick overview of Azure Security Center and its <strong class="bold">Overview</strong> dashboard, let's dig a bit deeper and see how it technically works.</p>
			<h2 id="_idParaDest-120"><a id="_idTextAnchor121"/>Enabling Azure Security Center</h2>
			<p>As a first step in leveraging Azure Security Center, we must enable this service and provide initial configuration parameters. There are several key components we need to consider before starting. </p>
			<p>Azure Security <a id="_idIndexMarker405"/>Center basically relies on Azure Log Analytics and its respective workspace, on Intelligent Security Graph, and on Azure Policy:</p>
			<ul>
				<li>The <strong class="bold">Log Analytics workspace</strong> is used for storing all kinds of log information, such as Windows Server security event logs, or Linux server syslog entries, but also for storing security alerts and other information. </li>
				<li><strong class="bold">Intelligent Security Graph</strong> is an AI/ML-based backend used to identify attacks and threats by evaluating the billions of threats signals that are generated in Microsoft products and services every day. Alerts and incidents in the <strong class="bold">Threat Protection</strong> section of Azure Security Center are basically generated using Intelligent Security Graph (and tools that rely on it and integrate into Azure Security Center, such as Microsoft Defender ATP). </li>
				<li><strong class="bold">Azure Policy</strong>, a service we have already covered in <a href="B15414_02_Final_JM_ePub.xhtml#_idTextAnchor038"><em class="italic">Chapter 2</em></a>, <em class="italic">Governance and Security</em>, is what recommendations in Azure Security Center rely on.</li>
			</ul>
			<p>Azure Security Center comes in two different pricing tiers: </p>
			<ul>
				<li>Free</li>
				<li>Standard</li>
			</ul>
			<p>With the free tier of Azure Security Center, you get access to your Azure Secure Score, as well as continuous assessments of your current configuration and security recommendations for Azure resources. If you want to also protect on-premise servers or VMs running in another public cloud platform, or if you want to leverage other features, such as just-in-time VM access, adaptive application controls and network hardening, the regulatory compliance dashboards, threat protection, and so on, you need to enable the standard tier of Azure Security Center.</p>
			<p>Standard tier pricing depends on the resources you protect and is calculated as follows:</p>
			<ul>
				<li>VMs and servers:		$15 per node per month</li>
				<li>Azure App Service:	$15 per instance per month</li>
				<li>PaaS SQL Servers:		$15 per server per month</li>
				<li>Storage Accounts:		$0.02 per 10,000 storage transactions</li>
				<li>SQL Server on VMs:	Free (during preview)</li>
				<li>Container Registries:	$0.29 per container image (preview pricing)</li>
				<li>Azure K8s Service:	$2 per VM core per month (preview pricing)<p class="callout-heading">Important note</p><p class="callout">Even for the free tier of Azure Security Center, pricing for Azure Log Analytics applies. This is also true for the standard tier of Azure Security Center, where Log Analytics pricing is calculated in addition to the ASC standard tier cost mentioned above. Preview pricing is subject to change after the <a id="_idIndexMarker406"/>respective services become <strong class="bold">generally available</strong> (<strong class="bold">GA</strong>).</p></li>
			</ul>
			<p>Before you <a id="_idIndexMarker407"/>can start using Azure Security Center, you must define which pricing tier you want to use per Azure subscription and connect Azure Security Center to a Log Analytics workspace. You do so by navigating to the Azure <strong class="bold">Security Center </strong>portal and selecting <strong class="bold">Pricing &amp; settings</strong>, where you can define the pricing tier and other global settings per Azure subscription:</p>
			<div><div><img src="img/Fig_7.3.jpg" alt="Figure. 7.3 – Selecting an Azure Security Center pricing tier&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.3 – Selecting an Azure Security Center pricing tier</p>
			<p>In the <code>Auto Provisioning</code>, which enables the automatic installation of the Microsoft Monitoring Agent: </p>
			<div><div><img src="img/Fig_7.4.jpg" alt="Figure. 7.4 – Enabling Auto Provisioning&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.4 – Enabling Auto Provisioning</p>
			<p>You need to <a id="_idIndexMarker408"/>also define whether you want to use a default Log Analytics workspace, which is automatically created by Azure Security Center, or whether you want to use an existing workspace:</p>
			<div><div><img src="img/Fig_7.5.jpg" alt="Figure. 7.5 – Selecting your Log Analytics workspace configuration&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.5 – Selecting your Log Analytics workspace configuration</p>
			<p>The last decision you have to make in this section is about the amount of security and the number of AppLocker event log files you want to submit to the configured Log Analytics workspace. You can choose between the following options:</p>
			<ul>
				<li><strong class="bold">None</strong></li>
				<li><strong class="bold">Minimal</strong></li>
				<li><strong class="bold">Common</strong></li>
				<li><strong class="bold">All Events</strong></li>
			</ul>
			<p>After Azure Security Center is enabled, we can start benefitting from all the advantages it offers and make Azure security better. But Azure Security Center is not limited to cloud resources and can be extended to on-premises resources as well. Next, we will look at tools that Azure Security Center provides that enable us to increase our security posture. </p>
			<h1 id="_idParaDest-121"><a id="_idTextAnchor122"/>Azure Secure Score and recommendations</h1>
			<p>Like several other services in the Microsoft enterprise cloud, such as Azure AD, and Office 365, Azure Security Center <a id="_idIndexMarker409"/>now also offers a security gamification option, the <strong class="bold">Azure Secure Score</strong>. The idea is to show the number of points you could achieve at a maximum for your currently <a id="_idIndexMarker410"/>deployed Azure resources and what your current secure score is. The more points you get, the better your security posture is. It's like bringing the complexity of cloud security down to a simple game:</p>
			<div><div><img src="img/Fig_7.6.jpg" alt="Figure. 7.6 – Azure Secure Score Dashboard&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.6 – Azure Secure Score Dashboard</p>
			<p>The <strong class="bold">Secure Score Dashboard</strong> offers you an overview of your current <strong class="bold">Overall secure score</strong> and your <strong class="bold">Secure score by category</strong>. If you click one of the Secure Score categories, you will see recommendations within that category with their respective Secure Score impact. The higher a recommendation's Secure Score impact is, the more important it is to remediate the corresponding misconfiguration.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">Secure Score does not reflect industry-standard security benchmarks; for example, more than 700 out of 1,000 points is secure and less than 300 is extremely unprotected. Secure Score will only calculate points you can achieve depending on your currently deployed resources and regarding recommendations that already have been met, just like in a game.</p>
			<p>Two Azure environments are never comparable regarding their secure scores. You can only say that the more points you achieve, the better it is. If you compare Figure<em class="italic">. 7.1: Azure Security Center overview dashboard</em> and figure<em class="italic">. 7.6: Azure Secure Score Dashboard</em>, you'll realize that the overall secure scores do not match (393 of 655 versus 350 of 640). These screenshots show the same Azure environment with 6 days in between. There have been some resources that were deleted in the meantime, but no other configuration changes occurred. Azure Secure Score can be used to compare security levels for the same environment at different points in time. Every change in your cloud configuration will have an impact on the overall secure score and Azure Secure Score is directly connected with recommendations. So, the more recommendations you meet, the better your secure score will be. Now, let's move on to recommendations and see what is provided there.</p>
			<h2 id="_idParaDest-122"><a id="_idTextAnchor123"/>Working with recommendations</h2>
			<p>In <a href="B15414_02_Final_JM_ePub.xhtml#_idTextAnchor038"><em class="italic">Chapter 2</em></a>, <em class="italic">Governance and Security</em>, you already learned that monitoring is essential in terms of security and how to leverage policies to create guardrails for your Azure environment. The nice thing about Azure <a id="_idIndexMarker411"/>Security Center is that its free tier is automatically enabled once you visit the <strong class="bold">Azure Security Center</strong> dashboard in the Azure portal and security policies, continuous security assessments, and recommendations that help you protect your Azure resources are automatically included. These recommendations are security best practices that can be enabled or disabled in your security policy, which relies on the Azure Policy service you learned about in <a href="B15414_02_Final_JM_ePub.xhtml#_idTextAnchor038"><em class="italic">Chapter 2</em></a>,<em class="italic"> Governance and Security</em>. Every recommendation refers to an audit policy, and if a resource is non-compliant regarding a particular policy, the <strong class="bold">Recommendation</strong> dashboard will reflect this failed resource:</p>
			<div><div><img src="img/Fig_7.7.jpg" alt="Figure. 7.7 – Failed resources in the Azure Security Center Recommendation dashboard&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.7 – Failed resources in the Azure Security Center Recommendation dashboard</p>
			<p>When you click one of the recommendations, you'll see a description and threats this recommendation protects from. Depending on the recommendation, you can either remediate it directly from Azure Security Center, or you'll be informed about manual remediation steps. The <strong class="bold">Quick Fix!</strong> button from the preceding screenshot enables single-click remediation for several recommendations, one of which is disabling insecure connectivity to all of your storage accounts.</p>
			<h1 id="_idParaDest-123"><a id="_idTextAnchor124"/>The Azure Security Center community</h1>
			<p>This section, in the <strong class="bold">Azure Security Center (ASC)</strong>, blade, contains some very useful links that can help you expand your usage of Azure Security Center. On the community forum, you can check for various announcements, ask questions, or look <a id="_idIndexMarker412"/>for previously posted questions. The community blog offers detailed descriptions on some topics and how-to guides. User Voice offers you the chance to ask for new features or improvements.</p>
			<p>One of the useful links in the Azure Security Center community section is to the Azure Security Center GitHub repository. The repository contains security recommendations that are still in preview, Azure Policy custom definition for at-scale management, Logic Apps templates for automated responses (alerting or auto-heal), and security remediations in the form of programmatic tools and PowerShell scripts. This is a community repository, so everyone has the chance to contribute. If you've authored templates, scripts, or something else, and you think they may be helpful to others, feel free to submit them.</p>
			<h1 id="_idParaDest-124"><a id="_idTextAnchor125"/>Workflow automation and sections in Azure Security Center</h1>
			<p>Before we <a id="_idIndexMarker413"/>start with workflow automation, we need to quickly <a id="_idIndexMarker414"/>explain what logic apps are.</p>
			<p><strong class="bold">Azure Logic Apps</strong> is a cloud <a id="_idIndexMarker415"/>service that helps you to schedule, automate, and orchestrate different tasks, processes, and workflows. It also offers the ability to integrate with different applications, datasets, systems, and services across organizations. This makes it very useful in a number of scenarios, whether you want to create a repetitive automated task, trigger an action whenever a condition happens, or connect different systems.</p>
			<p>In terms of using Logic Apps with Azure Security Center, we can use workflow automation in order to set up a logic app to respond to Azure Security Center alerts. Alerts can be separated into groups, threats, and recommendations. Based on alerts, we can define an automated response based on severity and type.</p>
			<p>For example, we can set up a logic app to be automatically triggered whenever a brute-force attack is detected in Azure Security Center. We need to create a workflow that will automatically trigger a logic app based on the detected threat, as shown in the following screenshot:</p>
			<div><div><img src="img/Fig_7.8.jpg" alt="Figure. 7.8 – Configuring a logic app trigger in workflow automation&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.8 – Configuring a logic app trigger in workflow automation</p>
			<p>This will <a id="_idIndexMarker416"/>only set up a trigger for the specified logic app. We'll still <a id="_idIndexMarker417"/>need to configure a logic app for the response. For example, we could send a notification that a brute-force attack has been detected. Logic apps have many connectors configured and we can set up any or more of them. Some options are to send email notifications or to post messages in a Team<a id="_idTextAnchor126"/>s group: </p>
			<div><div><img src="img/Fig_7.9.jpg" alt="Figure. 7.9 – Configuring an alert to be posted in a Teams channel &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.9 – Configuring an alert to be posted in a Teams channel </p>
			<p>This is only one example of what an automated response could be. We can set up a number of custom actions <a id="_idIndexMarker418"/>such as temporarily disabling access to an attacked resource or <a id="_idIndexMarker419"/>blocking access for IP addresses from which an attack originates. The Azure Security Center GitHub repository offers a number of templates and scripts that can be used to automate a response.</p>
			<h2 id="_idParaDest-125"><a id="_idTextAnchor127"/>Policy &amp; compliance</h2>
			<p>The section <a id="_idIndexMarker420"/>covering policy and compliance contains four subsections:</p>
			<ul>
				<li>Coverage</li>
				<li>Secure score</li>
				<li>Security policy</li>
				<li>Regulatory compliance</li>
			</ul>
			<p>The coverage and secure score sections offer a security overview per subscription. The coverage section shows information about which Azure Security Center plan is enabled on each individual subscription and how many resources are covered per subscription. The secure score section can be seen on the main dashboard but this time it offers per-subscription information, showing us the score for each individual subscription.</p>
			<p>The security policy section helps you define what kind of security recommendations will be sent by Azure Security Center. By default, recommendations will be made based on the most common compliance standards and custom Azure CIS. This can be done on the subscription level, and we can set different settings for different subscriptions. </p>
			<p>Examples of default settings are shown in the following screenshot:</p>
			<div><div><img src="img/Fig_7.10.jpg" alt="Figure. 7.10 – Default policy settings &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.10 – Default policy settings </p>
			<p>Standard policies that are enabled by default are Azure CIS 1.1.0, PCI DSS 3.2.1, ISO 27001, and SOC TSP. Additional industry and regulatory standards that are available are NIST SP 800-53 R4, UK Official and UK NHS, Canada Federal PBMM, and SWIFT CSP CSCF v2020.</p>
			<p>Besides industry <a id="_idIndexMarker421"/>and regulatory standards, we can create custom policies that apply to our organization. Using custom policies, we can track what happens in our Azure environment, based on special requirements. To create a custom policy, we need to define a subscription to which this will apply and select definitions that we want to track. For example, we can set a policy to track whether SQL-managed instances have Transparent data encryption (TDE) enabled with custom keys, or whether Azure Backup is enabled for Azure Virtual Machines. Azure Security Center will the track resources on a defined subscription and send notifications when policies are not applied. It's important to mention that this will only track and send notifications that resources are not compliant with the policy. We need to act and make changes to recommendations to actually change the state of the resource and comply. </p>
			<p>An example of a custom policy is shown in the following screenshot:</p>
			<div><div><img src="img/Figure_7.11.jpg" alt="Figure. 7.11 – Creating a custom security policy &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.11 – Creating a custom security policy </p>
			<p>With security policies, we can define which (if any) industry standards we want to be compliant with. Under regulatory compliance, we can see how our subscription holds when evaluated on each standard. Four standards <a id="_idIndexMarker422"/>are currently available: Azure CIS 1.1.0, PCI DSS 3.2.1, ISO 27001, and SOC TSP. Each standard has controls, and we can see which controls are passed or failed. There are a total of 330 controls that intervene between standards. The regulatory compliance section offers an overview of all the controls and controls for each individual standard, as shown in the following screenshot:</p>
			<div><div><img src="img/Fig_7.12.jpg" alt="Figure. 7.12 – Regulatory compliance overview &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.12 – Regulatory compliance overview </p>
			<p>For each available standard, we can see a more detailed report with information on passed and failed controls. Similar to recommendations, we have a list of actions that need to be taken to pass controls. And the same as with recommendations, actions can be presented in the form of instructions that we need to perform manually, or they can offer a quick fix to resolve issues. </p>
			<p>An example of failed controls is shown in the following screenshot:</p>
			<div><div><img src="img/Fig_7.13.jpg" alt="Figure. 7.13 – Regulatory compliance overview&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.13 – Regulatory compliance overview</p>
			<p>Controls are there only as a guideline; they are not fixed automatically. A list of failed controls is there as a reminder of <a id="_idIndexMarker423"/>what needs to be addressed and fixed in order to pass controls.</p>
			<p>Resource security hygiene</p>
			<p>This section <a id="_idIndexMarker424"/>offers a different view of Azure Security Center recommendations. The section is divided into the following subsections: </p>
			<ul>
				<li><strong class="bold">Recommendations</strong></li>
				<li><strong class="bold">Compute &amp; Apps</strong></li>
				<li><strong class="bold">Networking</strong></li>
				<li><strong class="bold">IoT hub &amp; resources</strong></li>
				<li><strong class="bold">Data &amp; storage</strong></li>
				<li><strong class="bold">Identity &amp; access</strong></li>
				<li><strong class="bold">Security solutions</strong></li>
			</ul>
			<p>The <strong class="bold">Recommendations</strong> section offers the same information as seen in the overview, and the rest of the subsections offer subcategories based on types. For example, the <strong class="bold">Networking</strong> subsection will provide only recommendations referring to Azure network services, such as network security groups, network interfaces, virtual networks, and so on.</p>
			<p>The last subsection, <strong class="bold">Security solutions</strong>, enables the integration of third-party tools with Azure Security Center. We can add non-Azure servers to be monitored by Azure Security Center, send Azure Security Center logs to SIEM, or add a web application firewall or next-generation firewall. </p>
			<p>A lot of companies and organizations require a central logging solution – <strong class="bold">SIEM</strong> (<strong class="bold">Security Information and Event Management</strong>). All products and systems that have custom logging and a centralized solution that helps you identify events across an organization are very useful. So, the ability to send information and logs gathered by Azure Security Center may be a very important requirement, especially for large organizations and enterprises. Some SIEM solutions that may be integrated with Azure Security Center are IBM QRadar, Splunk, SumoLogic, ArcSight, Syslog server, LogRhythm, and Logz.io.</p>
			<p>The option to add non-Azure Virtual Machines to Azure Security Center enables true hybrid-cloud capabilities. The security enhancements that Azure Security Center enables for Azure Virtual Machines can be extended to basically any other server, running in a local data center or another cloud. This allows advanced threat detection and alerts and incident investigation across our environment. </p>
			<p>Advanced cloud defense</p>
			<p>Advanced cloud <a id="_idIndexMarker425"/>defense presents additional tooling for enhanced threat mitigation. Four additional tools are available:</p>
			<ul>
				<li>Adaptive application controls</li>
				<li>Just-in-time VM access</li>
				<li>Adaptive network hardening</li>
				<li>File integrity monitoring</li>
			</ul>
			<p>Adaptive application controls enable you to have control over which applications can run on servers protected by Azure Security Center. This applies both to Azure and non-Azure VMs and servers. We can control what can run on servers by allowing only specific applications or types of applications to run and prevent any malicious or unauthorized software. We can create different groups that will track the file type protection based on location, operating system, and environment type. Servers can be added to multiple groups to track different protection modes. An example of a group to protect a Windows VM in Azure, located in the US region with the audit option for any EXE, MSI, or script, is shown in the following screenshot:</p>
			<div><div><img src="img/Fig_7.14.jpg" alt="Figure. 7.14 – Adaptive application control group settings&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.14 – Adaptive application control group settings</p>
			<p>Azure Virtual Machine management is another topic that needs to be taken very seriously. Best practice is to perform <a id="_idIndexMarker426"/>any management tasks only over a secure connection, using a P2S or S2S connection. An alternative is to use one VM as a jumpbox, and then perform management from there. But even in this situation, the connection must be secure.</p>
			<h3 id="_idParaDest-126">Just-in-time VM access</h3>
			<p>Just-in-time access for Azure Virtual Machines is used to block inbound traffic to VMs until specific traffic is <a id="_idIndexMarker427"/>temporarily allowed. This reduces their exposure to attacks by narrowing down the surface and enabling access. Enabling <strong class="bold">Just In Time</strong> (<strong class="bold">JIT</strong>) will block inbound traffic <a id="_idIndexMarker428"/>on all ports that are usually used for management, such as RDP, SSH, or WinRM. The user must explicitly request access, which will be granted for a period of time but only for a known IP address. This approach is the same as is used with <strong class="bold">Privileged Identity Management</strong> (<strong class="bold">PIM</strong>), where <a id="_idIndexMarker429"/>having rights doesn't necessarily mean that we can use them all the time; we have to activate/request for them to be used for a period of time.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">JIT access for Azure Virtual Machines supports only VMs deployed through ARM (Azure Resource Manager). It's not <a id="_idIndexMarker430"/>available for non-Azure VMs or Azure VMs deployed through <strong class="bold">Azure Service Management</strong> (<strong class="bold">ASR</strong>).</p>
			<p>JIT can be configured from the Azure Security Center blade, or from the Azure VM blade. Configuring JIT for an Azure VM requires a few parameters to be defined, such as which ports we want to use, whether we want <a id="_idIndexMarker431"/>to allow access from a specific IP address or range in the <strong class="bold">Classless Inter-Domain Routing</strong> (<strong class="bold">CIDR</strong>) format, and the maximum period of time access will be available. </p>
			<p>An example of configuring JIT is shown in the following screenshot:</p>
			<div><div><img src="img/Fig_7.15.jpg" alt="Figure. 7.15 – Configuring JIT access&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.15 – Configuring JIT access</p>
			<p>By default, we have the most common management ports available. We can edit rules for these ports, delete rules, or add custom rules. Besides ports, we can change protocols, the allowed source, and the maximum request time (that can be between 1 and 24 hours).</p>
			<p>Once JIT is configured, access needs to be requested each time we want to access the VM. This, again, can be done <a id="_idIndexMarker432"/>from the Azure Security Center blade or the Azure VM blade. While we are requesting, we can ask for a specific (or more than one) port to be opened, state whether we want to enable access from our current IP address or from an IP range, and finally, we need to define the time range. The time range depends on the configuration. By default, the time range is from 1 to 3 hours but can be configured for up to 24 hours. </p>
			<p>Requesting JIT access is shown in the following screenshot:</p>
			<div><div><img src="img/Fig_7.16.jpg" alt="Figure. 7.16 – Requesting JIT access&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.16 – Requesting JIT access</p>
			<p>JIT uses <strong class="bold">Network Security Groups</strong> (<strong class="bold">NSGs</strong>) to control traffic that is allowed or blocked. When JIT is configured <a id="_idIndexMarker433"/>for an Azure VM, NSG rules are created to block access over configured ports. Ports that are not configured for JIT should be automatically blocked unless configured otherwise. When JIT access is requested, another NSG is temporarily created that will allow access on the requested port. The new NSG rule will have a higher priority and override the block rule to enable access. Once the requested time period expires, the allow rule will be deleted, and access will be blocked again.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">If JIT is in use, no NSG rules for management ports should be created manually. Azure Security Center should control these ports at all times. If we create rules manually, we may override JIT rules, or we may create a rule that will allow one of the management ports at all times and use JIT for the rest of the management ports. Both situations make JIT pointless. </p>
			<p>Advanced network hardening analyzes our traffic communication patterns. Analysis is performed to determine <a id="_idIndexMarker434"/>whether NSG rules are overly permissive and create a threat in the form of an increased attack surface. Three potential threats are tracked: a malicious insider, data spillage, and data exfiltration. Azure Security Center reports all threats and assesses the current rules to determine whether changes to NSG rules are required and offers recommendations that will increase security.</p>
			<p>File Integrity Monitoring is used to validate files and registries of the operating system and application software. It tracks changes and compares the current checksum of the file with the last scan of the same file to see whether they are different. Information can be used to determine whether changes are valid or the result of a malicious modification.</p>
			<h2 id="_idParaDest-127"><a id="_idTextAnchor128"/>Threat protection</h2>
			<p>Threat protection provides information and reports on detected threats. It's very useful to have information on <a id="_idIndexMarker435"/>what is happening with our resources and whether anyone is trying anything against us. </p>
			<p class="callout-heading">Important note</p>
			<p class="callout">No action will be performed by threat protection automatically; this section only provides information. To act on detected threats, we need to set up workflow automation. </p>
			<p>Information provided in the threat protection section can be eye-opening. You might not even be the intended target but still get hacked as a victim of opportunity or due to a moment of carelessness.</p>
			<p>To provide an example, we created an experiment where we deployed five Azure Virtual Machines and left the RDP port accessible over a private IP address. These were five blank VMs with no data and nothing special about them. What happens is that 'bad guys' scan public IP addresses in the hope of detecting open ports. After something like that is detected, a 'brute-force' attack will begin. Brute-force attacks use a combination of most common usernames and passwords to try to connect. These five Azure VMs, running for a single month, got hit approximately 20,000 times each. </p>
			<p>All these attacks can be tracked and seen in Azure Security Center, in the threat protection section. An example of a report is shown in the following screenshot:</p>
			<div><div><img src="img/Fig_7.17.jpg" alt="Figure. 7.17 – Bruce-force attack detected&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.17 – Bruce-force attack detected</p>
			<p>In these<a id="_idTextAnchor129"/> reports, we can find <a id="_idIndexMarker436"/>information on which usernames were used in an attack, where the attack originated from, and how many times authentication was attempted. We can also see more information on the attack origin and the location from where the attack originated, as shown in the following screenshot:</p>
			<div><div><img src="img/Fig_7.18.jpg" alt="Figure. 7.18 – Bruce-force attack origin&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure. 7.18 – Bruce-force attack origin</p>
			<h1 id="_idParaDest-128"><a id="_idTextAnchor130"/>Summary</h1>
			<p>Azure Security Center helps us to keep our cloud environment safe in various ways, from offering recommendations on what needs to be improved to detecting threats as they happen, to response automation to act on possible threats. With different settings and policies, we can define our focus, track the health of our resources, and create a more secure infrastructure. </p>
			<p>In this chapter, we discussed how important Azure Security Center as a <strong class="bold">Cloud Security Posture Management</strong> (<strong class="bold">CSPM</strong>) and <strong class="bold">Cloud Workload Protection Platform</strong> (<strong class="bold">CWPP</strong>) tool is. The next chapter will focus on Azure Sentinel, which is Microsoft's cloud-based SIEM/SOAR solution.</p>
			<h1 id="_idParaDest-129"><a id="_idTextAnchor131"/>Questions</h1>
			<ol>
				<li value="1">Azure Security Center stores data in?<p>A. Azure Storage</p><p>B. Azure SQL Database</p><p>C. Log Analytics workspace</p></li>
				<li> Azure Security Center has which of the following pricing tiers?<p>A. Free</p><p>B. Standard</p><p>C. Premium</p><p>D. All of the above</p><p>E. Only 1 and 2</p><p>F. Only 2 and 3</p></li>
				<li>Information on how to increase Azure security on our resources is provided in the form of?<p>A. Fixes</p><p>B. Recommendations</p><p>C. Suggestions </p></li>
				<li>We can automate responses to Azure Security Center alerts with?<p>A. Log Analytics</p><p>B. Logic Apps</p><p>C. PowerShell</p></li>
				<li>Which file type cannot be controlled with Adaptive Application Control?<p>A. EXE</p><p>B. JAR</p><p>C. MSI</p></li>
				<li>When JIT is enabled on an Azure VM, the user?<p>A. Has the same access</p><p>B. Has less access</p><p>C. Has more access</p><p>D. Has to request access</p></li>
				<li>With <strong class="bold">Advanced Threat Protection</strong> (<strong class="bold">ATP</strong>), what happens when an attack occurs?<p>A. It will be automatically blocked.</p><p>B. The user has to create a response to the attack.</p><p>C. Some attacks are blocked automatically, and the user has to create a custom response for unsupported attacks.</p></li>
			</ol>
		</div>
	</body></html>