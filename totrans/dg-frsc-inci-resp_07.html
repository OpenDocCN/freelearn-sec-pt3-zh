<html><head></head><body>
<div id="_idContainer114">
<h1 class="chapter-number" id="_idParaDest-121"><a id="_idTextAnchor123"/><span class="koboSpan" id="kobo.1.1">7</span></h1>
<h1 id="_idParaDest-122"><a id="_idTextAnchor124"/><span class="koboSpan" id="kobo.2.1">Remote Evidence Collection</span></h1>
<p><span class="koboSpan" id="kobo.3.1">The preferred method for the acquisition of memory is through direct contact with the suspect system. </span><span class="koboSpan" id="kobo.3.2">This allows for adaptability by incident response analysts in the event that a tool or technique does not work. </span><span class="koboSpan" id="kobo.3.3">This method is also faster at obtaining the necessary files since it doesn’t depend on a stable network connection. </span><span class="koboSpan" id="kobo.3.4">Although this is the preferred method, there may be geographical constraints, especially with larger organizations where the incident response analysts are a plane ride away from the location containing </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">the evidence.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">In the case of remote acquisition, incident response analysts can leverage the same tools that are utilized in local acquisition. </span><span class="koboSpan" id="kobo.5.2">The one change is that incident response analysts are required to utilize remote technology to access the suspect systems and perform the capture. </span><span class="koboSpan" id="kobo.5.3">As with any method that is utilized, incident response analysts should ensure that they document any use of remote technology. </span><span class="koboSpan" id="kobo.5.4">This will allow for the proper identification of legitimate versus suspect connections </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">later on.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">In this chapter, we will cover the following </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">main topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.9.1">Enterprise incident </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">response challenges</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Endpoint detection </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">and response</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Velociraptor overview </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">and deployment</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.15.1">Velociraptor scenarios</span></span></li>
</ul>
<h1 id="_idParaDest-123"><a id="_idTextAnchor125"/><span class="koboSpan" id="kobo.16.1">Enterprise incident response challenges</span></h1>
<p><span class="koboSpan" id="kobo.17.1">The</span><a id="_idIndexMarker601"/><span class="koboSpan" id="kobo.18.1"> previous chapter focused on acquiring evidence when an analyst or a responder has physical access to the system. </span><span class="koboSpan" id="kobo.18.2">The reality of the situation is that this is often not the case. </span><span class="koboSpan" id="kobo.18.3">Infrastructure moved to cloud services</span><a id="_idIndexMarker602"/><span class="koboSpan" id="kobo.19.1"> such as </span><strong class="bold"><span class="koboSpan" id="kobo.20.1">Amazon Web Services</span></strong><span class="koboSpan" id="kobo.21.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.22.1">AWS</span></strong><span class="koboSpan" id="kobo.23.1">) or the move toward a remote workforce creates a situation where responders most likely will not have physical access to plug a USB device in and run their tools to </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">acquire evidence.</span></span></p>
<p><span class="koboSpan" id="kobo.25.1">Compounding this challenge is the need to get more actionable information much quicker than what traditional digital forensics can provide. </span><span class="koboSpan" id="kobo.25.2">For example, a traditional digital forensics methodology has analysts make a full image of an infected system, and capture the memory and other artifacts. </span><span class="koboSpan" id="kobo.25.3">These are then transferred to an analysis workstation and, over the course of hours or days, the analyst can obtain the necessary data. </span><span class="koboSpan" id="kobo.25.4">In situations where an incident may be localized or more detailed intrusion analysis needs to take place, this may be necessary. </span><span class="koboSpan" id="kobo.25.5">In other circumstances, this type of analysis methodology does not scale when looking at hundreds or even thousands of systems that may </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">be impacted.</span></span></p>
<p><span class="koboSpan" id="kobo.27.1">Moving </span><a id="_idIndexMarker603"/><span class="koboSpan" id="kobo.28.1">away from this </span><em class="italic"><span class="koboSpan" id="kobo.29.1">traditional</span></em><span class="koboSpan" id="kobo.30.1"> digital forensics and investigation model is one that focuses on </span><em class="italic"><span class="koboSpan" id="kobo.31.1">Live Triage</span></em><span class="koboSpan" id="kobo.32.1">. </span><span class="koboSpan" id="kobo.32.2">In this methodology, data is collected from systems that are suspected of being compromised. </span><span class="koboSpan" id="kobo.32.3">The focus here is on collecting high-value data in a central location where it can be indexed and analyzed. </span><span class="koboSpan" id="kobo.32.4">With the data in a central location, the analysts can then leverage tools and techniques to scale their investigation. </span><span class="koboSpan" id="kobo.32.5">Leveraging this technique will allow analysts to focus their efforts on systems with the greatest evidentiary value. </span><span class="koboSpan" id="kobo.32.6">It is on these systems that analysts can apply the full focus of digital forensics to gain the best understanding of the adversary and </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">their behavior.</span></span></p>
<h1 id="_idParaDest-124"><a id="_idTextAnchor126"/><span class="koboSpan" id="kobo.34.1">Endpoint detection and response</span></h1>
<p><span class="koboSpan" id="kobo.35.1">Ransomware has arguably been the one key threat that has changed how an incident response is conducted. </span><span class="koboSpan" id="kobo.35.2">The speed and widespread impact of such attacks has highlighted the need for tools that provide analysts with a method to search across the entire network infrastructure. </span><span class="koboSpan" id="kobo.35.3">This is where </span><strong class="bold"><span class="koboSpan" id="kobo.36.1">endpoint detection and response</span></strong><span class="koboSpan" id="kobo.37.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.38.1">EDR</span></strong><span class="koboSpan" id="kobo.39.1">) tools </span><a id="_idIndexMarker604"/><span class="koboSpan" id="kobo.40.1">come into </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">the picture.</span></span></p>
<p><span class="koboSpan" id="kobo.42.1">EDR tools grew out of the traditional signature-based antivirus that permeated the industry for nearly two decades. </span><span class="koboSpan" id="kobo.42.2">Building on the capability to match hash values and other signatures, EDR tools bring much-needed distributed capabilities to security and incident response teams. </span><span class="koboSpan" id="kobo.42.3">There are a variety of commercially available EDR platforms, each with distinctive features, but at a high level, they can generally perform the </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">following functions:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.44.1">Monitor and detect threats on endpoints</span></strong><span class="koboSpan" id="kobo.45.1">: This is </span><a id="_idIndexMarker605"/><span class="koboSpan" id="kobo.46.1">where EDRs overlap with traditional antivirus. </span><span class="koboSpan" id="kobo.46.2">EDR platforms use a combination of signature matching, detection rules, and machine learning/AI to detect threats. </span><span class="koboSpan" id="kobo.46.3">This combination makes it possible for EDR platforms to detect behaviors that would otherwise appear legitimate to traditional antivirus. </span><span class="koboSpan" id="kobo.46.4">For example, adversaries often make use of legitimate system tools or binaries to conduct their attacks. </span><span class="koboSpan" id="kobo.46.5">For example, the post-exploitation tool Cobalt Strike will often use the legitimate Microsoft Windows </span><strong class="source-inline"><span class="koboSpan" id="kobo.47.1">regsvr32.exe</span></strong><span class="koboSpan" id="kobo.48.1"> binary to bypass Windows protection mechanisms and execute malicious </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">code (</span></span><a href="https://attack.mitre.org/techniques/T1218/010/"><span class="No-Break"><span class="koboSpan" id="kobo.50.1">https://attack.mitre.org/techniques/T1218/010/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.51.1">).</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.52.1">Automated response</span></strong><span class="koboSpan" id="kobo.53.1">: Another key function of EDR platforms is to automate response actions. </span><span class="koboSpan" id="kobo.53.2">For example, a malicious file detection may be set to trigger the isolation of an endpoint so that the adversary can not use it to move laterally. </span><span class="koboSpan" id="kobo.53.3">Other automated actions include banning malicious binaries from executing or cutting off network connections for specific processes. </span><span class="koboSpan" id="kobo.53.4">Another key automated feature that EDR platforms have is the ability to notify specific individuals through email or instant messaging for a </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">quicker response.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.55.1">Digital forensic acquisition and analysis</span></strong><span class="koboSpan" id="kobo.56.1">: The main advantage of EDR platforms for incident response analysts is the ability to acquire and analyze digital evidence remotely. </span><span class="koboSpan" id="kobo.56.2">For example, EDR platforms will have the ability to show binaries that have recently been executed or additional files added to the system. </span><span class="koboSpan" id="kobo.56.3">Analysts would be able to search for indicators such as these over the entirety of the network versus attempting to find these files on individual systems. </span><span class="koboSpan" id="kobo.56.4">An additional </span><a id="_idIndexMarker606"/><span class="koboSpan" id="kobo.57.1">advantage is to also be able to acquire evidence such as individual files suspected of malicious activity or entire forensic packages. </span><span class="koboSpan" id="kobo.57.2">This functionality significantly reduces the time necessary to collect evidence while also allowing for searching and collection </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">at scale.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.59.1">Depending on the EDR platform, organizations also have flexibility in terms of deployment. </span><span class="koboSpan" id="kobo.59.2">The primary method of deployment is using a cloud management console that individual endpoints communicate with via an agent. </span><span class="koboSpan" id="kobo.59.3">This type of deployment can monitor both internal and cloud-based systems and provides flexibility for remote analysts and </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">incident responders.</span></span></p>
<p><span class="koboSpan" id="kobo.61.1">The one major disadvantage of </span><a id="_idIndexMarker607"/><span class="koboSpan" id="kobo.62.1">EDR platforms is cost. </span><span class="koboSpan" id="kobo.62.2">This functionality does not come without a cost. </span><span class="koboSpan" id="kobo.62.3">Given the visibility and functionality of EDR platforms, they are quickly becoming a critical tool for organizations of all sizes and an important asset to incident responders to quickly gain incident awareness and the ability to investigate widespread adversary activity across the </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1">entire network.</span></span></p>
<h1 id="_idParaDest-125"><a id="_idTextAnchor127"/><span class="koboSpan" id="kobo.64.1">Velociraptor overview and deployment</span></h1>
<p><span class="koboSpan" id="kobo.65.1">Aside from commercial platforms, there are open source tools that incident response teams can use that provide at least some of the functionality found in EDR platforms. </span><span class="koboSpan" id="kobo.65.2">One of these is </span><strong class="bold"><span class="koboSpan" id="kobo.66.1">Velociraptor</span></strong><span class="koboSpan" id="kobo.67.1">. </span><span class="koboSpan" id="kobo.67.2">This </span><a id="_idIndexMarker608"/><span class="koboSpan" id="kobo.68.1">tool uses a combination of a central server that endpoint agents connect to, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.69.1">Figure 7</span></em></span><em class="italic"><span class="koboSpan" id="kobo.70.1">.1</span></em><span class="koboSpan" id="kobo.71.1">. </span><span class="koboSpan" id="kobo.71.2">These endpoint agents, called </span><strong class="bold"><span class="koboSpan" id="kobo.72.1">clients</span></strong><span class="koboSpan" id="kobo.73.1">, manage</span><a id="_idIndexMarker609"/><span class="koboSpan" id="kobo.74.1"> the search of artifacts on remote systems. </span><span class="koboSpan" id="kobo.74.2">This places the load for searching and evidence acquisition on the endpoint, reducing the load on the server, and allowing for concurrent searches across multiple </span><span class="No-Break"><span class="koboSpan" id="kobo.75.1">remote clients.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.76.1">Velociraptor documentation</span></p>
<p class="callout"><span class="koboSpan" id="kobo.77.1">This chapter can only cover a limited portion of the features of Velociraptor. </span><span class="koboSpan" id="kobo.77.2">For a full breakdown of the features, including additional digital forensic use cases, review the Velociraptor</span><a id="_idIndexMarker610"/><span class="koboSpan" id="kobo.78.1"> documentation </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">at </span></span><a href="https://docs.velociraptor.app/"><span class="No-Break"><span class="koboSpan" id="kobo.80.1">https://docs.velociraptor.app/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.81.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer089">
<span class="koboSpan" id="kobo.82.1"><img alt="" src="image/Image_B18571_07_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.83.1">Figure 7.1 – Velociraptor setup</span></p>
<p><span class="koboSpan" id="kobo.84.1">To demonstrate</span><a id="_idIndexMarker611"/><span class="koboSpan" id="kobo.85.1"> some of the functionality of Velociraptor, a server will be configured. </span><span class="koboSpan" id="kobo.85.2">After that, a Windows client will be created and deployed to a Windows endpoint. </span><span class="koboSpan" id="kobo.85.3">From there, we will look at how Velociraptor can be used to gain data on an endpoint’s behavior and extract meaningful evidence for </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">further investigation.</span></span></p>
<h2 id="_idParaDest-126"><a id="_idTextAnchor128"/><span class="koboSpan" id="kobo.87.1">Velociraptor server</span></h2>
<p><span class="koboSpan" id="kobo.88.1">The first</span><a id="_idIndexMarker612"/><span class="koboSpan" id="kobo.89.1"> portion of the Velociraptor tool is the server, which manages the agents that will later be installed on the endpoint. </span><span class="koboSpan" id="kobo.89.2">There are detailed instructions on deployment available on the Velociraptor GitHub page at </span><a href="https://github.com/Velocidex/velociraptor"><span class="koboSpan" id="kobo.90.1">https://github.com/Velocidex/velociraptor</span></a><span class="koboSpan" id="kobo.91.1">. </span><span class="koboSpan" id="kobo.91.2">There are also several options for deploying the server, including using Windows and Linux OS and Docker. </span><span class="koboSpan" id="kobo.91.3">In this case, the server application will be installed on an Ubuntu 20.04 LTS server. </span><span class="koboSpan" id="kobo.91.4">After installing the server, go through the following steps to install </span><span class="No-Break"><span class="koboSpan" id="kobo.92.1">the application:</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.93.1">Static IP</span></p>
<p class="callout"><span class="koboSpan" id="kobo.94.1">One key consideration before getting started is to give Velociraptor a static IP address. </span><span class="koboSpan" id="kobo.94.2">The agents that will be configured later will need to have this IP address and any changes will make the </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">agents useless.</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.96.1">Once the </span><a id="_idIndexMarker613"/><span class="koboSpan" id="kobo.97.1">Linux server is configured, either use the console or SSH into the server and install Velociraptor. </span><span class="koboSpan" id="kobo.97.2">First, create a directory for the Velociraptor files with the </span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.99.1">mkdir velociraptor</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.100.1">Change to the </span><span class="No-Break"><span class="koboSpan" id="kobo.101.1">Velociraptor directory:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.102.1">cd velociraptor</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.103.1">Download the Velociraptor package from GitHub via the Linux </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.104.1">wget</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.105.1"> command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.106.1">wget https://github.com/Velocidex/velociraptor/releases/download/v0.6.4-  1/velociraptor-v0.6.4-1-linux-amd64 </span></strong></pre></li>
<li><span class="koboSpan" id="kobo.107.1">Next, enter the following command to allow the Velociraptor package </span><span class="No-Break"><span class="koboSpan" id="kobo.108.1">to execute:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.109.1">chmod +x velociraptor-v0.6.4-1-linux-amd64</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.110.1">Now that the Velociraptor has been set to run, the next step is to create the YAML configuration file that contains </span><span class="No-Break"><span class="koboSpan" id="kobo.111.1">the setup:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.112.1">./velociraptor-v0.6.4-1-linux-amd64 config generate &gt; velociraptor.config.yaml</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.113.1">The configuration file needs to be edited to include the IP address for the GUI and to communicate with the agents that will communicate with the server. </span><span class="koboSpan" id="kobo.113.2">Using VIM or Nano, edit the file. </span><span class="koboSpan" id="kobo.113.3">For example, Nano will be </span><span class="No-Break"><span class="koboSpan" id="kobo.114.1">used here:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.115.1">nano velociraptor.config.yaml</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.116.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">velocirpator.config.yaml</span></strong><span class="koboSpan" id="kobo.118.1"> file, there are two entries for localhost. </span><span class="koboSpan" id="kobo.118.2">Find these and replace them with the IP address of your server. </span><span class="koboSpan" id="kobo.118.3">Next, there are three entries for the IP address </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">127.0.0.1</span></strong><span class="koboSpan" id="kobo.120.1">; again, replace these with the IP address of </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">the server.</span></span></li>
<li><span class="koboSpan" id="kobo.122.1">Move the configuration file into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.123.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.124.1">etc</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.125.1"> directory:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.126.1">sudo mv velociraptor.config.yaml /etc</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.127.1">Next, set an administrator password to access the Velociraptor GUI. </span><span class="koboSpan" id="kobo.127.2">Enter a password </span><span class="No-Break"><span class="koboSpan" id="kobo.128.1">when prompted:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.129.1">./velociraptor-v0.6.4-1-linux-amd64 --config /etc/velociraptor.config.yaml user add admin --role administrator</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.130.1">To start the Velociraptor frontend GUI, execute the </span><span class="No-Break"><span class="koboSpan" id="kobo.131.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.132.1">./velociraptor-v0.6.0-1-linux-amd64 --config /etc/velociraptor.config.yaml frontend -v</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.133.1">If the installation </span><a id="_idIndexMarker614"/><span class="koboSpan" id="kobo.134.1">was successful, you should be able to log in to the GUI, which opens the </span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">following dashboard:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer090">
<span class="koboSpan" id="kobo.136.1"><img alt="" src="image/Image_B18571_07_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.137.1">Figure 7.2 – Velociraptor welcome screen</span></p>
<p><span class="koboSpan" id="kobo.138.1">As the previous</span><a id="_idIndexMarker615"/><span class="koboSpan" id="kobo.139.1"> directions show, setting up Velociraptor is easy. </span><span class="koboSpan" id="kobo.139.2">Further, the server can be deployed in either the internal network or within a cloud infrastructure such as AWS or Azure. </span><span class="koboSpan" id="kobo.139.3">This allows incident response analysts to collect data from any system with connectivity to the internet. </span><span class="koboSpan" id="kobo.139.4">This also removes the need to maintain a system as Velociraptor can be deployed as necessary in the event of an incident or maintained as a virtual system and powered up </span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">as needed.</span></span></p>
<p><span class="koboSpan" id="kobo.141.1">Now that the server has been configured, let’s go ahead and build a Windows collector that will allow an analyst to examine a remote </span><span class="No-Break"><span class="koboSpan" id="kobo.142.1">Windows system.</span></span></p>
<h2 id="_idParaDest-127"><a id="_idTextAnchor129"/><span class="koboSpan" id="kobo.143.1">Velociraptor Windows collector</span></h2>
<p><span class="koboSpan" id="kobo.144.1">The Velociraptor collector</span><a id="_idIndexMarker616"/><span class="koboSpan" id="kobo.145.1"> is the agent that is installed on monitored endpoints and is connected to the server. </span><span class="koboSpan" id="kobo.145.2">To configure a collector, follow </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">these steps:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.147.1">Before a client can be configured, the Velociraptor application needs to be able to accept a self-signed SSL certificate. </span><span class="koboSpan" id="kobo.147.2">Access the </span><strong class="source-inline"><span class="koboSpan" id="kobo.148.1">velociraptor.config.yaml</span></strong><span class="koboSpan" id="kobo.149.1"> file that was moved to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.150.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">etc</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.152.1"> directory:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.153.1">sudo nano /etc/velociraptor.config.yaml</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.154.1">Add the following line after the </span><strong class="source-inline"><span class="koboSpan" id="kobo.155.1">nonce</span></strong><span class="koboSpan" id="kobo.156.1"> line for the </span><span class="No-Break"><span class="koboSpan" id="kobo.157.1">first certificate:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.158.1">use_self_signed_ssl: true</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.159.1">Refer to the following screenshot </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">for reference:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer091">
<span class="koboSpan" id="kobo.161.1"><img alt="" src="image/Image_B18571_07_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.162.1">Figure 7.3 – Configuring the Velociraptor YAML file</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.163.1">From the </span><a id="_idIndexMarker617"/><span class="koboSpan" id="kobo.164.1">Velociraptor server command line, change to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">velociraptor</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.166.1"> directory:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.167.1">cd velociraptor</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.168.1">Create a client </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">configuration file:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.170.1">./velociraptor-v0.6.4-1-linux-amd64 --config /etc/velociraptor.config.yaml config client &gt; client.config.yaml</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.171.1">Download the Windows executable file </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">from GitHub:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.173.1">wget https://github.com/Velocidex/velociraptor/releases/download/v0.6.4-1/velociraptor-v0.6.4-windows-amd64.exe</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.174.1">The following command takes the Windows executable and combines it with the configuration file so that the Windows endpoint can communicate with </span><span class="No-Break"><span class="koboSpan" id="kobo.175.1">the server:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.176.1">./velociraptor-v0.6.0-1-linux-amd64 config repack --exe velociraptor-v0.6.0-1-windows-amd64.exe client.config.yaml Velociraptor_Agent.exe</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.177.1">Finally, ensure</span><a id="_idIndexMarker618"/><span class="koboSpan" id="kobo.178.1"> that the Secure Shell service is installed on the </span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">Velociraptor server:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.180.1">sudo apt install openssh-server -y</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.181.1">The collector is now configured. </span><span class="koboSpan" id="kobo.181.2">To get the collector off the Velociraptor server, simply use any SFTP to transfer it off the system. </span><span class="koboSpan" id="kobo.181.3">Then, transfer it to the Windows endpoint or endpoints that you would like to monitor. </span><span class="koboSpan" id="kobo.181.4">Next, install the Velociraptor service using the Windows Command Prompt </span><strong class="source-inline"><span class="koboSpan" id="kobo.182.1">Velociraptor_Agent.exe service install</span></strong><span class="koboSpan" id="kobo.183.1"> command, as </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer092">
<span class="koboSpan" id="kobo.185.1"><img alt="" src="image/Image_B18571_07_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.186.1">Figure 7.4 – Velociraptor Agent intallation</span></p>
<h1 id="_idParaDest-128"><a id="_idTextAnchor130"/><span class="koboSpan" id="kobo.187.1">Velociraptor scenarios</span></h1>
<p><span class="koboSpan" id="kobo.188.1">Velociraptor </span><a id="_idIndexMarker619"/><span class="koboSpan" id="kobo.189.1">is a feature-rich platform that can be leveraged for a wide range of digital forensics and incident response tasks. </span><span class="koboSpan" id="kobo.189.2">For the purposes of this discussion, the focus will be on using Velociraptor to access the remote system command line to return data along with running evidence </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1">collection binaries.</span></span></p>
<h2 id="_idParaDest-129"><a id="_idTextAnchor131"/><span class="koboSpan" id="kobo.191.1">Velociraptor evidence collection</span></h2>
<p><span class="koboSpan" id="kobo.192.1">Velociraptor is a </span><a id="_idIndexMarker620"/><span class="koboSpan" id="kobo.193.1">feature-rich tool with a wide range of capabilities. </span><span class="koboSpan" id="kobo.193.2">In this chapter, the focus will be on getting basic information about the endpoint, evidence acquisition through the command line, and finally, acquiring an evidence package for further analysis. </span><span class="koboSpan" id="kobo.193.3">This should be enough to at least gain some familiarity with Velociraptor. </span><span class="koboSpan" id="kobo.193.4">In later chapters, we will look at using Velociraptor for analysis and </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">threat hunting.</span></span></p>
<h3><span class="koboSpan" id="kobo.195.1">Using the Windows command line</span></h3>
<p><span class="koboSpan" id="kobo.196.1">One tool that is</span><a id="_idIndexMarker621"/><span class="koboSpan" id="kobo.197.1"> often overlooked when conducting an initial triage analysis is the Windows command line. </span><span class="koboSpan" id="kobo.197.2">From here, an analyst can examine running processes and network connections and extract files. </span><span class="koboSpan" id="kobo.197.3">Velociraptor has the capability for an analyst to run commands and evidence tools via the command line on a </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">remote system:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.199.1">From the home screen, navigate to the </span><strong class="bold"><span class="koboSpan" id="kobo.200.1">Search clients</span></strong><span class="koboSpan" id="kobo.201.1"> box and select the down arrow. </span><span class="koboSpan" id="kobo.201.2">Select </span><strong class="bold"><span class="koboSpan" id="kobo.202.1">Show All</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.203.1">for hosts:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer093">
<span class="koboSpan" id="kobo.204.1"><img alt="" src="image/Image_B18571_07_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.205.1">Figure 7.5 – Searching for clients</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.206.1">This will show all the systems that Velociraptor is communicating with. </span><span class="koboSpan" id="kobo.206.2">Those systems with a green button are currently communicating with Velociraptor. </span><span class="koboSpan" id="kobo.206.3">If there are red buttons, this means that the endpoint agent is not communicating with the server and needs to </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">be restarted:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer094">
<span class="koboSpan" id="kobo.208.1"><img alt="" src="image/Image_B18571_07_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.209.1">Figure 7.6 – Client list</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.210.1">In this </span><a id="_idIndexMarker622"/><span class="koboSpan" id="kobo.211.1">example, the analyst wants to review the hostname </span><strong class="bold"><span class="koboSpan" id="kobo.212.1">DESKTOP-9SK5KPF</span></strong><span class="koboSpan" id="kobo.213.1">. </span><span class="koboSpan" id="kobo.213.2">Clicking on the corresponding Client ID reveals the </span><span class="No-Break"><span class="koboSpan" id="kobo.214.1">following information:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer095">
<span class="koboSpan" id="kobo.215.1"><img alt="" src="image/Image_B18571_07_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.216.1">Figure 7.7 – Client information</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.217.1">One feature of Velociraptor that is useful for initial triage and investigation is the ability to leverage the Windows command line and PowerShell terminals on the Velociraptor server. </span><span class="koboSpan" id="kobo.217.2">To access this feature, navigate to the upper-right corner of the windows and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.218.1">&gt;</span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.219.1">_Shell</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.220.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer096">
<span class="koboSpan" id="kobo.221.1"><img alt="" src="image/Image_B18571_07_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.222.1">Figure 7.8 – Accessing Shell</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.223.1">This opens a window where the analyst can access the command line, PowerShell, Bash, or VQL. </span><span class="koboSpan" id="kobo.223.2">In this case, the analyst runs the </span><strong class="source-inline"><span class="koboSpan" id="kobo.224.1">netstat</span></strong><span class="koboSpan" id="kobo.225.1"> command against the target system by entering the command and clicking on </span><strong class="bold"><span class="koboSpan" id="kobo.226.1">Launch</span></strong><span class="koboSpan" id="kobo.227.1">. </span><span class="koboSpan" id="kobo.227.2">This will produce </span><span class="No-Break"><span class="koboSpan" id="kobo.228.1">the following:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer097">
<span class="koboSpan" id="kobo.229.1"><img alt="" src="image/Image_B18571_07_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.230.1">Figure 7.9 – Windows netstat command output</span></p>
<p><span class="koboSpan" id="kobo.231.1">This feature is </span><a id="_idIndexMarker623"/><span class="koboSpan" id="kobo.232.1">useful when conducting an initial analysis or triage of a system. </span><span class="koboSpan" id="kobo.232.2">Checking the network connections or running processes may reveal the presence of malware or command and control. </span><span class="koboSpan" id="kobo.232.3">This enables the analyst to focus on systems that may have those indicators. </span><span class="koboSpan" id="kobo.232.4">Another technique for evidence gathering is running tools that were discussed in the previous chapter from the </span><span class="No-Break"><span class="koboSpan" id="kobo.233.1">command line.</span></span></p>
<h2 id="_idParaDest-130"><a id="_idTextAnchor132"/><span class="koboSpan" id="kobo.234.1">CyLR</span></h2>
<p><span class="koboSpan" id="kobo.235.1">A simple way to acquire</span><a id="_idIndexMarker624"/><span class="koboSpan" id="kobo.236.1"> evidence from a remote system is to use the CyLR tool that was discussed in the previous chapter. </span><span class="koboSpan" id="kobo.236.2">In this case, the results can be sent to a remote server or workstation using SFTP. </span><span class="koboSpan" id="kobo.236.3">Simply run CyLR with the following command with the destination server username </span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">and password:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.238.1">
CyLR.exe -u username -p password -s 192.168.0.15</span></pre>
<p><span class="koboSpan" id="kobo.239.1">One technique that is useful is to send all the evidence to a central server where multiple analysts can work. </span><span class="koboSpan" id="kobo.239.2">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.240.1">Chapter 12</span></em></span><span class="koboSpan" id="kobo.241.1">, CyLR will be combined with additional tools available on the </span><span class="No-Break"><span class="koboSpan" id="kobo.242.1">Skadi platform.</span></span></p>
<h2 id="_idParaDest-131"><a id="_idTextAnchor133"/><span class="koboSpan" id="kobo.243.1">WinPmem</span></h2>
<p><span class="koboSpan" id="kobo.244.1">WinPmem </span><a id="_idIndexMarker625"/><span class="koboSpan" id="kobo.245.1">can be deployed on remote systems through native applications such as Remote Desktop or PsExec. </span><span class="koboSpan" id="kobo.245.2">Once installed on the remote system, the output of WinPmem can be piped to another system utilizing NetCat. </span><span class="koboSpan" id="kobo.245.3">For example, suppose that the incident response analyst is utilizing a system located at </span><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">192.168.0.56</span></strong><span class="koboSpan" id="kobo.247.1">. </span><span class="koboSpan" id="kobo.247.2">If the analyst is able to access the compromised host via PSExec or RDS, they can establish a NetCat connection back to their machine by using the </span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.249.1">
 C:/winpmem-2.1.exe - | nc 192.168.0.56 4455</span></pre>
<p><span class="koboSpan" id="kobo.250.1">The preceding command tells the system to perform the capture and send the output via NetCat to the incident response analyst workstation over port </span><strong class="source-inline"><span class="koboSpan" id="kobo.251.1">4455</span></strong><span class="koboSpan" id="kobo.252.1">. </span><span class="koboSpan" id="kobo.252.2">The drawback of this technique is that it requires access to Command Prompt, as well as the installation of both NetCat and WinPmem. </span><span class="koboSpan" id="kobo.252.3">This may not be the best option if the incident response analyst is dealing with a system that is suspected of </span><span class="No-Break"><span class="koboSpan" id="kobo.253.1">being compromised.</span></span></p>
<h3><span class="koboSpan" id="kobo.254.1">Virtual filesystem</span></h3>
<p><span class="koboSpan" id="kobo.255.1">Another key feature of</span><a id="_idIndexMarker626"/><span class="koboSpan" id="kobo.256.1"> Velociraptor is the </span><strong class="bold"><span class="koboSpan" id="kobo.257.1">virtual file system</span></strong><span class="koboSpan" id="kobo.258.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.259.1">VFS</span></strong><span class="koboSpan" id="kobo.260.1">). </span><span class="koboSpan" id="kobo.260.2">This </span><a id="_idIndexMarker627"/><span class="koboSpan" id="kobo.261.1">allows analysts to examine the file structure on a remote system. </span><span class="koboSpan" id="kobo.261.2">This is a handy feature for instances where the analysts know a specific file or files that they would like to collect in relation to an alert or incident. </span><span class="koboSpan" id="kobo.261.3">In the following example, the analyst has been alerted to a suspicious DLL file located on a remote system and has been tasked with collecting it </span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">for analysis:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.263.1">From the same window as the previous example, click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.264.1">VFS</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.265.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer098">
<span class="koboSpan" id="kobo.266.1"><img alt="" src="image/Image_B18571_07_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.267.1">Figure 7.10 – Accessing the VFS</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.268.1">Depending on the </span><a id="_idIndexMarker628"/><span class="koboSpan" id="kobo.269.1">connection, this may take a few minutes to load. </span><span class="koboSpan" id="kobo.269.2">When it finishes loading, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.270.1">ntfs</span></strong><span class="koboSpan" id="kobo.271.1"> portion, </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">as shown:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer099">
<span class="koboSpan" id="kobo.273.1"><img alt="" src="image/Image_B18571_07_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.274.1">Figure 7.11 – The VFS</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.275.1">When navigating the </span><a id="_idIndexMarker629"/><span class="koboSpan" id="kobo.276.1">filesystem, if there is an error message saying </span><strong class="bold"><span class="koboSpan" id="kobo.277.1">No data available</span></strong><span class="koboSpan" id="kobo.278.1">, click on the folder icon, which will refresh </span><span class="No-Break"><span class="koboSpan" id="kobo.279.1">the directory:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer100">
<span class="koboSpan" id="kobo.280.1"><img alt="" src="image/Image_B18571_07_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.281.1">Figure 7.12 – Refresh buttons</span></p>
<p><span class="koboSpan" id="kobo.282.1">In addition to refreshing the directory, the additional icons from left to right will either recursively refresh the directory, recursively download the directory, or view the </span><span class="No-Break"><span class="koboSpan" id="kobo.283.1">artifacts collected.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.284.1">Navigating to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.285.1">C:\Program Files\Common Files\System</span></strong><span class="koboSpan" id="kobo.286.1"> directory shows a few DLL files. </span><span class="koboSpan" id="kobo.286.2">The one that stands out is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.287.1">bghe21.dll</span></strong><span class="koboSpan" id="kobo.288.1"> file, which has a modified date and time of </span><strong class="bold"><span class="koboSpan" id="kobo.289.1">2022-05-04</span></strong><span class="koboSpan" id="kobo.290.1"> at </span><strong class="bold"><span class="koboSpan" id="kobo.291.1">09:44:20 UTC</span></strong><span class="koboSpan" id="kobo.292.1">. </span><span class="koboSpan" id="kobo.292.2">This stands out as the other DLL files appear to have been modified </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">much earlier:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer101">
<span class="koboSpan" id="kobo.294.1"><img alt="" src="image/Image_B18571_07_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.295.1">Figure 7.13 – Suspect DLL</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.296.1">Clicking </span><a id="_idIndexMarker630"/><span class="koboSpan" id="kobo.297.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.298.1">Collect from the client</span></strong><span class="koboSpan" id="kobo.299.1"> button will download the suspect DLL from the system </span><span class="No-Break"><span class="koboSpan" id="kobo.300.1">for analysis:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer102">
<span class="koboSpan" id="kobo.301.1"><img alt="" src="image/Image_B18571_07_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.302.1">Figure 7.14 – Collecting files</span></p>
<p><span class="koboSpan" id="kobo.303.1">The VFS is useful for those events and incidents where the analyst has some data pointing to a specific file or directory to search for evidence. </span><span class="koboSpan" id="kobo.303.2">This feature significantly decreases the time necessary to acquire specific files. </span><span class="koboSpan" id="kobo.303.3">There are some circumstances though where the analyst needs to acquire an evidence package from a remote system. </span><span class="koboSpan" id="kobo.303.4">In this case, Velociraptor can be leveraged to acquire a range of files and other data related to an </span><span class="No-Break"><span class="koboSpan" id="kobo.304.1">incident investigation.</span></span></p>
<h3><span class="koboSpan" id="kobo.305.1">Velociraptor evidence collection</span></h3>
<p><span class="koboSpan" id="kobo.306.1">The last feature that this</span><a id="_idIndexMarker631"/><span class="koboSpan" id="kobo.307.1"> chapter will look at is gathering evidence from a remote system for analysis. </span><span class="koboSpan" id="kobo.307.2">This feature gives the analyst a significant advantage in gathering this data remotely without the need to use</span><a id="_idIndexMarker632"/><span class="koboSpan" id="kobo.308.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.309.1">sneaker-net</span></strong><span class="koboSpan" id="kobo.310.1"> approach. </span><span class="koboSpan" id="kobo.310.2">In this case, Velociraptor will be used to gather KAPE evidence collection from a </span><span class="No-Break"><span class="koboSpan" id="kobo.311.1">remote system:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.312.1">Starting from the beginning, to collect evidence from a system, click on the corresponding Client ID for the suspect system – in this </span><span class="No-Break"><span class="koboSpan" id="kobo.313.1">case, </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.314.1">DESKTOP-9SK5KPF</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.315.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer103">
<span class="koboSpan" id="kobo.316.1"><img alt="" src="image/Image_B18571_07_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.317.1">Figure 7.15 – Client list</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.318.1">On the left pane, click on the bottom reverse </span><span class="No-Break"><span class="koboSpan" id="kobo.319.1">clock icon:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer104">
<span class="koboSpan" id="kobo.320.1"><img alt="" src="image/Image_B18571_07_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.321.1">Figure 7.16 – Collection icon</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.322.1">In the new </span><a id="_idIndexMarker633"/><span class="koboSpan" id="kobo.323.1">window, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.324.1">New Collection</span></strong><span class="koboSpan" id="kobo.325.1"> plus sign at the top-left under the </span><span class="No-Break"><span class="koboSpan" id="kobo.326.1">navigation bar:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer105">
<span class="koboSpan" id="kobo.327.1"><img alt="" src="image/Image_B18571_07_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.328.1">Figure 7.17 – Starting a new collection</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.329.1">This will </span><a id="_idIndexMarker634"/><span class="koboSpan" id="kobo.330.1">open the </span><strong class="bold"><span class="koboSpan" id="kobo.331.1">New Collection: Select Artifacts to collect</span></strong><span class="koboSpan" id="kobo.332.1"> window. </span><span class="koboSpan" id="kobo.332.2">There is a wide range of evidence items and sets that can be collected. </span><span class="koboSpan" id="kobo.332.3">In this instance, the analyst wants to collect the KAPE </span><strong class="bold"><span class="koboSpan" id="kobo.333.1">Targets</span></strong><span class="koboSpan" id="kobo.334.1"> artifacts. </span><span class="koboSpan" id="kobo.334.2">Navigate to </span><strong class="bold"><span class="koboSpan" id="kobo.335.1">Windows.KapeFiles.Targets</span></strong><span class="koboSpan" id="kobo.336.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">as shown:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer106">
<span class="koboSpan" id="kobo.338.1"><img alt="" src="image/Image_B18571_07_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.339.1">Figure 7.18 – Selecting artifacts</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.340.1">When clicking on the artifacts, the following dialog box opens in the right-hand pane. </span><span class="koboSpan" id="kobo.340.2">This information details what parameters can be set. </span><span class="koboSpan" id="kobo.340.3">This matches the collection types that were seen in the previous discussion </span><span class="No-Break"><span class="koboSpan" id="kobo.341.1">on KAPE:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer107">
<span class="koboSpan" id="kobo.342.1"><img alt="" src="image/Image_B18571_07_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.343.1">Figure 7.19 – KAPE Targets details</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.344.1">At the </span><a id="_idIndexMarker635"/><span class="koboSpan" id="kobo.345.1">bottom of the screen, click </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.346.1">Configure Parameters</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer108">
<span class="koboSpan" id="kobo.348.1"><img alt="" src="image/Image_B18571_07_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.349.1">Figure 7.20 – Collection parameters</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.350.1">In the </span><strong class="bold"><span class="koboSpan" id="kobo.351.1">New Collection: Configuration Parameters</span></strong><span class="koboSpan" id="kobo.352.1"> window, click on </span><strong class="bold"><span class="koboSpan" id="kobo.353.1">Windows.KapeFiles.Target</span></strong><span class="koboSpan" id="kobo.354.1">. </span><span class="koboSpan" id="kobo.354.2">This will open the window in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.355.1">Figure 7</span></em></span><em class="italic"><span class="koboSpan" id="kobo.356.1">.21</span></em><span class="koboSpan" id="kobo.357.1">. </span><span class="koboSpan" id="kobo.357.2">This window allows the analyst to select the specific KAPE targets that were discussed in the last chapter. </span><span class="koboSpan" id="kobo.357.3">In this case, a basic collection will be performed by clicking on the checkbox next </span><span class="No-Break"><span class="koboSpan" id="kobo.358.1">to </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.359.1">_BasicCollection</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer109">
<span class="koboSpan" id="kobo.361.1"><img alt="" src="image/Image_B18571_07_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.362.1">Figure 7.21 – Collection parameters detail</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.363.1">Review</span><a id="_idIndexMarker636"/><span class="koboSpan" id="kobo.364.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.365.1">Specify Resources</span></strong><span class="koboSpan" id="kobo.366.1"> window. </span><span class="koboSpan" id="kobo.366.2">In this case, the defaults can be left but this allows the analyst to configure how the agent will utilize resources. </span><span class="koboSpan" id="kobo.366.3">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.367.1">Review</span></strong><span class="koboSpan" id="kobo.368.1"> button to review the </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">collection request:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer110">
<span class="koboSpan" id="kobo.370.1"><img alt="" src="image/Image_B18571_07_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.371.1">Figure 7.22 – Collection request review</span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.372.1">Click</span><a id="_idIndexMarker637"/><span class="koboSpan" id="kobo.373.1"> on the </span><strong class="bold"><span class="koboSpan" id="kobo.374.1">Launch</span></strong><span class="koboSpan" id="kobo.375.1"> button. </span><span class="koboSpan" id="kobo.375.2">While the collection is running, an hourglass icon will appear in the window with a unique </span><span class="No-Break"><span class="koboSpan" id="kobo.376.1">Flow ID:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer111">
<span class="koboSpan" id="kobo.377.1"><img alt="" src="image/Image_B18571_07_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.378.1">Figure 7.23 – Collection request progress</span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.379.1">Once the collection has been completed, the files can be downloaded by clicking on the file cabinet icon in the results pane. </span><span class="koboSpan" id="kobo.379.2">This will make the downloads available </span><span class="No-Break"><span class="koboSpan" id="kobo.380.1">as shown:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer112">
<span class="koboSpan" id="kobo.381.1"><img alt="" src="image/Image_B18571_07_24.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.382.1">Figure 7.24 – KAPE Targets ready for download</span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.383.1">The files can</span><a id="_idIndexMarker638"/><span class="koboSpan" id="kobo.384.1"> then be examined on an analyst’s workstation using KAPE or other tools that will be </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">discussed later:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer113">
<span class="koboSpan" id="kobo.386.1"><img alt="" src="image/Image_B18571_07_25.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.387.1">Figure 7.25 – Acquired evidence</span></p>
<p><span class="koboSpan" id="kobo.388.1">With this, we have come to the end of </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.390.1">A major challenge of digital forensic acquisition is scaling it to remote systems and being able to quickly analyze the data. </span><span class="koboSpan" id="kobo.390.2">Even with this challenge, incident response analysts can leverage tools such as Velociraptor both as a standalone solution and by integrating the tools that they already have. </span><span class="koboSpan" id="kobo.390.3">Through this combination, they are able to quickly focus their efforts on those systems that have the greatest evidentiary value. </span><span class="koboSpan" id="kobo.390.4">This provides decision-makers with an understanding of the nature of the adversary's actions and what measures they can take without having to wait for a full analysis that is severely limited due to the remote nature of IT </span><span class="No-Break"><span class="koboSpan" id="kobo.391.1">operations today.</span></span></p>
<h1 id="_idParaDest-132"><a id="_idTextAnchor134"/><span class="koboSpan" id="kobo.392.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.393.1">In this chapter, we looked at how endpoint detection and response tools can provide analysts with the ability to conduct investigations at scale. </span><span class="koboSpan" id="kobo.393.2">Building on this, we examined the open source tool Velociraptor, going through the setup and configuration, agent deployment, and several scenarios where Velociraptor can aid in the gathering of evidence and analysis related to an incident. </span><span class="koboSpan" id="kobo.393.3">Keep these scenarios in mind when we discuss ransomware investigations in </span><a href="B18571_17.xhtml#_idTextAnchor304"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.394.1">Chapter 17</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.395.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.396.1">In the next chapter, we will examine how to properly image a system’s storage for follow-on analysis. </span></p>
<h1 id="_idParaDest-133"><a id="_idTextAnchor135"/><span class="koboSpan" id="kobo.397.1">Questions</span></h1>
<p><span class="koboSpan" id="kobo.398.1">Answer the following questions to test your knowledge of </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">this chapter:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.400.1">In an incident investigation, it may not be necessary to obtain a full disk or memory image before an analysis can </span><span class="No-Break"><span class="koboSpan" id="kobo.401.1">be conducted.</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.402.1">True</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.403.1">False</span></span></li></ol></li>
<li><span class="koboSpan" id="kobo.404.1">Which of the following are not advantages of an </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">EDR platform?</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.406.1">Cost</span></span></li><li><span class="koboSpan" id="kobo.407.1">Scalability </span><span class="No-Break"><span class="koboSpan" id="kobo.408.1">of investigation</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.409.1">Event alerting</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.410.1">Central management</span></span></li></ol></li>
<li><span class="koboSpan" id="kobo.411.1">The one advantage to Velociraptor is that all of the processing is done on the </span><span class="No-Break"><span class="koboSpan" id="kobo.412.1">Velociraptor server.</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.413.1">True</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.414.1">False</span></span></li></ol></li>
</ol>
</div>
<div>
<div id="_idContainer115">
</div>
</div>
</body></html>