<html><head></head><body>
<div id="_idContainer266">
<h1 class="chapter-number" id="_idParaDest-199"><a id="_idTextAnchor204"/><span class="koboSpan" id="kobo.1.1">12</span></h1>
<h1 id="_idParaDest-200"><a id="_idTextAnchor205"/><span class="koboSpan" id="kobo.2.1">Analyzing Log Files</span></h1>
<p><a href="B18571_03.xhtml#_idTextAnchor046"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.3.1">Chapter 3</span></em></span></a><span class="koboSpan" id="kobo.4.1"> contained a detailed discussion of Dr. </span><span class="koboSpan" id="kobo.4.2">Edmond Locard and his exchange principle. </span><span class="koboSpan" id="kobo.4.3">For review purposes, the central premise of Locard’s Exchange Principle is that when two objects come into contact with each other, they leave a trace. </span><span class="koboSpan" id="kobo.4.4">In the world of digital forensics, we have discussed the various locations and techniques that can be leveraged by responders in uncovering these traces from memory, hard drives, and network traffic. </span><span class="koboSpan" id="kobo.4.5">One location that provides a wealth of data that can be leveraged is that of log files. </span><span class="koboSpan" id="kobo.4.6">Actions are logged across a wide range of hardware and software. </span><span class="koboSpan" id="kobo.4.7">What is needed is for responders to understand how to acquire these logs, how to examine them, and what they detail. </span><span class="koboSpan" id="kobo.4.8">In doing so, they may be able to ascertain a good deal about the root cause of </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">an incident.</span></span></p>
<p><span class="koboSpan" id="kobo.6.1">In this chapter, the discussion will focus on logs and log management, using log aggregation tools such as a </span><strong class="bold"><span class="koboSpan" id="kobo.7.1">Security Information and Event Management</span></strong><span class="koboSpan" id="kobo.8.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.9.1">SIEM</span></strong><span class="koboSpan" id="kobo.10.1">) system, the Windows event logs, and – finally – analyzing Windows event logs. </span><span class="koboSpan" id="kobo.10.2">It is hoped that, by discussing some of these techniques, responders will be able to articulate how logs are critical to an incident investigation, while also being able to examine them as part of a larger </span><span class="No-Break"><span class="koboSpan" id="kobo.11.1">incident investigation.</span></span></p>
<p><span class="koboSpan" id="kobo.12.1">We will cover the following topics in </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.14.1">Logs and </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">log management</span></span></li>
<li><span class="koboSpan" id="kobo.16.1">Working </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">with SIEMs</span></span></li>
<li><span class="koboSpan" id="kobo.18.1">Windows </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">Event Logs</span></span></li>
<li><span class="koboSpan" id="kobo.20.1">Analyzing Windows </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">Event Logs</span></span></li>
</ul>
<h1 id="_idParaDest-201"><a id="_idTextAnchor206"/><span class="koboSpan" id="kobo.22.1">Logs and log management</span></h1>
<p><span class="koboSpan" id="kobo.23.1">The</span><a id="_idIndexMarker1006"/><span class="koboSpan" id="kobo.24.1"> lifeblood of a good </span><a id="_idIndexMarker1007"/><span class="koboSpan" id="kobo.25.1">incident investigation is evidence from a wide range of sources. </span><span class="koboSpan" id="kobo.25.2">Even something such as a malware infection on a host system requires corroboration from a variety of sources. </span><span class="koboSpan" id="kobo.25.3">One common challenge with incident response, especially in smaller networks, is how the organization handles log management. </span><span class="koboSpan" id="kobo.25.4">For a comprehensive investigation, incident response analysts need access to as much network data as possible. </span><span class="koboSpan" id="kobo.25.5">All too often, organizations do not dedicate the proper resources so that comprehensive logs can be collected from network devices and </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">other systems.</span></span></p>
<p><span class="koboSpan" id="kobo.27.1">Before any incident, it is critical to clearly define how and what an organization will log, as well as how it will maintain those logs. </span><span class="koboSpan" id="kobo.27.2">This should be established within a log management policy and associated procedure. </span><span class="koboSpan" id="kobo.27.3">The </span><strong class="bold"><span class="koboSpan" id="kobo.28.1">Computer Security Incident Response Team</span></strong><span class="koboSpan" id="kobo.29.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.30.1">CSIRT</span></strong><span class="koboSpan" id="kobo.31.1">) personnel</span><a id="_idIndexMarker1008"/><span class="koboSpan" id="kobo.32.1"> should be involved in any discussion as to which logs are necessary or not, as they will often have insight into the value of one log source </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">over another.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.34.1">NIST logging guidance</span></p>
<p class="callout"><span class="koboSpan" id="kobo.35.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.36.1">National Institute of Standards and Technology</span></strong><span class="koboSpan" id="kobo.37.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.38.1">NIST</span></strong><span class="koboSpan" id="kobo.39.1">) has published a short </span><a id="_idIndexMarker1009"/><span class="koboSpan" id="kobo.40.1">guide to log management, available </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">at </span></span><a href="http://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-92.pdf"><span class="No-Break"><span class="koboSpan" id="kobo.42.1">http://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-92.pdf</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.43.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.44.1">Aside from</span><a id="_idIndexMarker1010"/><span class="koboSpan" id="kobo.45.1"> the</span><a id="_idIndexMarker1011"/><span class="koboSpan" id="kobo.46.1"> technical issues regarding log management, there are legal issues that must be addressed. </span><span class="koboSpan" id="kobo.46.2">The following are some issues that should be addressed by the CSIRT and its legal support before </span><span class="No-Break"><span class="koboSpan" id="kobo.47.1">any incident:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.48.1">Establish logging as a normal business practice</span></strong><span class="koboSpan" id="kobo.49.1">: Depending on the type of business </span><a id="_idIndexMarker1012"/><span class="koboSpan" id="kobo.50.1">and the jurisdiction, users may have a reasonable expectation of privacy absent from any expressly stated monitoring policy. </span><span class="koboSpan" id="kobo.50.2">In addition, if logs are enabled strictly to determine a user’s potential malicious activity, there may be legal issues. </span><span class="koboSpan" id="kobo.50.3">As a result, the logging policy should establish that logging network activity is part of normal business activity and that users do not have a reasonable expectation </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">of privacy.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.52.1">Logging close to the event</span></strong><span class="koboSpan" id="kobo.53.1">: This is not so much an issue with automated logging, as logs are often created almost as the event occurs. </span><span class="koboSpan" id="kobo.53.2">From an evidentiary standpoint, logs that are not created close to the event lose their value as evidence in </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">a courtroom.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.55.1">Knowledgeable personnel</span></strong><span class="koboSpan" id="kobo.56.1">: The value of logs is often dependent on who created the entry, and whether or not they were knowledgeable about the event. </span><span class="koboSpan" id="kobo.56.2">In the case of logs from network devices, the logging software addresses this issue. </span><span class="koboSpan" id="kobo.56.3">So long as the software can be demonstrated to be functioning properly, there should be </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">no issue.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.58.1">Comprehensive logging</span></strong><span class="koboSpan" id="kobo.59.1">: Enterprise logging should be configured for as much of the enterprise as possible. </span><span class="koboSpan" id="kobo.59.2">In addition, logging should be consistent. </span><span class="koboSpan" id="kobo.59.3">A pattern of logging that is random will have less value in a court than a consistent pattern of logging across the </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">entire enterprise.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.61.1">Qualified custodian</span></strong><span class="koboSpan" id="kobo.62.1">: The logging policy should name a data custodian. </span><span class="koboSpan" id="kobo.62.2">This individual would speak for the logging procedure and the types of software utilized to create the logs. </span><span class="koboSpan" id="kobo.62.3">They would also be responsible for testifying to the accuracy of the </span><a id="_idIndexMarker1013"/><span class="koboSpan" id="kobo.63.1">logs and the logging </span><span class="No-Break"><span class="koboSpan" id="kobo.64.1">software used.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.65.1">Document failures</span></strong><span class="koboSpan" id="kobo.66.1">: Prolonged failures, or a history of failures when logging events, may diminish</span><a id="_idIndexMarker1014"/><span class="koboSpan" id="kobo.67.1"> their </span><a id="_idIndexMarker1015"/><span class="koboSpan" id="kobo.68.1">value in a courtroom. </span><span class="koboSpan" id="kobo.68.2">A logging failure must be documented, and a reason associated with </span><span class="No-Break"><span class="koboSpan" id="kobo.69.1">the failure.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.70.1">Log file discovery</span></strong><span class="koboSpan" id="kobo.71.1">: Organizations should be made aware that logs utilized within a courtroom proceeding are going to be made available to the opposing </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">legal counsel.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.73.1">Logs from compromised systems</span></strong><span class="koboSpan" id="kobo.74.1">: Logs that originate from a known compromised system are suspect. </span><span class="koboSpan" id="kobo.74.2">If these logs are to be introduced as evidence, the custodian or incident responder will often have to testify at length concerning the veracity of the data contained within </span><span class="No-Break"><span class="koboSpan" id="kobo.75.1">the logs.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.76.1">Original copies are preferred</span></strong><span class="koboSpan" id="kobo.77.1">: Log files can be copied from the log source to storage media. </span><span class="koboSpan" id="kobo.77.2">As a further step, any logs should be archived off the system. </span><span class="koboSpan" id="kobo.77.3">Incident responders should establish a chain of custody for each log file used throughout the incident, and these logs should be maintained as part of the case until an</span><a id="_idIndexMarker1016"/><span class="koboSpan" id="kobo.78.1"> order from the court is obtained, allowing for </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">their destruction.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.80.1">A log management process addresses the foundational elements required to identify those events that an organization deems necessary. </span><span class="koboSpan" id="kobo.80.2">From here, the next major component of a proper log management strategy is the technology that is leveraged for aggregation and </span><a id="_idIndexMarker1017"/><span class="koboSpan" id="kobo.81.1">review. </span><span class="koboSpan" id="kobo.81.2">This</span><a id="_idIndexMarker1018"/><span class="koboSpan" id="kobo.82.1"> involves integrating a SIEM system as part of the overall structure of the log </span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">management process.</span></span></p>
<h1 id="_idParaDest-202"><a id="_idTextAnchor207"/><span class="koboSpan" id="kobo.84.1">Working with SIEMs</span></h1>
<p><span class="koboSpan" id="kobo.85.1">A significant </span><a id="_idIndexMarker1019"/><span class="koboSpan" id="kobo.86.1">challenge that a great many organizations have is the nature of logging on network devices. </span><span class="koboSpan" id="kobo.86.2">With limited space, log files are often rolled over, whereby new log files are written over older log files. </span><span class="koboSpan" id="kobo.86.3">The result is that, in some cases, an organization may only have a few days’, or even a few hours’, worth of important logs. </span><span class="koboSpan" id="kobo.86.4">If a potential incident happened several weeks ago, the incident response personnel will be without critical pieces </span><span class="No-Break"><span class="koboSpan" id="kobo.87.1">of evidence.</span></span></p>
<p><span class="koboSpan" id="kobo.88.1">One tool that has been embraced by a wide range of enterprises is a SIEM system. </span><span class="koboSpan" id="kobo.88.2">This appliance can aggregate log and event data from network sources and combine them into a single location. </span><span class="koboSpan" id="kobo.88.3">This allows the CSIRT and other security personnel to observe activity across the entire network, without having to examine </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">individual systems.</span></span></p>
<p><span class="koboSpan" id="kobo.90.1">The following diagram illustrates how a SIEM system integrates into the </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">overall network:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer239">
<span class="koboSpan" id="kobo.92.1"><img alt="Figure 12.1 – SIEM and logging architecture " src="image/Image_B18571_12_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.93.1">Figure 12.1 – SIEM and logging architecture</span></p>
<p><span class="koboSpan" id="kobo.94.1">A variety of sources, from security controls to SQL databases, are configured to send logs to  SIEM. </span><span class="koboSpan" id="kobo.94.2">In this case, the SQL database located at </span><strong class="source-inline"><span class="koboSpan" id="kobo.95.1">10.100.20.18</span></strong><span class="koboSpan" id="kobo.96.1"> indicates that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.97.1">USSalesSyncAcct</span></strong><span class="koboSpan" id="kobo.98.1"> user account was utilized to copy a database to the remote host, located at </span><strong class="source-inline"><span class="koboSpan" id="kobo.99.1">10.88.6.12</span></strong><span class="koboSpan" id="kobo.100.1">. </span><span class="koboSpan" id="kobo.100.2">SIEM allows a quick examination of this type of activity. </span><span class="koboSpan" id="kobo.100.3">For example, if it is determined that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.101.1">USSalesSyncAcct</span></strong><span class="koboSpan" id="kobo.102.1"> account has been compromised, CSIRT </span><a id="_idIndexMarker1020"/><span class="koboSpan" id="kobo.103.1">analysts can quickly query SIEM for any usage of that account. </span><span class="koboSpan" id="kobo.103.2">From there, they would be able to see the log entry that indicated a copy of a database to the </span><span class="No-Break"><span class="koboSpan" id="kobo.104.1">remote host.</span></span></p>
<p><span class="koboSpan" id="kobo.105.1">Without that SIEM, CSIRT analysts would have to search each system that might have been accessed, a process that may </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1">be prohibitive.</span></span></p>
<p><span class="koboSpan" id="kobo.107.1">From the SIEM platform, security and network analysts can perform several different tasks related to incident response, </span><span class="No-Break"><span class="koboSpan" id="kobo.108.1">as follows:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.109.1">Log aggregation</span></strong><span class="koboSpan" id="kobo.110.1">: Typical </span><a id="_idIndexMarker1021"/><span class="koboSpan" id="kobo.111.1">enterprises have several thousand devices within the internal network, each with logs; SIEM can be deployed to aggregate these logs in a </span><span class="No-Break"><span class="koboSpan" id="kobo.112.1">central location.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.113.1">Log retention</span></strong><span class="koboSpan" id="kobo.114.1">: Another key feature that SIEM platforms provide is a platform to retain logs. </span><span class="koboSpan" id="kobo.114.2">Compliance frameworks, such as the </span><strong class="bold"><span class="koboSpan" id="kobo.115.1">Payment Card Industry Data Security Standard</span></strong><span class="koboSpan" id="kobo.116.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.117.1">PCI-DSS</span></strong><span class="koboSpan" id="kobo.118.1">), stipulate that system logs should be maintained</span><a id="_idIndexMarker1022"/><span class="koboSpan" id="kobo.119.1"> for 1 year, with 90 days’ worth immediately available. </span><span class="koboSpan" id="kobo.119.2">SIEM platforms can aid with log management by providing a system that archives logs in an orderly fashion and allow them to be </span><span class="No-Break"><span class="koboSpan" id="kobo.120.1">retrieved immediately.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.121.1">Routine analysis</span></strong><span class="koboSpan" id="kobo.122.1">: It is advisable when using a SIEM platform to conduct periodic reviews of the information. </span><span class="koboSpan" id="kobo.122.2">SIEM platforms often provide a dashboard that highlights key elements, such as the number of connections, data flow, and any critical alerts. </span><span class="koboSpan" id="kobo.122.3">SIEM platforms also allow reporting so that stakeholders can keep informed about </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1">the activity.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.124.1">Alerting</span></strong><span class="koboSpan" id="kobo.125.1">: SIEM platforms can alert to specific conditions that may indicate malicious activity. </span><span class="koboSpan" id="kobo.125.2">This can include alerting from security controls such as antivirus and intrusion prevention or detection systems. </span><span class="koboSpan" id="kobo.125.3">Another key feature of SIEM platforms is event correlation. </span><span class="koboSpan" id="kobo.125.4">This technique examines the log files and determines</span><a id="_idIndexMarker1023"/><span class="koboSpan" id="kobo.126.1"> whether there is a link or any commonality between the events. </span><span class="koboSpan" id="kobo.126.2">SIEM can then alert to these types of events. </span><span class="koboSpan" id="kobo.126.3">For example, if a user account attempts multiple logins across several systems in the enterprise, SIEM can identify that activity and alert the relevant parties </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">to it.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.128.1">Threat hunting</span></strong><span class="koboSpan" id="kobo.129.1">: Modern adversaries can embed themselves into target networks or leverage previously unidentified vulnerabilities. </span><span class="koboSpan" id="kobo.129.2">Threat hunting is the practice of leveraging digital forensics techniques to uncover these types of long-term</span><a id="_idIndexMarker1024"/><span class="koboSpan" id="kobo.130.1"> attacks. </span><span class="koboSpan" id="kobo.130.2">SIEM platforms allow threat hunters to search for </span><strong class="bold"><span class="koboSpan" id="kobo.131.1">Indicators of </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.132.1">Compromise </span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.133.1">(</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.134.1">IOCs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">).</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.136.1">Incident response</span></strong><span class="koboSpan" id="kobo.137.1">: As SIEM becomes the single point for log aggregation and analysis, CSIRT analysts will often make use of SIEM during an incident. </span><span class="koboSpan" id="kobo.137.2">CSIRT analysis will often make queries on the platform, as well as download logs for offline analysis. </span><span class="koboSpan" id="kobo.137.3">Because of the centralization of log files, the time to conduct searches and event collection is significantly reduced. </span><span class="koboSpan" id="kobo.137.4">For example, let’s say a CSIRT analysis has indicated a user account has been compromised. </span><span class="koboSpan" id="kobo.137.5">Without a SIEM, the CSIRT analyst would have to check various systems for any activity concerning that user account. </span><span class="koboSpan" id="kobo.137.6">With a SIEM in place, the analyst simply searches that user account on the SIEM platform, which has aggregated user account activity in logs from systems all over the enterprise. </span><span class="koboSpan" id="kobo.137.7">The result is that the analyst has a clear idea of the user account activity, in a fraction of the time it would have taken to </span><a id="_idIndexMarker1025"/><span class="koboSpan" id="kobo.138.1">examine logs from various systems throughout </span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">the enterprise.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.140.1">SIEM platforms do entail a good deal of time and money to purchase and implement. </span><span class="koboSpan" id="kobo.140.2">Added to that cost are the constant upkeep, maintenance, and having to modify the necessary rules. </span><span class="koboSpan" id="kobo.140.3">From an incident response perspective, though, a properly configured and maintained SIEM is vital to gathering network-based evidence promptly. </span><span class="koboSpan" id="kobo.140.4">In addition, the features and capabilities of SIEM platforms can significantly reduce the time it takes to determine the root cause of an incident once it has </span><span class="No-Break"><span class="koboSpan" id="kobo.141.1">been detected.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.142.1">SIEM use cases</span></p>
<p class="callout"><span class="koboSpan" id="kobo.143.1">The following article provides an excellent breakdown of the use cases of SIEM platforms in </span><a id="_idIndexMarker1026"/><span class="koboSpan" id="kobo.144.1">enterprise </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">environments: </span></span><a href="https://www.sumologic.com/blog/why-modern-siem/"><span class="No-Break"><span class="koboSpan" id="kobo.146.1">https://www.sumologic.com/blog/why-modern-siem/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.147.1">.</span></span></p>
<h2 id="_idParaDest-203"><a id="_idTextAnchor208"/><span class="koboSpan" id="kobo.148.1">Splunk</span></h2>
<p><span class="koboSpan" id="kobo.149.1">Splunk is a</span><a id="_idIndexMarker1027"/><span class="koboSpan" id="kobo.150.1"> commercial </span><a id="_idIndexMarker1028"/><span class="koboSpan" id="kobo.151.1">tool that is used in a wide range of organizations across all types of enterprises. </span><span class="koboSpan" id="kobo.151.2">The platform utilizes a log forwarder application to aggregate logs and ships them to a central server, either on-premise or in a cloud instance. </span><span class="koboSpan" id="kobo.151.3">From here, analysts can review logs and craft alerts that identify and escalate potential malicious activity. </span><span class="koboSpan" id="kobo.151.4">The one drawback to Splunk is the commercial licensing required. </span><span class="koboSpan" id="kobo.151.5">This licensing is based on the amount of data and logs that are sent to the platform. </span><span class="koboSpan" id="kobo.151.6">Most organizations can’t send every single log from every single system on the network. </span><span class="koboSpan" id="kobo.151.7">Therefore, organizations need to be judicious with the logs that are sent: </span></p>
<div>
<div class="IMG---Figure" id="_idContainer240">
<span class="koboSpan" id="kobo.152.1"><img alt="Figure 12.2 – The Splunk platform " src="image/Image_B18571_12_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.153.1">Figure 12.2 – The Splunk platform</span></p>
<h2 id="_idParaDest-204"><a id="_idTextAnchor209"/><span class="koboSpan" id="kobo.154.1">Elastic Stack</span></h2>
<p><span class="koboSpan" id="kobo.155.1">Another open-source</span><a id="_idIndexMarker1029"/><span class="koboSpan" id="kobo.156.1"> option</span><a id="_idIndexMarker1030"/><span class="koboSpan" id="kobo.157.1"> for SIEM is the Elastic Stack (or the ELK Stack, as it is commonly known). </span><span class="koboSpan" id="kobo.157.2">The Elastic Stack is a combination of three tools in one. </span><span class="koboSpan" id="kobo.157.3">The open-source tools Elasticsearch, Logstash, and Kibana are combined to provide threat hunters with an open-source platform that ingests data and then transforms it into a format that can be viewed and analyzed via the Kibana GUI. </span><span class="koboSpan" id="kobo.157.4">This allows threat hunters to visualize log data from multiple systems at once. </span><span class="koboSpan" id="kobo.157.5">The Elastic Stack is built into several different open source security tools, including the Security Onion platform, which we will discuss shortly. </span><span class="koboSpan" id="kobo.157.6">The Elastic Stack can also be configured as a standalone SIEM solution, with tools such as Winlogbeat, which forwards Windows event logs to the </span><span class="No-Break"><span class="koboSpan" id="kobo.158.1">Elastic Stack.</span></span></p>
<p><span class="koboSpan" id="kobo.159.1">The following is the most visible portion of the Elastic Stack – that is, the Kibana interface. </span><span class="koboSpan" id="kobo.159.2">This interface allows data visualization and searching, as can be </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">seen here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer241">
<span class="koboSpan" id="kobo.161.1"><img alt="Figure 12.3 – The Kibana platform " src="image/Image_B18571_12_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.162.1">Figure 12.3 – The Kibana platform</span></p>
<p><span class="koboSpan" id="kobo.163.1">SIEM platforms are an excellent way for responders to examine a wide range of logs from many systems. </span><span class="koboSpan" id="kobo.163.2">One facet where this becomes critical is examining Windows event logs. </span><span class="koboSpan" id="kobo.163.3">The next section will examine a variety of Windows event logs and the insight they can provide</span><a id="_idIndexMarker1031"/><span class="koboSpan" id="kobo.164.1"> responders </span><a id="_idIndexMarker1032"/><span class="koboSpan" id="kobo.165.1">into account and </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">application usage.</span></span></p>
<h2 id="_idParaDest-205"><a id="_idTextAnchor210"/><span class="koboSpan" id="kobo.167.1">Security Onion</span></h2>
<p><span class="koboSpan" id="kobo.168.1">Security Onion</span><a id="_idIndexMarker1033"/><span class="koboSpan" id="kobo.169.1"> is an </span><a id="_idIndexMarker1034"/><span class="koboSpan" id="kobo.170.1">open-source multi-tool platform that can serve as both a network </span><strong class="bold"><span class="koboSpan" id="kobo.171.1">Intrusion Detection System</span></strong><span class="koboSpan" id="kobo.172.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.173.1">IDS</span></strong><span class="koboSpan" id="kobo.174.1">) and</span><a id="_idIndexMarker1035"/><span class="koboSpan" id="kobo.175.1"> a SIEM. </span><span class="koboSpan" id="kobo.175.2">Security Onion ties a wide range of security tools – such as OSSEC, Suricata, and Zeek – into a </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">single platform.</span></span></p>
<p><span class="koboSpan" id="kobo.177.1">Security Onion also has features such as dashboards and tools for deep analysis of log files. </span><span class="koboSpan" id="kobo.177.2">The following screenshot shows the level of detail </span><span class="No-Break"><span class="koboSpan" id="kobo.178.1">that’s available:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer242">
<span class="koboSpan" id="kobo.179.1"><img alt="Figure 12.4 – The Security Onion platform " src="image/Image_B18571_12_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.180.1">Figure 12.4 – The Security Onion platform</span></p>
<p><span class="koboSpan" id="kobo.181.1">Although installing and deploying the Security Onion platform may require some resources in terms of time, it is a powerful, low-cost alternative, providing a solution to organizations that cannot deploy a full-featured SIEM solution (the Security Onion platform and </span><a id="_idIndexMarker1036"/><span class="koboSpan" id="kobo.182.1">its associated </span><a id="_idIndexMarker1037"/><span class="koboSpan" id="kobo.183.1">documentation are available </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">at </span></span><a href="https://securityonion.net/"><span class="No-Break"><span class="koboSpan" id="kobo.185.1">https://securityonion.net/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.186.1">).</span></span></p>
<h1 id="_idParaDest-206"><a id="_idTextAnchor211"/><span class="koboSpan" id="kobo.187.1">Windows Logs</span></h1>
<p><span class="koboSpan" id="kobo.188.1">The most </span><a id="_idIndexMarker1038"/><span class="koboSpan" id="kobo.189.1">prevalent endpoint operating system that responders will have to examine related to an incident is by far the Windows OS. </span><span class="koboSpan" id="kobo.189.2">Due to the overwhelming market share that Microsoft has, most enterprise endpoints will be Microsoft desktop/laptop, server, or virtual systems. </span><span class="koboSpan" id="kobo.189.3">As a result, responders must have a solid understanding of how to leverage the Windows Event and System Monitor logs for </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1">incident analysis.</span></span></p>
<h2 id="_idParaDest-207"><a id="_idTextAnchor212"/><span class="koboSpan" id="kobo.191.1">Windows Event Logs</span></h2>
<p><span class="koboSpan" id="kobo.192.1">Windows event</span><a id="_idIndexMarker1039"/><span class="koboSpan" id="kobo.193.1"> logs provide extensive data on the actions of the operating systems, connections from other systems, and credential use, along with the use </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">of PowerShell.</span></span></p>
<p><span class="koboSpan" id="kobo.195.1">Adversarial tactics from initial compromise using malware or other exploits, credential accessing, and elevation and lateral movement using the Windows operating system’s internal tools are often captured via Windows </span><span class="No-Break"><span class="koboSpan" id="kobo.196.1">event logs.</span></span></p>
<p><span class="koboSpan" id="kobo.197.1">The specific logs that are captured during the operating system’s activities are largely dependent on how the organization has configured them. </span><span class="koboSpan" id="kobo.197.2">Most enterprises utilize the Group Policy settings to configure which actions the system logs, as well as the storage space allocated for log files. </span><span class="koboSpan" id="kobo.197.3">Depending on the organization’s log management practices, the Windows OS can be configured to log the use of PowerShell, </span><strong class="bold"><span class="koboSpan" id="kobo.198.1">Server Message Block</span></strong><span class="koboSpan" id="kobo.199.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.200.1">SMB</span></strong><span class="koboSpan" id="kobo.201.1">) usage, application</span><a id="_idIndexMarker1040"/><span class="koboSpan" id="kobo.202.1"> activity, DHCP client administration, and Task </span><span class="No-Break"><span class="koboSpan" id="kobo.203.1">Scheduler maintenance.</span></span></p>
<p><span class="koboSpan" id="kobo.204.1">Most often, log management configurations are managed via Windows Group Policy. </span><span class="koboSpan" id="kobo.204.2">Here, administrators can manage a wide range of systems via </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">one policy.</span></span></p>
<p><span class="koboSpan" id="kobo.206.1">The Windows OS has included the Event Viewer so that users or systems administrators can determine what logs are available on the system, as well as perform a cursory review. </span></p>
<p><span class="koboSpan" id="kobo.207.1">To access the Windows Event Viewer, use the Windows search function for Event Viewer and click on</span><a id="_idIndexMarker1041"/><span class="koboSpan" id="kobo.208.1"> the icon. </span><span class="koboSpan" id="kobo.208.2">This will open the </span><strong class="bold"><span class="koboSpan" id="kobo.209.1">Event </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.210.1">Viewer</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.211.1"> window:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer243">
<span class="koboSpan" id="kobo.212.1"><img alt="Figure 12.5 – Microsoft Windows Event Viewer " src="image/Image_B18571_12_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.213.1">Figure 12.5 – Microsoft Windows Event Viewer</span></p>
<p><span class="koboSpan" id="kobo.214.1">From this viewer, the responder can get a good sense of what is being logged and can even search for specific log entries. </span><span class="koboSpan" id="kobo.214.2">To access the logs directly for offline analysis, navigate to the default file path for log storage at </span><strong class="source-inline"><span class="koboSpan" id="kobo.215.1">C:\Windows\System32\winevt\logs</span></strong><span class="koboSpan" id="kobo.216.1">. </span><span class="koboSpan" id="kobo.216.2">This will show the variety of events that can be logged, </span><span class="No-Break"><span class="koboSpan" id="kobo.217.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer244">
<span class="koboSpan" id="kobo.218.1"><img alt="Figure 12.6 – Windows Event Log directory " src="image/Image_B18571_12_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.219.1">Figure 12.6 – Windows Event Log directory</span></p>
<p><span class="koboSpan" id="kobo.220.1">As previously </span><a id="_idIndexMarker1042"/><span class="koboSpan" id="kobo.221.1">stated, there are Windows event logs for a wide range of activities performed by the operating system. </span><span class="koboSpan" id="kobo.221.2">For this chapter, the focus will be on three of the more pertinent Windows Event Log types. </span><span class="koboSpan" id="kobo.221.3">These types cover a wide range of activities and are useful in determining which actions have taken place on a potentially compromised system. </span><span class="koboSpan" id="kobo.221.4">These are detailed </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">as follows:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.223.1">Security logs</span></strong><span class="koboSpan" id="kobo.224.1">: These </span><a id="_idIndexMarker1043"/><span class="koboSpan" id="kobo.225.1">logs contain data entries concerning the security of the system. </span><span class="koboSpan" id="kobo.225.2">This includes logons, logoffs, security group membership, and </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">program execution.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.227.1">Application logs</span></strong><span class="koboSpan" id="kobo.228.1">: Application developers determine which types of activity applications will log. </span><span class="koboSpan" id="kobo.228.2">These are aggregated in the application </span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">log file.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.230.1">System logs</span></strong><span class="koboSpan" id="kobo.231.1">: Often utilized to troubleshoot non-malicious activity, the system logs maintain data that the Windows </span><span class="No-Break"><span class="koboSpan" id="kobo.232.1">OS creates.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.233.1">There are over 100 Windows Event Log IDs. </span><span class="koboSpan" id="kobo.233.2">Depending on how the operating system is used, some of these are seldom – if ever – observed on the system. </span><span class="koboSpan" id="kobo.233.3">Others can be very common and are seen constantly in use, even in normal circumstances. </span><span class="koboSpan" id="kobo.233.4">The following are some of the</span><a id="_idIndexMarker1044"/><span class="koboSpan" id="kobo.234.1"> more useful Windows event log types </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">for responders:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.236.1">4624 and 4634 – logon and logoff</span></strong><span class="koboSpan" id="kobo.237.1">: These</span><a id="_idIndexMarker1045"/><span class="koboSpan" id="kobo.238.1"> event log entries show the use of credentials on a potentially compromised system. </span><span class="koboSpan" id="kobo.238.2">In addition, the 4624 event IDs can show whether the logon was performed on the local system or through a remote connection, which is critical to finding lateral movement using the Windows </span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">SMB protocol.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.240.1">4625 – account failed logon</span></strong><span class="koboSpan" id="kobo.241.1">: One or two of these entries may not mean much. </span><span class="koboSpan" id="kobo.241.2">A few entries of this nature may indicate a fat-fingered logon here and there, but an excessive amount of these log entries is indicative of an adversary attempting to </span><span class="No-Break"><span class="koboSpan" id="kobo.242.1">brute-force credentials.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.243.1">4672 – special privileges assigned to new logon</span></strong><span class="koboSpan" id="kobo.244.1">: This is the Windows OS equivalent of a user account attempting to elevate to root- or administrator-level privileges. </span><span class="koboSpan" id="kobo.244.2">This can be used to determine if an adversary is escalating privileges with a </span><span class="No-Break"><span class="koboSpan" id="kobo.245.1">compromised account.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.246.1">4688 – a new process has been created</span></strong><span class="koboSpan" id="kobo.247.1">: This log entry documents every time a program is run. </span><span class="koboSpan" id="kobo.247.2">While there may be a lot to sift through in the logs, in terms of how many executables are run, threat hunters can focus on well-known abused programs, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.248.1">PsExec</span></strong><span class="koboSpan" id="kobo.249.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">CMD.EXE</span></strong><span class="koboSpan" id="kobo.251.1">, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">Whami.exe</span></strong><span class="koboSpan" id="kobo.253.1">, to zero in on potentially </span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">malicious behavior.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.255.1">4768-4773 – Kerberos service</span></strong><span class="koboSpan" id="kobo.256.1">: Several well-known exploits are used by adversaries where a Kerberos Ticket Granting Ticket is utilized for elevated privileges. </span><span class="koboSpan" id="kobo.256.2">This attack – often referred to as Kerberoasting – is particularly devastating, as it allows attackers to run through the network with </span><span class="No-Break"><span class="koboSpan" id="kobo.257.1">valid credentials.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.258.1">5140 – a network share object was accessed</span></strong><span class="koboSpan" id="kobo.259.1">: This activity is logged when a user account first logs on to a network share. </span><span class="koboSpan" id="kobo.259.2">Anomalies in time or user activity may be indicative of an adversary attempting to obtain confidential data, or ransomware attempting to infect </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">network shares.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.261.1">7045 – a new service was installed</span></strong><span class="koboSpan" id="kobo.262.1">: This log entry occurs when a new service was installed by the user indicated within the log entry. </span><span class="koboSpan" id="kobo.262.2">Some strains of malware will install themselves as a service. </span><span class="koboSpan" id="kobo.262.3">A review of these log entries may indicate the </span><a id="_idIndexMarker1046"/><span class="koboSpan" id="kobo.263.1">presence of </span><span class="No-Break"><span class="koboSpan" id="kobo.264.1">malicious code.</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.265.1">Windows Event Log reference</span></p>
<p class="callout"><span class="koboSpan" id="kobo.266.1">Specific details on every event log ID are outside the scope of this chapter. </span><span class="koboSpan" id="kobo.266.2">A good reference for the specific IDs is available </span><span class="No-Break"><span class="koboSpan" id="kobo.267.1">at </span></span><a href="https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/default.aspx"><span class="No-Break"><span class="koboSpan" id="kobo.268.1">https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/default.aspx</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.269.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.270.1">As previously stated, there are over 100 specific Windows event types available. </span><span class="koboSpan" id="kobo.270.2">The specific ones</span><a id="_idIndexMarker1047"/><span class="koboSpan" id="kobo.271.1"> in use are often determined by the organization and have to be weighed against the amount of storage space that is available, as well as against the usefulness of the specific log entries during </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">an investigation.</span></span></p>
<p><span class="koboSpan" id="kobo.273.1">Several resources can be leveraged to better understand Windows event logs. </span><span class="koboSpan" id="kobo.273.2">The first of these is the site </span><strong class="source-inline"><span class="koboSpan" id="kobo.274.1">ultimatewindowssecurity.com</span></strong><span class="koboSpan" id="kobo.275.1">. </span><span class="koboSpan" id="kobo.275.2">This site provides a searchable database of the various Windows event log types by event ID. </span><span class="koboSpan" id="kobo.275.3">This is very useful in those circumstances where responders may come across a more obscure event ID. </span><span class="koboSpan" id="kobo.275.4">The MITRE Corporation also provides the ATT&amp;CK knowledge database. </span><span class="koboSpan" id="kobo.275.5">This knowledge base can be searched for Windows event log IDs that may be pertinent to an investigation – for example, a responder is examining a system for indications that the system has been infected with the Carbanak malware. </span><span class="koboSpan" id="kobo.275.6">From the ATT&amp;CK knowledge database, the responder can determine that Carbanak has created an account, and the Windows event ID for that is 4720. </span><span class="koboSpan" id="kobo.275.7">From here, the responder would be able to search systems for that specific event ID and determine if any additional accounts appeared to </span><span class="No-Break"><span class="koboSpan" id="kobo.276.1">be suspicious.</span></span></p>
<p><span class="koboSpan" id="kobo.277.1">As can be seen, the Windows operating system has a significant number of log event types and</span><a id="_idIndexMarker1048"/><span class="koboSpan" id="kobo.278.1"> IDs. </span><span class="koboSpan" id="kobo.278.2">The following section will provide the responder with a way to collect and analyze these </span><span class="No-Break"><span class="koboSpan" id="kobo.279.1">log files.</span></span></p>
<h1 id="_idParaDest-208"><a id="_idTextAnchor213"/><span class="koboSpan" id="kobo.280.1">Analyzing Windows Event Logs</span></h1>
<p><span class="koboSpan" id="kobo.281.1">Analyzing Windows</span><a id="_idIndexMarker1049"/><span class="koboSpan" id="kobo.282.1"> event logs is a detailed process. </span><span class="koboSpan" id="kobo.282.2">One challenge that is often encountered by responders is the sheer number of logs that they may have to potentially analyze during an incident. </span><span class="koboSpan" id="kobo.282.3">In the case of multiple systems, the responder may have to contend with millions of separate event log entries. </span><span class="koboSpan" id="kobo.282.4">Cutting them down requires using specialized tools and processes, starting with acquisition, moving into triage, and then, finally, focusing on analyzing the key event logs that are pertinent to the </span><span class="No-Break"><span class="koboSpan" id="kobo.283.1">incident investigation.</span></span></p>
<h2 id="_idParaDest-209"><a id="_idTextAnchor214"/><span class="koboSpan" id="kobo.284.1">Acquisition</span></h2>
<p><span class="koboSpan" id="kobo.285.1">There are several methods</span><a id="_idIndexMarker1050"/><span class="koboSpan" id="kobo.286.1"> that a responder can utilize in the acquisition of Windows event logs. </span><span class="koboSpan" id="kobo.286.2">Ideally, log files should be sent to a SIEM, to allow the responders to search log entries across the enterprise. </span><span class="koboSpan" id="kobo.286.3">Unfortunately, many organizations face a significant hurdle in terms of storage costs with commercial, or even open source, platforms. </span><span class="koboSpan" id="kobo.286.4">The result is that they often must trade off the cost of aggregating these logs by allowing the local systems to handle storage. </span></p>
<p><span class="koboSpan" id="kobo.287.1">Since most of these logs are on the local system, responders will need to use techniques to gather them. </span><span class="koboSpan" id="kobo.287.2">The first of these techniques is to simply copy the event logs from the local system to some type of removable media. </span><span class="koboSpan" id="kobo.287.3">Simply navigate to the default directory, </span><strong class="source-inline"><span class="koboSpan" id="kobo.288.1">C:\Windows\System32\winevt\Logs</span></strong><span class="koboSpan" id="kobo.289.1">, and copy the pertinent logs. </span><span class="koboSpan" id="kobo.289.2">This method does require local access and a good deal of interaction with the local system. </span><span class="koboSpan" id="kobo.289.3">It is incumbent on the responder to document every action they took on the system, for proper reporting. </span></p>
<p><span class="koboSpan" id="kobo.290.1">Responders also have the option of scripting the acquisition of log files through simple batch scripts. </span><span class="koboSpan" id="kobo.290.2">This acquisition can take place along with other actions to acquire evidence from a local system. </span><span class="koboSpan" id="kobo.290.3">For example, the following screenshot shows the acquisition of four Windows event log types from a </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">local system:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer245">
<span class="koboSpan" id="kobo.292.1"><img alt="Figure 12.7 – Event log CMD acquisition " src="image/Image_B18571_12_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.293.1">Figure 12.7 – Event log CMD acquisition</span></p>
<p><span class="koboSpan" id="kobo.294.1">These types of scripts can be run from a USB device or through remote sessions, thereby reducing the amount of interaction with the system. </span></p>
<p><a href="B18571_06.xhtml#_idTextAnchor105"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.295.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.296.1"> introduced the </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.298.1"> tool for the local acquisition of evidence. </span><span class="koboSpan" id="kobo.298.2">One of the key sets of evidence that </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.300.1"> acquires is Windows event logs. </span><span class="koboSpan" id="kobo.300.2">As was previously indicated, these log files can be acquired from the local system and exported to a USB. </span><span class="koboSpan" id="kobo.300.3">Another option that will be explored in this section is the use of </span><strong class="source-inline"><span class="koboSpan" id="kobo.301.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.302.1"> to acquire Windows event logs and forward them to the Skadi log review platform. </span><span class="koboSpan" id="kobo.302.2">Skadi will be addressed later in this section, but first, </span><strong class="source-inline"><span class="koboSpan" id="kobo.303.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.304.1"> will be run against a system, and the output will be sent to the </span><span class="No-Break"><span class="koboSpan" id="kobo.305.1">Skadi server.</span></span></p>
<p><span class="koboSpan" id="kobo.306.1">To acquire the log</span><a id="_idIndexMarker1051"/><span class="koboSpan" id="kobo.307.1"> files from a local system and send them to a Skadi instance, proceed </span><span class="No-Break"><span class="koboSpan" id="kobo.308.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.309.1">Open the Windows Command Prompt as </span><span class="No-Break"><span class="koboSpan" id="kobo.310.1">an administrator.</span></span></li>
<li><span class="koboSpan" id="kobo.311.1">Navigate to the directory where the </span><strong class="source-inline"><span class="koboSpan" id="kobo.312.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.313.1"> file </span><span class="No-Break"><span class="koboSpan" id="kobo.314.1">is located.</span></span></li>
<li><span class="koboSpan" id="kobo.315.1">Enter the following command into the </span><span class="No-Break"><span class="koboSpan" id="kobo.316.1">Command Prompt:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.317.1">C:\Users\JSmith\Desktop&gt;CyLR.exe -s 192.168.207.130:22 -u admin -p password</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.318.1">In the previous command, </span><strong class="source-inline"><span class="koboSpan" id="kobo.319.1">-s</span></strong><span class="koboSpan" id="kobo.320.1"> is the IP address or domain name of the remote system where </span><strong class="source-inline"><span class="koboSpan" id="kobo.321.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.322.1"> output is sent. </span><span class="koboSpan" id="kobo.322.2">In this case, this compressed evidence file will be sent to the system, </span><strong class="source-inline"><span class="koboSpan" id="kobo.323.1">192.168.207.130</span></strong><span class="koboSpan" id="kobo.324.1">, via SFTP. </span><strong class="source-inline"><span class="koboSpan" id="kobo.325.1">-u</span></strong><span class="koboSpan" id="kobo.326.1"> is the username of the account utilized to access the remote system, and, finally, </span><strong class="source-inline"><span class="koboSpan" id="kobo.327.1">-p</span></strong><span class="koboSpan" id="kobo.328.1"> is the password for the account related to the remote system. </span><span class="koboSpan" id="kobo.328.2">Just as with a local acquisition, </span><strong class="source-inline"><span class="koboSpan" id="kobo.329.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.330.1"> will run, and the following will be visible in the </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">Command Prompt:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer246">
<span class="koboSpan" id="kobo.332.1"><img alt="Figure 12.8 – CyLR.exe execution output " src="image/Image_B18571_12_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.333.1">Figure 12.8 – CyLR.exe execution output</span></p>
<p><span class="koboSpan" id="kobo.334.1">This remote capture technique can be accomplished via any remote access tool available. </span><span class="koboSpan" id="kobo.334.2">The one distinct advantage of this method is the ability to acquire log data along with the other evidence that </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.336.1"> captures, and automatically forward it to a central repository. </span><span class="koboSpan" id="kobo.336.2">This central repository can be the Skadi instance, or simply an SFTP server that has been configured to accept </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">this data.</span></span></p>
<p><span class="koboSpan" id="kobo.338.1">Depending on the type of incident and the number of systems involved, there may be a significant </span><a id="_idIndexMarker1052"/><span class="koboSpan" id="kobo.339.1">amount of data. </span><span class="koboSpan" id="kobo.339.2">Sometimes, it may be too much for a responder to examine manually. </span><span class="koboSpan" id="kobo.339.3">In those cases, it is necessary to triage that data to determine what log entries are </span><span class="No-Break"><span class="koboSpan" id="kobo.340.1">most important.</span></span></p>
<h2 id="_idParaDest-210"><a id="_idTextAnchor215"/><span class="koboSpan" id="kobo.341.1">Triage</span></h2>
<p><span class="koboSpan" id="kobo.342.1">As discussed </span><a id="_idIndexMarker1053"/><span class="koboSpan" id="kobo.343.1">previously, depending on the incident, responders may be examining multiple Windows systems. </span><span class="koboSpan" id="kobo.343.2">Each of these systems may contain several thousand, or even a hundred thousand, event log entries. </span><span class="koboSpan" id="kobo.343.3">There is no possible way for a responder or team of responders to be able to examine that many individual entries. </span><span class="koboSpan" id="kobo.343.4">This equates to the often-used saying </span><em class="italic"><span class="koboSpan" id="kobo.344.1">it’s like finding a needle in a haystack</span></em><span class="koboSpan" id="kobo.345.1">. </span><span class="koboSpan" id="kobo.345.2">To address the large datasets that are often encountered in Windows event log analysis, responders can utilize the DeepBlueCLI tool. </span><span class="koboSpan" id="kobo.345.3">This PowerShell script, developed by Eric Conrad, detects suspicious Windows event log entries, such as service creation, account creation, a high number of login failures, and malicious PowerShell usage. </span><span class="koboSpan" id="kobo.345.4">By focusing on these more critical event types, responders will be able to analyze more log files and potentially identify </span><span class="No-Break"><span class="koboSpan" id="kobo.346.1">suspicious activity.</span></span></p>
<p><span class="koboSpan" id="kobo.347.1">To run DeepBlueCLI, proceed </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">as follows:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.349.1">Download </span><a id="_idIndexMarker1054"/><span class="koboSpan" id="kobo.350.1">the PowerShell script from its GitHub site at </span><a href="https://github.com/sans-blue-team/DeepBlueCLI"><span class="koboSpan" id="kobo.351.1">https://github.com/sans-blue-team/DeepBlueCLI</span></a><span class="koboSpan" id="kobo.352.1">. </span><span class="koboSpan" id="kobo.352.2">Once downloaded, uncompressed </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">the file.</span></span></li>
<li><span class="koboSpan" id="kobo.354.1">Open PowerShell and navigate to the directory </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">containing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.356.1">DeepBlue.ps1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.357.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.358.1">Execute the </span><strong class="source-inline"><span class="koboSpan" id="kobo.359.1">DeepBlue.ps1</span></strong><span class="koboSpan" id="kobo.360.1"> PowerShell script by pointing it to a specific Windows event log file – in this case, the Windows security event log, as </span><span class="No-Break"><span class="koboSpan" id="kobo.361.1">shown here:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.362.1">PS C:\Users\madno\Desktop\DeepBlueCLI-master\DeepBlueCLI-master&gt; .\DeepBlue.ps1 -log security C:\Users\madno\Desktop\Logs\Security.evtx</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.363.1">The screenshot for reference is </span><span class="No-Break"><span class="koboSpan" id="kobo.364.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer247">
<span class="koboSpan" id="kobo.365.1"><img alt="Figure 12.9 – DeepBlueCLI suspicious security event logs " src="image/Image_B18571_12_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.366.1">Figure 12.9 – DeepBlueCLI suspicious security event logs</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.367.1">The Windows</span><a id="_idIndexMarker1055"/><span class="koboSpan" id="kobo.368.1"> event logs may also contain entries that are indicative of malicious activity. </span><span class="koboSpan" id="kobo.368.2">Run the DeepBlueCLI PowerShell script against the system logs with the </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.370.1">PS C:\Users\madno\Desktop\DeepBlueCLI-master\DeepBlueCLI-master&gt; .\DeepBlue.ps1 -log system C:\Users\madno\Desktop\Logs\System.evtx</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.371.1">This will produce the </span><span class="No-Break"><span class="koboSpan" id="kobo.372.1">following output:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer248">
<span class="koboSpan" id="kobo.373.1"><img alt="Figure 12.10 – DeepBlueCLI suspicious system event log entry " src="image/Image_B18571_12_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.374.1">Figure 12.10 – DeepBlueCLI suspicious system event log entry</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.375.1">As we already discussed, the amount of Windows Event logs is extensive. </span><span class="koboSpan" id="kobo.375.2">One log source that often provides key data points, especially in ransomware attacks, is the</span><a id="_idIndexMarker1056"/><span class="koboSpan" id="kobo.376.1"> Windows PowerShell Operational logs. </span><span class="koboSpan" id="kobo.376.2">This log will often capture malicious PowerShell scripts that are used as part of multistage ransomware attacks. </span><span class="koboSpan" id="kobo.376.3">Use the following command to triage the </span><span class="No-Break"><span class="koboSpan" id="kobo.377.1">PowerShell logs:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.378.1">PS C:\Users\madno\Desktop\DeepBlueCLI-master\DeepBlueCLI-master&gt; .\DeepBlue.ps1 C:\Users\madno\Desktop\Logs\Microsoft-Windows-PowerShell%4Operational.evtx</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.379.1">This command produces the </span><span class="No-Break"><span class="koboSpan" id="kobo.380.1">following output:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer249">
<span class="koboSpan" id="kobo.381.1"><img alt="Figure 12.11 – DeepBlueCLI PowerShell event log entry " src="image/Image_B18571_12_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.382.1">Figure 12.11 – DeepBlueCLI PowerShell event log entry</span></p>
<p><span class="koboSpan" id="kobo.383.1">In the preceding screenshot, we can see a PowerShell script that is larger than 1,000 bytes, which may indicate that it is malicious. </span><span class="koboSpan" id="kobo.383.2">A review of the script indicates that it opens a network</span><a id="_idIndexMarker1057"/><span class="koboSpan" id="kobo.384.1"> socket to an IP address with the port set </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.386.1">4443</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer250">
<span class="koboSpan" id="kobo.388.1"><img alt="Figure 12.12 – PowerShell network socket " src="image/Image_B18571_12_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.389.1">Figure 12.12 – PowerShell network socket</span></p>
<p><span class="koboSpan" id="kobo.390.1">This type of behavior may be legitimate but should be followed up on as various post-exploitation </span><a id="_idIndexMarker1058"/><span class="koboSpan" id="kobo.391.1">tools</span><a id="_idIndexMarker1059"/><span class="koboSpan" id="kobo.392.1"> such as </span><strong class="bold"><span class="koboSpan" id="kobo.393.1">PowerSploit</span></strong><span class="koboSpan" id="kobo.394.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.395.1">Cobalt Strike</span></strong><span class="koboSpan" id="kobo.396.1"> make extensive use of PowerShell. </span><span class="koboSpan" id="kobo.396.2">We will examine ransomware attacks in </span><span class="No-Break"><span class="koboSpan" id="kobo.397.1">later chapters.</span></span></p>
<p><span class="koboSpan" id="kobo.398.1">DeepBlueCLI is an excellent resource for conducting an initial pass on event logs. </span><span class="koboSpan" id="kobo.398.2">The two drawbacks are that analysts will still need to examine the initial log entries with additional tools and that DeepBlueCLI may miss actual malicious activity. </span><span class="koboSpan" id="kobo.398.3">It is advisable to start with this tool and then progress to more detailed examination methods and tools. </span><span class="koboSpan" id="kobo.398.4">In these instances, tools such as Event Log Explorer and Skadi are useful for gaining a</span><a id="_idIndexMarker1060"/><span class="koboSpan" id="kobo.399.1"> much more detailed analysis. </span></p>
<h2 id="_idParaDest-211"><a id="_idTextAnchor216"/><span class="koboSpan" id="kobo.400.1">Detailed Event Log analysis</span></h2>
<p><span class="koboSpan" id="kobo.401.1">As highlighted </span><a id="_idIndexMarker1061"/><span class="koboSpan" id="kobo.402.1">previously, the use of triage tools is a useful first step, but any incident investigation where event logs are available will require the use of specialized tools to dig deeper into the data that they provide. </span><span class="koboSpan" id="kobo.402.2">The Windows operating system has a native event log viewer. </span><span class="koboSpan" id="kobo.402.3">In the experience of many responders, that viewer is more suited to limited troubleshooting than to a deep analysis of the event logs. </span><span class="koboSpan" id="kobo.402.4">There are several tools, either open source or commercial, that can be leveraged for event log analysis. </span><span class="koboSpan" id="kobo.402.5">SIEM tools provide one of the best types of tools, especially if they can analyze offline event logs or those logs that have been acquired through scripts or other tools. </span><span class="koboSpan" id="kobo.402.6">In this chapter, two tools will be discussed: Event Log Explorer and Skadi. </span><span class="koboSpan" id="kobo.402.7">Each of these tools is useful for event log analysis but has unique features that make it suited for different aspects of event </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">log analysis.</span></span></p>
<p><span class="koboSpan" id="kobo.404.1">For example, Event Log Explorer allows better filtering of results, along with its string searching ability. </span><span class="koboSpan" id="kobo.404.2">Event Log Explorer can also combine multiple sources. </span><span class="koboSpan" id="kobo.404.3">Other tools, such as Skadi, allow the remote acquisition of log files and can combine log entries with other data, such as MFT entries and registry key settings. </span><span class="koboSpan" id="kobo.404.4">The one drawback with Skadi is the time necessary to ingest and process the data for review. </span><span class="koboSpan" id="kobo.404.5">Therefore, it is up to the responder to choose which tool best fits the incident </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">under investigation.</span></span></p>
<h3><span class="koboSpan" id="kobo.406.1">Event Log Explorer</span></h3>
<p><span class="koboSpan" id="kobo.407.1">Event Log</span><a id="_idIndexMarker1062"/><span class="koboSpan" id="kobo.408.1"> Explorer is an event log </span><a id="_idIndexMarker1063"/><span class="koboSpan" id="kobo.409.1">analysis tool that has more features and an easy-to-navigate GUI. </span><span class="koboSpan" id="kobo.409.2">Available as a commercial tool, the creators of Event Log Explorer, FSPro Labs, provide a 30-day trial period in which to test the tool. </span><span class="koboSpan" id="kobo.409.3">The tool can be downloaded from the website at </span><a href="https://eventlogxp.com/"><span class="koboSpan" id="kobo.410.1">https://eventlogxp.com/</span></a><span class="koboSpan" id="kobo.411.1"> and can be installed on the Windows </span><span class="No-Break"><span class="koboSpan" id="kobo.412.1">operating system.</span></span></p>
<p><span class="koboSpan" id="kobo.413.1">In this section, we will continue examining log files obtained from the storage we analyzed in the </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">previous chapter:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.415.1"> Open </span><strong class="bold"><span class="koboSpan" id="kobo.416.1">Event Log Explorer</span></strong><span class="koboSpan" id="kobo.417.1">; the following window </span><span class="No-Break"><span class="koboSpan" id="kobo.418.1">will appear:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer251">
<span class="koboSpan" id="kobo.419.1"><img alt="Figure 12.13 – Event Log Explorer GUI " src="image/Image_B18571_12_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.420.1">Figure 12.13 – Event Log Explorer GUI</span></p>
<p><span class="koboSpan" id="kobo.421.1">The GUI has </span><a id="_idIndexMarker1064"/><span class="koboSpan" id="kobo.422.1">three main </span><a id="_idIndexMarker1065"/><span class="koboSpan" id="kobo.423.1">areas. </span><span class="koboSpan" id="kobo.423.2">The center pane contains the individual log entries that are contained within the Windows event log type. </span><span class="koboSpan" id="kobo.423.3">The lower pane contains the details contained within each log entry. </span><span class="koboSpan" id="kobo.423.4">Finally, the left-hand pane includes the Windows event log types that are </span><span class="No-Break"><span class="koboSpan" id="kobo.424.1">under analysis.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.425.1">Event Log Explorer will automatically import the localhost’s Windows event logs. </span><span class="koboSpan" id="kobo.425.2">To remove these logs, right-click on the computer’s name and click </span><strong class="bold"><span class="koboSpan" id="kobo.426.1">Remove Computer</span></strong><span class="koboSpan" id="kobo.427.1">. </span><span class="koboSpan" id="kobo.427.2">Click </span><strong class="bold"><span class="koboSpan" id="kobo.428.1">YES</span></strong><span class="koboSpan" id="kobo.429.1">. </span><span class="koboSpan" id="kobo.429.2">This will remove the existing Windows </span><span class="No-Break"><span class="koboSpan" id="kobo.430.1">event logs.</span></span></li>
<li><span class="koboSpan" id="kobo.431.1">To import an event log file or files, click on </span><strong class="bold"><span class="koboSpan" id="kobo.432.1">File</span></strong><span class="koboSpan" id="kobo.433.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.434.1">Open Log File</span></strong><span class="koboSpan" id="kobo.435.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.436.1">Standard</span></strong><span class="koboSpan" id="kobo.437.1">. </span><span class="koboSpan" id="kobo.437.2">Navigate to the appropriate folder where the event logs have been extracted. </span><span class="koboSpan" id="kobo.437.3">From here, load the log file from a directory. </span><span class="koboSpan" id="kobo.437.4">In this case, we will examine the Windows Security Event Logs. </span><span class="koboSpan" id="kobo.437.5">Select and click </span><strong class="bold"><span class="koboSpan" id="kobo.438.1">Open</span></strong><span class="koboSpan" id="kobo.439.1">, as </span><span class="No-Break"><span class="koboSpan" id="kobo.440.1">shown here:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer252">
<span class="koboSpan" id="kobo.441.1"><img alt="Figure 12.14 – Opening Windows event logs " src="image/Image_B18571_12_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.442.1">Figure 12.14 – Opening Windows event logs</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.443.1">This will load all the log entries for that log file. </span><span class="koboSpan" id="kobo.443.2">In this example, we are going to examine the </span><strong class="bold"><span class="koboSpan" id="kobo.444.1">New User Added</span></strong><span class="koboSpan" id="kobo.445.1"> entry that was identified in the DeepBlueCLI triage. </span><span class="koboSpan" id="kobo.445.2">That output identified not only the Event ID but also the account, two pieces </span><a id="_idIndexMarker1066"/><span class="koboSpan" id="kobo.446.1">of </span><a id="_idIndexMarker1067"/><span class="koboSpan" id="kobo.447.1">data we can filter on. </span><span class="koboSpan" id="kobo.447.2">To open the filter, look for the funnel icon on </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">the taskbar:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer253">
<span class="koboSpan" id="kobo.449.1"><img alt="Figure 12.15 – Event Log Explorer – creating a filter " src="image/Image_B18571_12_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.450.1">Figure 12.15 – Event Log Explorer – creating a filter</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.451.1">The filter screen will then. </span><span class="koboSpan" id="kobo.451.2">From here, we can filter the event logs on a variety of specific attributes. </span><span class="koboSpan" id="kobo.451.3">This includes the event types, event IDs, and even keyword searching in the text of the log file entry. </span><span class="koboSpan" id="kobo.451.4">In this case, we will examine the log entries for </span><strong class="bold"><span class="koboSpan" id="kobo.452.1">New User Created</span></strong><span class="koboSpan" id="kobo.453.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.454.1">event ID 4720</span></strong><span class="koboSpan" id="kobo.455.1">, which included a username of </span><strong class="source-inline"><span class="koboSpan" id="kobo.456.1">minecraftsteve</span></strong><span class="koboSpan" id="kobo.457.1">. </span><span class="koboSpan" id="kobo.457.2">This was identified with the DeepBlueCLI triage script. </span><span class="koboSpan" id="kobo.457.3">Enter the event ID as </span><strong class="source-inline"><span class="koboSpan" id="kobo.458.1">4720</span></strong><span class="koboSpan" id="kobo.459.1"> and, in the </span><strong class="bold"><span class="koboSpan" id="kobo.460.1">Text in description</span></strong><span class="koboSpan" id="kobo.461.1"> field, the plaintext of the account name, </span><strong class="source-inline"><span class="koboSpan" id="kobo.462.1">minecraftsteve</span></strong><span class="koboSpan" id="kobo.463.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.464.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer254">
<span class="koboSpan" id="kobo.465.1"><img alt="Figure 12.16 – Event Log Explorer filter parameters " src="image/Image_B18571_12_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.466.1">Figure 12.16 – Event Log Explorer filter parameters</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.467.1">The </span><a id="_idIndexMarker1068"/><span class="koboSpan" id="kobo.468.1">output, after </span><a id="_idIndexMarker1069"/><span class="koboSpan" id="kobo.469.1">clicking </span><strong class="bold"><span class="koboSpan" id="kobo.470.1">OK</span></strong><span class="koboSpan" id="kobo.471.1">, shows the event log entries that match the filters that were entered. </span><span class="koboSpan" id="kobo.471.2">The details of the event log entries include additional details about the </span><span class="No-Break"><span class="koboSpan" id="kobo.472.1">account creation:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer255">
<span class="koboSpan" id="kobo.473.1"><img alt="Figure 12.17 – Event log details " src="image/Image_B18571_12_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.474.1">Figure 12.17 – Event log details</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.475.1">Again, returning </span><a id="_idIndexMarker1070"/><span class="koboSpan" id="kobo.476.1">to the </span><a id="_idIndexMarker1071"/><span class="koboSpan" id="kobo.477.1">results of the DeepBlueCLI script, there was an additional entry with Event ID 4732 that indicated elevated privileges for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.478.1">minecraftsteve</span></strong><span class="koboSpan" id="kobo.479.1"> account. </span><span class="koboSpan" id="kobo.479.2">By going back to the filter and replacing the event ID of 4720 with 4732 and removing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.480.1">minecraftsteve</span></strong><span class="koboSpan" id="kobo.481.1"> account, we can see that the account SID was not only moved into the administrator’s group but also moved into the </span><strong class="bold"><span class="koboSpan" id="kobo.482.1">Remote Management </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.483.1">Users</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.484.1"> group:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer256">
<span class="koboSpan" id="kobo.485.1"><img alt="Figure 12.18 – Event log entry description " src="image/Image_B18571_12_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.486.1">Figure 12.18 – Event log entry description</span></p>
<p><span class="koboSpan" id="kobo.487.1">In this short</span><a id="_idIndexMarker1072"/><span class="koboSpan" id="kobo.488.1"> example, we were able to </span><a id="_idIndexMarker1073"/><span class="koboSpan" id="kobo.489.1">correlate the creation of a new user account and the elevation of its privileges to both the administrator’s group and the remote management users. </span><span class="koboSpan" id="kobo.489.2">While this may not be malicious, if there is no ability to tie this new account to a legitimate user, it may be indicative of an adversary creating an account and adding it to the </span><span class="No-Break"><span class="koboSpan" id="kobo.490.1">administrator’s group.</span></span></p>
<p><span class="koboSpan" id="kobo.491.1">One Windows Event Log that may be available to analysts is the Windows Defender Operational Event Log. </span><span class="koboSpan" id="kobo.491.2">These entries contain information concerning Windows Defender malware prevention and can provide additional information concerning updates and detections. </span><span class="koboSpan" id="kobo.491.3">Opening the file shows that there are </span><span class="No-Break"><span class="koboSpan" id="kobo.492.1">several warnings:</span></span></p>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"> </p>
<div>
<div class="IMG---Figure" id="_idContainer257">
<span class="koboSpan" id="kobo.493.1"><img alt="Figure 12.19 – Windows Defender entries " src="image/Image_B18571_12_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.494.1">Figure 12.19 – Windows Defender entries</span></p>
<p><span class="koboSpan" id="kobo.495.1">A review of </span><a id="_idIndexMarker1074"/><span class="koboSpan" id="kobo.496.1">one of the warnings</span><a id="_idIndexMarker1075"/><span class="koboSpan" id="kobo.497.1"> indicates that Defender has detected the use of Meterpreter, a well-known </span><span class="No-Break"><span class="koboSpan" id="kobo.498.1">post-exploitation tool:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer258">
<span class="koboSpan" id="kobo.499.1"><img alt="Figure 12.20 – Windows Defender Meterpreter detection " src="image/Image_B18571_12_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.500.1">Figure 12.20 – Windows Defender Meterpreter detection</span></p>
<p><span class="koboSpan" id="kobo.501.1">Event Log Explorer has a great deal of functionality that cannot be addressed in this volume. </span><span class="koboSpan" id="kobo.501.2">Some of its other features include building custom views, filtering on specific data points, and finding text within log entries across multiple event log files. </span><span class="koboSpan" id="kobo.501.3">Even with these features, Event Log Explorer does have some minor limitations. </span><span class="koboSpan" id="kobo.501.4">First, responders have to gather the logs onto the system for analysis and load them manually. </span><span class="koboSpan" id="kobo.501.5">The second is that, depending on the file size, Event Log Explorer may have performance issues, including </span><a id="_idIndexMarker1076"/><span class="koboSpan" id="kobo.502.1">freezing. </span><span class="koboSpan" id="kobo.502.2">Responders </span><a id="_idIndexMarker1077"/><span class="koboSpan" id="kobo.503.1">should ensure they do not overload the application. </span><span class="koboSpan" id="kobo.503.2">Regardless, Event Log Explorer is an excellent tool for responders to include in </span><span class="No-Break"><span class="koboSpan" id="kobo.504.1">their toolkits.</span></span></p>
<h3><span class="koboSpan" id="kobo.505.1">Skadi and Kabana</span></h3>
<p><span class="koboSpan" id="kobo.506.1">Incidents </span><a id="_idIndexMarker1078"/><span class="koboSpan" id="kobo.507.1">often </span><a id="_idIndexMarker1079"/><span class="koboSpan" id="kobo.508.1">involve multiple </span><a id="_idIndexMarker1080"/><span class="koboSpan" id="kobo.509.1">systems </span><a id="_idIndexMarker1081"/><span class="koboSpan" id="kobo.510.1">across an enterprise network. </span><span class="koboSpan" id="kobo.510.2">Correlating this activity is often very difficult without analyzing the event logs from multiple systems. </span><span class="koboSpan" id="kobo.510.3">This is where the previously discussed SIEM appliances are helpful. </span><span class="koboSpan" id="kobo.510.4">Another option, if SIEM is not preconfigured to ingest and analyze event logs, is the Skadi platform. </span><span class="koboSpan" id="kobo.510.5">This open-source platform, available from GitHub at </span><a href="https://github.com/orlikoski/Skadi"><span class="koboSpan" id="kobo.511.1">https://github.com/orlikoski/Skadi</span></a><span class="koboSpan" id="kobo.512.1">, is a group of applications and forensics installed on an Ubuntu 16.04 LTS server </span><span class="No-Break"><span class="koboSpan" id="kobo.513.1">base image.</span></span></p>
<p><span class="koboSpan" id="kobo.514.1">The primary tool that this chapter will focus on is the Elastic Stack, which is included as part of the Skadi platform. </span><span class="koboSpan" id="kobo.514.2">The other major feature that Skadi offers is the ability to ingest logs and other forensic data that is acquired through </span><strong class="source-inline"><span class="koboSpan" id="kobo.515.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.516.1">. </span><span class="koboSpan" id="kobo.516.2">As previously discussed, </span><strong class="source-inline"><span class="koboSpan" id="kobo.517.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.518.1"> can be configured to send its output via SFTP to a remote system. </span><span class="koboSpan" id="kobo.518.2">Skadi combines an additional tool with </span><strong class="source-inline"><span class="koboSpan" id="kobo.519.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.520.1">, to produce a dataset that is ingestible by the Elastic Stack on Skadi. </span><span class="koboSpan" id="kobo.520.2">This feature allows responders to run </span><strong class="source-inline"><span class="koboSpan" id="kobo.521.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.522.1"> on several different systems and have it sent directly to Skadi, where it can then be processed, indexed, searched, </span><span class="No-Break"><span class="koboSpan" id="kobo.523.1">and correlated.</span></span></p>
<p><span class="koboSpan" id="kobo.524.1">After </span><strong class="source-inline"><span class="koboSpan" id="kobo.525.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.526.1"> has finished, the responder will log into the Skadi console. </span><span class="koboSpan" id="kobo.526.2">From here, the </span><strong class="bold"><span class="koboSpan" id="kobo.527.1">Cold Disk Quick Response</span></strong><span class="koboSpan" id="kobo.528.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.529.1">CDQR</span></strong><span class="koboSpan" id="kobo.530.1">) tool </span><a id="_idIndexMarker1082"/><span class="koboSpan" id="kobo.531.1">will be run to convert the data that’s been acquired into a format that can be ingested by the Elasticsearch tool. </span><span class="koboSpan" id="kobo.531.2">The following command starts the processing </span><span class="No-Break"><span class="koboSpan" id="kobo.532.1">with CDQR:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.533.1">
skadi@skadi:~$ cdqr in:DESKTOP-SKPTDIO.zip out:Results -p win --max_cpu -z --es_kb DESKTOP-SKPTDIO</span></pre>
<p><span class="koboSpan" id="kobo.534.1">CDQR takes the input, </span><strong class="source-inline"><span class="koboSpan" id="kobo.535.1">jsmith-pc.zip</span></strong><span class="koboSpan" id="kobo.536.1">, from </span><strong class="source-inline"><span class="koboSpan" id="kobo.537.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.538.1"> and outputs it to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.539.1">Results</span></strong><span class="koboSpan" id="kobo.540.1"> folder. </span><span class="koboSpan" id="kobo.540.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.541.1">-p</span></strong><span class="koboSpan" id="kobo.542.1"> argument selects the parser. </span><span class="koboSpan" id="kobo.542.2">In this case, since </span><strong class="source-inline"><span class="koboSpan" id="kobo.543.1">DESKTOP-SKPTDIO</span></strong><span class="koboSpan" id="kobo.544.1"> is a Microsoft Windows system, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.545.1">win</span></strong><span class="koboSpan" id="kobo.546.1"> parser is selected. </span><span class="koboSpan" id="kobo.546.2">Next is </span><strong class="source-inline"><span class="koboSpan" id="kobo.547.1">--max_cpu</span></strong><span class="koboSpan" id="kobo.548.1">. </span><span class="koboSpan" id="kobo.548.2">This argument allows analysts to throttle the CPU usage of the Skadi machine. </span><span class="koboSpan" id="kobo.548.3">If multiple </span><strong class="source-inline"><span class="koboSpan" id="kobo.549.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.550.1"> outputs are being processed, the analyst should omit this argument. </span><span class="koboSpan" id="kobo.550.2">The next argument, </span><strong class="source-inline"><span class="koboSpan" id="kobo.551.1">-z</span></strong><span class="koboSpan" id="kobo.552.1">, indicates that the file is a ZIP file. </span><span class="koboSpan" id="kobo.552.2">Finally, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.553.1">--ex_kb</span></strong><span class="koboSpan" id="kobo.554.1"> argument tells CDQR to output the results into Kibana with an index name of </span><strong class="source-inline"><span class="koboSpan" id="kobo.555.1">DESKTOP-SKPTDIO</span></strong><span class="koboSpan" id="kobo.556.1">. </span><span class="koboSpan" id="kobo.556.2">This indexing allows analysts to differentiate between systems within the </span><span class="No-Break"><span class="koboSpan" id="kobo.557.1">Kabana application:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer259">
<span class="koboSpan" id="kobo.558.1"><img alt="Figure 12.21 – CDQR execution " src="image/Image_B18571_12_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.559.1">Figure 12.21 – CDQR execution</span></p>
<p><span class="koboSpan" id="kobo.560.1">After this process has finished, the results can be viewed in the Kibana GUI, </span><span class="No-Break"><span class="koboSpan" id="kobo.561.1">as follows:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.562.1">Navigate </span><a id="_idIndexMarker1083"/><span class="koboSpan" id="kobo.563.1">to </span><a id="_idIndexMarker1084"/><span class="koboSpan" id="kobo.564.1">the</span><a id="_idIndexMarker1085"/><span class="koboSpan" id="kobo.565.1"> IP address of the Skadi server </span><a id="_idIndexMarker1086"/><span class="koboSpan" id="kobo.566.1">and enter the username and password. </span><span class="koboSpan" id="kobo.566.2">The default is </span><strong class="source-inline"><span class="koboSpan" id="kobo.567.1">skadi:skadi</span></strong><span class="koboSpan" id="kobo.568.1">. </span><span class="koboSpan" id="kobo.568.2">This opens the portal shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.569.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer260">
<span class="koboSpan" id="kobo.570.1"><img alt="Figure 12.22 – Skadi portal " src="image/Image_B18571_12_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.571.1">Figure 12.22 – Skadi portal</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.572.1">Click </span><a id="_idIndexMarker1087"/><span class="koboSpan" id="kobo.573.1">on </span><strong class="bold"><span class="koboSpan" id="kobo.574.1">Kibana</span></strong><span class="koboSpan" id="kobo.575.1">; the</span><a id="_idIndexMarker1088"/><span class="koboSpan" id="kobo.576.1"> following</span><a id="_idIndexMarker1089"/><span class="koboSpan" id="kobo.577.1"> screen</span><a id="_idIndexMarker1090"/> <span class="No-Break"><span class="koboSpan" id="kobo.578.1">will appear:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer261">
<span class="koboSpan" id="kobo.579.1"><img alt="Figure 12.23 – Kibana GUI " src="image/Image_B18571_12_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.580.1">Figure 12.23 – Kibana GUI</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.581.1">From here, click </span><strong class="bold"><span class="koboSpan" id="kobo.582.1">Discover</span></strong><span class="koboSpan" id="kobo.583.1">. </span><span class="koboSpan" id="kobo.583.2">In the top right-hand corner, set the date to an appropriate time range. </span><span class="koboSpan" id="kobo.583.3">Kibana defaults to the last 15 minutes of data. </span><span class="koboSpan" id="kobo.583.4">For offline data, set the time range that is applicable or simply click </span><strong class="bold"><span class="koboSpan" id="kobo.584.1">Last 2 years</span></strong><span class="koboSpan" id="kobo.585.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.586.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer262">
<span class="koboSpan" id="kobo.587.1"><img alt="Figure 12.24 – Kibana’s Discover dashboard " src="image/Image_B18571_12_24.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.588.1">Figure 12.24 – Kibana’s Discover dashboard</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.589.1">Kibana</span><a id="_idIndexMarker1091"/><span class="koboSpan" id="kobo.590.1"> is</span><a id="_idIndexMarker1092"/><span class="koboSpan" id="kobo.591.1"> feature-rich</span><a id="_idIndexMarker1093"/><span class="koboSpan" id="kobo.592.1"> and provides a wide </span><a id="_idIndexMarker1094"/><span class="koboSpan" id="kobo.593.1">range of options in terms of analyzing data. </span><span class="koboSpan" id="kobo.593.2">This includes the use of customer queries, event IDs, keywords, and XML strings. </span><span class="koboSpan" id="kobo.593.3">In this case, the responder will focus on event ID 4104, which indicates that a PowerShell command was run remotely. </span><span class="koboSpan" id="kobo.593.4">Then, look at adding an XML filter on the IP address associated with the DeepBlueCLI output. </span><span class="koboSpan" id="kobo.593.5">In this case, select </span><strong class="bold"><span class="koboSpan" id="kobo.594.1">Add a Filter</span></strong><span class="koboSpan" id="kobo.595.1">. </span><span class="koboSpan" id="kobo.595.2">Then, in the </span><strong class="bold"><span class="koboSpan" id="kobo.596.1">Filter</span></strong><span class="koboSpan" id="kobo.597.1"> field scroll, to </span><strong class="bold"><span class="koboSpan" id="kobo.598.1">event_identifier</span></strong><span class="koboSpan" id="kobo.599.1">. </span><span class="koboSpan" id="kobo.599.2">Input </span><strong class="source-inline"><span class="koboSpan" id="kobo.600.1">4104</span></strong><span class="koboSpan" id="kobo.601.1"> and click </span><strong class="bold"><span class="koboSpan" id="kobo.602.1">Save</span></strong><span class="koboSpan" id="kobo.603.1">. </span><span class="koboSpan" id="kobo.603.2">This will run </span><span class="No-Break"><span class="koboSpan" id="kobo.604.1">the command:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer263">
<span class="koboSpan" id="kobo.605.1"><img alt="Figure 12.25 – Filter on Event ID " src="image/Image_B18571_12_25.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.606.1">Figure 12.25 – Filter on Event ID</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.607.1">This produces</span><a id="_idIndexMarker1095"/><span class="koboSpan" id="kobo.608.1"> a </span><a id="_idIndexMarker1096"/><span class="koboSpan" id="kobo.609.1">total </span><a id="_idIndexMarker1097"/><span class="koboSpan" id="kobo.610.1">of 176 total </span><a id="_idIndexMarker1098"/><span class="koboSpan" id="kobo.611.1">entries with that event identification. </span><span class="koboSpan" id="kobo.611.2">To reduce this further, let’s go ahead and add the second filter for the XML </span><span class="No-Break"><span class="koboSpan" id="kobo.612.1">data, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.613.1">192.168.191.253</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.614.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer264">
<span class="koboSpan" id="kobo.615.1"><img alt="Figure 12.26 – Filter on IP address " src="image/Image_B18571_12_26.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.616.1">Figure 12.26 – Filter on IP address</span></p>
<p><span class="koboSpan" id="kobo.617.1">This produces two results. </span><span class="koboSpan" id="kobo.617.2">An analysis of the results confirms the results</span><a id="_idIndexMarker1099"/><span class="koboSpan" id="kobo.618.1"> that were</span><a id="_idIndexMarker1100"/><span class="koboSpan" id="kobo.619.1"> shown</span><a id="_idIndexMarker1101"/><span class="koboSpan" id="kobo.620.1"> in </span><a id="_idIndexMarker1102"/><span class="koboSpan" id="kobo.621.1">DeepBlueCLI. </span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.622.1">What can be helpful is to see if there are additional results with that IP address. </span><span class="koboSpan" id="kobo.622.2">In the </span><strong class="bold"><span class="koboSpan" id="kobo.623.1">event_identifier: “4104”</span></strong><span class="koboSpan" id="kobo.624.1"> field, click on the trash can, which will remove that filter. </span><span class="koboSpan" id="kobo.624.2">The result is that there are 134 event entries with an IP address of </span><strong class="source-inline"><span class="koboSpan" id="kobo.625.1">192.168.191.253</span></strong><span class="koboSpan" id="kobo.626.1">. </span><span class="koboSpan" id="kobo.626.2">By drilling into an entry with Event ID 600, an additional PowerShell entry shows that a version of PowerCat, a PowerShell script that has the functionality of the popular hacking tool Netcat, </span><span class="No-Break"><span class="koboSpan" id="kobo.627.1">was run:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer265">
<span class="koboSpan" id="kobo.628.1"><img alt="Figure 12.27 – Meterpreter event entry " src="image/Image_B18571_12_27.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.629.1">Figure 12.27 – Meterpreter event entry</span></p>
<p><span class="koboSpan" id="kobo.630.1">Skadi, combined with </span><strong class="source-inline"><span class="koboSpan" id="kobo.631.1">CyLR.exe</span></strong><span class="koboSpan" id="kobo.632.1">, provides the responder with the ability to acquire and analyze log files from several systems involved in the incident. </span><span class="koboSpan" id="kobo.632.2">The ability to pivot off specific Event IDs or keywords makes Skadi a powerful tool to zero in on specific log entries that are important in identifying additional evidence in an incident investigation. </span><span class="koboSpan" id="kobo.632.3">By analyzing </span><a id="_idIndexMarker1103"/><span class="koboSpan" id="kobo.633.1">these </span><a id="_idIndexMarker1104"/><span class="koboSpan" id="kobo.634.1">events, we</span><a id="_idIndexMarker1105"/><span class="koboSpan" id="kobo.635.1"> can</span><a id="_idIndexMarker1106"/><span class="koboSpan" id="kobo.636.1"> see that an adversary was able to remotely execute PowerShell and install a remote network service. </span></p>
<h1 id="_idParaDest-212"><a id="_idTextAnchor217"/><span class="koboSpan" id="kobo.637.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.638.1">At the heart of log analysis is the assumption that actions by an adversary will leave a trace. </span><span class="koboSpan" id="kobo.638.2">Just as in the physical world, responders’ ability to see these traces is based upon the tools and techniques that are used. </span><span class="koboSpan" id="kobo.638.3">This chapter explored the foundational elements of logs and log management, as well as tools such as SIEM to aggregate and review these logs, and, finally, looked at the tools and techniques to examine the most prevalent logs that originate from the Windows OS. </span><span class="koboSpan" id="kobo.638.4">This chapter has only scratched the surface concerning how logs play an integral part in an </span><span class="No-Break"><span class="koboSpan" id="kobo.639.1">incident investigation.</span></span></p>
<p><span class="koboSpan" id="kobo.640.1">In keeping with the theme of understanding the traces of an adversary attack, the next chapter will examine the role that malware analysis plays in </span><span class="No-Break"><span class="koboSpan" id="kobo.641.1">incident response.</span></span></p>
<h1 id="_idParaDest-213"><a id="_idTextAnchor218"/><span class="koboSpan" id="kobo.642.1">Questions</span></h1>
<p><span class="koboSpan" id="kobo.643.1">Answer the following questions to test your knowledge of </span><span class="No-Break"><span class="koboSpan" id="kobo.644.1">this chapter:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.645.1">For effective log management, an organization should establish logging as a normal </span><span class="No-Break"><span class="koboSpan" id="kobo.646.1">business practice.</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.647.1">True</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.648.1">False</span></span></li></ol></li>
<li><span class="koboSpan" id="kobo.649.1">Which is not one of the functions of </span><span class="No-Break"><span class="koboSpan" id="kobo.650.1">a SIEM?</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.651.1">Log retention</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.652.1">Automated response</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.653.1">Alerting</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.654.1">Log aggregation</span></span></li></ol></li>
<li><span class="koboSpan" id="kobo.655.1">Which of these is not part of the </span><span class="No-Break"><span class="koboSpan" id="kobo.656.1">Elastic Stack?</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.657.1">Kibana</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.658.1">Elasticsearch</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.659.1">Log response</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.660.1">Logstash</span></span></li></ol></li>
<li><span class="koboSpan" id="kobo.661.1">Locard’s exchange principle states that when two objects come into contact with each other, they </span><span class="No-Break"><span class="koboSpan" id="kobo.662.1">leave traces.</span></span><ol><li><span class="No-Break"><span class="koboSpan" id="kobo.663.1">True</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.664.1">False</span></span></li></ol></li>
</ol>
<h1 id="_idParaDest-214"><a id="_idTextAnchor219"/><span class="koboSpan" id="kobo.665.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.666.1">For more information about the topics that were covered in this chapter, refer to the </span><span class="No-Break"><span class="koboSpan" id="kobo.667.1">following resources:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.668.1">Windows Security Log </span><span class="No-Break"><span class="koboSpan" id="kobo.669.1">Events: </span></span><a href="https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/"><span class="No-Break"><span class="koboSpan" id="kobo.670.1">https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/</span></span></a></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.671.1">Graylog: </span></span><a href="https://github.com/Graylog2"><span class="No-Break"><span class="koboSpan" id="kobo.672.1">https://github.com/Graylog2</span></span></a></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.673.1">Skadi: </span></span><a href="https://github.com/orlikoski/Skadi"><span class="No-Break"><span class="koboSpan" id="kobo.674.1">https://github.com/orlikoski/Skadi</span></span></a></li>
<li><span class="koboSpan" id="kobo.675.1">Applied Incident Response Windows Event Log </span><span class="No-Break"><span class="koboSpan" id="kobo.676.1">Analysis: </span></span><a href="https://forwarddefense.com/media/attachments/2021/05/15/windows-event-log-analyst-reference.pdf"><span class="No-Break"><span class="koboSpan" id="kobo.677.1">https://forwarddefense.com/media/attachments/2021/05/15/windows-event-log-analyst-reference.pdf</span></span></a></li>
</ul>
</div>
</body></html>