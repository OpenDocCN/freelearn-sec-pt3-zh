<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Android Forensic Setup and Pre-Data Extraction Techniques</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we covered the fundamentals of the Android architecture, security features, filesystems, and other capabilities. Having an established forensic environment before the start of an examination is important, as it ensures that the data is protected while you, as the examiner, maintain control of the workstation. This chapter will explain the process of—and what to consider when—setting up a digital forensic examination environment. It is paramount that you maintain control of the forensic environment at all times; this prevents the introduction of contaminants that could affect the forensic investigation.</p>
<p>We will cover the following topics in this chapter:</p>
<ul>
<li>Setting up a forensic environment for Android</li>
<li>Connecting an Android device to a workstation</li>
<li>Screen lock bypassing techniques</li>
<li>Gaining root access</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up a forensic environment for Android</h1>
                </header>
            
            <article>
                
<p>As a forensic examiner, you may encounter a wide range of mobiles over the course of your investigation. Therefore, it is necessary to have a basic environment set up on top of which you can build based on requirements. It is also very important that you maintain complete control over the environment at all times to avoid any unexpected situations. Setting up a proper lab environment is an essential part of the forensic process. The Android forensic setup usually involves the following steps:</p>
<ol>
<li>Start with a fresh or forensically sterile computer environment. This means that other data is either not present on the system or is contained in a manner that prevents it from contaminating the present investigation.</li>
<li>Install the basic software necessary to connect to the device. Android forensic tools and methodologies will work on the Windows, Linux, and macOS platforms.</li>
<li>Obtain access to the device. You must be able to enable settings or bypass them in order to allow the data to be extracted from the Android device.</li>
<li>Issue commands to the device using the methods defined in this chapter and in <a href="bf232566-3a17-4914-992b-80674dd379de.xhtml">Chapter 9</a>, <em>Android Data Extraction Techniques</em>.</li>
</ol>
<p>The following sections provide guidance on setting up a basic Android forensic workstation.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing the software</h1>
                </header>
            
            <article>
                
<p>The Android <strong>Software Development Kit</strong> (<strong>SDK</strong>) helps the development world to build, test, and debug applications to run on Android. The Android SDK comes with Android Studio, the official <strong>integrated development environment</strong> (<strong>IDE</strong>) for developing Android apps. Android Studio provides valuable documentation and other tools that can be of great help during the investigation of an Android device. Alternatively, you can download just the platform tools, which are components of the Android SDK and include tools that can interact with the Android platform, such as the ADB, fast boot, and so on; these will be described in more detail in the following sections.</p>
<p>A good understanding of the Android SDK will help you to get to grips with the particulars of a device and its data on the device.</p>
<div class="packt_infobox">Android Studio consists of software libraries, APIs, tools, emulators, and other reference material. It can be downloaded for free from <a href="https://developer.android.com/studio/index.html"><span class="URLPACKT">https://developer.android.com/studio/index.html</span></a>. The platform tools can be downloaded from <a href="https://developer.android.com/studio/releases/platform-tools">https://developer.android.com/studio/releases/platform-tools</a>.</div>
<p>During a forensic investigation, having these tools helps you connect to and access data on Android devices. The Android SDK is updated very frequently, so it's important to verify that your workstation also remains up to date. The Android SDK can run on Windows, Linux, and macOS. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing the Android platform tools</h1>
                </header>
            
            <article>
                
<p>A working installation of the Android SDK or Android platform tools is a must during the investigation of a forensic device. <span>The Windows version of Android Studio is around 718 MB, and rather heavy compared to the software for the platform tools, which is just 20 MB. </span></p>
<p>The following is the step-by-step procedure to install the Android platform tools on a Windows 10 machine:</p>
<ol>
<li>Before you install Android Studio or the platform tools, make sure that your system has <strong>Java Development Kit</strong> (<span>JDK</span>) installed, because the Android SDK relies on Java SE Development Kit.</li>
</ol>
<div class="packt_infobox">JDK can be downloaded from <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html"><span class="URLPACKT">http://www.oracle.com/technetwork/java/javase/downloads/index.html</span></a>.</div>
<ol start="2">
<li>Download the latest version of the platform tools from <a href="https://developer.android.com/studio/releases/platform-tools">https://developer.android.com/studio/releases/platform-tools</a>. </li>
</ol>
<ol start="3">
<li>Right-click and extract the ZIP files to a folder. <span>The installation location is your choice and must be remembered for future access. In this example, we will extract it to the</span> <kbd>C:\ folder</kbd>.</li>
<li><span>Open the directory (</span><kbd>C:\platform-tools</kbd><span>) and note that the following tools are listed:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/54c05c40-3681-41ec-a4a0-e1cccabeda46.png" style="width:48.75em;height:36.42em;"/></p>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Android platform tools</div>
<p>This completes the basic Android tool installation. If you're installing the full-blown Android Studio version, you should still see the platform tools folder under the newly installed Android directory. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating an Android virtual device</h1>
                </header>
            
            <article>
                
<p>With Android Studio you can create an <strong>Android virtual device</strong> (<strong>AVD</strong>), also called an emulator, which is often used by developers when creating new applications; however, an emulator has significance from a forensic perspective, too. Emulators are useful when trying to understand how applications behave and execute on a device. This could be helpful in confirming certain findings that are unearthed during a forensic investigation.</p>
<p>Also, while working on a device that is running on an older platform, you can design an emulator for the same platform. Furthermore, before installing a forensic tool on a real device, the emulator can be used to find out how a forensic tool works and changes the content on an Android device. To create a new AVD (on the Windows workstation), go through the following steps:</p>
<ol>
<li>Open Android Studio and navigate to <span class="packt_screen">Tools</span> | <span class="packt_screen">AVD Manager</span>. The <span class="packt_screen">Android Virtual Device Manager</span> <span>window is shown in the following screenshot:</span></li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/4257f6b5-0d95-4100-aed7-5d37f6e47317.png" style="width:53.83em;height:19.92em;"/></div>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Android Virtual Device Manager</div>
<ol start="2">
<li>Click on <span class="packt_screen">Create Virtual Device</span> to create a new virtual device. In the screens that follow, select the appropriate hardware, system image, API level, AVD name, and so on, and proceed further. For example, the following screenshot shows Android Pie being selected:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1237 image-border" src="assets/a1949229-9e65-4b11-b025-4a31e41aafb9.png" style="width:44.67em;height:30.17em;"/></p>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Virtual device configuration</div>
<ol start="3">
<li>A confirmation message is shown once the device is successfully created. Now, select the AVD and click on the <span class="packt_screen">Play</span> button. </li>
<li>This should launch the emulator. Note that this could take a few minutes, or even longer, depending on the workstation's CPU and RAM. The emulator does consume a significant amount of resources on the system. After a successful launch, the AVD will run, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/fd474902-3666-403e-8416-48c3af41e24c.png" style="width:14.33em;height:26.92em;"/></p>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">The Android emulator </div>
<p>From a forensic perspective, analysts and security researchers can leverage the functionality of an emulator to understand the file system, data storage, and so on. The data created when working on an emulator is stored in your home directory in a folder named <kbd>android</kbd>. For instance, in our example, the details about the Pixel<span><span>_XL_API_28 </span></span>emulator that we created earlier are stored under <kbd>C:\Users\Rohit\.android\avd\Pixel_XL_API_28.avd</kbd>.</p>
<p>Among the various files present under this directory, the following are those that are of interest to a forensic analyst:</p>
<ul>
<li><kbd>cache.img</kbd>: This is the disk image of the <kbd>/cache</kbd> partition (remember that we discussed the <kbd>/cache</kbd> partition of an Android device in <a href="eb3f20e0-270d-4e7d-bb69-3bfd1e707f38.xhtml"><em>Chapter 7</em></a>, <em>Understanding Android</em>).</li>
<li><kbd>sdcard.img</kbd>: This is the disk image of the SD card partition.</li>
<li><kbd>Userdata-qemu.img</kbd>: This is the disk image of the <kbd>/data</kbd> partition. The <kbd>/data</kbd> partition contains valuable information about the device user.</li>
</ul>
<p>Now that we have understood the steps to set up the environment, let's connect the Android device to a forensic workstation.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Connecting an Android device to a workstation</h1>
                </header>
            
            <article>
                
<p>Forensic acquisition of an Android device using open source tools requires you to connect the device to a forensic workstation. Forensic acquisition of any device should be conducted on a forensically sterile workstation. This means that the workstation is strictly used for forensics and not for personal use.</p>
<div class="packt_infobox">Note that any time a device is plugged into a computer, changes can be made to the device; you must have full control of all interactions with the Android device at all times.</div>
<p>The following steps should be performed by you in order to <span>successfully</span><span> </span><span>connect the device to a workstation. Note that write protection may prevent the successful acquisition of the device, since commands may need to be pushed to the device in order to pull information. All the following steps should be validated on a test device prior to attempting them on real evidence.</span></p>
<p> </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Identifying the device cable</h1>
                </header>
            
            <article>
                
<p>The physical USB interface of an Android device allows it to connect to a computer to share data, such as songs, videos, and photos. This USB interface might change from manufacturer to manufacturer and also from device to device. For example, some devices use mini-USB while some others use micro-USB and USB Type C. Apart from this, some manufacturers use their own proprietary formats, such as EXT-USB, EXT micro-USB, and so on. The first step in acquiring an Android device is to determine what kind of device cable is required.</p>
<p>There are different types, such as mini-USB, micro-USB, and other proprietary formats. The following is a brief description of the most widely used connector types:</p>
<table style="border-collapse: collapse" border="1">
<tbody>
<tr>
<td style="width: 303px">
<p class="CDPAlignCenter CDPAlign"><strong>Connector type</strong></p>
</td>
<td style="width: 494px">
<p class="CDPAlignCenter CDPAlign"><strong>Description</strong></p>
</td>
</tr>
<tr>
<td style="width: 303px">
<p class="CDPAlignCenter CDPAlign">Mini - A USB</p>
</td>
<td style="width: 494px">
<p>It is approximately 7 x 3 mm in size, with two of the corners on one long side lifted out.</p>
</td>
</tr>
<tr>
<td style="width: 303px">
<p class="CDPAlignCenter CDPAlign">Micro - B USB</p>
</td>
<td style="width: 494px">
<p>It is approximately 6 x 1.5 mm in size, with two corners cut off to form a trapezoid.</p>
</td>
</tr>
<tr>
<td style="width: 303px">
<p class="CDPAlignCenter CDPAlign">Co-axial</p>
</td>
<td style="width: 494px">
<p>It has a circular hole with a pin sticking up in the middle. There are different sizes in this category, varying from 2 to 5 mm in diameter. Widely used with Nokia models.</p>
</td>
</tr>
<tr>
<td style="width: 303px">
<p class="CDPAlignCenter CDPAlign">D Sub-miniature</p>
</td>
<td style="width: 494px">
<p>It has the shape of a rectangle with two rounded corners. The length of the rectangle varies, but the height is always 1.5 to 2 mm. Used mostly by Samsung and LG devices.</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Next, let's have a quick look at how to install device drivers.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing device drivers</h1>
                </header>
            
            <article>
                
<p>In order to identify the device properly, the computer may need certain drivers to be installed. Without the necessary drivers, the computer may not identify and work with the connected device. The issue is that, since Android is allowed to be modified and customized by manufacturers, there is no single generic driver that works for all Android devices. Each manufacturer writes its own proprietary drivers and distributes them over the internet, so it's important to identify the specific device drivers that need to be installed. Of course, some Android forensic toolkits (which we will discuss in the following chapters) do come with some generic drivers or a set of the most widely used drivers; they may not work with all models of the Android phone.</p>
<p>Some Windows operating systems are able to autodetect and install drivers once the device is plugged in, but more often than not they fail. The device drivers for all manufacturers can be found on their respective websites.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Accessing the connected device</h1>
                </header>
            
            <article>
                
<p>If you haven't done so already, connect the unlocked Android device to the computer directly using the USB cable. The Android device will appear as a new drive and you will be able to access the files on the external storage. If the device is locked, then at this point, you will not be able to access any files and may need to use the <span class="packt_screen">Turn on USB storage</span> option, which can be enabled on the phone, as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/32c7722a-6859-4e09-8d09-922b25024de5.png" style="width:18.25em;height:28.00em;"/></div>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">USB mass storage in Android 4.1 version</div>
<p>With some Android phones (especially with HTC), the device may expose more than one functionality when connected with a USB cable. For instance, as shown in the following screenshot, when an HTC device is connected it presents a menu with four options. The default selection is <span class="packt_screen">Charge only</span>. When the <span class="packt_screen">Disk drive</span> option is selected, it is mounted as a disk drive:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/ec34f18c-7553-44e3-a6db-d8f1d6205684.png" style="width:18.17em;height:25.33em;"/></div>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">HTC mobile USB options</div>
<p>When the device is mounted as a disk drive, you will be able to access the SD card present on the device. From a forensic point of view, the SD card has significant value as it may contain files that are important to an investigation; however, the core application data stored under <kbd>/data/data</kbd> will remain on the device and cannot be accessed with these methods.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Android debug bridge</h1>
                </header>
            
            <article>
                
<p>Considered to be one of the most crucial components in Android forensics, the <strong>Android debug bridge</strong> (<strong>ADB</strong>) is a command-line tool that allows you to communicate with the Android device and control it. We will learn about the ADB in detail in upcoming chapters; for now, we will focus on a basic introduction to the ADB. You can access the ADB tool under <span><span><span><kbd>/platform-tools/</kbd></span></span></span>.</p>
<p>Before we discuss anything about the ADB, we need to have an understanding of the <strong>USB debugging</strong> option.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">USB debugging</h1>
                </header>
            
            <article>
                
<p>The primary function of this option is to enable communication between the Android device and the workstation on which the Android SDK is installed. On a Samsung phone, you can access this under <span class="packt_screen">Settings</span> | <span class="packt_screen">Developer Options</span>, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/73540294-59bb-4c6c-8649-a885589841b8.png" style="width:17.58em;height:27.17em;"/></p>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">The USB debugging option in a Samsung S8 device</div>
<p><span>Other </span>Android<span> phones may have different environments and configuration features. You may have to force the </span><span class="packt_screen">Developer Options</span><span> option by accessing build mode.</span></p>
<p>However, starting from Android 4.2, the <span class="packt_screen">Developer Options</span> menu is hidden to make sure that users do not enable it by accident. To enable it, go to <span class="packt_screen">Settings</span> | <span class="packt_screen">About Phone</span> and then tap the <span class="packt_screen">Build Number</span> field seven times. After this, <span class="packt_screen">Developer Options</span> will be available in the <span class="packt_screen">Settings</span> menu. Prior to Android 4.2.2, enabling this option was the only requirement for communicating with the device over ADB; however, starting from Android 4.2.2, Google has introduced the secure USB debugging option. This feature only allows hosts that are explicitly authorized by the user to connect to the device using ADB.</p>
<p>Thus, when you connect the device to a new workstation via USB in order to access ADB, you need to first unlock the device and authorize access by pressing <span class="packt_screen">OK</span> in the confirmation window, as shown in the following screenshot. If <span class="packt_screen">Always allow from this computer</span> is checked, the device will not prompt for authorization in the future:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/4df919bd-ed19-45c7-8caa-4800946a8835.png" style="width:16.25em;height:14.00em;"/></div>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Secure USB debugging</div>
<p>When the <span class="packt_screen">USB debugging</span> option is selected, the device will run the <strong>adb daemon</strong> (<kbd>adbd</kbd>) in the background and will continuously look for a USB connection. The daemon will usually run under a nonprivileged shell user account and thus will not provide access to the complete data; however, on rooted phones, <kbd>adbd</kbd> will run under the root account and therefore provide access to all the data. It is not recommended that you root a device to gain full access unless all other forensic methods fail. Should you elect to root an Android device, the methods must be well-documented and tested prior to attempting it on real evidence. Rooting will be discussed at the end of this chapter.</p>
<p>On the workstation where the Android SDK is installed, <kbd>adbd</kbd> will run as a background process. Also, on the same workstation, a client program, which can be invoked from a shell by issuing the <kbd>adb</kbd> command, will run. When the <kbd>adb</kbd> client is started, it first checks whether an <kbd>adb</kbd> daemon is already running. If the response is negative, it initiates a new process to start the <kbd>adb</kbd> daemon. The <kbd>adb</kbd> client program communicates with local <kbd>adbd</kbd> over port <kbd>5037</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Accessing the device using adb</h1>
                </header>
            
            <article>
                
<p>Once the environment setup is complete and the Android device is in USB debugging mode, connect the Android device to the forensic workstation with a USB cable and start using <kbd>adb</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Detecting connected devices</h1>
                </header>
            
            <article>
                
<p>The following <kbd>adb</kbd> command provides a list of all the devices connected to the forensic workstation. This will also list the emulator if it is running at the time of issuing the command. Also remember that, if the necessary drivers are not installed, then the following command will show a blank message. If you encounter this situation, download the necessary drivers from the manufacturer and install them:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/6b952415-ff44-418b-9067-88e9374f0c87.png" style="width:24.00em;height:4.25em;"/></div>
<p>We now have a list of devices connected to the workstation. Next, we will see how to kill the local ADB server.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Killing the local ADB server</h1>
                </header>
            
            <article>
                
<p>The following command kills the local <kbd>adb</kbd> service:</p>
<pre><strong>C:\android-sdk\platform-tools&gt;adb.exe kill-server</strong></pre>
<p>After killing the local <kbd>adb</kbd> service, issue the <kbd>adb</kbd> devices command. You will see that the server is started, as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/b2236193-c3b2-47d0-8782-3c6d0ff11c66.png" style="width:24.08em;height:5.17em;"/></div>
<p>We will now access the ADB shell on the Android device.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Accessing the adb shell</h1>
                </header>
            
            <article>
                
<p>The ADB shell command allows you to access the shell on an Android device and interact with the device.</p>
<p>The following is the command to access the <kbd>adb</kbd> shell and execute a basic <kbd>ls</kbd> command to see the contents of the current directory:</p>
<pre><strong>C:\android-sdk\platform-tools&gt;adb.exe shell shell@android:/ $ ls</strong>
<strong>ls acct cache</strong>
<strong>config d</strong>
<strong>data default.prop dev</strong>
<strong>efs etc</strong>
<strong>factory fstab.smdk4x12 init</strong>
<strong>init.bt.rc init.goldfish.rc init.rc init.smdk4x12.rc init.smdk4x12.usb.rc</strong>
<strong>....</strong>  </pre>
<p>The Android emulator can be used by you to execute and understand <kbd>adb</kbd> commands before using them on the device. In <a href="bf232566-3a17-4914-992b-80674dd379de.xhtml">Chapter 9</a>, <em>Android Data Extraction Techniques</em>, we will explain more about leveraging adb to install applications, copy files and folders from the device, view device logs, and so on.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Basic Linux commands</h1>
                </header>
            
            <article>
                
<p>We will now take a quick look at some commonly used Linux commands and their usage with respect to an Android device:</p>
<ul>
<li><kbd>ls</kbd>: The <kbd>ls</kbd> command (with no option) lists the files and directories present in the current directory. With the <kbd>-l</kbd> option, this command shows files and directories and also their size, modified date and time, the owner of the file and its permission, and so on, as shown in the following command-line output:</li>
</ul>
<pre style="padding-left: 60px"><strong>shell@android:/ $ ls -l</strong>
<strong>ls -l</strong>
<strong>drwxr-xr-x root     root             2015-01-17 10:13 acct</strong>
<strong>drwxrwx--- system   cache             2014-05-31 14:55 cache</strong>
<strong>dr-x------ root     root              2015-01-17 10:13 config</strong>
<strong>lrwxrwxrwx root     root              2015-01-17 10:13 d -&gt; /sys/kernel/debug</strong>
<strong>drwxrwx--x system   system            2015-01-17 10:13 data</strong>
<strong>-rw-r--r-- root     root          116 1970-01-01 05:30 default.prop</strong>
<strong>drwxr-xr-x root     root              2015-01-17 10:13 dev</strong>
<strong>drwxrwx--x radio    system            2013-08-13 09:34 efs</strong>
<strong>lrwxrwxrwx root     root              2015-01-17 10:13 etc -&gt; /system/etc</strong>
<strong>...</strong>  </pre>
<p>Similarly, the following are a few options that can be used along with the <kbd>ls</kbd> command:</p>
<table style="border-collapse: collapse" border="1">
<tbody>
<tr>
<td style="width: 36.33%">
<p class="CDPAlignCenter CDPAlign"><strong>Option</strong></p>
</td>
<td style="width: 62.931%">
<p class="CDPAlignCenter CDPAlign"><strong>Description</strong></p>
</td>
</tr>
<tr>
<td style="width: 36.33%">
<p class="CDPAlignCenter CDPAlign"><kbd>a</kbd></p>
</td>
<td style="width: 62.931%">
<p>Lists hidden files</p>
</td>
</tr>
<tr>
<td style="width: 36.33%">
<p class="CDPAlignCenter CDPAlign"><kbd>c</kbd></p>
</td>
<td style="width: 62.931%">
<p>Displays files by timestamp</p>
</td>
</tr>
<tr>
<td style="width: 36.33%">
<p class="CDPAlignCenter CDPAlign"><kbd>d</kbd></p>
</td>
<td style="width: 62.931%">
<p>Displays only directories</p>
</td>
</tr>
<tr>
<td style="width: 36.33%">
<p class="CDPAlignCenter CDPAlign"><kbd>n</kbd></p>
</td>
<td style="width: 62.931%">
<p>Displays the long-format listing, with GID and UID numbers.</p>
</td>
</tr>
<tr>
<td style="width: 36.33%">
<p class="CDPAlignCenter CDPAlign"><kbd>R</kbd></p>
</td>
<td style="width: 62.931%">
<p>Displays subdirectories as well</p>
</td>
</tr>
<tr>
<td style="width: 36.33%">
<p class="CDPAlignCenter CDPAlign"><kbd>t</kbd></p>
</td>
<td style="width: 62.931%">
<p>Displays files based on timestamp</p>
</td>
</tr>
<tr>
<td style="width: 36.33%">
<p class="CDPAlignCenter CDPAlign"><kbd>u</kbd></p>
</td>
<td style="width: 62.931%">
<p>Displays the file access time</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Depending on the requirements, one or more of the following options can be used by the investigator to view the details:</p>
<ul>
<li><kbd>cat</kbd>: The <kbd>cat</kbd> command reads one or more files and prints them to standard output, as shown in the following command lines:</li>
</ul>
<pre style="padding-left: 60px"><strong>shell@android:/ $ cat default.prop</strong>
<strong>cat default.prop</strong>
<strong>#</strong>
<strong># ADDITIONAL_DEFAULT_PROPERTIES</strong>
<strong>#</strong>
<strong>ro.secure=1</strong>
<strong>ro.allow.mock.location=0</strong>
<strong>ro.debuggable=0</strong>
<strong>persist.sys.usb.config=mtp</strong>  </pre>
<p style="padding-left: 60px">To combine multiple files into one, we can use the <kbd>&gt;</kbd> <span>operator</span><span>. To append to an existing file, we can use the </span><kbd>&gt;&gt;</kbd> <span>operator</span><span>.</span></p>
<ul>
<li><kbd>cd</kbd>: The <kbd>cd</kbd> command is used to change from one directory to another. This is more frequently used while navigating from one folder to another. The following example shows the commands used to change to the <kbd>system</kbd> folder:</li>
</ul>
<pre style="padding-left: 60px"><strong>shell@android:/ $ cd /system</strong>
<strong>cd /system</strong>
<strong>shell@android:/system $ </strong>  </pre>
<ul>
<li><kbd>cp</kbd>: The <kbd>cp</kbd> command can be used to copy a file from one location to another. The syntax for this command is as follows:</li>
</ul>
<pre style="padding-left: 60px"><strong>$ cp [options] &lt;source&gt;&lt;destination&gt;</strong>  </pre>
<ul>
<li><kbd>chmod</kbd>: The <kbd>chmod</kbd> command is used to change the access permissions to filesystem objects (files and directories). It may also alter special mode flags. The syntax for this command is as follows:</li>
</ul>
<pre style="padding-left: 60px"><strong>$ chmod [option] mode files</strong>  </pre>
<p style="padding-left: 60px">For example, <kbd>chmod 777</kbd> on a file gives read, write, and execute permissions to everyone.</p>
<ul>
<li><kbd>dd</kbd>: The <kbd>dd</kbd> command is used to copy a file, converting and formatting it according to the operands. With Android, the <kbd>dd</kbd> command can be used to create a bit-by-bit image of the Android device. More details of imaging are covered in <a href="f082adcc-6892-4e66-80cc-49b9752cb56a.xhtml"><em>Chapter 4</em></a>, <em>Data Acquisition from iOS Backups</em>. The following is the syntax that needs to be used with this command:</li>
</ul>
<pre style="padding-left: 60px"><strong>dd if=/test/file of=/sdcard/sample.image</strong>    </pre>
<ul>
<li><kbd>rm</kbd>: The <kbd>rm</kbd> command can be used to delete files or directories. The following is the syntax for this command:</li>
</ul>
<pre style="padding-left: 60px"><strong>rm file_name</strong>    </pre>
<ul>
<li><kbd>grep</kbd>: The <kbd>grep</kbd> command is used to search files or output for a particular pattern. The syntax for this command is as follows:</li>
</ul>
<pre style="padding-left: 60px"><strong>grep [options] pattern [files]</strong>    </pre>
<ul>
<li><kbd>pwd</kbd>: The <kbd>pwd</kbd> command displays the current working directory. For example, the following command-line output shows that the current working directory is <kbd>/system</kbd>:</li>
</ul>
<pre style="padding-left: 60px"><strong>shell@android:/system $ pwd</strong>
<strong>pwd</strong>
<strong>/system</strong>  </pre>
<ul>
<li><kbd>mkdir</kbd>: The <kbd>mkdir</kbd> command is used to create a new directory. The following is the syntax for this command:</li>
</ul>
<pre style="padding-left: 60px"><strong>mkdir [options] directories</strong>  </pre>
<ul>
<li><kbd>exit</kbd>: The <kbd>exit</kbd> command can be used to exit the shell you are in. Just type <kbd>exit</kbd> in the shell to exit from it.</li>
</ul>
<p>Next, we will see how to handle an Android device efficiently before the investigation.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Handling an Android device</h1>
                </header>
            
            <article>
                
<p>Handling an Android device in a proper manner prior to the forensic investigation is a very important task. Care should be taken to make sure that our unintentional actions don't result in data modification or any other unwanted happenings. The following sections throw light on certain issues that need to be considered while handling the device in the initial stages of a forensic investigation.</p>
<p>With improvements in technology, the concept of <em>device locking</em> has effectively changed over the last few years. Most users now have a passcode locking mechanism enabled on their device because of the increase in general security awareness. Before we look at some of the techniques used to bypass locked Android devices, it is important for us not to miss an opportunity to disable the passcode when there is a chance.</p>
<p>When an Android device that is to be analyzed is first accessed, check whether the device is still active (unlocked). If so, change the settings of the device to enable greater access to the device. When the device is still active, consider performing the following tasks:</p>
<ul>
<li><strong>Enabling USB debugging</strong>: Once the USB debugging option is enabled, it gives greater access to the device through the <kbd>adb</kbd> connection. This is of great significance when it comes to extracting data from the device. The location of the option to enable USB debugging might change from device to device, but it's usually under <span class="packt_screen">Developer Options</span> in <span class="packt_screen">Settings</span>. Most methods for physically acquiring Android devices require USB debugging to be enabled.</li>
<li><strong>Enabling the Stay awake setting</strong>: If the <span class="packt_screen">Stay awake</span> option is selected and the device is connected for charging, then the device never locks. Again, if the device locks, the acquisition can be halted.</li>
<li><strong>Increasing screen timeout</strong>: This is the time for which the device will be effectively active once it is unlocked. The location to access this setting varies depending upon the model of the device. On a Samsung Galaxy S3 phone, you can access this setting by navigating to <span class="packt_screen">Settings</span> | <span class="packt_screen">Display</span> | <span class="packt_screen">Screen</span><span class="packt_screen">Timeout</span>.</li>
</ul>
<p>Apart from these, as mentioned in <a href="3bd35df5-095f-4aac-a214-31a25983715b.xhtml"><em>Chapter 1</em></a>, <em>Introduction to Mobile Forensics</em>, the device needs to be isolated from the network to make sure that remote wipe options do not work on the device. The Android Device Manager allows the phone to be remotely wiped or locked. This can be done by signing in to the Google account, which is configured on the mobile. More details about this are supplied in the following section. If the Android device is not set up to allow remote wiping, the device can only be locked using the Android Device Manager. There are also several <strong>mobile device management</strong> (<strong>MDM</strong>) software products available on the market, which allow users to remotely lock or wipe the Android device. Some of these may not require specific settings to be enabled on the device.</p>
<p>Using the available remote wipe software, it is possible to delete all the data, including emails, applications, photos, contacts, and other files, as well as those found on the SD card. To isolate the device from the network, you can put the device in airplane mode and disable Wi-Fi as an extra precaution. Enabling airplane mode and disabling Wi-Fi works well, as the device will not be able to communicate over a cellular network and cannot be accessed via Wi-Fi. Removing the SIM card from the phone is also an option, but that does not effectively stop the device from communicating over Wi-Fi or other cellular networks. To place the device in airplane mode, press and hold the Power Off button and select <span class="packt_screen">Airplane mode</span>.</p>
<p>All these steps can be done when the Android device is not locked; however, during the investigation, we commonly encounter devices that are locked. Therefore, it's important to understand how to bypass the lock code if it is enabled on an Android device.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Screen lock bypassing techniques</h1>
                </header>
            
            <article>
                
<p>Because of the increase in user awareness and the ease of functionality, there has been an exponential increase in the usage of passcode options to lock Android devices. This means that bypassing the device's screen lock during a forensic investigation becomes increasingly important. The applicability of the screen lock bypass techniques discussed so far is based on the situation. Note that some of these methods may result in us making changes to the device. Make sure that you test and validate all the steps listed on non-evidentiary Android devices. You must have authorization to make the required changes to the device, document all steps taken, and be able to describe the steps taken if courtroom testimony is required.</p>
<p>Currently, there are three types of screen lock mechanisms offered by Android. Although there are some devices that have voice-lock, face-lock, and fingerprint-lock options, we will limit our discussion to the following three options, since these are the most widely used on all Android devices:</p>
<ul>
<li><strong>Pattern lock</strong>: The user sets a pattern or design on the phone and the same pattern must be drawn to unlock the device. Android was the first smartphone to introduce a pattern lock.</li>
<li><strong>PIN code</strong>: This is the most common lock option and is found on many mobile phones. The PIN code is a four-digit number that needs to be entered to unlock the device.</li>
<li><strong>Passcode</strong>: This is an alphanumeric passcode. Unlike the PIN, which takes four digits, the alphanumeric passcode includes letters as well as digits.</li>
</ul>
<p>The following section details some techniques you can use to bypass these Android lock mechanisms. Depending on the situation, these techniques might help an investigator to bypass the screen lock.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using ADB to bypass the screen lock</h1>
                </header>
            
            <article>
                
<p>If USB debugging appears to be enabled on the Android device, it is wise to take advantage of it by connecting with <kbd>adb</kbd> using a USB connection, as discussed in the earlier sections of this chapter. You should connect the device to the forensic workstation and issue the <kbd>adb</kbd> devices command. If the device shows up, it implies that USB debugging is enabled. If the Android device is locked, you must attempt to bypass the screen lock. The following two methods may allow you to bypass the screen lock when USB debugging is enabled.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deleting the gesture.key file</h1>
                </header>
            
            <article>
                
<p>Deleting the <kbd>gesture.key</kbd> file will remove the pattern lock on the device; however, it's important to note that this will permanently change the device, as the pattern lock is gone. This should be considered if you are conducting covert operations. The following shows how the process is done:</p>
<ol>
<li>Connect the device to the forensic workstation (a Windows machine, in our example) using a USB cable.</li>
</ol>
<ol start="2">
<li>Open the command prompt and execute the following instructions:</li>
</ol>
<pre style="padding-left: 60px"><strong>adb.exe shell</strong>
<strong>cd /data/system rm gesture.key</strong>  </pre>
<ol start="3">
<li>Reboot the device. If the pattern lock still appears, just draw any random design and the device should unlock without any trouble.</li>
</ol>
<div class="packt_infobox">This method works when the device is rooted. This method may not be successful on unrooted devices. Rooting an Android device should not be performed without proper authorization, as the device is altered.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating the settings.db file</h1>
                </header>
            
            <article>
                
<p>To update the <kbd>settings.db</kbd> file, go through the following steps:</p>
<ol>
<li>Connect the device to the forensic workstation using a USB cable.</li>
<li>Open the command prompt and execute the following: <kbd>/data/data/com.android.providers.settings/databases sqlite3 settings.db</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/856dc999-8d82-45b4-9d57-11c9c6f1abe4.png" style="width:47.33em;height:10.17em;"/></p>
<ol start="3">
<li>Exit and reboot the device.</li>
<li>The Android device should be unlocked. If it is not, attempt to remove the <kbd>gesture.key</kbd> as explained earlier.</li>
</ol>
<p>We will have a look at the recovery mode and ADB connection in the following section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Checking for the modified recovery mode and ADB connection</h1>
                </header>
            
            <article>
                
<p>In Android, recovery refers to the dedicated partition where the recovery console is present. The two main functions of recovery are deleting all user data and installing updates. For instance, when you factory-reset your phone, recovery boots up and deletes all the data. Similarly, when updates are to be installed on the phone, it is done in recovery mode.</p>
<p>There are many enthusiastic Android users who install custom ROM through a modified recovery module. This modified recovery module is mainly used to make the process of installing custom ROM easy. Recovery mode can be accessed in different ways, depending on the manufacturer of the device; information on which method is right for which manufacturer's devices is easily available on the internet. Usually, this is done by holding different keys together, such as the Volume button and Power button. Once in recovery mode, connect the device to the workstation and try to access the <kbd>adb</kbd> connection. If the device has a recovery mode that is not modified, you <span>may not be able to access the</span> <kbd>adb</kbd> <span>connection. Modified recovery versions of the device present the user with</span> different <span>options as shown in the</span> following <span>screenshot:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b241b78f-fe58-44e5-b75a-fd1984664839.png" style="width:18.08em;height:11.67em;"/></p>
<p>Next, we will see how to flash the recovery partition.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Flashing a new recovery partition</h1>
                </header>
            
            <article>
                
<p>There are mechanisms available to flash the recovery partition of an Android device with a modified image. The fastboot utility facilitates this process. Fastboot is a diagnostic protocol that comes with the SDK package and is used primarily to modify the flash filesystem through a USB connection from a host computer. For this, you need to start the device in boot loader mode, in which only the most basic hardware initialization is performed.</p>
<p>Once the protocol is enabled on the device, it will accept a specific set of commands that are sent to it via the USB cable using a command line. Flashing or rewriting a partition with a binary image stored on the computer is one such command that is allowed. Once the recovery is flashed, boot the device in recovery mode, mount the <kbd>/data</kbd> and <kbd>/system</kbd> partitions, and use <kbd>adb</kbd> to remove the <kbd>gesture.key</kbd> file. Reboot the phone and you should be able to bypass the screen lock; however, this works only if the device bootloader is unlocked. Also, flashing permanently alters the device. Instead of flashing, you could use the fastboot <kbd>boot</kbd> command to boot to a recovery image temporarily to delete the key file without permanently changing the recovery partition.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using automated tools</h1>
                </header>
            
            <article>
                
<p>There are several automated solutions available on the market for unlocking Android devices. Commercial tools, such as Cellebrite and XRY, are capable of bypassing the screen locks, but most of them require USB debugging to be enabled. We will now examine how to unlock an Android device using the UFED user lock code recovery tool. This tool only works on those devices that support USB OTG. This process also requires a UFED camera, Cable No. 500-Bypass lock, and Cable No. 501-Bypass lock. Once the tool is installed on the workstation, go through the following steps to unlock the Android device:</p>
<ol>
<li>Run the tool on the workstation and press <kbd>1</kbd>, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/d451d87c-63de-4905-a9cb-34ee27dae914.png" style="width:42.17em;height:18.25em;"/></div>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">UFED user lock code recovery tool</div>
<ol start="2">
<li>Now, connect side A of Cable No. 500-Bypasslock to a USB port of the workstation. Also, connect side B of Cable No. 500-Bypasslock to Cable No. 501- OTG and then connect the other end to the device.</li>
<li>Once connected, the tool prompts you to select the recovery profile. Select <kbd>[1] Manually select the recovery profile.</kbd>.</li>
<li>Now, select the lock type used on the device and the recovery profile, and proceed by following the instructions on the screen.</li>
</ol>
<ol start="5">
<li>After this, make sure that the keypad appears on the device screen and that it's ready to accept the PIN code.</li>
<li>Close any message windows that may appear. Press <kbd>1</kbd> and hit <em>Enter</em>. Now, make five incorrect login attempts by entering random input, and click on <span class="packt_screen">Forgot pattern</span> at the bottom of the device.</li>
<li>Follow the instructions on the screen, wait for the camera window to open, and then click on the camera window.</li>
<li>Use the cursor to select any nonempty area on the device's screen by placing the green square over it—for example, select any number on the screen. This is used by the tool to detect whether the device is unlocked. Press <em>Enter</em> to start the process.</li>
<li>The tool will try a number of combinations to unlock the device. Once unlocked, it will prompt you to end the process.</li>
</ol>
<p>We will now learn about the Android Device Manager and how to unlock a device using it.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Android Device Manager</h1>
                </header>
            
            <article>
                
<p>Most of the latest Android phones come with a service called Android Device Manager, which helps the owner of a device to locate their lost phone. This service can also be used to unlock a device; however, this is possible only when you know the Google account credentials that are configured on the device. If you have access to the account credentials, then follow these steps to unlock the device:</p>
<ol>
<li>Visit <a href="http://google.com/android/devicemanager"><span class="URLPACKT">http://google.com/android/devicemanager</span></a> on your workstation.</li>
<li>Sign in using the Google account that is configured on the device.</li>
<li>Select the device you need to unlock and click on <span class="packt_screen">Lock</span>, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/96e9d1fa-43c6-4269-8d04-a531816e05b6.png" style="width:38.50em;height:25.58em;"/></p>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Android Device Manager</div>
<ol start="4">
<li>Enter a temporary password and click on <span class="packt_screen">Lock</span> again.</li>
<li>Once it's successful, enter the temporary password on the device to unlock it.</li>
</ol>
<p>This can be done without knowing the credentials of the computer that the login is saved on (that is, the suspect's PC). </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Bypass using Find My Mobile (for Samsung phones only)</h1>
                </header>
            
            <article>
                
<p>Using Find My Mobile is a technique that's worth attempting if you're handling a Samsung device; however, it <span>only</span><span> w</span><span>orks if the device owner is already logged into the Samsung account on the device and you know the Samsung credentials that are configured on the device.</span></p>
<p class="mce-root">To start the process, access the Find My Mobile service from the web browser and then log in using the Samsung account credentials registered on the device, as follows:</p>
<ol>
<li class="mce-root">Tap on the <span class="packt_screen">Lock My Screen</span> option located on the left side.:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6bf2591e-f260-40e7-8fb0-50ff9711e467.png" style="width:54.42em;height:34.58em;"/></p>
<ol start="2">
<li class="mce-root">Now, enter any temporary PIN and then tap on the <span class="packt_screen">Lock</span> button. (You may also see the <span class="packt_screen">unlock my screen</span> option for <span>some devices, which also serves the same purpose). </span>The phone can now be unlocked with the temporary PIN that was set earlier.</li>
</ol>
<p>Next, let's take a look at a smudge attack.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Smudge attack</h1>
                </header>
            
            <article>
                
<p>In rare cases, a smudge attack may be used to deduce the password of a touchscreen mobile device. This attack relies on identifying the smudges left behind by the user's fingers. While this may present a bypass method, it must be said that a smudge attack is unlikely to work since most Android devices are touchscreen and smudges will also be present from using the device; however, it has been demonstrated that, under proper lighting, the smudges that are left behind can <span>be</span><span> </span><span>easily detected, as shown in the following screenshot.</span></p>
<p>By analyzing the smudge marks, we can discern the pattern that is used to unlock the screen. This attack is more likely to work while discerning the pattern lock on the Android device. In some cases, PIN codes can also be recovered depending upon the cleanliness of the screen. So, during a forensic investigation, care should be taken when the device is first handled to make sure that the screen is not touched:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/53acfd74-b095-4bf7-a99d-10bac648fb6b.png" style="width:15.08em;height:28.25em;"/></p>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Smudges visible on a device under proper lighting </div>
<p>We will now be looking at the next method, which is the forgot password option.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using the forgot password/forgot pattern option</h1>
                </header>
            
            <article>
                
<p>If you know the username and password of the primary Gmail address that is configured on the device, you can change the PIN, password, or swipe on the device. After making a certain number of failed attempts to unlock the screen, Android provides an option called <span class="packt_screen">Forgot pattern?</span> or <span class="packt_screen">Forgot password?</span>, as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/43b264a2-7044-445f-9ae5-40705fd65345.png" style="width:20.50em;height:34.92em;"/></div>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Forgot pattern option on an Android device</div>
<p>Tap on that link and sign in using the Gmail username and password. This will allow you to create a new pattern lock or passcode for the device.</p>
<div class="packt_infobox">Note that this works only on devices running Android 4.4 or earlier.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Bypassing third-party lock screens by booting into safe mode</h1>
                </header>
            
            <article>
                
<p>If the screen lock is a third-party app, rather than the in-built lock, it can be bypassed by booting into safe mode and disabling it. To boot into safe mode on an Android device 4.1 or later, press and hold the <em>Power</em> button until the Power options menu appears. Then, press and hold the <em>Power</em> button and you'll be prompted to reboot your Android device into safe mode. Tap the <span class="packt_screen">OK</span> button, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/45d280e4-f582-47e0-bd32-d10c8af469f6.png" style="width:27.17em;height:9.83em;"/></p>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Safe mode in Android</div>
<p>Once you're in safe mode, you can disable the third-party lock screen app or uninstall it completely. After this, reboot the device and you should be able to access it without any lock screen.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Secure USB debugging bypass using ADB keys</h1>
                </header>
            
            <article>
                
<p>As mentioned earlier, while using USB debugging, if the <span class="packt_screen">Always allow from this computer</span> option is checked, the device will not prompt for authorization in the future. This is done by storing certain keys, namely <kbd>adbkey</kbd> and <kbd>adbkey.pub</kbd>, on the computer. Any attempt to connect to <kbd>adb</kbd> from an untrusted computer is denied. In this case, the <kbd>adbkey</kbd> and the <kbd>adbkey.pub</kbd> files can be pulled from the suspect's computer and copied to the investigator's workstation. The device will then assume that it is communicating with a known, authorized computer. The <kbd>adbkey</kbd> and <kbd>adbkey.pub</kbd> files can be found at <kbd>C:Users&lt;username&gt;.android</kbd> on Windows machines.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Secure USB debugging bypass in Android 4.4.2</h1>
                </header>
            
            <article>
                
<p>As explained in earlier sections, the secure USB debugging feature introduced in Android 4.4.2 allows only authorized workstations to connect to the device; however, there's a bug in this feature, as reported at <a href="https://labs.mwrinfosecurity.com/"><span class="URLPACKT">https://labs.mwrinfosecurity.com/</span></a>, which allows a user to bypass the Secure USB debugging feature and connect the device to any workstation. Here are the steps to follow to bypass Secure USB debugging on an Android device:</p>
<ol>
<li>On an unlocked device, attempt to use <kbd>adb</kbd>. An error message will be shown by the device.</li>
<li>Now, navigate to either the emergency dialer or the lock-screen camera and execute the following commands:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ adb kill-server</strong>
<strong>$ adb shell</strong>  </pre>
<ol start="3">
<li>The confirmation dialog will be triggered and the workstation can now be authorized without unlocking the device. The confirmation dialog box will be displayed on the emergency dialer, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/c1ae9227-03b0-4a25-b965-ae68de0b7608.png" style="width:19.17em;height:16.25em;"/></div>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Secure USB debugging in Android 4.2.2</div>
<ol start="4">
<li>Once connected to the device through <kbd>adb</kbd>, try to bypass the lock screen using the following command:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ adb shell pm clear com.android.keyguard<br/></strong></pre>
<p>Next, let's see how to bypass the screen lock by crashing the lock screen.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Crashing the lock screen UI in Android 5.x</h1>
                </header>
            
            <article>
                
<p>On devices running Android 5.0 to 5.1.1, the password lock screen (not the PIN or pattern locks) can be bypassed by crashing the screen UI. This can be accomplished by performing the following steps, as explained at <a href="https://android.gadgethacks.com/"><span class="URLPACKT">https://android.gadgethacks.com/</span></a>:</p>
<ol>
<li>Click on the <span class="packt_screen">Emergency Call</span> option on the lock screen and then enter any random input (for example, 10 asterisks) on the dialer screen.</li>
<li>Double-tap the field to highlight the entered text, as shown in the following screenshot, and select <span class="packt_screen">Copy</span>. Now, paste it into the same field:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/efbd2799-8164-4768-8b11-fc83fec2cc35.png" style="width:18.17em;height:30.25em;"/></div>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Crashing lock screen UI</div>
<ol start="3">
<li>Repeat this process to add more characters. Do this until the field no longer highlights the characters on double-tapping.</li>
<li>Go back to the lock screen and open the camera shortcut. Now, pull down the notifications screen and tap the <span class="packt_screen">Settings</span> icon. You will then be prompted to enter a password.</li>
</ol>
<ol start="5">
<li>Press and hold the input field and select <span class="packt_screen">Paste</span>, repeat this process multiple times. Once enough characters are pasted into the field, the lock screen will crash, allowing you to access the device.</li>
</ol>
<p>Now, let's look at some more techniques.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Other techniques</h1>
                </header>
            
            <article>
                
<p>All of the aforementioned techniques and available commercial tools are useful to any forensic examiner, like you, trying to get access to the data on an Android device; however, there could be situations where none of these techniques work. To obtain a complete physical image of the device, techniques such as chip-off and JTAG may be required when commercial and open source solutions fail. A short description of these techniques is included here.</p>
<p>While the chip-off technique removes the memory chip from a circuit and tries to read it, the JTAG technique involves probing the JTAG <strong>test access ports</strong> (<strong>TAPs</strong>) and soldering connectors to the JTAG ports in order to read data from the device memory. The chip-off technique is more destructive because, once the chip is removed from a device, it is difficult to restore the device to its original functional state. Also, expertise is needed to carefully remove the chip from the device by desoldering the chip from the circuit board. The heat required to remove the chip can also damage or destroy the data stored on that chip, which means that this technique should be used only when the data is not retrievable by open source or commercial tools or the device is damaged beyond repair. When using the JTAG technique, JTAG ports help you to access the memory chip to retrieve a physical image of the data without needing to remove the chip. To turn off screen lock on a device, you can identify where the lock code is stored in the physical memory dump, turn off the locking, and copy that data back to the device. Commercial tools, such as Cellebrite Physical Analyzer, can accept <kbd>.bin</kbd> files from chip-off and JTAG acquisitions and crack the lock code for you. Once the code is either manually removed or cracked, you can analyze the device using normal techniques.</p>
<div class="packt_infobox">Both the chip-off and JTAG techniques require extensive research and experience to be attempted on a real device. A great resource for JTAG and chip-off on devices can be found at <a href="https://forensicswiki.xyz/page/Main_Page" target="_blank">https://forensicswiki.xyz/page/Main_Page</a>.</div>
<p>In this section, we looked into various ways to bypass a screen lock on Android device. We will now learn what Android rooting is all about.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Gaining root access</h1>
                </header>
            
            <article>
                
<p>As a mobile device forensic examiner, it is essential for you to know everything that relates to twisting and tweaking the device. This will help you to understand the internal workings of the device in detail and understand many issues that you may face during your investigation. Rooting Android phones has become a common phenomenon, and you can expect to encounter rooted phones during forensic examinations. Where applicable, you may also need to root the device in order to acquire data for forensic examination. This means that it's important to know the ins and outs of rooted devices and how they are different from other phones. The following sections cover information about Android rooting and other related concepts.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">What is rooting?</h1>
                </header>
            
            <article>
                
<p>The default administrative account in Unix-like operating systems is called <strong>root</strong>. In Linux, the root user has the power to start/stop any system service, edit/delete any file, change the privileges of other users, and so on. We have already learned that Android uses the Linux kernel, and so most Linux concepts are applicable to Android as well; however, most Android phones do not let you log in as a root user by default.</p>
<div class="packt_infobox">Rooting an Android phone is all about gaining access to the device to perform actions that are not normally allowed on the device. Manufacturers want devices to function in a certain manner for normal users. Rooting a device may void a warranty, since using root opens the system to vulnerabilities and provides the user with superuser capabilities.</div>
<p>Imagine a malicious application gaining access to an entire Android system with root access. Remember that, in Android, each application is treated as a separate user and is issued a UID. This means that applications have access to limited resources and the concept of application isolation is enforced. Essentially, rooting an Android device allows superuser capabilities and provides open access to the Android device.</p>
<p>Superuser capabilities are similar to the admin capability on a Windows machine, and give privileged access to perform actions that may not be done by a normal user. In mobiles, this superuser access is disabled by design, but rooting a phone allows you to gain this privilege. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Understanding the rooting process</h1>
                </header>
            
            <article>
                
<p>Even though hardware manufacturers try to impose enough restrictions to restrict access to the root, hackers have always found different ways to get access to the root. The process of rooting varies depending on the underlying device manufacturer; however, rooting any device usually involves exploiting a security bug in the device's firmware, then copying the <kbd>su</kbd> (superuser) binary to a location in the current process's path (<kbd>/system/xbin/su</kbd>), and granting it executable permissions with the <kbd>chmod</kbd> command.</p>
<p>For the sake of simplicity, imagine that an Android device has three to four partitions, which run programs not entirely related to Android (Android being one among them).</p>
<p>The boot loader is present in the first partition and is the first program that runs when the phone is powered on. The primary job of this boot loader is to boot other partitions and load the Android partition, commonly referred to as ROM by default. To see the boot loader menu, a specific key combination is required, such as holding the power button and pressing the volume up button. This menu provides options for you to boot into other partitions, such as the recovery partition.</p>
<p>The recovery partition deals with installing upgrades to the phone, which are written directly to the Android ROM partition. This is the mode that you see when you install any official update on the device. Device manufacturers make sure that only official updates are installed through the recovery partition. This means that bypassing this restriction would allow you to install/flash any unlocked Android ROM. Modified recovery programs are those that not only allow an easier rooting process, but also provide various options that are not seen in the normal recovery mode. The following screenshot shows the normal recovery mode:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/276340e8-f14d-469a-969a-61d74a747da6.png" style="width:23.33em;height:15.50em;"/></p>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Normal Android system recovery mode</div>
<p>The following screenshot shows the modified recovery mode:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/b2aad127-aa2e-48cd-94df-bc7dab921af8.png" style="width:21.33em;height:14.17em;"/></div>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">The modified recovery mode</div>
<p>The most commonly used recovery program in the Android world is Clockwork recovery, also called <strong>ClockworkMod</strong>. Most rooting methods begin by flashing a modified recovery to the recovery partition. After that, you can issue an update, which can root the device; however, you don't need to perform all the actions manually, as software is available for most models that can root your phone with a single click.</p>
<p>Starting from Android 7.x, Google started strictly enforcing <strong>verified boot</strong> on devices. Verified boot guarantees that the software on the device is not modified before booting into the normal mode. This is implemented in such a way that each stage verifies the integrity and authenticity of the next stage before executing it. If a particular partition or segment is modified, the integrity check fails and the mobile may not boot into normal mode. More information about verified boot can be found at <a href="https://source.android.com/security/verifiedboot/verified-boot"><span class="URLPACKT">https://source.android.com/security/verifiedboot/verified-boot</span></a>.</p>
<p>This also means that rooting such Android devices is going to be extremely difficult because rooting involves tweaking the Android OS. Marshmallow was the first Android version to provide alerts on system integrity, but since Android 7.x, this has been made mandatory.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Rooting an Android device</h1>
                </header>
            
            <article>
                
<p><span>We will now look at the different methods available to root an Android device. The primary factor that influences your choice of method is whether the underlying boot loader is locked or unlocked. Gaining root access on a device with an unlocked boot loader is very easy, while gaining root access to a device with a locked boot loader is not so straightforward, which means that unlocking your Android phone’s bootloader is often the first step to rooting and flashing custom ROMs. This can be done either through fastboot mode (discussed in earlier sections) or by following a vendor-specific boot loader unlock procedure. Once the device bootloader is unlocked, the next step is to copy the <kbd>su</kbd> binary and grant it executable permissions. This can be done in many ways. </span></p>
<p>The following is how to root a Samsung Galaxy S7 (International SM-G930F/FD/X, Korean SM-G930K/L/S, and Canadian SM-G930W8 Exynos models):</p>
<ol>
<li class="mce-root">Make sure OEM unlock is enabled in the <span class="packt_screen">Developer</span> options.</li>
<li class="mce-root">Download ODIN (available at <a href="https://build.nethunter.com/samsung-tools/Odin_3.12.3.zip">https://build.nethunter.com/samsung-tools/Odin_3.12.3.zip</a>) and extract the contents of the archive to the directory of your choice.</li>
<li class="mce-root">Download the TWRP image (available at <a href="https://twrp.me/samsung/samsunggalaxys7.html">https://twrp.me/samsung/samsunggalaxys7.html</a>).</li>
<li class="mce-root">Reboot your device into download mode. To do this, hold the Volume down + Home buttons while your device reboots. Once you see the download mode warning screen, press Volume up to continue.<br/>
Start Odin and put the TWRP image in the AP slot; don't forget to disable <span class="packt_screen">Auto-Reboot</span>. Start flashing the recovery.</li>
<li class="mce-root">To exit download mode, hold Volume down + Home + Power; when the screen blanks, immediately change Volume down to Volume up.</li>
<li class="mce-root">Allow system modifications by swiping right.</li>
<li class="mce-root">Download SuperSU (available at <a href="https://download.chainfire.eu/supersu">https://download.chainfire.eu/supersu</a>).</li>
<li class="mce-root">Transfer the archive with SuperSU to the device via MTP and install it via the corresponding TWRP option.</li>
</ol>
<p>Rooting is a highly device-specific process and hence the forensic investigator needs to be cautious before applying these techniques on any Android device. Rooting a device has both advantages and disadvantages associated with it. The following are the advantages of rooting: </p>
<ul>
<li>Rooting allows modification of the software on the device to the deepest level—for example, you can overclock or underclock the device's CPU.</li>
</ul>
<ul>
<li>It allows restrictions imposed on the device by carriers, manufacturers, and so on, to be bypassed.</li>
<li>For extreme customization, new customized ROMs can be downloaded and installed.</li>
</ul>
<p>The following are the disadvantages of rooting:</p>
<ul>
<li>Rooting a device must be done with extreme care as errors may result in irreparable damage to the software on the phone, turning the device into a useless brick.</li>
<li>Rooting might void the warranty of a device.</li>
<li>Rooting results in increased exposure to malware and other attacks. Malware with access to the entire Android system can create havoc.</li>
</ul>
<p>Once the device is rooted, applications such as the <strong>Superuser app</strong> are available to provide and deny root privileges. This app helps you to grant and manage superuser rights on the device, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d7232d9e-6d6f-415a-b11f-fad93ceda817.png" style="width:20.92em;height:18.25em;"/></p>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Application requesting root access</div>
<p>We will now look at root access.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Root access - ADB shell</h1>
                </header>
            
            <article>
                
<p>A normal Android phone does not allow you to access certain directories and files on the device. For example, try to access the <kbd>/data/data</kbd> folder on an Android device that is not rooted. You will see the following message:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/a8a87e66-a5db-4249-b65a-61d8702c50f8.png" style="width:24.42em;height:6.67em;"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Permission denial without root access</div>
<p>On a rooted phone, you can run the <kbd>adb</kbd> shell as root by issuing the following command:</p>
<pre><strong>C:\android-sdk\platform-tools&gt;adb.exe root<br/></strong></pre>
<p>The following screenshot shows the output of the preceding command:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0139ceda-331a-4745-bbb0-b8658299a245.png" style="width:22.42em;height:10.58em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Successful execution of shell command on a rooted device</div>
<p>Thus, rooting a phone enables you to access folders and data that are otherwise not accessible. Also note that <kbd>#</kbd> symbolizes root or superuser access, while <kbd>$</kbd> reflects a normal user, as shown in the preceding command lines.</p>
<div class="packt_infobox"><br/>
Android 7.0 (Nougat) and later versions support <strong>file-based encryption</strong> (<strong>FBE</strong>), which allows the encryption of different files with different keys. For a forensic investigator like you, it is important to note that it is not possible to apply a permanent root to an FBE-enabled device for acquisition purposes. Instead, it is recommended that you use a custom recovery methodology, because the recovery partition runs with root privileges. </div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we learned how to set up a proper forensic workstation before conducting investigations on an Android device. Start with a sterile forensic workstation that has the necessary basic software and device drivers installed on it. If the method of forensic acquisition requires the Android device to be unlocked, you need to determine the best method by which to gain access to the device. If the device has the USB debugging feature enabled, then bypassing the screen-lock is just a cakewalk. We learned about the various screen lock bypass techniques and helped you to determine which one to use under different circumstances. Depending on the forensic acquisition method and the scope of the investigation, rooting the device should provide complete access to the files present on the device. We also learned about rooting and how it can be used to gain complete access to the device's filesystem and perform actions that are not normally allowed. </p>
<p>Now that the basic concepts of gaining access to an Android device have been covered, we will cover acquisition techniques and describe how data is pulled using each method in <a href="bf232566-3a17-4914-992b-80674dd379de.xhtml"><em>Chapter 9</em></a>, <em>Android Data Extraction Techniques</em>.</p>


            </article>

            
        </section>
    </body></html>