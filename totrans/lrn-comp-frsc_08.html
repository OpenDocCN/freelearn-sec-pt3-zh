<html><head></head><body>
  <div><h1 class="chapterNumber">8</h1>
    <h1 id="_idParaDest-165" class="chapterTitle">Email Forensics – Investigation Techniques</h1>
    <p class="normal">Email is just one portion of the global internet that has become a daily resource in the consumer and corporate realms. It has become one of the primary communication tools used by nearly every citizen of the industrialized world. Now that email has become part of everyone’s everyday lives, criminals will use this vector to commit crimes and collaborate with their co-conspirators.</p>
    <p class="normal">It can be difficult for the digital forensic investigator to trace an email back to the source from its destination. Therefore, the digital forensic investigator will have to be educated in the methods and delivery systems of the email life cycle. When the digital forensic investigator successfully identifies the source of the email, that will lead to additional forensic investigations of the digital evidence that was found at the source.</p>
    <p class="normal">Where can you find digital evidence relating to an email investigation? The local machine will have the destination version of the email, the email server(s), the device used to access the email, such as a cell phone, and logs from the internet service provider. The digital forensic investigator will have to know which tools can analyze emails and the compound files of the email box used by some email suites. Knowing how to present this information to a non-technical person will be crucial for conveying the relevance of the data that the examiner recovered. By the end of this chapter, you will understand the protocols used to send and receive emails, how to decode the email headers, and how to analyze client and web-based emails.</p>
    <p class="normal">We will cover the following topics in this chapter:</p>
    <ul>
      <li class="bulletList">Understanding email protocols</li>
      <li class="bulletList">Decoding emails</li>
      <li class="bulletList">Understanding client-based email analysis</li>
      <li class="bulletList">Understanding WebMail analysis</li>
    </ul>
    <h1 id="_idParaDest-166" class="heading-1">Understanding email protocols</h1>
    <p class="normal">An email protocol is a standard used to allow two computer hosts to exchange email communication. When <a id="_idIndexMarker736"/>an email is sent, it travels from the sender’s host to an email server. The email server can forward the email through a series of relays until it arrives at an email server close to the recipient’s host. The recipient will receive a notification stating that an email is available; the recipient will then reach out to the email server to get the email.</p>
    <p class="normal">Users typically use an email client to access emails. An email client can use different protocols to access the email. We will now discuss some email protocols you may encounter when conducting a digital forensics investigation.</p>
    <h2 id="_idParaDest-167" class="heading-2">Understanding SMTP – Simple Mail Transfer Protocol</h2>
    <p class="normal">SMTP is the protocol <a id="_idIndexMarker737"/>for email transmission. It is an <a id="_idIndexMarker738"/>internet standard based on RFC 821 but was later updated to RFC 3207, RFC 5321/5322.</p>
    <div><p class="normal"><strong class="keyWord">Tip</strong></p>
      <p class="normal">RFC stands for Request for Comments. This is used on internet/communications <a id="_idIndexMarker739"/>technology to create standards. An RFC may come from different bodies, such as the Internet Architecture Board/Internet Engineering Task Force or an independent researcher. It was initially designed to track the development of the original ARPANET but has now evolved into a source of official documentation regarding internet specifications and communication protocols.</p>
    </div>
    <p class="normal">Mail servers use SMTP to send and receive email messages from all locations accessing the internet. Typically, you <a id="_idIndexMarker740"/>will find an SMTP server utilizing <strong class="keyWord">Transmission Control Protocol</strong> (<strong class="keyWord">TCP</strong>) port <strong class="keyWord">25</strong> on the network. The path from the sender to the recipient is outlined in the following diagram:</p>
    <figure class="mediaobject"><img src="img/B18329_08_01.png" alt="Figure 8.1: SMTP map "/></figure>
    <p class="packt_figref">Figure 8.1: Diagram of an email sent by SMTP</p>
    <p class="normal">When the user sends an <a id="_idIndexMarker741"/>email, it will travel from the <a id="_idIndexMarker742"/>host to a series of SMTP servers until it reaches the destination SMTP server. The recipient will have to use a different protocol to retrieve the email, which is our next topic.</p>
    <p class="normal">The next protocol we will discuss is POP3.</p>
    <h2 id="_idParaDest-168" class="heading-2">Understanding the Post Office Protocol</h2>
    <p class="normal">POP3 is the standardized protocol that allows users to access their inbox and download emails. POP3 is specifically <a id="_idIndexMarker743"/>designed only to receive emails; the system <a id="_idIndexMarker744"/>does not allow users to send emails. This protocol enables the user to be offline when drafting, reading, or replying and can access the online mailbox on-demand at the user’s request. Be aware that the email you are conducting your digital forensic examination on may be the only copy. The user has the option to not leave a copy of the email on the server. Once the email has been downloaded, the system can remove it to reduce storage use on the server.</p>
    <p class="normal">You will find POP utilizing port <strong class="keyWord">110</strong> on the network.</p>
    <p class="normal">In the following diagram, you can see the general functionality of the SMTP-POP process:</p>
    <figure class="mediaobject"><img src="img/B18329_08_02.png" alt="Figure 8.2: SMTP-POP map "/></figure>
    <p class="packt_figref">Figure 8.2: SMTP-POP map</p>
    <p class="normal">Here, you can see the <a id="_idIndexMarker745"/>path the email takes, which is as <a id="_idIndexMarker746"/>follows:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">The email originates from the sender.</li>
      <li class="numberedList">The SMTP server forwards it to the destination.</li>
      <li class="numberedList">The recipient collects the email from the server. The recipient can decide if a copy of the email stays on the server or whether the email will be deleted when the user downloads the email from the server.</li>
    </ol>
    <p class="normal">When we look at the next protocol, we will discuss functions similar to SMTP, but with some significant differences. We will discuss these differences in the next section.</p>
    <h2 id="_idParaDest-169" class="heading-2">IMAP – Internet Message Access Protocol</h2>
    <p class="normal"><strong class="keyWord">IMAP</strong> is the <strong class="keyWord">Internet Message Access Protocol</strong> and is a standard protocol used by an email client <a id="_idIndexMarker747"/>to access emails on <a id="_idIndexMarker748"/>an email server. The protocol was designed to allow complete inbox management with multiple clients. In most cases, email messages will be left on the server until the user deletes them. IMAP is a newer protocol than POP, but both are still prevailing email standards in use today. The most significant difference between IMAP and POP is that POP retrieves the mailbox’s contents, and IMAP was designed as a remote access mailbox protocol.</p>
    <p class="normal">In the following diagram, you can see the general functionality of the SMTP-IMAP process:</p>
    <figure class="mediaobject"><img src="img/B18329_08_03.png" alt="Figure 8.3: IMAP map "/></figure>
    <p class="packt_figref">Figure 8.3: IMAP map</p>
    <p class="normal">Here, you can see the path the email takes:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">The email originates from the sender.</li>
      <li class="numberedList">The SMTP server forwards it to the destination.</li>
      <li class="numberedList">The recipient collects the email from the server. A copy of the email stays on the server until the user explicitly deletes it.</li>
    </ol>
    <p class="normal">All three protocols <a id="_idIndexMarker749"/>we just discussed are <a id="_idIndexMarker750"/>typically used in the email client-server relationship. Users also have another option when it comes to accessing emails known as web-based email, which is the topic of the next section.</p>
    <h2 id="_idParaDest-170" class="heading-2">Understanding web-based email</h2>
    <p class="normal">Web-based email is a <a id="_idIndexMarker751"/>service the user accesses with a web browser. Standard webmail providers are Gmail, Yahoo Mail, and Outlook/Hotmail. Some internet service providers also provide an email account that the user can access with a web browser.</p>
    <p class="normal">User-deleted emails stored on a web-based email server typically remain on the server until the system deletes them. A characteristic feature of web-based email is that when the user deletes an email, it is moved from the inbox into a <strong class="keyWord">Deleted/Trash</strong> folder and can still be accessed. However, after the email remains in the <strong class="keyWord">Deleted</strong> folder for a set timeframe, the system permanently deletes it from the user’s inbox.</p>
    <p class="normal">We have gone over the different methods of how a user may access email services. However, once you have the email dataset available for examination, you may find the contents of the <a id="_idIndexMarker752"/>email encoded. So, how do you decode the contents of the email to determine whether a crime/violation has/has not been committed?</p>
    <p class="normal">In the next topic, we will decode the email header so that you can make an informed choice about your investigative endeavors.</p>
    <h1 id="_idParaDest-171" class="heading-1">Decoding email</h1>
    <p class="normal">An email has many unique identifiers for a digital forensic investigator to identify and track down. The <a id="_idIndexMarker753"/>mailbox and domain name, along with the message ID, will allow a digital forensic investigator to serve judicially approved subpoenas/search warrants on the vendor to follow any investigative leads.</p>
    <p class="normal">In this section, we will break down the email header one section at a time so that you can decide how to conduct your investigation. First, we will start by discussing the email envelope.</p>
    <h2 id="_idParaDest-172" class="heading-2">Understanding the email message format</h2>
    <p class="normal">The vast majority of email users <a id="_idIndexMarker754"/>are only familiar with basic email information, such as this:</p>
    <pre class="programlisting code"><code class="hljs-code">Subject background checks 
Date 07/19/2008 23:39:57 +0 
Sender alison@m57.biz 
Recipients jean@m57.biz 
</code></pre>
    <p class="normal">We are back to dealing with our friend Jean, and by looking at the email, we can see several fields commonly associated with an email. Here, we know the subject, background checks, the date and time when the user sent the email, the sender, and the recipient. </p>
    <p class="normal">We also have the content of the email, as shown here:</p>
    <pre class="programlisting code"><code class="hljs-code">Jean,
One of the potential investors that I've been dealing with has asked me to get a background check of our current employees. Apparently they recently had some problems at some other company they funded.
Could you please put together for me a spreadsheet specifying each of our employees, their current salary, and their SSN? Please do not mention this to anybody.
Thanks.
(ps: because of the sensitive nature of this, please do not include the text of this email in your message to me. Thanks.)
</code></pre>
    <p class="normal">As we look at the email, it appears that the email was sent to <em class="italic">Jean</em> from <em class="italic">Alison</em>. Alison is requesting a spreadsheet of confidential employee information. Based on the basic examination of this email, there is nothing to contradict what it initially appears to be.</p>
    <p class="normal">The user has created <a id="_idIndexMarker755"/>the information in the <em class="italic">to</em> and <em class="italic">from</em> fields and the <em class="italic">subject</em> and the <em class="italic">content</em> of the email. The system derives the date and time from the system time, which can be set by the user.</p>
    <p class="normal">Underneath the typical email information, another layer of data is instrumental when conducting your investigations. This is referred to as the <em class="italic">email header</em>, and it contains information about the source, transmission, and destination of a specific email.</p>
    <p class="normal">Most email clients require an additional command to view the email header. For example, Gmail requires you to click <strong class="screenText">Show original</strong> to see the email header. For example, the following is the email header for the email Jean received from Alison:</p>
    <pre class="programlisting code"><code class="hljs-code">-----HEADERS-----
Return-Path: simsong@xy.dreamhostps.com
X-Original-To: jean@m57.biz
Delivered-To: x2789967@spunkymail-mx8.g.dreamhost.com
Received: from smarty.dreamhost.com (sd-green-bigip-81.dreamhost.com [208.97.132.81]) by spunkymail-mx8.g.dreamhost.com (Postfix) with ESMTP id E32634D80F for &lt;jean@m57.biz&gt;; Sat, 19 Jul 2008 16:39:57 -0700 (PDT)
Received: from xy.dreamhostps.com (apache2-xy.xy.dreamhostps.com [208.97.188.9]) by smarty.dreamhost.com (Postfix) with ESMTP id 6E408EE23D for &lt;jean@m57.biz&gt;; Sat, 19 Jul 2008 16:39:57 -0700 (PDT)
Received: by xy.dreamhostps.com (Postfix, from userid 558838) id 64C683B1DAE; Sat, 19 Jul 2008 16:39:57 -0700 (PDT)
To: jean@m57.biz From: alison@m57.biz 
subject: background checks 
Message-Id: 20080719233957.64C683B1DAE@xy.dreamhostps.com
Date: Sat, 19 Jul 2008 16:39:57 -0700 (PDT)
</code></pre>
    <p class="normal">The email header shows where the email originated from and what servers it touched upon. Starting from the bottom, we can see the <code class="inlineCode">Message-Id</code> field:</p>
    <pre class="programlisting code"><code class="hljs-code">Message-Id: &lt;20080719233957.64C683B1DAE@xy.dreamhostps.com&gt;
</code></pre>
    <p class="normal">The <code class="inlineCode">Message-Id</code> field contains a unique ID for every email that has been sent. When a user sends an email, it will <a id="_idIndexMarker756"/>receive its message ID from the first email server it touches. The message ID will be globally unique, so there should not be another email with the same message ID. If you find different emails that contain the same message ID, you are dealing with one of two scenarios:</p>
    <ul>
      <li class="bulletList">The email server is not compliant with the standard.</li>
      <li class="bulletList">A user has altered the email.</li>
    </ul>
    <p class="normal">When you look at the message ID, you will see a string of random alphanumeric characters, as well as the <code class="inlineCode">@</code> symbol and a domain name. Sometimes, the arbitrary string of alphanumeric characters contains a date/timestamp. Looking at the preceding example, we can see the numbers <code class="inlineCode">20080719233957</code>, which can be translated to <em class="italic">2008 07 19</em> – the year, month, and day. <em class="italic">23:39:57</em> is the time in hours, minutes, and seconds (GMT) when the email touched the first server.</p>
    <p class="normal">We can see the first <strong class="keyWord">Received</strong> line from the bottom to the top. This email transverses three different email servers. As the email crosses a server on its journey to its destination, each email server will attach a <strong class="keyWord">Received</strong> line on top of the preceding <strong class="keyWord">Received</strong> line. You can follow the email path from source to destination. In the email, we are examining the first server the email touched, which is as follows:</p>
    <pre class="programlisting code"><code class="hljs-code">Received: by xy.dreamhostps.com (Postfix, from userid 558838) id 64C683B1DAE; Sat, 19 Jul 2008 16:39:57 -0700 (PDT)
</code></pre>
    <p class="normal">This is the first server the email touched; we have the domain name <code class="inlineCode">dreamhostps.com</code> and a user ID. The next logical step would be to subpoena the ISP and identify the subscriber with user ID <code class="inlineCode">558838</code>. Finally, the term <code class="inlineCode">Postfix</code> identifies the email server. Postfix is a free, open-source mail transfer agent and could be a commercial email server or an email server maintained by a potential bad actor.</p>
    <p class="normal">The following two <strong class="keyWord">Received</strong> lines <a id="_idIndexMarker757"/>identify the subsequent servers on the path to the destination:</p>
    <pre class="programlisting code"><code class="hljs-code">Received: from smarty.dreamhost.com (sd-green-bigip-81.dreamhost.com [208.97.132.81])
by spunkymail-mx8.g.dreamhost.com (Postfix) with ESMTP id E32634D80F for &lt;jean@m57.biz&gt;; 
Sat, 19 Jul 2008 16:39:57 -0700 (PDT)
Received: from xy.dreamhostps.com (apache2-xy.xy.dreamhostps.com [208.97.188.9]) 
by smarty.dreamhost.com (Postfix) with ESMTP id 6E408EE23D for &lt;jean@m57.biz&gt;; 
Sat, 19 Jul 2008 16:39:57 -0700 (PDT)
</code></pre>
    <p class="normal">In both cases, we now have the IP addresses of the specific servers (and server names) that touched the email.</p>
    <p class="normal">What’s interesting is when we look at the <code class="inlineCode">Return-Path</code> field:</p>
    <pre class="programlisting code"><code class="hljs-code">Return-Path: &lt;simsong@xy.dreamhostps.com&gt;
</code></pre>
    <p class="normal">The <code class="inlineCode">Return-Path</code> is the address where undeliverable messages will be sent. <code class="inlineCode">Return-Path</code> will also override the <code class="inlineCode">From</code> field that the user will see. You will see this being used in email mailing lists, where you can reply to the user of the post and not to the list.</p>
    <p class="normal">There are optional fields that you may come across in your investigations. These fields typically start with an <code class="inlineCode">X–</code>, as shown here:</p>
    <pre class="programlisting code"><code class="hljs-code">X-Priority: 3 
X-Mailer: PHPMailer 5.2.9 (https://github.com/PHPMailer/PHPMailer/)
Message-Id: ff176aaf06e2f6958ada6e2d3c43b095@x3.netcomlearning.com
X-Report-Abuse: Please forward a copy of this message, including all headers, to abuse@mandrill.com 
X-Report-Abuse: You can also report abuse here: http://mandrillapp.com/contact/abuse?id=30514476.1925a088d66f450cb25a4034f3ec6942 X-Mandrill-User: md_30514476
</code></pre>
    <p class="normal">These fields are not part of the email protocol standard. They can contain information about a virus scan, spam scans, or information about the server. As you can see, it provides information <a id="_idIndexMarker758"/>about contact information regarding abuse, such as spam. You may also see an optional field called <code class="inlineCode">X–Originating–IP</code> that may contain the sender’s IP address when the user sent the message. An email provider can strip that information and replace it with a server address, which happens when a message is sent from Gmail.</p>
    <p class="normal">A note about IP addresses: there are two different types of IPv4 addresses: public and private. You may see both in the email header. However, if you see a private IP address, you cannot identify the provider (unless you are investigating within the organization). Private IPv4 addresses run from the following addressing schemes:</p>
    <ul>
      <li class="bulletList">10.X.X.X</li>
      <li class="bulletList">127.X.X.X</li>
      <li class="bulletList">172.16.X.X</li>
      <li class="bulletList">192.168.X.X</li>
    </ul>
    <p class="normal">We will discuss email attachments in the next section.</p>
    <h2 id="_idParaDest-173" class="heading-2">Email attachments</h2>
    <p class="normal"><strong class="keyWord">MIME</strong> is the acronym for <strong class="keyWord">Multipurpose Internet Mail Extensions</strong>, the internet standard for allowing <a id="_idIndexMarker759"/>emails to accept text other than ASCII, binary <a id="_idIndexMarker760"/>attachments, multi-part message bodies, and non-ASCII base header information. When you are viewing the header, you will see MIME indicated with the following:</p>
    <pre class="programlisting code"><code class="hljs-code">MIME-Version: 1.0
</code></pre>
    <p class="normal">An example of this is as follows:</p>
    <pre class="programlisting code"><code class="hljs-code">MIME-Version: 1.0 
Content-Type: text/html; charset=us-ascii 
Content-Transfer-Encoding: 7bit
</code></pre>
    <p class="normal">Here, we can see the content type, HTML, and with the following line, we see it is using 7-bit coding. We would also see Base64 encoding if there were an attachment, which converts the binary data into ASCII text.</p>
    <p class="normal">The system will separate the body of the email based on the data type of each segment. For example, a JPEG image <a id="_idIndexMarker761"/>will accompany one segment and store ASCII text in a different segment. In addition, each segment will start with a MIME header that includes the keyword <code class="inlineCode">_PART_</code>.</p>
    <p class="normal">Now that we have discussed the email and header, we need to look at some of the clients the user may use to access the emails.</p>
    <h1 id="_idParaDest-174" class="heading-1">Understanding client-based email analysis</h1>
    <p class="normal">A user has access to many email clients to retrieve, read, and send emails. Depending on whether you’re in the consumer or commercial environment, you may encounter different email clients. In the consumer market, you will find that Microsoft Outlook/Outlook Express <a id="_idIndexMarker762"/>will prevail because it is preinstalled on the system. In addition, Microsoft Outlook comes with the Microsoft Office suite. There are also freeware options available such as the Thunderbird email client.</p>
    <p class="normal">You can conduct an email examination by exporting the container used by the client and opening it with the email client installed on your forensic computer. Another option is to utilize specialized commercial forensic software created for email examinations. The more common forensic suites will typically analyze the more common email client containers.</p>
    <p class="normal">We will discuss some more common email clients in the following sections.</p>
    <h2 id="_idParaDest-175" class="heading-2">Exploring Microsoft Outlook/Outlook Express</h2>
    <p class="normal">Outlook stores <a id="_idIndexMarker763"/>email information <a id="_idIndexMarker764"/>in several file types, such as <code class="inlineCode">pst</code>, <code class="inlineCode">.mdb</code>, and <code class="inlineCode">.ost</code>. We will find the PST file on the user’s hard disk at the following path:</p>
    <pre class="programlisting con"><code class="hljs-con">\Users\$USER$\AppData\Local\Microsoft\Outlook
</code></pre>
    <p class="normal">The OST file is an offline file that may also be stored on the user’s hard drive in the same path as the PST file. Finally, you will find the MDB file on the server. Typically, this file is found when you are investigating a corporate environment.</p>
    <p class="normal">The system will store all the content used with the Outlook client in the PST/OST file. Be aware that the user <a id="_idIndexMarker765"/>can change the <a id="_idIndexMarker766"/>default location and the naming convention. You do not need a login to access the PST/OST file.</p>
    <p class="normal">If you need to carve out a PST/OST file from the unallocated space of the storage device, you may have to deal with fragmentation because of the potential size of the PST/OST file.</p>
    <p class="normal">Microsoft has replaced Outlook Express with Windows Live. The following section will provide details about this client.</p>
    <h2 id="_idParaDest-176" class="heading-2">Exploring Microsoft Windows Live Mail</h2>
    <p class="normal">Starting with Windows Vista and Windows 7, Windows Live became the default email client shipping with the <a id="_idIndexMarker767"/>Windows operating <a id="_idIndexMarker768"/>system. (Note that it has been discontinued and that Windows Mail is now included with Windows 10 instead. Windows Mail will not store the emails on the disk, the emails will only be cloud based. ) The client stores email messages in the following path:</p>
    <pre class="programlisting con"><code class="hljs-con">\Users\$USER$\AppData\Local\Microsoft\Windows Live Mail
</code></pre>
    <p class="normal">Users can use this client to access their web-based emails as well. Windows Live Mail will download the contents of those accounts and then create the folder structure within the user’s path.</p>
    <p class="normal">The client will store the emails as an<code class="inlineCode">.eml</code> file in the Windows Live Mail folder, as shown here:</p>
    <figure class="mediaobject"><img src="img/B18329_08_04.png" alt="A picture containing text, receipt, screenshot  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 8.4: Windows Live Mail folder</p>
    <p class="normal">As you can see, this user was using Hotmail with the Windows Live Mail application. You can see the email <a id="_idIndexMarker769"/>address, <code class="inlineCode">little9@hotmail.com</code>, and <a id="_idIndexMarker770"/>see that 54 emails are being stored in the user’s folders.</p>
    <p class="normal">The emails are in the standard text format, <code class="inlineCode">.eml</code>, which can be read by any forensic tool. Alternatively, you can use a text editor. The next client is also popular and free: Mozilla Thunderbird.</p>
    <h2 id="_idParaDest-177" class="heading-2">Mozilla Thunderbird</h2>
    <p class="normal">Thunderbird is a free, open-source email client provided by Mozilla. Thunderbird will store emails <a id="_idIndexMarker771"/>within a <code class="inlineCode">.MBOX</code> file. The MBOX format is a <a id="_idIndexMarker772"/>generic term for a family of file formats used to store emails. It will keep all the emails from folder into a singular database file. By default, the examiner can find the MBOX file in the following path:</p>
    <pre class="programlisting con"><code class="hljs-con">$USERNAME$\AppData\Roaming\Thunderbird\Profiles
</code></pre>
    <p class="normal">The following is the folder structure you will see when Thunderbird is installed:</p>
    <figure class="mediaobject"><img src="img/B18329_08_05.png" alt=""/></figure>
    <p class="packt_figref">Figure 8.5: Thunderbird folder structure</p>
    <p class="normal">The profile name is created by Thunderbird. The release version of the software the user has installed can also <a id="_idIndexMarker773"/>be seen here. As we analyze the folder <a id="_idIndexMarker774"/>structure, we will see that it contains information about crashes and stores data in a minidump when a crash occurs. There may also be calendar data and mailboxes.</p>
    <p class="normal">Here, the user is using the IMAP protocol to access their Yahoo mail account, and there are 15 items stored within the folder.</p>
    <p class="normal">When we look in the folder, we will see the following files:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">Archive.msf</code></li>
      <li class="bulletList"><code class="inlineCode">Archives.msf</code></li>
      <li class="bulletList"><code class="inlineCode">Bulk Mail.msf</code></li>
      <li class="bulletList"><code class="inlineCode">Draft.msf</code></li>
      <li class="bulletList"><code class="inlineCode">Drafts.msf</code></li>
      <li class="bulletList"><code class="inlineCode">INBOX</code></li>
      <li class="bulletList"><code class="inlineCode">INBOX.msf</code></li>
      <li class="bulletList"><code class="inlineCode">msgFilterRules.dat</code></li>
      <li class="bulletList"><code class="inlineCode">Sent-1.msf</code></li>
      <li class="bulletList"><code class="inlineCode">Sent.msf</code></li>
      <li class="bulletList"><code class="inlineCode">Templates.msf</code></li>
      <li class="bulletList"><code class="inlineCode">Trash.msf</code></li>
    </ul>
    <p class="normal">The <strong class="keyWord">MSF</strong> files are <strong class="keyWord">Mail Summary files</strong>, one part of the email. The email client, Thunderbird, stores the <a id="_idIndexMarker775"/>email data in two different parts. The first <a id="_idIndexMarker776"/>part is the MBOX file, which does not have a file extension. The MSF files are the index files for Thunderbird and contain email headers and a summary. Thunderbird uses these files as an index to locate the email stored in the MBOX.</p>
    <p class="normal">In the following screenshot, three emails are being stored in the MBOX. When X-Ways parses out the inbox, the emails will have a <code class="inlineCode">.eml</code> file extension:</p>
    <figure class="mediaobject"><img src="img/B18329_08_06.png" alt="Figure 8.4: Thunderbird inbox "/></figure>
    <p class="packt_figref">Figure 8.6: Thunderbird inbox</p>
    <p class="normal">The MBOX format is used by many email clients, including Apple Mail, Opera Mail, and Thunderbird. In addition, most commercial and open-source forensic suites will process the MBOX and provide access to emails.</p>
    <p class="normal">While the user can access their email from a client, another popular option allows the user to access their email without using a client: WebMail.</p>
    <h1 id="_idParaDest-178" class="heading-1">Understanding WebMail analysis</h1>
    <p class="normal">Web-based email has become increasingly popular as we transition from the twentieth to the twenty-first <a id="_idIndexMarker777"/>century. It’s easy to access, requires little to no configuration from the user, and is available from any computer. In the simplest terms, WebMail is just another internet artifact for conducting browser analysis (we will cover internet artifacts in <em class="chapterRef">Chapter 9</em>, <em class="italic">Internet Artifacts</em>).</p>
    <p class="normal">The service provider maintains the user’s email and may provide additional services, such as address books and calendars. Users can use a host-based client to access web-based email. Still, I have found that those users are in the minority when content is hosted by the service provider, which provides additional obstacles to the digital forensic investigator. The only artifacts relating to the content may be in the user’s internet history, which <a id="_idIndexMarker778"/>may be fragmented. If a digital forensic investigator wants to access the content of a user’s web-based email, they will have to serve a search warrant (in the United States; your jurisdiction may have different requirements) on the service provider. You may be unable to access or recover any deleted emails from the account. It will depend on the specific set of circumstances for each service provider.</p>
    <p class="normal">Suppose the digital forensic investigator wants to investigate the user’s use of web-based email. In that case, they will have to analyze the temporary internet files or the internet <em class="italic">cache</em> on the user’s system. The temporary internet files/cache contains images, text, or any web page component the user has viewed in their browser.</p>
    <p class="normal">Their browser saves this information in the temporary internet <strong class="keyWord">files/cache</strong> location to enhance the user experience. It does this by having a faster response time when presenting pages to the user. Instead of continually redownloading the content, you can reach back into the cache and present that information to the user.</p>
    <p class="normal">Gmail is very popular, and when the service first deployed its web application, it changed how WebMail was presented to users. No longer were static web pages displaying the email content and the user’s email folders. Instead, Gmail dynamically created content on the fly for each user. The system no longer saved image files and text to the user’s local <a id="_idIndexMarker779"/>storage device; instead, Gmail used <strong class="keyWord">Asynchronous JavaScript</strong> (<strong class="keyWord">AJAX</strong>) and XML files. Unfortunately, this new method did not allow a web page to be rebuilt by investigators.</p>
    <p class="normal">You can still recover artifacts within the internet cache and other potential sources such as RAM or the pagefile on the user’s local storage device. You will need to conduct keyword searches for email addresses or keyword searches for terms related to your investigation.</p>
    <p class="normal">Before I look into the cache, I want to look into the internet history of the installed browser to see if the user has accessed web-based email. For the Chrome browser, you will find the history stored in a SQLite database named <code class="inlineCode">History</code> at the following path:</p>
    <pre class="programlisting con"><code class="hljs-con">$USER$\AppData\Local\Google\Chrome\User Data\Default
</code></pre>
    <p class="normal">The analysis of the <code class="inlineCode">History</code> database shows the user accessed the Gmail web-based service, as shown in the following screenshot:</p>
    <figure class="mediaobject"><img src="img/B18329_08_07.png" alt="Figure 8.5: Email – History "/></figure>
    <p class="packt_figref">Figure 8.7: Email – History</p>
    <p class="normal">We have a date/time stamp, along with the email address. The artifact also shows that the user had two unread <a id="_idIndexMarker780"/>emails in the inbox when accessing the service.</p>
    <p class="normal">I found this in the internet cache for the Google Chrome browser, which the examiner can find at the following location:</p>
    <pre class="programlisting con"><code class="hljs-con">$USER$\AppData\Local\Google\Chrome\User Data\Default\History Provider Cache
</code></pre>
    <p class="normal">As you can see in the following screenshot showing the Chrome cache, the content is not easily decipherable and does not give us a lot to follow up with:</p>
    <figure class="mediaobject"><img src="img/B18329_08_08.png" alt=""/></figure>
    <p class="packt_figref">Figure 8.8: Chrome cache displayed</p>
    <p class="normal">If we keep searching for the email address we found in the cache, <code class="inlineCode">badguyneedslove@gmail.com</code>, we may find other artifacts, such as the following:</p>
    <pre class="programlisting code"><code class="hljs-code">{"endpoint_info_list":[{"endpoint":"<strong class="hljs-slc">smtp:badguy27@yahoo.com</strong>",
"c_id":"d24c.2d00",
"c_name":"<strong class="hljs-slc">Joe Badguy Smith</strong>"},
{"endpoint":"<strong class="hljs-slc">smtp:badguyneedslove@gmail.com</strong>",
"c_id":"e80f.5b71","c_name":"<strong class="hljs-slc">John Badguy Smith</strong>"},
{"endpoint":"<strong class="hljs-slc">smtp:yahoo@mail.comms.yahoo.net</strong>",
"c_id":"624f.10f0","c_name":"<strong class="hljs-slc">Yahoo! In</strong><strong class="hljs-slc"/><strong class="hljs-slc"/><strong class="hljs-slc">c.</strong>"}]}
</code></pre>
    <p class="normal">This artifact, which the examiner can find within the cache, gives us another email address, <code class="inlineCode">badguy27@yahoo.com</code>, to follow up. Unfortunately, the content of the email remains out of reach.</p>
    <p class="normal">Let’s look at the Firefox <a id="_idIndexMarker781"/>cache and see whether it can give us a better look at the cache and history.</p>
    <p class="normal">The examiner can find the cache and history for the Firefox browser at the following location:</p>
    <pre class="programlisting con"><code class="hljs-con">$USERS$\AppData\Local\Mozilla\Firefox\Profiles\&lt;profile&gt;\cache2
</code></pre>
    <p class="normal">Firefox will store the internet history and cache in the user’s profile. The folder structure you will see may look like this:</p>
    <figure class="mediaobject"><img src="img/B18329_08_09.png" alt="Text  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 8.9: Firefox folder structure</p>
    <p class="normal">It looks like the visual depiction of the content of the Firefox cache is not much better:</p>
    <figure class="mediaobject"><img src="img/B18329_08_10.png" alt=""/></figure>
    <p class="packt_figref">Figure 8.10: Firefox Cache</p>
    <p class="normal">It does not provide a wealth of information, but it does supply breadcrumbs for us to follow up and conduct additional investigative efforts.</p>
    <p class="normal">In the world of forensics, the artifacts you rely upon can quickly change with new updates to the software <a id="_idIndexMarker782"/>or changes in the operating system. Be flexible with your investigative techniques so that you can jump into the latest technology to make your investigation successful. Once you have identified that the subject of your inquiry is using web-based email, your best course of action is to serve the service provider with the appropriate judicial paperwork to freeze the account and get the required content.</p>
    <h1 id="_idParaDest-179" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, we have gone over standard email protocols: the system uses SMTP to send emails, while POP and IMAP are used to receive emails. IMAP also includes features that the user can use to manage the inbox. We went over the email header and the components that make up the header. We also discussed WebMail and email clients.</p>
    <p class="normal">You now have the skills necessary to read an email header and determine the servers that the user used to transmit the email and what protocols the system used to send and receive the email. When conducting a digital forensic examination, you can now identify artifacts from typical email clients and web-based emails.</p>
    <p class="normal">In the next chapter, you will learn about the similarities between web-based email clients.</p>
    <h1 id="_idParaDest-180" class="heading-1">Questions</h1>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Which of the following is not an email protocol?<ol class="alphabeticList" style="list-style-type: lower-alpha;">
          <li class="alphabeticList" value="1">HTML</li>
          <li class="alphabeticList">POP</li>
          <li class="alphabeticList">SMTP</li>
          <li class="alphabeticList">IMAP</li>
        </ol>
      </li>
      <li class="numberedList">Which of the following allows the user to manage their inbox?<ol class="alphabeticList" style="list-style-type: lower-alpha;">
          <li class="alphabeticList" value="1">COC</li>
          <li class="alphabeticList">POP</li>
          <li class="alphabeticList">FreeBSD</li>
          <li class="alphabeticList">IMAP</li>
        </ol>
      </li>
      <li class="numberedList">The email header is created by user input information.<ol class="alphabeticList" style="list-style-type: lower-alpha;">
          <li class="alphabeticList" value="1">True</li>
          <li class="alphabeticList">False</li>
        </ol>
      </li>
      <li class="numberedList">Thunderbird stores emails in which file?<ol class="alphabeticList" style="list-style-type: lower-alpha;">
          <li class="alphabeticList" value="1">Inbox</li>
          <li class="alphabeticList">Outbox</li>
          <li class="alphabeticList">MBOX</li>
          <li class="alphabeticList">Letterbox</li>
        </ol>
      </li>
      <li class="numberedList">Which email client uses a PST file?<ol class="alphabeticList" style="list-style-type: lower-alpha;">
          <li class="alphabeticList" value="1">Thunderbird</li>
          <li class="alphabeticList">Gmail</li>
          <li class="alphabeticList">Yahoo Mail</li>
          <li class="alphabeticList">Outlook</li>
        </ol>
      </li>
      <li class="numberedList">Windows Live Mail was replaced with which client?<ol class="alphabeticList" style="list-style-type: lower-alpha;">
          <li class="alphabeticList" value="1">Outlook Express</li>
          <li class="alphabeticList">Outlook</li>
          <li class="alphabeticList">Windows Mail</li>
          <li class="alphabeticList">Windows Email</li>
        </ol>
      </li>
      <li class="numberedList">You will always find the content of a web-based email in the user’s cache.<ol class="alphabeticList" style="list-style-type: lower-alpha;">
          <li class="alphabeticList" value="1">True</li>
          <li class="alphabeticList">False</li>
        </ol>
      </li>
    </ol>
    <p class="normal">You will find the answers at the back of this book, under <em class="italic">Assessments</em>.</p>
    <h1 id="_idParaDest-181" class="heading-1">Further reading</h1>
    <ul>
      <li class="bulletList"><em class="italic">Jones, R. (2006). Internet forensics: Beijing: OReilly</em> (can be purchased at <a href="http://shop.oreilly.com/product/9780596100063.do">http://shop.oreilly.com/product/9780596100063.do</a>)</li>
    </ul>
    <h1 id="_idParaDest-182" class="heading-1">Exercise</h1>
    <h2 id="_idParaDest-183" class="heading-2">Data set</h2>
    <p class="normal"><code class="inlineCode">Jean outlook.pst</code></p>
    <h2 id="_idParaDest-184" class="heading-2">Software needed</h2>
    <p class="normal">Autopsy - <a href="https://www.autopsy.com/">https://www.autopsy.com/</a></p>
    <h2 id="_idParaDest-185" class="heading-2">Scenario</h2>
    <p class="normal">A company, XYZ LLC, finds that a spreadsheet containing confidential information was posted as an attachment in the “technical support” forum of a competitor’s website.</p>
    <p class="normal">The spreadsheet came from the CFO of XYZ LLC, Jean’s computer.</p>
    <h3 id="_idParaDest-186" class="heading-3">Interviews</h3>
    <p class="normal">You are tasked with investigating the leak of confidential information. To that end, you conduct interviews with the President and Chief Financial Officer of XYZ LLC, Alison and Jean respectively. Here are excerpts from their interviews:</p>
    <p class="normal">Alison (President):</p>
    <ul>
      <li class="bulletList">I don’t know what Jean is talking about.</li>
      <li class="bulletList">I never asked Jean for the spreadsheet.</li>
      <li class="bulletList">I never received the spreadsheet by email.</li>
    </ul>
    <p class="normal">Jean (CFO):</p>
    <ul>
      <li class="bulletList">Alison asked me to prepare the spreadsheet as part of a new funding round.</li>
      <li class="bulletList">Alison asked me to send the spreadsheet to her by email.</li>
      <li class="bulletList">That’s all I know.</li>
    </ul>
    <h2 id="_idParaDest-187" class="heading-2">Email accounts</h2>
    <p class="normal">Alison (President):</p>
    <p class="normal"><code class="inlineCode">alison@m57.biz</code> </p>
    <p class="normal">Jean (CFO):</p>
    <p class="normal"><code class="inlineCode">jean@m57.biz</code></p>
    <h2 id="_idParaDest-188" class="heading-2">Question to answer</h2>
    <p class="normal">Examining Jean’s email – How did the documents get on the competitor’s website? Use Autopsy (or your tool of choice) to analyze the emails contained in the <code class="inlineCode">.pst</code> file.</p>
    <h1 id="_idParaDest-189" class="heading-1">Join our community on Discord</h1>
    <p class="normal">Join our community’s Discord space for discussions with the author and other readers:</p>
    <p class="normal"><a href="https://packt.link/CyberSec">https://packt.link/CyberSec</a></p>
    <p class="normal"><img src="img/QR_Code38524672928771120931.png" alt=""/></p>
  </div>
</body></html>