<html><head></head><body><div><h1 class="header-title">Reversing Various File Types</h1>
                
            
            
                
<p>So far, we have been dealing with binary executables. In this chapter, we will also look at other ways in which code can be executed. Visiting websites (HTML) and receiving emails (that have documents attached to them) are some of the mediums where malware can easily enter a target system.</p>
<p>In this chapter, we will learn about the following topics:</p>
<ul>
<li>Debugging scripts in HTML</li>
<li>Understanding Macro in Office documents</li>
<li>Performing PDF analysis</li>
<li>SWF analysis</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Analysis of HTML scripts</h1>
                
            
            
                
<p>Almost every website we visit contains scripts. Most commonly, it contains JavaScript code that is triggered by clicking on the OK button on a website or by those artistic bubbles and stars that roam around with the mouse pointer. JavaScript is one of the most powerful tools that can be used by a site developer. It can be used to control elements that an internet browser contains. </p>
<p>Besides JavaScript, Visual Basic scripts (VBScripts) can also be embedded in HTML websites. However, VBScript has been disabled by default in recent web browsers. This is due to the fact that VBScript has been exposed to a lot of vulnerabilities in the past. In addition, JavaScript is the default language used by many internet browsers.</p>
<p>There are two sides for a website to work, that is, the server side and the client side. When visiting a website, we are looking at the client side page. All backend scripts are running at the server side. For example, when visiting a website, the server-side programs send the HTML contents, including text, scripts, images, Java applets, and flash files. Only the browser elements, like HTML, JavaScript, Java applets, and SWF flash, that can be supported by internet browsers, are the objects that are crafted and sent by server-side programs. In essence, what we can analyze are these browser elements.</p>
<p>Fortunately, scripts are readable text files. We can perform static analysis for HTML scripts. But like any other code, reversing requires that we have learn scripting language used.  The bottom line is, we need to learn the basics of the JavaScript programming language.</p>
<p>Let's try reversing a simple HTML file. You can download this HTML file from the following link: <a href="https://github.com/PacktPublishing/Mastering-Reverse-Engineering/blob/master/ch13/demo_01.html">https://github.com/PacktPublishing/Mastering-Reverse-Engineering/blob/master/ch13/demo_01.html</a>. </p>
<p>Only do this if you have time. When reversing a HTML file, it is recommended that you set it up to run as though it's being viewed in a website and not as an HTML file.</p>
<p>Using a text editor, such as Notepad, we can perform static analysis on the HTML file. Other text editors, such as Notepad++ (<a href="https://notepad-plus-plus.org/">https://notepad-plus-plus.org/</a>), would be better since it can show script syntax in color. This helps us to distinguish between the script functions from the data, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1200 image-border" src="img/8400c6b3-fd76-4107-a91f-f33dfac949d6.png" style="width:30.75em;height:19.17em;" width="518" height="323"/></p>
<p>To understand this code, a lot of references about HTML programming are available in the internet. One of these reference sites is <a href="https://www.w3schools.com/html/default.asp">https://www.w3schools.com/html/default.asp</a>. What we are after here are the scripts that are defined in the <kbd>script</kbd> tags. There are a total of three JavaScript script codes here. The first script contains the following code:</p>
<pre>alert("Hello reverser! --from a javascript code");</pre>
<p>The <kbd>alert</kbd> function is used to display a message box. The message should be enclosed with quotes.</p>
<p>The second script contains the following code:</p>
<pre>alert("1 + 2 is equal to");<br/>x = 1<br/>y = 2</pre>
<p>Again, the script displays a message, and then assigns the value <kbd>1</kbd> to variable <kbd>x</kbd> and the value <kbd>2</kbd> to variable <kbd>y</kbd>.</p>
<p>The last script contains the following code:</p>
<pre>alert("x + y");</pre>
<p>This shows another message. This time, the message is the sum of the <kbd>x</kbd> and <kbd>y</kbd> variables, which should give us the value of <kbd>3</kbd>. Even with the script code being located in separate tags, values in variables from the last running script should be reflected in succeeding scripts.</p>
<p>To prove this behavior, let's dynamically analyze the file by running it in an internet browser.</p>
<p>Open Internet Explorer. We can also use Firefox or Chrome. Drag and drop <kbd>demo_01.html</kbd> into Internet Explorer. This should show the following message box once it has loaded:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1201 image-border" src="img/793c08d8-e89c-4abb-91a3-32671a4d7e3a.png" style="width:22.50em;height:11.50em;" width="282" height="143"/></p>
<p>The message may not show up if the internet browser has disabled running JavaScript content. Usually, a security message appears, asking if we want to allow running script codes. Just allow the script to run:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1202 image-border" src="img/2c01113e-ec14-4a8a-8b92-e10c70d8bc02.png" style="width:49.50em;height:2.92em;" width="775" height="45"/></p>
<p>The following message boxes will come up afterwards:</p>
<p class="CDPAlignCenter CDPAlign">  <img class="alignnone size-full wp-image-1203 image-border" src="img/8310cfad-67c5-4555-b11d-139287e004a7.png" style="width:17.92em;height:7.92em;" width="374" height="165"/></p>
<p>Now that the page has completely been loaded, press <kbd>F12</kbd> to bring up the debugger console. Select the Debugger pane. This should show the HTML script, as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1204 image-border" src="img/c22f722f-bf35-4c83-b266-aa8db26d201c.png" style="width:20.83em;height:30.75em;" width="396" height="584"/></p>
<p>In the debugger, place a breakpoint at line <kbd>3</kbd>, which is the first <kbd>alert</kbd> function. To place a breakpoint, click on the empty gray space at the left of the line number. This should create a red dot that indicates a breakpoint line. The following screenshot shows all three scripts with their first lines marked with a breakpoint:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1205 image-border" src="img/5165e4c7-5bb2-4907-bdfe-0ead3e9ab6f3.png" style="width:42.83em;height:18.67em;" width="822" height="357"/></p>
<p>Refresh the browser by focusing on the internet browser's page and pressing F5. We may end up debugging the <kbd>browsertools</kbd> script, which is an Internet Explorer initialization script. This is shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1206 image-border" src="img/3c29d19e-0d88-4e81-8c0b-5e72700da6e6.png" style="width:46.50em;height:23.58em;" width="981" height="497"/></p>
<p>Just press <em>F5</em> again to make the debugger continue until we reach our breakpoint. We should now be at the first <kbd>alert</kbd> function, as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1207 image-border" src="img/68b3b5b9-724f-4ab6-a047-9a324813aea8.png" style="width:28.58em;height:7.75em;" width="588" height="159"/></p>
<p>We can press <em>F11</em> to step into or F10 to Step over the script line. Doing so should invoke the first message box. Continue pressing <em>F10</em> to move on to the following script lines. The next script is another <kbd>alert</kbd> function:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1208 image-border" src="img/391d2290-1b37-4cdc-9c1f-95d7208c7c17.png" style="width:25.00em;height:13.00em;" width="586" height="304"/></p>
<p>The following lines assign <kbd>1</kbd> to <kbd>x</kbd> and <kbd>2</kbd> to <kbd>y</kbd>. We can monitor what happens to these variables by adding these in the watch list, which is located in the right-hand pane. Click on Add watch to add the variables that we can monitor:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1209 image-border" src="img/9959902b-a48d-4e00-b606-ecd5e7ed87df.png" style="width:44.67em;height:16.08em;" width="982" height="354"/></p>
<p>The last function is another <kbd>alert</kbd> function that displays the sum of <kbd>x</kbd> and <kbd>y</kbd>.</p>
<p>Let's try this with <kbd>demo_02.html</kbd> (<a href="https://github.com/PacktPublishing/Mastering-Reverse-Engineering/blob/master/ch13/demo_02.html">https://github.com/PacktPublishing/Mastering-Reverse-Engineering/blob/master/ch13/demo_02.html</a>).</p>
<p>If we debug this, it performs the same behavior that we encountered in <kbd>demo_01.html</kbd>. The difference is that it looks obfuscated when we look at it from the text editor:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1210 image-border" src="img/e1c8ec6c-635c-48b7-8e67-e685e9dceac2.png" style="width:25.83em;height:13.25em;" width="743" height="380"/></p>
<p>The message was converted to escaped format using each ASCII character's hexadecimal equivalent. In the previous chapter, we learned about <kbd>Cyberchef</kbd>, an online tool that we can use to de-obfuscate these types of data. Since this type of data is escaped, we should use an <kbd>unescape</kbd> operation to decode this data. Using <kbd>Cyberchef</kbd>, search for the <kbd>unescape</kbd> operation, and then copy and paste the escaped data in the Input window. We should get a decoded output showing the exact text we saw in the messages, like so:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1211 image-border" src="img/427c1c5d-1384-4fff-b2ed-5268018b0e84.png" style="width:29.75em;height:20.25em;" width="874" height="593"/></p>
<p>Analyzing HTML scripts is not that complicated, especially since everything is almost human readable. All we need to understand is the syntax and the functions of the script language. Plus, this a way to dynamically analyze the script using debugging tools that are fortunately available in internet browsers.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">MS Office macro analysis</h1>
                
            
            
                
<p>Microsoft Office has a way for automating simple tasks such as creating formatted tables or inserting letterheads. This is called an MS office macro. MS Office macro makes use of the Visual Basic for Application language, which uses the same language as Visual Basic scripts. However, these can be abused to do more like download a file, create files, make registry entries, and even delete files. </p>
<p>First off, we need static tools to read information and extract the macro source from a given Office file. To open MS Office documents, we need to have Microsoft Office installed. The other tool that we could use would be OLE tools, which can be downloaded from <a href="http://www.decalage.info/en/python/oletools">http://www.decalage.info/en/python/oletools</a>. These set of tools are Python scripts, and will require Python 2.7 to be installed on your system. The Python installer can be downloaded from <a href="https://www.python.org/">https://www.python.org/</a>.</p>
<p>The file we are going to analyze first is <a href="https://github.com/PacktPublishing/Mastering-Reverse-Engineering/blob/master/ch13/demo_01.doc">https://github.com/PacktPublishing/Mastering-Reverse-Engineering/blob/master/ch13/demo_01.doc</a>. Type in the following  code into the command line to use <kbd>olevba.py</kbd> on <kbd>demo_01.doc</kbd>:</p>
<pre>python olevba.py demo_01.doc</pre>
<p>This extracts information about the <kbd>VBA</kbd> source and the source itself:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1212 image-border" src="img/e8f7fba1-084f-4650-923a-565855c198cf.png" style="width:28.58em;height:17.75em;" width="641" height="397"/></p>
<p>We can see from the preceding screenshot that the source has two subroutines: <kbd>autoopen()</kbd> and <kbd>autoclose()</kbd>. <kbd>olevba.py</kbd> also describes these subroutines that are tied to events when the document is opened and closed.</p>
<p>The source contains code that pops up messages. Now, let's try to open the document in Microsoft Word. By doing this, we may end up with Microsoft Word showing us a security warning about the document containing code. Click on Enable Content so that we can see what the macro can do:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1213 image-border" src="img/eca37d63-1544-442d-80d5-13d76219cd24.png" style="width:38.08em;height:7.83em;" width="931" height="192"/></p>
<p>The first message immediately appears:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1214 image-border" src="img/c20cef93-1c9d-4f27-940c-19e1e85ac011.png" style="width:6.00em;height:6.00em;" width="122" height="121"/></p>
<p>To debug the code, we need to open up the VBA editor. Select View-&gt;Macro. This opens up the Macro dialog box where you can select any Macro name and click on the Edit button:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1215 image-border" src="img/d85e2ad7-900b-4e53-b78a-3e92bad59322.png" style="width:36.42em;height:20.33em;" width="987" height="549"/></p>
<p>We are currently using Microsoft Office 2013, so the user interface for the <kbd>VBA</kbd> Editor may be different for other versions. In the <kbd>VBA</kbd> Editor, we should now see the source code. Pressing <em>F9</em> on a line of code enables or disables a breakpoint. Pressing <em>F8</em> does step debugging. <em>F5</em> is for continuing to run the code. We can start debugging from any of the subroutines. Select the Debug menu to view more debug features that are available:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1216 image-border" src="img/cad95591-5ef9-4628-964f-cbb259c98d68.png" style="width:39.50em;height:23.33em;" width="604" height="357"/></p>
<p>Closing the document will bring up the following message box:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1217 image-border" src="img/088493d9-c2d0-422b-b0ec-7660b8ee92e7.png" style="width:10.25em;height:10.42em;" width="123" height="125"/></p>
<p>Now, try analyzing demo_02.doc. This will be quite a challenge since we will be looking at how the password can be derived.</p>
<p>Remember that the VBA Editor is the macro developer's console. This is where the macro program was developed and debugged. Thus, to reverse what we are looking for, we can manipulate the source code. </p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1218 image-border" src="img/fc26f00b-9f29-4ca6-aba5-8454c007590d.png" style="width:43.42em;height:45.92em;" width="591" height="624"/></p>
<p>The password for <kbd>demo_02.doc</kbd> can be found in the Summary section of this chapter.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">PDF file analysis</h1>
                
            
            
                
<p>PDF files have evolved to run specific actions and allow for the execution of JavaScript. For PDF analysis, what we can do is extract event information and analyze what the JavaScript will do. We can use Didier Stevens' PDF Tools to help us analyze PDFs. This toolset runs using Python, so we will again need that installed. PDF Tools can be downloaded from <a href="https://blog.didierstevens.com/programs/pdf-tools/">https://blog.didierstevens.com/programs/pdf-tools/</a>. If you go to the site, you will get a description about each tool in the package.</p>
<p>Let's try using the tool with <a href="https://github.com/PacktPublishing/Mastering-Reverse-Engineering/blob/master/ch13/demo_01.pdf">https://github.com/PacktPublishing/Mastering-Reverse-Engineering/blob/master/ch13/demo_01.pdf</a>. Using <kbd>pdfid.py</kbd>, execute the following line:</p>
<pre>python pdfid.py demo_01.pdf</pre>
<p>The following screenshot shows the result of <kbd>pdfid</kbd> on <kbd>demo_01.pdf</kbd>:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1219 image-border" src="img/c87e5f46-607d-49a1-8c1e-4b249d4e3866.png" style="width:16.00em;height:23.42em;" width="204" height="294"/></p>
<p>Here, we can see that there is JavaScript code embedded to it. Let's now try the <kbd>pdf-parser.py</kbd> file so that we can extract more information. Some elements in the PDF file can be compressed and will not be readable. The <kbd>pdf-parser</kbd> tool is able to decompress these streams. Execute the following command to redirect output from <kbd>pdf-parser</kbd> to <kbd>demo_01.log</kbd>:</p>
<pre>python pdf-parser.py demo_01.pdf &gt; demo_01.log</pre>
<p class="mce-root">The output given by <kbd>pdf-parser</kbd> is basically the same as the contents of <kbd>demo_01.pdf</kbd>. The reason for this is that there were no PDF objects that got decompressed. If we look closer at the output, we can easily identify where the script code is:</p>
<pre>  &lt;&lt;<br/>    /JS (app.alert({cMsg: "Reversing is fun!", cTitle: "Mastering Reverse Engineering"})<br/>    ; )<br/>    /S /JavaScript<br/>  &gt;&gt;</pre>
<p>As a result, using Chrome as our PDF reader, the PDF displays the following message box:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1220 image-border" src="img/e2713b44-0860-43f7-a0ca-b299af647cab.png" style="width:39.75em;height:23.75em;" width="700" height="417"/></p>
<p class="mce-root">To debug the JavaScript, we would need to copy this into a separate JavaScript or HTML file. We may also need to fix the syntax of running JavaScript operators. The JavaScript code from the PDF can be converted into the following HTML code:</p>
<pre>&lt;html&gt;<br/>&lt;script&gt;<br/>    alert("Reversing is fun!", "Mastering Reverse Engineering");<br/>&lt;/script&gt;<br/>&lt;/html&gt;</pre>


            

            
        
    </div>



  
<div><h1 class="header-title">SWF file analysis</h1>
                
            
            
                
<p>ShockWave Flash files can also contain code. Basically, flash files are legitimately written to follow a sequence of tasks. But just like any other code, it can be abused to carry out malicious activities.</p>
<p>The SWF file we are going to analyze can be downloaded from <a href="https://github.com/PacktPublishing/Mastering-Reverse-Engineering/blob/master/ch13/demo01.swf">https://github.com/PacktPublishing/Mastering-Reverse-Engineering/blob/master/ch13/demo01.swf</a>.  </p>
<p>The main tool used for analyzing SWF at the time of writing this book is the JPEXS SWF decompiler.  Besides this let's first talk about other existing tools that are able to parse SWF files.  These tools are as follows:</p>
<ul>
<li>SWFTools</li>
<li>FLASM</li>
<li>Flare</li>
<li>XXXSWF</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">SWFTools</h1>
                
            
            
                
<p>SWFTools is a collection of tools for reading and building SWF files.  It can be downloaded from <a href="http://www.swftools.org/">http://www.swftools.org/</a>. To successfully install SWFTools, it should be run as administrator. The tools are used at the command line. There are two tools here that can extract information about the SWF file: <kbd>swfdump</kbd> and <kbd>swfextract</kbd>. Here's what <kbd>swfdump</kbd> gives us:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1305 image-border" src="img/67706c17-1b0a-4a38-a6d5-68e4716bf44b.png" style="width:34.00em;height:19.50em;" width="592" height="339"/></p>
<p>The result tells us that the file is <kbd>zlib</kbd> compressed.  There is also a <kbd>DOABC</kbd> method labeled <kbd>Main</kbd>. The existence of a <kbd>DOABC</kbd> also means that there is an embedded action script. Using <kbd>HxD</kbd>, we can verify that the file is compressed. The magic header <kbd>CWS</kbd> indicates that the <kbd>SWF</kbd> is indeed compressed. An uncompressed <kbd>SWF</kbd> starts with <kbd>FWS</kbd> magic bytes:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1304 image-border" src="img/eaea745b-640e-4cec-98ce-e6b19cfd6033.png" style="width:50.75em;height:27.92em;" width="907" height="499"/></p>
<p>The other tool, <kbd>swfextract</kbd>, is capable of extracting embedded videos or images. <kbd>demo01.swf</kbd> doesn't contain any media, as we can see from the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1303 image-border" src="img/2aac9f59-b840-4499-a305-bcac91fd6b3c.png" style="width:44.25em;height:4.08em;" width="597" height="55"/></p>
<p>The other tools in <kbd>SWFTools</kbd> are used to build <kbd>SWFs</kbd> from PDFs, images, and videos.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">FLASM</h1>
                
            
            
                
<p><kbd>FLASM</kbd> is a tool that is capable of decompressing and disassembling <kbd>SWF</kbd> files. It can be downloaded from <a href="http://nowrap.de/flasm.html">http://nowrap.de/flasm.html</a>. We decompressed <kbd>demo01.swf</kbd> using the <kbd>-x</kbd> parameter and got the following output:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1302 image-border" src="img/68e3cd0e-2589-4d96-9fa3-78d09ef14c9d.png" style="width:39.33em;height:3.08em;" width="472" height="37"/></p>
<p>After that, we used the <kbd>-d</kbd> parameter to disassemble the file where it showed information about how the <kbd>SWF</kbd> was structured:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1301 image-border" src="img/be362add-3b05-4592-ae32-06118d496de1.png" style="width:80.42em;height:27.58em;" width="965" height="331"/></p>
<p>We can't see any disassembled nor decompiled action scripts here.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Flare</h1>
                
            
            
                
<p>This is a tool that is capable of decompiling ActionScript code. It can be downloaded from <a href="http://nowrap.de/flare.html">http://nowrap.de/flare.html</a>. However, it may not be able to fully support <kbd>AS2</kbd> and <kbd>AS3</kbd> code. Just pass the <kbd>SWF</kbd> file to the Flare tool and it will generate an <kbd>FLR</kbd> file. We can executed Flare using the following command:</p>
<pre>flare.exe demo01.swf</pre>
<p>The result placed in <kbd>demo01.flr</kbd> contained the following output:</p>
<pre>movie 'demo01.swf' {<br/>// flash 32, total frames: 1, frame rate: 30 fps, 800x600 px, compressed, network access alowed<br/><br/>  metadata &lt;rdf:RDF xmlns:rdf=\'http://www.w3.org/1999/02/22-rdf-syntax-ns#\'&gt;&lt;rdf:Description rdf:about=\'\' xmlns:dc=\'http://purl.org/dc/elements/1.1\'&gt;&lt;dc:format&gt;application/x-shockwave-flash&lt;/dc:format&gt;&lt;dc:title&gt;Adobe Flex 4 Application&lt;/dc:title&gt;&lt;dc:description&gt;http://www.adobe.com/products/flex&lt;/dc:description&gt;&lt;dc:publisher&gt;unknown&lt;/dc:publisher&gt;&lt;dc:creator&gt;unknown&lt;/dc:creator&gt;&lt;dc:language&gt;EN&lt;/dc:language&gt;&lt;dc:date&gt;Oct 29, 2018&lt;/dc:date&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;<br/>  <br/>  // unknown tag 82 length 706<br/>  <br/>  // unknown tag 76 length 9<br/>}</pre>
<p>It had the same result as <kbd>FLASM</kbd>. No action scripts were disassembled.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">XXXSWF</h1>
                
            
            
                
<p>This tool can be downloaded from <a href="https://github.com/viper-framework/xxxswf">https://github.com/viper-framework/xxxswf</a>. It is a Python script that accepts the following parameters:</p>
<pre>Usage: xxxswf.py [options] &lt;file.bad&gt;<br/><br/>Options:<br/>  -h, --help show this help message and exit<br/>  -x, --extract Extracts the embedded SWF(s), names it MD5HASH.swf &amp;<br/>                        saves it in the working dir. No addition args needed<br/>  -y, --yara Scans the SWF(s) with yara. If the SWF(s) is<br/>                        compressed it will be deflated. No addition args<br/>                        needed<br/>  -s, --md5scan Scans the SWF(s) for MD5 signatures. Please see func<br/>                        checkMD5 to define hashes. No addition args needed<br/>  -H, --header Displays the SWFs file header. No addition args needed<br/>  -d, --decompress Deflates compressed SWFS(s)<br/>  -r PATH, --recdir=PATH<br/>                        Will scan a directory for files that contain SWFs.<br/>                        Must provide path in quotes<br/>  -c, --compress Compress SWF using Zlib<br/>  -z, --zcompress Compress SWF using LZMA</pre>
<p>We tried using this tool with <kbd>demo01.swf</kbd>. After using the <kbd>-H</kbd> paramater, the tool tells us that it is compressed. We then decompressed the file using the <kbd>-d</kbd> option. This resulted in a decompressed <kbd>SWF</kbd> version in the <kbd>243781cd4047e8774c8125072de4edb1.swf</kbd> file. Finally, we used the <kbd>-H</kbd> parameter on the decompressed file:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1300 image-border" src="img/eee59e0c-470b-4f4a-b0f5-631b81717f1d.png" style="width:54.83em;height:18.50em;" width="869" height="293"/></p>
<p>So far, what comes in useful for this without the <kbd>yara</kbd> and <kbd>md5</kbd> features is its ability to search for embedded flash files. This comes in useful for detecting <kbd>SWF</kbd> malware with embedded SWFs in it.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">JPEXS SWF decompiler </h1>
                
            
            
                
<p>One of the most used tool for analyzing SWF files is the <kbd>JPEXS</kbd> SWF decompiler. Nightly builds can be downloaded from <a href="https://github.com/jindrapetrik/jpexs-decompiler">https://github.com/jindrapetrik/jpexs-decompiler</a>. This tool is capable of decompiling <kbd>ActionScript</kbd> that supports <kbd>AS3</kbd>. The following screenshot shows the <kbd>JPEXS</kbd> console:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1299 image-border" src="img/ce6cadd1-2d9e-49ad-82d9-c2264f2e853c.png" style="width:34.75em;height:23.00em;" width="771" height="510"/></p>
<p>Besides being able to decompile, it has an interface that can be set up with Adobe Flash Player's debugger. After installing JPEXS, we need to download the <em>flash player projector content debugger </em>from <a href="https://www.adobe.com/support/flashplayer/debug_downloads.html">https://www.adobe.com/support/flashplayer/debug_downloads.html</a>.</p>
<p>Open JPEXS and then select Settings-&gt;Advanced Settings-&gt;Paths. Then, browse to the downloaded flash executable to fill up the Flash Player projector content debugger path.  Click OK when you're done:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1298 image-border" src="img/b430a73c-86f5-4389-b7dd-46c2fb6b552b.png" style="width:44.58em;height:17.25em;" width="800" height="309"/></p>
<p>This is an important setup that enables us to debug the decompiled ActionCcript. You can also fill up the Flash Player projector path by downloading the Flash Player projector from <a href="https://www.adobe.com/support/flashplayer/debug_downloads.html">https://www.adobe.com/support/flashplayer/debug_downloads.html</a>.</p>
<p>Open the SWF file and expand the tree of objects in the left window pane. Select Main under the <kbd>scripts</kbd> object. This displays the decompiled ActionScript, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1297 image-border" src="img/22c8ac6e-ac53-4d89-b5ca-2f321afa9799.png" style="width:57.17em;height:33.00em;" width="1101" height="634"/></p>
<p>And here is the decompiled code for <kbd>demo01.swf</kbd>:</p>
<pre>package<br/>{<br/>   import flash.display.Sprite;<br/>   import flash.text.TextField;<br/>   <br/>   public class Main extends Sprite<br/>   {<br/>       <br/>      <br/>      public function Main()<br/>      {<br/>         super();<br/>         trace("Hello World!");<br/>         var myText:TextField = new TextField();<br/>         myText.text = "Ahoy there!";<br/>         myText.textColor = 16711680;<br/>         myText.width = 100;<br/>         myText.height = 100;<br/>         addChild(myText);<br/>         var myText2:TextField = new TextField();<br/>         myText2.text = "Reversing is fun!\n--b0yb4w4n9";<br/>         myText.y = 100;<br/>         addChild(myText2);<br/>      }<br/>   }<br/>}</pre>
<p>Click the Debug button or <em>Ctrl+F5,</em> this<em> </em>should bring us to the debugger console. In the left-most window, the byte-code equivalent of the decompiled Actionscript is shown.</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1296 image-border" src="img/9ba58b85-ce3b-4411-b394-3025784551a9.png" style="width:76.17em;height:53.42em;" width="1000" height="700"/></p>
<p>What the code does is create two TextFields containing text that gets displayed on the SWF display space.</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1295 image-border" src="img/e783e061-46b4-4077-9b5c-6cc63af70c56.png" style="width:7.67em;height:10.92em;" width="133" height="189"/></p>
<p>JPEXS is a tool that has the important feature we want to analyze code in a flash file.  It has a byte-code disassembler, source decompiler, and a debugger.  </p>


            

            
        
    </div>



  
<div><h1 class="header-title">Summary</h1>
                
            
            
                
<p>Analyzing various file types also uses the same concept as reversing. In this chapter, we learned about the scripting language that the file format is using. We could gather additional information if we were also inclined to understand the file's header and structure. We also learned that as long as executable code can be embedded into a file, there is a way to analyze it. It may not be dynamically analyzed easily, but at least static analysis can be performed.</p>
<p>We tackled how to debug JavaScript that is embedded in HTML scripts. Virtually, we can analyze any website we visit. We also learned about the tools that we can use to extract macro code in Microsoft Office documents. It also happens that we can debug this macro code using the VBA Editor. We also looked at a variety of tools that we can use to extract JavaScript from a PDF file. Then we analyzed an SWF file using JPEXS, a powerful tool that has a disassembler, decompiler, and debugger. </p>
<p>Reversing engineering software is a concept at hand. We research what the software is and how it works. We also get to learn the low-level language beneath the code that executes in the file. It may take time to learn this language, but it is worth the knowledge and experience that we gain from it.</p>
<p>Have a fun day reversing!</p>
<p>P.S.  The password for <kbd>demo_02.doc</kbd> is burgersteak.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Further reading</h1>
                
            
            
                
<p><a href="https://www.w3schools.com/html/default.asp">https://www.w3schools.com/html/default.asp</a> : a good tutorial site for learning HTML scripting</p>
<p><a href="http://www.javascriptobfuscator.com">http://www.javascriptobfuscator.com</a> <a href="http://www.javascriptobfuscator.com">-</a> this is an online site that can obfuscate javascript code</p>


            

            
        
    </div>



  </body></html>