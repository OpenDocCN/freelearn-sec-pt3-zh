<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Evidence Acquisition and Analysis from iCloud"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Evidence Acquisition and Analysis from iCloud</h1></div></div></div><p>The goal of this chapter is to introduce the cloud system provided by Apple to all its users through which they can save the backups of their devices and other files on remote servers. In the first part of the chapter, we will show you the main characteristics of this service, and then the techniques to create and recover a backup and other files from iCloud.</p><div class="section" title="The iCloud service"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec42"/>The iCloud service</h1></div></div></div><p>iCloud is a cloud storage and cloud computing service designed by Apple and offered to iOS users since iOS 5. The iCloud service was announced on June 6, 2011 during the Apple Worldwide Developers Conference, and became available to the public from October 12, 2011. In February 2016, iCloud had more than 780 million users. The service allows users to store data on iCloud Drive, share photos and videos between various devices and people, perform geolocation for their Apple device with Find My iPhone, and save personal passwords with iCloud Keychain on remote servers. The iCloud Drive storage space can also be used by individual applications to store information and specific backup data; for example, WhatsApp, at the time of the first configuration or following a version upgrade, asks the user whether they wants to use iCloud to store backups of conversations and WhatsApp media files, and if so, how often (daily, weekly, or monthly). iCloud also allows users to synchronize data between devices (e-mail, contacts, calendars, bookmarks, notes, reminders, iWork documents, and so on) or to make a backup of an iOS device (iPhone, iPad, or iPod touch) on remote servers rather than using iTunes and your local computer. The data uploaded to iCloud can also be shared with Apple computers running Mac OS X (native support) or a personal computer running Windows Vista or later, by installing the iCloud Control Panel software, which can be downloaded for free from the Apple website.</p><p>Each iCloud account has 5 GB of free storage. Purchases made through iTunes (music, apps, videos, movies, and so on) are not calculated in the count of the occupied space and can be stored in iCloud and downloaded on all devices associated with the Apple ID of the user. Moreover, the user has the option to purchase additional storage in denominations of 50 GB ($0.99 a month), 200 GB ($2.99 a month), or 1,000 GB ($9.99 a month).</p></div></div>
<div class="section" title="iDevice backup on iCloud"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec43"/>iDevice backup on iCloud</h1></div></div></div><p>iCloud allows users to make online backups of iDevices so that they will be able to restore their data even on a different iDevice (for example, in case of replacement of devices). The choice of which backup mode to use can be done directly in the settings of the device or through iTunes when the device is connected to the PC or Mac, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/B05100_05_01.jpg" alt="iDevice backup on iCloud"/></div><p>Once the user has activated the service, the device automatically backs up, at least once a day, and each time all the following conditions are met:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It is connected to the power cable</li><li class="listitem" style="list-style-type: disc">It is connected to a Wi-Fi network</li><li class="listitem" style="list-style-type: disc">The screen is locked</li><li class="listitem" style="list-style-type: disc">Enough space on iCloud is available</li></ul></div><p>iCloud online backups are incremental through subsequent snapshots, and each snapshot is the current status of the device at the time of its creation. The structure of the backup stored on iCloud is entirely analogous to that of the backup made with iTunes.</p></div>
<div class="section" title="iDevice backup acquisition"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec44"/>iDevice backup acquisition</h1></div></div></div><p>Backups that are made online are, to all intents and purposes, not encrypted. Technically, they are encrypted, but the encryption key is stored with the encrypted files. Apple made this choice in order for users to be able to restore the backup on a different device from the one that created it. Currently, the acquisition of iCloud backup is supported by various commercial software (<span class="strong"><strong>Elcomsoft Phone Breaker</strong></span> (<span class="strong"><strong>EPPB</strong></span>), Passware, Oxygen Forensics Detective, Cellebrite Cloud Analyzer, iPhone Backup Extractor, and Wondershare Dr.Fone) and two open source tools (iLoot, which is available at <a class="ulink" href="https://github.com/hackappcom/iloot">https://github.com/hackappcom/iloot</a> and works up to iOS 8 and InflatableDonkey, which is available at <a class="ulink" href="https://github.com/horrorho/InflatableDonkey">https://github.com/horrorho/InflatableDonkey</a> and works with iOS 9). The interesting aspect is that this same technique was used in the iCloud hack performed in 2014, when personal photos and videos were hacked from the respective iCloud services and released over the Internet (more information is available at <a class="ulink" href="http://en.wikipedia.org/wiki/2014_celebrity_photo_hack">http://en.wikipedia.org/wiki/2014_celebrity_photo_hack</a>). Although there is no strong evidence yet that describes how the hack was made, it is believed that Apple's <span class="emphasis"><em>Find My iPhone</em></span> service was responsible for this and Apple did not implement any security measure to lock down the account after a particular number of wrong login attempts, which directly raises the possibility of exploitation (brute force, in this case). The tool used to brute force the iCloud password, named iBrute, is still available at <a class="ulink" href="https://github.com/hackappcom/ibrute">https://github.com/hackappcom/ibrute</a>, but it has not been working since January 2015. A new tool called iBrutr <a class="ulink" href="https://github.com/Pr0x13/iBrutr">https://github.com/Pr0x13/iBrutr</a>, which uses a different iCloud service vulnerability, was released in September 2015.</p><div class="section" title="Case study - iDevice backup acquisition and EPPB with username and password"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec37"/>Case study - iDevice backup acquisition and EPPB with username and password</h2></div></div></div><p>As reported on the software manufacturer's website, EPPB allows the acquisition of data stored on an online backup. Moreover, online backups can be acquired without having the original iOS device to hand. All that's needed to access online backups stored in the cloud service are the original user's credentials, including their Apple ID, accompanied with the corresponding password or an authentication token extracted from a computer (detailed later in this chapter).</p><p>iCloud login credentials can be retrieved as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using social engineering techniques</li><li class="listitem" style="list-style-type: disc">From a PC (or a Mac) on which they are stored</li><li class="listitem" style="list-style-type: disc">Using iTunes Password Decryptor (<a class="ulink" href="http://securityxploded.com/">http://securityxploded.com/</a>)</li><li class="listitem" style="list-style-type: disc">Using WebBrowserPassView (<a class="ulink" href="http://www.nirsoft.net/">http://www.nirsoft.net/</a>)</li><li class="listitem" style="list-style-type: disc">Directly from the device (iPhone/iPad/iPod touch) by extracting the credentials stored in the Keychain, as explained in <a class="link" href="ch04.html" title="Chapter 4. Evidence Acquisition and Analysis from iTunes Backup">Chapter 4</a>, <span class="emphasis"><em>Evidence Acquisition and Analysis from iTunes Backup</em></span></li></ul></div><p>Once the credentials have been extracted, the download of the backup is very simple. Follow the step-by-step instructions provided in the program by entering the username and password in the <span class="strong"><strong>Download backup from iCloud</strong></span> dialog box by navigating to <span class="strong"><strong>Tools</strong></span> | <span class="strong"><strong>Apple</strong></span> | <span class="strong"><strong>Download backup from iCloud</strong></span> | <span class="strong"><strong>Password</strong></span> and clicking on <span class="strong"><strong>Sign in</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/B05100_05_02.jpg" alt="Case study - iDevice backup acquisition and EPPB with username and password"/></div><p>At this point, the software displays a screen that shows all the backups present in the user account and allows you to download data, as shown here:</p><div class="mediaobject"><img src="graphics/B05100_05_03.jpg" alt="Case study - iDevice backup acquisition and EPPB with username and password"/></div><p>It is important to notice the possibility of using the following two options:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Restore original file names</strong></span>: If enabled, this option interprets the contents of the <code class="literal">Manifest.mbdb</code> file and rebuilds the backup with the same tree structure into domains and subdomains as described in <a class="link" href="ch04.html" title="Chapter 4. Evidence Acquisition and Analysis from iTunes Backup">Chapter 4</a>, <span class="emphasis"><em>Evidence Acquisition and Analysis from iTunes Backup</em></span>. If the investigator intends to carry out the analysis with traditional software for data extraction from backups, it is recommended that you disable this option, because if enabled, that software will no longer be able to parse the backup.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Download only specific data</strong></span>: This option is very useful when the investigator needs to download only some specific information. Currently, the software supports <span class="strong"><strong>Call history</strong></span>, <span class="strong"><strong>Messages</strong></span>, <span class="strong"><strong>Attachments</strong></span>, <span class="strong"><strong>Contacts</strong></span>, <span class="strong"><strong>Safari data</strong></span>, <span class="strong"><strong>Google data</strong></span>, <span class="strong"><strong>Calendar</strong></span>, <span class="strong"><strong>Notes</strong></span>, <span class="strong"><strong>Info &amp; Settings</strong></span>, <span class="strong"><strong>Camera Roll</strong></span>, <span class="strong"><strong>Social &amp; Communications</strong></span>, and so on. In this case, the <span class="strong"><strong>Restore original file names</strong></span> option is automatically activated and it cannot be disabled:<div class="mediaobject"><img src="graphics/B05100_05_04.jpg" alt="Case study - iDevice backup acquisition and EPPB with username and password"/></div></li></ul></div><p>Once you have chosen the destination folder for the download, the backup starts. The time required to download depends on the size of the storage space available to the user and the number of snapshots stored within that space:</p><div class="mediaobject"><img src="graphics/B05100_05_05.jpg" alt="Case study - iDevice backup acquisition and EPPB with username and password"/></div></div><div class="section" title="Case study - iDevice backup acquisition and EPPB with authentication token"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec38"/>Case study - iDevice backup acquisition and EPPB with authentication token</h2></div></div></div><p>The Forensic edition of Phone Breaker from Elcomsoft is a tool that gives a digital forensics examiner the power to obtain iCloud data without having the original Apple ID and password. This kind of access is made possible via the use of an authentication token extracted from the user's computer. These tokens can be obtained from any suspect's computer where iCloud Control Panel is installed. Tokens can be extracted from such computers both live while it's running and afterwards from its hard drive, by extracting specific files and folders.</p><p>In the first case, on a live system, the analyst needs to use a small executable file called <code class="literal">atex.exe</code> on the machine. The executable file can be launched from an external pen drive during a live forensics activity.</p><p>Open Command Prompt and launch the <code class="literal">atex -l</code> command to list all the local iCloud users as follows:</p><div class="mediaobject"><img src="graphics/B05100_05_06.jpg" alt="Case study - iDevice backup acquisition and EPPB with authentication token"/></div><p>Then, launch <code class="literal">atex.exe</code> again with the <code class="literal">--getToken</code> parameter and enter the username of the specific local Windows user (<code class="literal">-n username</code>) and the password for this user's Windows account (<code class="literal">-p password</code>):</p><div class="mediaobject"><img src="graphics/B05100_05_07.jpg" alt="Case study - iDevice backup acquisition and EPPB with authentication token"/></div><p>A file called <code class="literal">icloud_token_&lt;timestamp&gt;.txt</code> will be created in the folder from which <code class="literal">atex.exe</code> was launched. This file contains the Apple ID of the current iCloud Control Panel user and its authentication token:</p><div class="mediaobject"><img src="graphics/B05100_05_08.jpg" alt="Case study - iDevice backup acquisition and EPPB with authentication token"/></div><p>Now that the analyst has the authentication token, they can start the EPPB software, navigate to <span class="strong"><strong>Tools</strong></span> | <span class="strong"><strong>Apple</strong></span> | <span class="strong"><strong>Download backup from iCloud</strong></span> | <span class="strong"><strong>Token</strong></span>, copy and paste the token (be careful to copy the entire second row from the <code class="literal">.txt</code> file created by the <code class="literal">atex.exe</code> tool) into the software, and click on <span class="strong"><strong>Sign in</strong></span>, as shown in the following screenshot. At this point, the software shows the screen for downloading the iCloud backups stored within the iCloud space of the user, in a similar way as you provide a username and password:</p><div class="mediaobject"><img src="graphics/B05100_05_09.jpg" alt="Case study - iDevice backup acquisition and EPPB with authentication token"/></div><p>The procedure for the Mac OS X version is exactly the same. Just launch the <code class="literal">atex</code> Mac version from a shell and follow the steps as shown previously in the Windows environment:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">sudo atex -l</code>: This command is used to get the list of all iCloud users.</li><li class="listitem" style="list-style-type: disc"><code class="literal">sudo atex --getTokenOnline -u &lt;username&gt;</code>: This command is used to get the authentication token for a specific user. You will need to enter the user's system password when prompted.</li></ul></div><p>Tokens can also be extracted from a switched off computer, running either Mac OS X or MS Windows, where iCloud Control Panel is installed and configured.</p><p>In a MS Windows environment, in order to obtain the token, you need to extract the following file and folder (or its forensics image) from the computer:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">com.apple.AOSKit.plist</code> file, typically located in <code class="literal">\Users\&lt;username&gt;\AppData\Roaming\Apple Computer\Preferences\</code></li><li class="listitem" style="list-style-type: disc">The <code class="literal">\Users\&lt;username&gt;\AppData\Roaming\Microsoft\Protect\&lt;SID&gt;\</code> folder</li></ul></div><p>It is also necessary to know the account password for the local user on the target computer.</p><p>Once these files have been extracted, you can start the EPPB software and navigate to <span class="strong"><strong>Tools</strong></span> | <span class="strong"><strong>Apple</strong></span> | <span class="strong"><strong>Extract authentication token</strong></span>. The software prompts you to provide the <code class="literal">com.apple.AOSKit.plist</code> file and the local user password:</p><div class="mediaobject"><img src="graphics/B05100_05_10.jpg" alt="Case study - iDevice backup acquisition and EPPB with authentication token"/></div><p>The next step is you need to provide the path to the folder containing the user's master key:</p><div class="mediaobject"><img src="graphics/B05100_05_11.jpg" alt="Case study - iDevice backup acquisition and EPPB with authentication token"/></div><p>If the information provided is correct, the software will show the authentication token, allowing direct access to the download features of backup from iCloud and files from the iCloud Drive:</p><div class="mediaobject"><img src="graphics/B05100_05_12.jpg" alt="Case study - iDevice backup acquisition and EPPB with authentication token"/></div><p>In the Mac OS X environment, in order to obtain the token, you need to extract the following file and folder (or its forensics image) from the computer:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">login.keychain</code> file, stored by default in <code class="literal">/Users/&lt;username&gt;/Library/Keychains/</code></li><li class="listitem" style="list-style-type: disc">The folder containing the authentication token, stored by default in <code class="literal">/Users/&lt;username&gt;/Library/Application Support/iCloud/Accounts/</code></li></ul></div><p>It is also necessary to know the account password for the local user on the target computer.</p><p>Once these files have been extracted, you can start the EPPB software and navigate to <span class="strong"><strong>Tools</strong></span> | <span class="strong"><strong>Apple</strong></span> | <span class="strong"><strong>Extract authentication token</strong></span>. The software prompts you to provide the <code class="literal">login.keychain</code> file and the local user password:</p><div class="mediaobject"><img src="graphics/B05100_05_13.jpg" alt="Case study - iDevice backup acquisition and EPPB with authentication token"/></div><p>The next step you need is to provide the path to the folder containing the authentication token:</p><div class="mediaobject"><img src="graphics/B05100_05_14.jpg" alt="Case study - iDevice backup acquisition and EPPB with authentication token"/></div><p>By clicking on <span class="strong"><strong>Extract</strong></span>, the token is extracted in a <code class="literal">plist</code> file and can be used to access and backup files stored in iCloud.</p></div><div class="section" title="Case study - iDevice backup acquisition with iLoot"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec39"/>Case study - iDevice backup acquisition with iLoot</h2></div></div></div><p>The same activity can be performed using the open source tool called iLoot (available at <a class="ulink" href="https://github.com/hackappcom/iloot">https://github.com/hackappcom/iloot</a>), which works up to iOS 8. It requires Python and some dependencies. We suggest that you check out the website for the latest version and requirements.</p><p>By accessing the help (<code class="literal">iloot.py -h</code>), we can see the various available options. We can choose the output folder, if we want to download one specific snapshot, if we want the backup to be downloaded in the original iTunes format or with the domain-style folders, or if we want to download only specific information (for example, call history, SMS, photos, and so on) or only a specific domain, as shown here:</p><div class="mediaobject"><img src="graphics/B05100_05_15.jpg" alt="Case study - iDevice backup acquisition with iLoot"/></div><p>To download a backup, you only need to insert the account credentials, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/B05100_05_16.jpg" alt="Case study - iDevice backup acquisition with iLoot"/></div><p>At the end of the process, you will find the backup in the output folder (the default folder's name is <code class="literal">/output</code>).</p></div><div class="section" title="Case study - iDevice backup acquisition with InflatableDonkey"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec40"/>Case study - iDevice backup acquisition with InflatableDonkey</h2></div></div></div><p>The same activity on iOS 9 can be performed using an open source tool called InflatableDonkey (available at <a class="ulink" href="https://github.com/horrorho/InflatableDonkey">https://github.com/horrorho/InflatableDonkey</a>). It requires Java SDK and Maven. We suggest that you check out the website for the latest version and requirements.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>At the time of writing this book, the tool is still a PoC, so test it before using in real investigations.</p></div></div><p>By accessing the help (<code class="literal">java -jar InflatableDonkey.jar --help</code>), we can see the various available options. We can choose the device that we want to access and the specific backup snapshot we want to download, apply a file extension or domain-based filter, request the list of available devices and snapshots, and define the output folder, as shown here:</p><div class="mediaobject"><img src="graphics/B05100_05_17.jpg" alt="Case study - iDevice backup acquisition with InflatableDonkey"/></div><p>We can list the available devices and snapshots by providing the valid iCloud username and password, and the <code class="literal">--snapshots</code> option:</p><div class="mediaobject"><img src="graphics/B05100_05_18-1.jpg" alt="Case study - iDevice backup acquisition with InflatableDonkey"/></div><p>To download the backup, you need to insert the account credentials and eventually choose the specific device and snapshots. In the example shown in the following screenshot, the second snapshot from the available device has been requested:</p><div class="mediaobject"><img src="graphics/B05100_05_19-1.jpg" alt="Case study - iDevice backup acquisition with InflatableDonkey"/></div><p>At the end of the process, you will find the backup in the output folder (the default folder's name is <code class="literal">/testoutput</code>). It is important to highlight that it is not possible to download the backup in the original iTunes format, but only with the domain-style folders.</p></div><div class="section" title="Case study - WhatsApp backup acquisition with Elcomsoft Explorer for WhatsApp"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec41"/>Case study - WhatsApp backup acquisition with Elcomsoft Explorer for WhatsApp</h2></div></div></div><p>As already mentioned, the applications installed on your iOS device have the opportunity to backup their data to iCloud Drive. One of the applications that enables this feature is WhatsApp (navigate to <span class="strong"><strong>Settings</strong></span> | <span class="strong"><strong>Chats</strong></span> | <span class="strong"><strong>Chat Backup</strong></span> within the application menu). You can manually make the backup (<span class="strong"><strong>Back Up Now</strong></span>) or you can set the <span class="strong"><strong>Auto Backup</strong></span> feature on a <span class="strong"><strong>Daily</strong></span>, <span class="strong"><strong>Weekly</strong></span>, or <span class="strong"><strong>Monthly</strong></span> basis:</p><div class="mediaobject"><img src="graphics/B05100_05_20-1.jpg" alt="Case study - WhatsApp backup acquisition with Elcomsoft Explorer for WhatsApp"/></div><p>Elcomsoft Explorer for WhatsApp allows you to extract WhatsApp backup data stored within a backup on iCloud or iCloud Drive. Like the EPPB software, it can access the data on iCloud through the authentication credentials (username and password) or through an authentication token:</p><div class="mediaobject"><img src="graphics/B05100_05_21-1.jpg" alt="Case study - WhatsApp backup acquisition with Elcomsoft Explorer for WhatsApp"/></div><p>Once downloaded, the data can be viewed directly within the software divided by type, <span class="strong"><strong>Calls</strong></span>, <span class="strong"><strong>Contacts</strong></span>, <span class="strong"><strong>Media</strong></span>, and <span class="strong"><strong>Messages:</strong></span></p><div class="mediaobject"><img src="graphics/B05100_05_22-1.jpg" alt="Case study - WhatsApp backup acquisition with Elcomsoft Explorer for WhatsApp"/></div></div></div>
<div class="section" title="iCloud Control Panel artifacts on the computer"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec45"/>iCloud Control Panel artifacts on the computer</h1></div></div></div><p>The installation of iCloud Control Panel, other than allowing the recovery of the user's authentication token, as shown previously, leaves logs of interest within the disk of the computer.</p><p>On a Windows Vista/7/8 system, the logs of the connections to the iCloud service are stored in <code class="literal">C:\Users\&lt;username&gt;\AppData\Roaming\Apple Computer\Logs</code>. To locate the logs of interest, it is necessary to search logs related to the executable <code class="literal">iCloud.exe</code> file within the text file. The files are named according to a standard format that includes the date and time at which the service started (for example, <code class="literal">asl.113048_18Apr16.log</code>), thus letting the analyst create a timeline of iCloud usage.</p><p>The user information configured in the iCloud Control Panel software is stored in the <code class="literal">C:\Users\&lt;username&gt;\AppData\Roaming\Apple Computer\Preferences\ mobilemeaccounts.plist</code> file.</p><p>In particular, the following user information is there in the file:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AccountDSID</code>: This key denotes user identification</li><li class="listitem" style="list-style-type: disc"><code class="literal">AccountID</code>: This key denotes the iCloud account username</li><li class="listitem" style="list-style-type: disc"><code class="literal">DisplayName</code>: This key denotes the displayed name set by the account owner</li><li class="listitem" style="list-style-type: disc"><code class="literal">IsPaidAccount</code>: This key is set to <code class="literal">True</code> if the user has purchased additional services from Apple (more storage on iCloud)</li><li class="listitem" style="list-style-type: disc"><code class="literal">LoggedIn</code>: This key denotes whether the user is automatically logged in or not to the service<div class="mediaobject"><img src="graphics/B05100_05_23-1.jpg" alt="iCloud Control Panel artifacts on the computer"/></div></li></ul></div><p>On a Mac OS X system, the user information is stored instead in the <code class="literal">/Users/&lt;user&gt;/Library/Preferences/MobileMeAccounts.plist</code> file.</p><p>You will also find plenty of the <code class="literal">asl</code> logs (the Apple system logs), so, in order to check a user's iCloud activity, you will have to parse the following log files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/private/var/log/asl/YYYY.MM.DD.UID.asl</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">/private/var/log/system.log</code></li></ul></div><p>For a detailed analysis of iCloud artifacts on a Mac OS X computer we suggest you to read the presentation <span class="emphasis"><em>Ubiquity Forensics - Your iCloud and You</em></span> available at <a class="ulink" href="http://www.mac4n6.com/resources/">http://www.mac4n6.com/resources/</a>.</p></div>
<div class="section" title="Acquiring data from Cloud with stored tokens"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec46"/>Acquiring data from Cloud with stored tokens</h1></div></div></div><p>In <span class="emphasis"><em><a class="link" href="ch04.html" title="Chapter 4. Evidence Acquisition and Analysis from iTunes Backup">Chapter 4</a></em></span>, <span class="emphasis"><em>Evidence Acquisition and Analysis from iTunes Backup</em></span>, we saw how an encrypted backup contains an application's login credentials stored in the Keychain. Depending on the application, it is possible to directly find the password, as in the case of the native mail, or an authentication token, as in the case of many third-party applications such as Facebook and Twitter.</p><p>Therefore, knowing the password of the backup (either because it was specifically set in order to extract the credentials, or because it was cracked) you can extract the credentials of an application and use them to access the user cloud services directly on various service portals. In this way, for applications that store the token, it is not necessary to know the user's password for the specific service, but the access is guaranteed by the same token.</p><p>Several commercial mobile forensics solutions are integrating this functionality within their software or additional software to be used in combination with their forensic tool. Among the best known, those worth mentioning are UFED Cloud Analyzer, Oxygen Forensic Detective, and Paraben Device Seizure.</p><p>It should be stressed that this type of software makes remote access to various servers and that data is not physically stored within the analyzed device. For this, we need to consider at least two aspects: to be sure to have adequate legal authority to do this activity and, in any case, to bear in mind that this type of acquisition will leave traces and may generate notifications for the owner. For these reasons, we must take particular care when using it.</p><div class="section" title="Case study - Cloud data acquisition with UFED Cloud Analyzer"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec42"/>Case study - Cloud data acquisition with UFED Cloud Analyzer</h2></div></div></div><p>UFED Cloud Analyzer is a commercial software developed by Cellebrite as completion of forensic suites for the acquisition and analysis of mobile devices. This software allows you to access your data on different platforms: Google (Gmail, Contacts, Drive, Location History, and Search History), Dropbox, Facebook, Twitter, Instagram, Kik, and Vk.</p><p>The software can take login credentials as manual input (username and password) or by importing an account package exported using the UFED Physical Analyzer software. The following screenshot shows the export procedure:</p><div class="mediaobject"><img src="graphics/B05100_05_24-1.jpg" alt="Case study - Cloud data acquisition with UFED Cloud Analyzer"/></div><p>The starting screen of the software allows you to view the already existing persons or create a new one. It refers to it as person, since we are talking about users' personal accounts:</p><div class="mediaobject"><img src="graphics/B05100_05_25-1.jpg" alt="Case study - Cloud data acquisition with UFED Cloud Analyzer"/></div><p>When inserting a new person, you can specify their identification information and the time zone of reference, as shown here:</p><div class="mediaobject"><img src="graphics/B05100_05_26-1.jpg" alt="Case study - Cloud data acquisition with UFED Cloud Analyzer"/></div><p>It is then possible to proceed with the extraction, providing even the related legal information (for example, Search warrant):</p><div class="mediaobject"><img src="graphics/B05100_05_27-1.jpg" alt="Case study - Cloud data acquisition with UFED Cloud Analyzer"/></div><p>It is then necessary to select which account, among those available within the account package, you want to acquire. In the following example, credentials for Dropbox, Twitter, and Google are available:</p><div class="mediaobject"><img src="graphics/B05100_05_28-1.jpg" alt="Case study - Cloud data acquisition with UFED Cloud Analyzer"/></div><p>The user's credentials are then authenticated to verify the correctness and validity:</p><div class="mediaobject"><img src="graphics/B05100_05_29-1.jpg" alt="Case study - Cloud data acquisition with UFED Cloud Analyzer"/></div><p>Finally, it is also possible to specify the parameters for each account to be acquired, such as the type of content (for example, <span class="strong"><strong>Messages</strong></span>, <span class="strong"><strong>Contacts</strong></span>, <span class="strong"><strong>Images</strong></span>, <span class="strong"><strong>Videos</strong></span>, and so on) and the timeframe of interest. Once such options have been selected, it is possible to start extracting data:</p><div class="mediaobject"><img src="graphics/B05100_05_30-1.jpg" alt="Case study - Cloud data acquisition with UFED Cloud Analyzer"/></div><p>Once the extraction is completed, it shows a summary of the acquired data, broken down for each account:</p><div class="mediaobject"><img src="graphics/B05100_05_31-1.jpg" alt="Case study - Cloud data acquisition with UFED Cloud Analyzer"/></div><p>The software also allows filtering and searching the data by offering different types of visualization, such as <span class="strong"><strong>Timeline table</strong></span>, <span class="strong"><strong>Timeline feed</strong></span>, <span class="strong"><strong>Files</strong></span>, <span class="strong"><strong>Contacts</strong></span>, <span class="strong"><strong>Map</strong></span>, and <span class="strong"><strong>Profile</strong></span>:</p><div class="mediaobject"><img src="graphics/B05100_05_32-1.jpg" alt="Case study - Cloud data acquisition with UFED Cloud Analyzer"/></div><p>The following screenshot shows an example of the file visualization of a <span class="strong"><strong>Google Drive</strong></span> account:</p><div class="mediaobject"><img src="graphics/B05100_05_33-1.jpg" alt="Case study - Cloud data acquisition with UFED Cloud Analyzer"/></div></div><div class="section" title="Case study - cloud data acquisition with Oxygen Forensic Detective"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec43"/>Case study - cloud data acquisition with Oxygen Forensic Detective</h2></div></div></div><p>Oxygen Forensic Detective is a commercial software developed by Oxygen Forensic and is the most complete version among those available from this vendor. In particular, in addition to extraction and analysis capabilities present in the Analyst version, this version includes specific features to enable access of the data stored on the Cloud. The software allows you to access your data on different platforms: Google (Calendar Bookmarks, History, Contacts, Drive, Location History, Mail, Photos, Tasks, and Backup WhatsApp), iCloud (Calendars, Contacts, and iOS Backup), Live (Calendars, Contacts, and OneDrive), Box, Dropbox, Facebook, Twitter, Instagram, and Swarm (Foursquare).</p><p>The software can take login credentials as manual input (username and password) or by importing an Oxygen Credentials Package exported using the Oxygen Forensic Detective software itself. The following screenshot shows an example of the acquisition of an <span class="strong"><strong>Apple iPhone 6S</strong></span> with iOS <span class="strong"><strong>9.3.1</strong></span>. It's important to remember that for the extraction of credentials, encrypting the backup is necessary:</p><div class="mediaobject"><img src="graphics/B05100_05_34-1.jpg" alt="Case study - cloud data acquisition with Oxygen Forensic Detective"/></div><p>The authentication credentials can be viewed by accessing the specific account section. For each account, the password or authentication token and the input file of the credentials are given. In the specific example here, the credentials were related to a Facebook account:</p><div class="mediaobject"><img src="graphics/B05100_05_35-1.jpg" alt="Case study - cloud data acquisition with Oxygen Forensic Detective"/></div><p>Using the <span class="strong"><strong>Save Accounts Date</strong></span> option you can export the credentials in the Oxygen Credentials Package format while saving the files on the computer:</p><div class="mediaobject"><img src="graphics/B05100_05_36-1.jpg" alt="Case study - cloud data acquisition with Oxygen Forensic Detective"/></div><p>Once you have your credentials package from the main screen of the software, simply click on the <span class="strong"><strong>Cloud</strong></span> button at the top right to access the setup wizard:</p><div class="mediaobject"><img src="graphics/B05100_05_37-1.jpg" alt="Case study - cloud data acquisition with Oxygen Forensic Detective"/></div><p>In order to proceed, you must specify the <span class="strong"><strong>Import credentials package</strong></span> option and select the exported file from the previous step. It then displays a view about the user, typically containing name and surname, profile photo, e-mail address, and telephone number, as shown here:</p><div class="mediaobject"><img src="graphics/B05100_05_38-1.jpg" alt="Case study - cloud data acquisition with Oxygen Forensic Detective"/></div><p>It is then possible to select which account you want to access, verify the correctness of the credentials, and set each of the extraction parameters. In the specific case of Facebook, you can specify which content you want to extract (<span class="strong"><strong>Images</strong></span>, <span class="strong"><strong>Video</strong></span>, <span class="strong"><strong>Audio</strong></span>, <span class="strong"><strong>Messages</strong></span>, <span class="strong"><strong>Contacts</strong></span>, <span class="strong"><strong>Files</strong></span>, and so on) and the timeframe of interest:</p><div class="mediaobject"><img src="graphics/B05100_05_39-1.jpg" alt="Case study - cloud data acquisition with Oxygen Forensic Detective"/></div><p>Once the extraction is launched, the software provides the user with a detailed real-time view of extracted data and the task completion percentage:</p><div class="mediaobject"><img src="graphics/B05100_05_40-1.jpg" alt="Case study - cloud data acquisition with Oxygen Forensic Detective"/></div><p>When the extraction is completed, it shows a detailed summary of the extracted data, broken down by account and by type:</p><div class="mediaobject"><img src="graphics/B05100_05_41-1.jpg" alt="Case study - cloud data acquisition with Oxygen Forensic Detective"/></div><p>The extracted data can then be viewed within Oxygen Forensic Detective or saved in an archive <span class="strong"><strong>Oxygen Cloud Backup</strong></span> (<span class="strong"><strong>OCB</strong></span>) for later analysis:</p><div class="mediaobject"><img src="graphics/B05100_05_42-1.jpg" alt="Case study - cloud data acquisition with Oxygen Forensic Detective"/></div><p>Opening of the backup within the software allows you to navigate easily around the extracted data:</p><div class="mediaobject"><img src="graphics/B05100_05_43_bis.jpg" alt="Case study - cloud data acquisition with Oxygen Forensic Detective"/></div><p>In the specific case of the current example, you will have access to the <span class="strong"><strong>Social Network</strong></span> section and view all the extracted data in a structured way:</p><div class="mediaobject"><img src="graphics/B05100_05_44-1.jpg" alt="Case study - cloud data acquisition with Oxygen Forensic Detective"/></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec47"/>Summary</h1></div></div></div><p>In this chapter, we introduced the iCloud service provided by Apple to store files on remote servers and backup its devices. In particular, we showed the techniques to download the backups stored on iCloud when you know the user credentials (Apple ID and password) and when you have access to a computer (either Windows or Mac OS X, turned on or off) where it is installed and that uses iCloud Control Panel. In the next chapter, we will introduce you to the most interesting and useful artifacts that can be found on iDevices.</p></div>
<div class="section" title="Self-test questions"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec48"/>Self-test questions</h1></div></div></div><p>Q1. When is a new backup on iCloud automatically created?</p><p>
</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Every 5 minutes</li><li class="listitem">It depends on the iOS version</li><li class="listitem">When the device is connected to the power cable, to a Wi-Fi network and is locked</li><li class="listitem">When the device is locked</li></ol></div><p>
</p><p>Q2. Which of these tools can be used to download a backup from iCloud?</p><p>
</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">iPhone Backup Analyzer</li><li class="listitem">InflatableDonkey</li><li class="listitem">UFED Physical Analyzer</li><li class="listitem">iOS Forensic Toolkit</li></ol></div><p>
</p><p>Q3. Which tool can be used to recover the auth token from a PC with iCloud Control Panel?</p><p>
</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><code class="literal">Oauth.exe</code></li><li class="listitem"><code class="literal">Iloot.exe</code></li><li class="listitem"><code class="literal">Token.exe</code></li><li class="listitem"><code class="literal">Atex.exe</code>    </li></ol></div><p>
</p><p>Q4. Where are the log files related to iCloud Control Panel stored in Windows 7?</p><p>
</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><code class="literal">C:\Users\[username]\AppData\Local\Apple Computer\Logs</code></li><li class="listitem"><code class="literal">C:\Users\[username]\AppData\Local\Apple\Logs</code></li><li class="listitem"><code class="literal">C:\Users\[username]\AppData\Roaming\Apple Computer\Logs</code></li><li class="listitem"><code class="literal">C:\Users\[username]\AppData\Roaming\Apple\Logs</code></li></ol></div></div></body></html>