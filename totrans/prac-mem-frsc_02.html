<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer006">
			<h1 id="_idParaDest-13"><a id="_idTextAnchor011"/>Chapter 1: Why Memory Forensics?</h1>
			<p>We are living in a world where nothing is more certain than change and cybercrimes are no exception. New attack techniques are constantly being developed, and hundreds of malicious programs and scripts are being written and tested to bypass security controls, while scanners scrutinize the World Wide Web for vulnerable hosts and publicly available services. That is why it is extremely important to stay on trend and have all kinds of tools and techniques in your arsenal to be on the same page as the threat actors. </p>
			<p>So, why is <strong class="bold">memory forensics</strong> a vital part of many digital <em class="italic">forensic examinations</em> and <em class="italic">incident response engagements</em> today? What are the main investigative goals and techniques used by digital forensics and incident response professionals? What challenges do they face every day? You'll find answers to these questions in this chapter.</p>
			<p>This chapter will cover the following topics:  </p>
			<ul>
				<li>Understanding the main benefits of memory forensics</li>
				<li>Learning about the investigation goals and methodology</li>
				<li>Discovering the challenges of memory forensics</li>
			</ul>
			<h1 id="_idParaDest-14"><a id="_idTextAnchor012"/>Understanding the main benefits of memory forensics</h1>
			<p>Naturally, for the <a id="_idIndexMarker000"/>reader who picks up this book, the benefits are obvious. Since you have decided to deepen your knowledge of memory forensics, you probably have your own reasons for doing so. However, let's take another look at the most common<a id="_idIndexMarker001"/> situations in which <strong class="bold">Random Access Memory </strong>(<strong class="bold">RAM</strong>) investigation can play a crucial role (not only in digital forensics but also incident response and <a id="_idIndexMarker002"/>malware analysis), and perhaps you will discover new use cases for the knowledge and skills you have acquired.</p>
			<h2 id="_idParaDest-15"><a id="_idTextAnchor013"/>No trace is left behind</h2>
			<p>The number of threat actors using <em class="italic">living off the land</em> and <em class="italic">fileless</em> attack techniques has increased dramatically over the past few years. Attackers no longer care as much about removing their footprints, instead, they try to leave as few of them as possible to avoid detection. This makes the job of information security professionals <a id="_idIndexMarker003"/>much more difficult because the use of built-in tools and the lack of malicious files on the disk that can be scanned means that some traditional security solutions may be useless. A lack of logging may make it very hard to reconstruct how threat actors abused built-in dual-use tools, for example, various command and scripting interpreters, in the course of a post-mortem examination, so acquiring and analyzing memory may play a key role in such cases. </p>
			<p>Let's discuss each case separately.</p>
			<h3>Find me in memory</h3>
			<p>Let's start with <strong class="bold">malware</strong> that works exclusively in memory. The concept itself is not new. When talking about the beginning of the era of memory-resident malware, some researchers refer to <em class="italic">Maltese Amoeba</em>, a virus first discovered back in 1991 in Ireland. Others prefer to start with the <em class="italic">Code Red</em> worm that appeared in 2001. In any case, since the beginning of the twenty-first century, fileless attacks have only gained momentum and are becoming more and more popular. For example, a payload may be injected directly into memory via PowerShell, and it is becoming extremely common. The process injection technique itself was included in the top 10 <em class="italic">MITRE ATT&amp;CK®</em> techniques of 2020 by many cybersecurity vendors. For example, here are the top 10 techniques from the <em class="italic">Red Canary 2021 Threat Detection Report</em> via <a href="https://redcanary.com/threat-detection-report/techniques/">https://redcanary.com/threat-detection-report/techniques/</a>:</p>
			<div>
				<div id="_idContainer005" class="IMG---Figure">
					<img src="Images/Figure_1.1_B17056.jpg" alt="Figure 1.1 – Top 10 MITRE ATT&amp;CK techniques of 2020&#13;&#10;" width="786" height="907"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.1 – Top 10 MITRE ATT&amp;CK techniques of 2020</p>
			<p>Process hollowing, dynamic-link library injection, process doppelgänging, and other <strong class="bold">process injection</strong> sub-techniques are used not only by sophisticated state-sponsored<a id="_idIndexMarker004"/> threat groups but even by commodity malware operators.</p>
			<h3>Frame of work</h3>
			<p>The other<a id="_idIndexMarker005"/> side of the issue is the use <a id="_idIndexMarker006"/>of numerous <strong class="bold">post-exploitation frameworks</strong>, such as Metasploit, Cobalt Strike, or PowerShell Empire. Such instrumentation provides attackers with a wide range of options to generate a variety of malicious payloads and inject them into memory. </p>
			<p>Created with offensive security in mind, these frameworks allowed first penetration testers and red teamers, and then various threat actors to use a wide range of techniques with very limited footprints on disk, even if they didn't have outstanding malware development experience. For example, Cobalt Strike's Beacon payload's unmanaged PowerShell features allowed threat actors to run it without actually running <strong class="source-inline">powershell.exe</strong>, abusing the Windows API instead.</p>
			<p>Such frameworks as Cobalt Strike have become so common that some threat actors even use them instead of custom malware. For example, the notorious Evil Corp group, whose members are believed to be behind high-profile ransomware attacks, including Garmin, switched the Dridex bot to Cobalt Strike's Beacon in their <em class="italic">WastedLocker</em> campaigns.</p>
			<h3>Living off the land</h3>
			<p><strong class="bold">Living off the land</strong> is <a id="_idIndexMarker007"/>a very popular approach in which attackers use built-in tools and installed legitimate software for their own purposes. Most tools for example, PowerShell or WMI, are used by system administrators to perform their daily tasks, making it difficult not only to detect attackers but also to block the tools they use.</p>
			<p>Attackers can utilize living-off-the-land techniques with a variety of tactics. PowerShell can be used for downloading the initial payload from the attacker-controlled server, binaries such as <strong class="source-inline">rundll32.exe</strong> and <strong class="source-inline">regsvr32.exe</strong> can be used for execution and defense evasion, <strong class="bold">Ntdsutil</strong> can be leveraged for credentials access, and <strong class="bold">PsExec</strong> and <strong class="bold">WMIC</strong> can be abused for remote execution. There are lots of similar examples, and if the IT infrastructure doesn't have advanced logging capabilities, an analyst's chances of extracting such information may be very low. If acquired in time, memory analysis may be of great help!</p>
			<p>Another important note is that in many cases, you can find only the first stage of the malicious binary on the disk – the next stage (and potentially even the next!) is loaded from the server directly into memory, so you won't see it during post-mortem analysis if you don't have a memory image. </p>
			<p>What's more, most malicious binaries are packed, encoded, and encrypted nowadays in order to avoid detection, but not in memory! So you can use tools such as PE-sieve <a id="_idIndexMarker008"/>to collect potentially malicious code for further analysis. Of course, we'll show you how to do it in the following chapters.</p>
			<h2 id="_idParaDest-16"><a id="_idTextAnchor014"/>Privacy keeper</h2>
			<p>In recent<a id="_idIndexMarker009"/> years, the issue of <em class="italic">privacy</em> has become more acute. Tons of personal data, photos, and messages appear online every day. Service providers collect information about our personalities, interests, and routines to make their work more efficient and more useful. Instant messengers, browsers with privacy modes, in-memory file systems, password managers, and crypto containers are emerging as a result. </p>
			<p>Of course, privacy is everyone's concern, but it is most relevant to cybercriminals, as they really have something to hide. We have seen more than once situations where files of interest found on a suspect's computer have been encrypted or saved in a crypto container. In such situations, memory collection and analysis is the key to all doors, as it allows investigators to retrieve the passwords and keys needed for decryption.</p>
			<p>As you can see, there are different cases but they all have one thing in common, which is that in each of them, memory forensics can play an extremely important role.</p>
			<h1 id="_idParaDest-17"><a id="_idTextAnchor015"/>Learning about the investigation goals and methodology</h1>
			<p>The basis<a id="_idIndexMarker010"/> of any <strong class="bold">forensic investigation</strong> is <strong class="bold">goal</strong> setting. Goals determine evidence to look for, methods to use, and tools we need. The right approach to goal setting helps to achieve the desired result quickly and efficiently. Remember the famous "<em class="italic">divide et impera</em>" principle? Despite its origins and primary purpose, this principle is great for achieving any goals, the main thing is to understand what to divide and how to use it. As part of the investigation goal setting, this principle can be used to break down the primary goal into smaller and simpler ones. Thus, by dividing our goals into components, we get a set of specific actions, the result of which will be the pieces of the puzzle and all we will have to do is to put them together.</p>
			<p>Let's start with the more general goals. If we receive for examination the device involved in the incident, there is a high probability that it is either one of the following:</p>
			<ul>
				<li>The alleged victim's device</li>
				<li>The suspect's device</li>
			</ul>
			<p>Let's look at what both are in the next sections. </p>
			<h2 id="_idParaDest-18"><a id="_idTextAnchor016"/>The victim's device</h2>
			<p>Consider a <a id="_idIndexMarker011"/>situation in which the victim's device is under investigation. The main goal in this case is to answer the question, <em class="italic">What happened?</em> One way is to break this question down into its components:</p>
			<ol>
				<li>How did an attacker gain access to the system?</li>
				<li>What tools were launched?</li>
				<li>Did the attacker get persistence?</li>
				<li>Was there a lateral movement?</li>
				<li>What actions on the objective were performed?</li>
			</ol>
			<p>Now let's do the same thing with the question, <em class="italic">How did the attacker gain access to the system?</em>:</p>
			<ol>
				<li value="1">Are there any traces of potentially malicious files/links having been opened?</li>
				<li>Are there any remote connection services running? </li>
				<li>Are there any traces of suspicious connections?</li>
				<li>Are there any traces of removable devices being connected?</li>
			</ol>
			<p>Let's ask <a id="_idIndexMarker012"/>questions about malicious files too:</p>
			<ol>
				<li value="1">Are there any traces of suspicious files saved?</li>
				<li>Are there any traces of suspicious links opened?</li>
				<li>Are there any traces of suspicious files opened?</li>
			</ol>
			<p>Finding answers to these questions requires not only knowledge of the digital artifacts and their sources but also the attacker's tactics, techniques, and procedures, so such assessments must also be <em class="italic">cyber threat intelligence-driven</em>. </p>
			<p>This is the level to which each upper-level question should be broken down. As a result, we have a final list of questions that will allow us to piece together a picture of the incident and answer the first question of <em class="italic">What happened?</em> in detail.</p>
			<h2 id="_idParaDest-19"><a id="_idTextAnchor017"/>The suspect's device</h2>
			<p>A similar<a id="_idIndexMarker013"/> method can be used to investigate the device from which the attacks are suspected to have originated. In this case, questions would be posed based on what the owner of the device is suspected of. For example, if they are suspected of being a malware developer, our questions would be related to the presence of development tools, traces of source code, sales of malware, and so on.</p>
			<p>So, we have discussed how memory forensics can help our investigation and what methodology we can apply to do so. However, we cannot remain silent and overlook <a id="_idIndexMarker014"/>the weaknesses and possible risks. Let's discuss the challenges of memory forensics.</p>
			<h1 id="_idParaDest-20"><a id="_idTextAnchor018"/>Discovering the challenges of memory forensics</h1>
			<p>We hope <a id="_idIndexMarker015"/>you have already realized the importance of memory analysis. Now it is time to look for the pitfalls. RAM is a very useful and extremely fragile thing. Any interaction with the system, even the smallest one, can lead to irreversible consequences. For this reason, one of the most important <a id="_idIndexMarker016"/>challenges in memory analysis is <strong class="bold">data preservation</strong>.</p>
			<p>A few important points related to memory dump creation are listed in the next sections. </p>
			<h2 id="_idParaDest-21"><a id="_idTextAnchor019"/>Tools</h2>
			<p>Since<a id="_idIndexMarker017"/> most operating systems do not have built-in solutions for creating complete memory dumps, you will have to use specialized tools. There are all kinds of tools available today for creating full memory dumps as well as for extracting individual processes. Investigators can be guided by various considerations when choosing a tool:</p>
			<ul>
				<li>Changes being made to the system</li>
				<li>Costs</li>
				<li>The possibility of remote dump creation</li>
			</ul>
			<p>Unfortunately, even using a trusted tool cannot guarantee 100% success. Moreover, it can<a id="_idIndexMarker018"/> corrupt the system, and that brings us to the following point.</p>
			<h2 id="_idParaDest-22"><a id="_idTextAnchor020"/>Critical systems</h2>
			<p>In some cases, running <a id="_idIndexMarker019"/>tools to create memory dumps can cause an overload of the system. That is why an investigator who decides to create a memory dump should be ready to take responsibility for possible risks. The system under investigation could be a critical object, disabling which could lead not only to the loss of important data, but also to the shutdown of critical business processes, and in rare cases, even to a threat to the lives and health of people. The decision to create memory dumps on such systems should be balanced and consider all the pros and cons.</p>
			<h2 id="_idParaDest-23"><a id="_idTextAnchor021"/>Instability</h2>
			<p>If the system<a id="_idIndexMarker020"/> under investigation is infected with poorly written malware, it is itself <em class="italic">unstable</em>. In this situation, an attempt to create a memory dump could lead to unpredictable consequences. </p>
			<p>Besides, sometimes malware tries to use <em class="italic">anti-forensic techniques</em> and prevent memory preservation in every possible way, which again leads to unpredictable consequences. This happens rarely, but this factor should also be taken into account.</p>
			<h1 id="_idParaDest-24"><a id="_idTextAnchor022"/>Summary</h1>
			<p>Memory is a great source of forensic artifacts in the hands of an experienced investigator. Memory analysis provides information on malware activity and its functionality, user context, including recent actions, browsing activity, messaging, and unique evidence such as fileless malware, memory-only application data, encryption keys, and so on.</p>
			<p>Memory analysis, like anything else, must be approached in some way. One of the most important things is to set the investigation goal and break it down into simple components to conduct the investigation more quickly and efficiently, and, what's more important, to decide whether it's necessary or data left on the disk is enough to get the answers. </p>
			<p>Of course, there is no silver bullet, and memory forensics also has its drawbacks. The main problem is data preservation, but if you can manage that, you will be generously rewarded.</p>
			<p>So now that you've learned about the benefits of memory forensics and the challenges associated with it, and you understand the approach to investigation, what's next? We think it's time to dive into the more practical stuff, and our first stop is the memory acquisition process, which we'll talk about in the next chapter.</p>
		</div>
	</div></body></html>