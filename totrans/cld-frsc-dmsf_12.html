<html><head></head><body>
<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2"><h1 class="chapter-number" id="_idParaDest-162"><a id="_idTextAnchor174" class="pcalibre1 pcalibre2 pcalibre"/>9</h1>

<h3 id="_idParaDest-163" class="calibre6"><a id="_idTextAnchor175" class="pcalibre1 pcalibre2 pcalibre"/>Common Attack Vectors and TTPs</h3>
<p class="calibre3">As organizations increasingly rely on cloud infrastructures, security teams and incident responders find themselves confronting some unique vulnerabilities and attack patterns in the cloud. Attackers capitalize on these vulnerabilities and employ <strong class="bold">Tactics, Techniques, and Procedures</strong> (<strong class="bold">TTPs</strong>) that are sometimes tailored specifically to <span>cloud environments.</span></p>
<p class="calibre3">This chapter dives deep into these common attack vectors in the cloud, offering insights to empower and refine our response strategies in the face of ever-evolving threats. Misconfigured virtual machine instances and storage buckets, unprotected API endpoints, and inadequate authentication protocols are just a few of the vulnerabilities that threat actors target. To exploit these weaknesses, attackers employ TTPs ranging from privilege escalation and server-side request forgery to zero-day exploits tailored for cloud infrastructures. Grasping these specific threats is indispensable for cloud security and effective <span>incident response.</span></p>
<p class="calibre3">Specifically, we will discuss the following topics in <span>this chapter:</span></p>

<ul class="calibre12">
<li class="calibre13">MITRE <span>ATT&amp;CK framework</span></li>
<li class="calibre13">Forensic <span>triage collections</span></li>
<li class="calibre13"><span>Host-based forensics</span></li>
<li class="calibre13">Misconfigured virtual <span>machine instances</span></li>
<li class="calibre13">Misconfigured <span>storage buckets</span></li>
<li class="calibre13">Cloud administrator <span>portal breach</span></li>
</ul>
<p class="calibre3">Attack vectors and TTPs in the cloud, for the most part, echo those in on-premises environments. However, the decentralized nature of the cloud introduces distinct vulnerabilities. Misconfigured virtual machine instances can expose entire virtual environments, while improperly secured storage buckets can become gateways for data breaches. The cloud’s accessibility brings forth issues such as weak authentication mechanisms, which can lead to unauthorized access. While the core principles of cybersecurity remain consistent, these cloud-centric issues demand specialized attention <span>and understanding.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">We’ll look at common attack vectors and TTPs for cloud productivity suites in more detail in <a href="part0032_split_000.html#_idTextAnchor227" class="pcalibre1 pcalibre2 pcalibre"><span><em class="italic">Chapter 12</em></span></a><span>.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h1 id="_idParaDest-164" class="calibre5"><a id="_idTextAnchor176" class="pcalibre1 pcalibre2 pcalibre"/>MITRE ATT&amp;CK framework</h1>
<p class="calibre3">The MITRE ATT&amp;CK framework is a knowledge base of attacker tactics and techniques based on real-world observations<a id="_idIndexMarker735" class="pcalibre1 pcalibre2 pcalibre"/> from security researchers. It’s a tool that’s used by security teams to better understand attack behavior and to improve defense and response strategies. In the context of cloud environments, the MITRE ATT&amp;CK framework outlines specific techniques that adversaries use <a id="_idIndexMarker736" class="pcalibre1 pcalibre2 pcalibre"/>against <strong class="bold">cloud service providers</strong> (<strong class="bold">CSPs</strong>) such as AWS, Azure, <span>and GCP.</span></p>
<p class="calibre3">The MITRE ATT&amp;CK framework is particularly useful for cloud forensics because it allows responders to anticipate attacker behavior and plan their forensic investigations accordingly. By aligning with this framework, organizations can identify gaps in their defensive posture and better understand how to detect, respond to, and mitigate <span>cloud-specific threats.</span></p>
<p class="calibre3">Within the scope of cloud infrastructures, the MITRE ATT&amp;CK framework provides a matrix of known attacker TTPs, which includes, but is not limited to, <span>the following:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Initial access</strong>: Techniques that use <a id="_idIndexMarker737" class="pcalibre1 pcalibre2 pcalibre"/>various entry vectors to gain a foothold within a cloud environment. For example, Exploit Public-Facing Application (T1190) could be linked to vulnerabilities in web applications hosted in <span>the cloud.</span></li>
<li class="calibre13"><strong class="bold">Execution</strong>: The execution phase encompasses techniques that result in adversary-controlled code<a id="_idIndexMarker738" class="pcalibre1 pcalibre2 pcalibre"/> running on a local or remote system. This could involve Server Software Component (T1505), where an attacker might execute code through a web <span>server plugin.</span></li>
<li class="calibre13"><strong class="bold">Persistence</strong>: In the cloud, attackers often exploit features to remain logged in to an environment, as seen in <a id="_idIndexMarker739" class="pcalibre1 pcalibre2 pcalibre"/>Create Cloud Instance (T1578), where an adversary creates a new instance within an existing account to maintain <span>their operations.</span></li>
<li class="calibre13"><strong class="bold">Privilege escalation</strong>: Techniques that allow an adversary to gain higher-level permissions on a system or network. An<a id="_idIndexMarker740" class="pcalibre1 pcalibre2 pcalibre"/> example is Abuse Elevation Control Mechanism (T1548), which could involve an<a id="_idIndexMarker741" class="pcalibre1 pcalibre2 pcalibre"/> attacker taking advantage of overly permissive <strong class="bold">Identity and Access Management</strong> (<span><strong class="bold">IAM</strong></span><span>) roles.</span></li>
<li class="calibre13"><strong class="bold">Defense evasion</strong>: This<a id="_idIndexMarker742" class="pcalibre1 pcalibre2 pcalibre"/> involves techniques that adversaries use to avoid detection throughout their compromise. Techniques such as Disabling Security Tools (T1562) might be used to switch off monitoring and logging capabilities in <span>the cloud.</span></li>
</ul>
<p class="calibre3">To further illustrate how the MITRE ATT&amp;CK framework fits within a cloud attack scenario, consider the <span>following example:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Misconfiguration and Unauthorized Access (T1580)</strong>: As discussed later in this chapter, attackers often take advantage of misconfigurations in cloud storage services <a id="_idIndexMarker743" class="pcalibre1 pcalibre2 pcalibre"/>such as AWS S3 buckets or Azure Blob Storage. By enumerating these services and exploiting open permissions, attackers can read, modify, or delete sensitive data stored in <span>these resources.</span></li>
</ul>
<p class="calibre3">By incorporating the MITRE ATT&amp;CK framework into cloud security practices, organizations can more effectively structure their response to incidents and align their forensic efforts with industry-standard nomenclature and tactics. Doing so not only enhances the incident response plan but also aligns with global best practices, helping to ensure a more resilient defense against <span>cloud-based attacks.</span></p>
<p class="calibre3">Incident responders will likely have to map all forensic findings to MITRE numbers in an easy tabular format for defense teams to better understand how an attack occurred in their environment. As an example, the following table demonstrates a sample MITRE ATT&amp;CK table for a hypothetical <span>cloud compromise:</span></p>

<table class="t---table" id="table001-3">
<colgroup class="calibre22">
<col class="calibre23"/>
<col class="calibre23"/>
<col class="calibre23"/>
</colgroup>
<thead class="calibre24">
<tr class="t---table1">
<td class="t---table2">
<p class="calibre3"><strong class="bold">MITRE ATT&amp;CK </strong><span><strong class="bold">Technique Number</strong></span></p>

</td>
<td class="t---table2">
<p class="calibre3"><span><strong class="bold">Technique Name</strong></span></p>

</td>
<td class="t---table2">
<p class="calibre3"><span><strong class="bold">Description</strong></span></p>

</td>
</tr>
</thead>
<tbody class="calibre25">
<tr class="t---table1">
<td class="t---table2">
<p class="calibre3"><span><strong class="bold">T1190</strong></span></p>

</td>
<td class="t---table2">
<p class="calibre3">Exploit <span>Public-Facing Application</span></p>

</td>
<td class="t---table2">
<p class="calibre3">Attacking a server or service that is accessible from the internet to gain access. For example, attackers could target specific web applications or services exposed to the internet, such as a web portal or API gateway hosted in the cloud. The focus is often on exploiting vulnerabilities in web modules or application code to gain unauthorized access to underlying cloud resources or <span>sensitive data.</span></p>

</td>
</tr>
<tr class="t---table1">
<td class="t---table2">
<p class="calibre3"><span><strong class="bold">T1136.003</strong></span></p>

</td>
<td class="t---table2">
<p class="calibre3">Use of <span>Service Principal</span></p>

</td>
<td class="t---table2">
<p class="calibre3">Creating<a id="_idIndexMarker744" class="pcalibre1 pcalibre2 pcalibre"/> or compromising cloud identities to maintain access to cloud resources. This could involve creating or hijacking cloud identity services, such as Azure AD service principals or AWS IAM roles. Attackers may establish fake identities or compromise existing ones to gain persistent access to cloud resources, enabling them to access or manipulate workloads <span>and services.</span></p>

</td>
</tr>
<tr class="t---table1">
<td class="t---table2">
<p class="calibre3"><span><strong class="bold">T1580</strong></span></p>

</td>
<td class="t---table2">
<p class="calibre3">Cloud <span>Infrastructure Discovery</span></p>

</td>
<td class="t---table2">
<p class="calibre3">Scanning for information about cloud services and assets to plan further attacks. Attackers typically conduct reconnaissance on cloud environments, targeting specific cloud services such as AWS EC2 or Azure Virtual Machines. They scan for exposed APIs, unsecured storage buckets, or misconfigured cloud resources to identify potential entry points or <span>valuable data.</span></p>

</td>
</tr>
<tr class="t---table1">
<td class="t---table2">
<p class="calibre3"><span><strong class="bold">T1078</strong></span></p>

</td>
<td class="t---table2">
<p class="calibre3"><span>Valid Accounts</span></p>

</td>
<td class="t---table2">
<p class="calibre3">Using stolen account credentials to gain unauthorized access to <span>cloud systems.</span></p>

</td>
</tr>
<tr class="t---table1">
<td class="t---table2">
<p class="calibre3"><span><strong class="bold">T1090</strong></span></p>

</td>
<td class="t---table2">
<p class="calibre3"><span>Proxy</span></p>

</td>
<td class="t---table2">
<p class="calibre3">Utilizing intermediary systems to disguise the origin of malicious traffic. Attackers use intermediary cloud-based services or virtual machines as proxies to conceal their origin. This technique may involve spinning up cloud instances to route malicious traffic, making it harder to trace back to <span>the source.</span></p>

</td>
</tr>
<tr class="t---table1">
<td class="t---table2">
<p class="calibre3"><span><strong class="bold">T1526</strong></span></p>

</td>
<td class="t---table2">
<p class="calibre3">Cloud <span>Service Dashboard</span></p>

</td>
<td class="t---table2">
<p class="calibre3">Gaining access to cloud service management interfaces for control or reconnaissance. By gaining access to cloud management interfaces, such as the AWS management console or the Azure portal, attackers can monitor and control cloud resources. This might involve tracking workloads, modifying configurations, or gaining insights into <span>security controls.</span></p>

</td>
</tr>
<tr class="t---table1">
<td class="t---table2">
<p class="calibre3"><span><strong class="bold">T1548.004</strong></span></p>

</td>
<td class="t---table2">
<p class="calibre3">Cloud <span>Service Abuse</span></p>

</td>
<td class="t---table2">
<p class="calibre3">Exploiting cloud services or resources to support <span>malicious operations.</span></p>

</td>
</tr>
<tr class="t---table1">
<td class="t---table2">
<p class="calibre3"><span><strong class="bold">T1562.007</strong></span></p>

</td>
<td class="t---table2">
<p class="calibre3">Disable or Modify <span>Cloud Firewall</span></p>

</td>
<td class="t---table2">
<p class="calibre3">Modifying or disabling cloud-based firewalls to allow malicious traffic or block security responses. Attackers modify or disable cloud-based firewalls, such as AWS WAF or Azure Firewall, to permit malicious traffic or impede security responses. This could involve changing rules to allow access to specific ports or services, or disabling protective measures around critical <span>cloud assets.</span></p>

</td>
</tr>
<tr class="t---table1">
<td class="t---table2">
<p class="calibre3"><span><strong class="bold">T1578</strong></span></p>

</td>
<td class="t---table2">
<p class="calibre3">Modify Cloud <span>Compute Infrastructure</span></p>

</td>
<td class="t---table2">
<p class="calibre3">Making<a id="_idIndexMarker745" class="pcalibre1 pcalibre2 pcalibre"/> changes to cloud compute services such as instances and virtual machines to establish persistence or escalate privileges, as well as making unauthorized alterations to cloud compute services, such as modifying virtual machine configurations or injecting malicious code into containerized applications. This technique aims to establish persistence, escalate privileges, or create backdoors in <span>cloud environments.</span></p>

</td>
</tr>
<tr class="t---table1">
<td class="t---table2">
<p class="calibre3"><span><strong class="bold">T1583</strong></span></p>

</td>
<td class="t---table2">
<p class="calibre3">Acquire Infrastructure: <span>Cloud Accounts</span></p>

</td>
<td class="t---table2">
<p class="calibre3">Purchasing or otherwise obtaining cloud accounts<a id="_idIndexMarker746" class="pcalibre1 pcalibre2 pcalibre"/> for <span>malicious purposes.</span></p>

</td>
</tr>
<tr class="t---table1">
<td class="t---table2">
<p class="calibre3"><span><strong class="bold">T1608.001</strong></span></p>

</td>
<td class="t---table2">
<p class="calibre3">Stage Data for Exfiltration: <span>Cloud Storage</span></p>

</td>
<td class="t---table2">
<p class="calibre3">Placing stolen data in cloud storage services in preparation for exfiltration, as well as placing stolen or illicitly obtained data in cloud storage services, such as Amazon S3 buckets or Azure Blob Storage, in preparation for exfiltration. This step often precedes large-scale data breaches or data theft operations, leveraging the cloud for staging and dissemination of <span>compromised data.</span></p>

</td>
</tr>
</tbody>
</table>
<p class="img---caption" lang="en-US">Table 9.1 – Example of an incident MITRE ATT&amp;CK table</p>
<p class="callout-heading">Important note</p>
<p class="callout">All attacker TTPs can be mapped to the appropriate number under the ATT&amp;CK framework. This can be found on the MITRE organization’s <span>site: </span><a href="https://attack.mitre.org/" class="pcalibre1 pcalibre2 pcalibre"><span>https://attack.mitre.org/</span></a><span>.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h1 id="_idParaDest-165" class="calibre5"><a id="_idTextAnchor177" class="pcalibre1 pcalibre2 pcalibre"/>Forensic triage collections</h1>
<p class="calibre3">One of the biggest pain <a id="_idIndexMarker747" class="pcalibre1 pcalibre2 pcalibre"/>points incident responders will face is data acquisition at the individual host level, especially when it pertains to operating system artifacts. CSPs such as Azure, AWS, and GCP offer various logging mechanisms to aid in monitoring and auditing actions on their resources. However, these logs often capture activities related to the infrastructure or services utilized. By default, they do not capture the granular details of user activities or system operations at the operating system level (except for cloud ecosystem-connected EDR agents such as Microsoft Defender for Endpoint). Even in a cyber incident that involves cloud resources, the reality is that most of an<a id="_idIndexMarker748" class="pcalibre1 pcalibre2 pcalibre"/> incident’s <strong class="bold">indicators of compromise</strong> (<strong class="bold">IoCs</strong>) will come from <span>host-level artifacts.</span></p>
<p class="calibre3">As we have seen throughout this book, cloud log sources primarily focus on the cloud resources’ interactions. This means detailed host-level activities, such as specific Windows Event Logs, file modifications, memory operations, and user command executions are not captured (that is, accessible from the cloud) by default. The exception to this is if host artifacts and logs have been set to be forwarded to cloud services such as AWS CloudWatch or an Azure Log Analytics workspace. Most likely, incident responders will be<a id="_idIndexMarker749" class="pcalibre1 pcalibre2 pcalibre"/> responding to an incident that will require capturing all forensic artifacts at the host level (that is, the virtual machine instance hosted in the cloud environment). The operating system artifacts offer a more detailed picture of what happened on a virtual machine instance and piecing together the analysis of multiple virtual machines will allow incident responders to understand the extent to which their cloud infrastructure was impacted by <span>the incident.</span></p>
<p class="calibre3">These artifacts can include <span>the following:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Filesystem metadata</strong>: Details about file creation, modification, <span>or deletion</span></li>
<li class="calibre13"><strong class="bold">Memory artifacts</strong>: Information about running processes, network connections, and <span>loaded modules</span></li>
<li class="calibre13"><strong class="bold">Registry artifacts (for Windows)</strong>: Details about installed applications, user activities, and <span>system configurations</span></li>
<li class="calibre13"><strong class="bold">Shell histories (for Linux)</strong>: Command execution histories, which can provide insights into <span>user activities</span></li>
<li class="calibre13"><strong class="bold">Application logs</strong>: Specific applications might generate logs that haven’t been captured or aggregated by <span>the CSP</span></li>
</ul>
<p class="calibre3">The absence of these artifacts from the <a id="_idIndexMarker750" class="pcalibre1 pcalibre2 pcalibre"/>CSP makes it crucial to use tools such as <strong class="bold">Kroll Artifact Parser and Extractor</strong> (<strong class="bold">KAPE</strong>, <a href="https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape" class="pcalibre1 pcalibre2 pcalibre">https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape</a>) or <strong class="bold">Collect Your Logs Remotely</strong> (<strong class="bold">CyLR</strong>) for triage <a id="_idIndexMarker751" class="pcalibre1 pcalibre2 pcalibre"/>and <span>forensic analysis.</span></p>
<p class="calibre3">KAPE and CyLR are both free triage tools that collect and process forensically relevant artifacts swiftly. They are highly customizable and enable incident responders to target specific artifacts based on the nature of the cyber incident. They are lightweight and do not require much computational power to be run on <span>a system.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">KAPE requires <a id="_idIndexMarker752" class="pcalibre1 pcalibre2 pcalibre"/>an enterprise license when used on a third-party network and/or as part of a paid engagement. It is free for any local, state, federal, or international government agency, as well as educational and <span>research uses.</span></p>
<p class="callout">You can download KAPE and find its usage instructions <span>at </span><a href="https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape/" class="pcalibre1 pcalibre2 pcalibre"><span>https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape/</span></a><span>.</span></p>
<p class="callout">You can download CyLR<a id="_idIndexMarker753" class="pcalibre1 pcalibre2 pcalibre"/> and find its usage instructions on GitHub <span>at </span><a href="https://github.com/orlikoski/CyLR/" class="pcalibre1 pcalibre2 pcalibre"><span>https://github.com/orlikoski/CyLR/</span></a><span>.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h1 id="_idParaDest-166" class="calibre5"><a id="_idTextAnchor178" class="pcalibre1 pcalibre2 pcalibre"/>Host-based forensics</h1>
<p class="calibre3">In the context of the<a id="_idIndexMarker754" class="pcalibre1 pcalibre2 pcalibre"/> cloud, a host refers to a virtual or physical machine that runs user applications and serves as an endpoint for user and application activities. It can be an individual server, a virtual machine, or a container, depending on the specific cloud model being utilized. While in traditional on-premises scenarios, a host would often refer to a tangible physical server or machine, in the cloud, hosts can be ephemeral and rapidly spun up or down based on the demand <span>and require<a id="_idTextAnchor179" class="pcalibre1 pcalibre2 pcalibre"/>ments.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">In this chapter, we will concentrate on Windows-based systems. Linux systems will have different host-based artifacts that can be collected <span>and analyzed.</span></p>
<p class="calibre3">Host-based forensics in the cloud focuses on retrieving and analyzing data from these individual hosts or endpoints, aiming to identify signs of intrusions, lateral movements, malicious code executions, and other TTPs. Given that a host is the primary point of execution for applications and often the entry or pivot point for attackers, it is a rich source of <span>forensic data.</span></p>
<p class="calibre3">Several artifacts in the Windows operating system can provide a wealth of information regarding activities on <span>a host:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Prefetch</strong>: This is used to speed up the Windows boot process and application startup times. By examining <a id="_idIndexMarker755" class="pcalibre1 pcalibre2 pcalibre"/>prefetch files, incident responders can determine which programs were executed on a host <span>and when.</span></li>
<li class="calibre13"><strong class="bold">AmCache</strong>: AmCache<a id="_idIndexMarker756" class="pcalibre1 pcalibre2 pcalibre"/> contains information about executed applications and can provide insights into program execution and <span>user activities.</span></li>
<li class="calibre13"><strong class="bold">ShimCache</strong>: Also known as Application<a id="_idIndexMarker757" class="pcalibre1 pcalibre2 pcalibre"/> Compatibility Cache, ShimCache contains a list of recently<a id="_idIndexMarker758" class="pcalibre1 pcalibre2 pcalibre"/> executed applications. It is<a id="_idIndexMarker759" class="pcalibre1 pcalibre2 pcalibre"/> valuable for understanding what ran on a system, especially after a system reboot, as some other artifacts might <span>be purged.</span></li>
<li class="calibre13"><strong class="bold">Windows Event Logs</strong>: These logs, especially the security, system, and application logs, can offer a plethora<a id="_idIndexMarker760" class="pcalibre1 pcalibre2 pcalibre"/> of information about security-related events, system startups, shutdowns, application crashes, and more. They are critical for identifying patterns related to potential <span>security incidents.</span></li>
</ul>
<p class="calibre3">Many more artifacts can be analyzed, but these are the most useful from an incident responder’s point of view. We will utilize these artifacts to analyze common intrusions on cloud resources discussed throughout <span>this chapter.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">Prefetch, AmCache, ShimCache, and Windows Event Logs are some of the many artifacts collected by KAPE <span>and CyLR.</span></p>
<p class="calibre3">The process of analyzing host-based logs can be broken down into the <span>following steps:</span></p>

<ol class="calibre14">
<li class="calibre13"><strong class="bold">Log collection</strong>: Gather the data from the target host. This is the initial step where all the necessary <a id="_idIndexMarker761" class="pcalibre1 pcalibre2 pcalibre"/>entries are extracted for analysis. These logs are also captured when generating forensic <span>triage packages.</span></li>
<li class="calibre13"><strong class="bold">Data preparation</strong>: Utilize a parsing tool to convert the raw data into a readable and <span>analyzable format.</span></li>
<li class="calibre13"><strong class="bold">Analysis and correlation</strong>: This considers key aspects such as user activity, file paths, execution flags, file modification times, and file sizes/attributes for any anomalies or red flags. Cross-reference log data with other forensic artifacts to contextualize findings within the broader scope of <span>the investigation.</span></li>
<li class="calibre13"><strong class="bold">Outcome</strong>: Document the analysis results, identifying any potential indicators of compromise. Based on the findings, determine the appropriate response actions, which could include further detailed investigation, system remediation, or initiating security<a id="_idIndexMarker762" class="pcalibre1 pcalibre2 pcalibre"/> protocols to prevent <span>future breaches.</span></li>
</ol>
<p class="calibre3">These steps can be visualized in the following <span>process map:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer153"><img alt="Figure 9.1 – Host-based forensic analysis process" src="../images/00166.jpeg" class="calibre156"/></div>
</div>
<p class="img---caption" lang="en-US">Figure 9.1 – Host-based forensic analysis process</p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h2 id="_idParaDest-167" class="calibre10"><a id="_idTextAnchor180" class="pcalibre1 pcalibre2 pcalibre"/>Evidence of intrusion</h2>
<p class="calibre3">Determining evidence of execution is often a crucial initial step in ascertaining evidence of intrusion on a host system. Threat <a id="_idIndexMarker763" class="pcalibre1 pcalibre2 pcalibre"/>actors, in their pursuit of system compromise and subsequent exploitation, frequently seek to execute unauthorized applications, particularly malware, to establish a foothold or gain elevated privileges. The unauthorized execution of these applications can serve as clear indicators of a breach <span>or intrusion.</span></p>
<p class="calibre3">To pinpoint such unauthorized executions, incident responders rely on certain intrinsic artifacts, such as Prefetch, AmCache, and ShimCache. These artifacts store data about executed programs, offering invaluable insights into the history of application runs. By meticulously analyzing these artifacts, professionals can discern any discrepancies or anomalies pointing to unauthorized executions, thus revealing potential evidence of system intrusion by malicious actors. The focus is not just on identifying malware but also on understanding the breadth and depth of any intrusion, allowing for a more comprehensive <span>security response.</span></p>
<p class="calibre3">In 2013, a large American retailer experienced a significant data breach where attackers stole credit card and personal<a id="_idIndexMarker764" class="pcalibre1 pcalibre2 pcalibre"/> information from millions of customers. In this incident, forensic artifacts such as Prefetch, AmCache, ShimCache, and Windows Event Logs were integral to the investigation. Prefetch files likely provided insights into the execution of malware and hacking tools used by the attackers, revealing patterns of malicious activity. AmCache entries, detailing executed programs, could have helped in identifying unauthorized binaries associated with the breach. ShimCache might have offered additional evidence of malicious executable runs, which would have been useful for understanding the malware’s compatibility strategies across the retailer’s systems. Windows Event Logs, which record a wide range of system activities, were crucial in reconstructing the breach’s timeline, including login attempts, system changes, and network activities. These artifacts, when combined, enabled investigators to piece together the attackers’ movements, ascertain the methods used in the breach, and comprehend the full extent of the intrusion, thus playing a pivotal role in unraveling one of the most significant cyberattacks in the <span>retail sector.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h2 id="_idParaDest-168" class="calibre10"><a id="_idTextAnchor181" class="pcalibre1 pcalibre2 pcalibre"/>Prefetch analysis</h2>
<p class="calibre3">Prefetching is an optimization technique that’s employed by the Windows operating system to expedite the startup of applications. It achieves this by predicting which files an application will need and<a id="_idIndexMarker765" class="pcalibre1 pcalibre2 pcalibre"/> loading them into memory pre-emptively. After<a id="_idIndexMarker766" class="pcalibre1 pcalibre2 pcalibre"/> an application’s initial execution, the system populates the <strong class="source-inline">Prefetch</strong> directory with a corresponding <strong class="source-inline">.pf</strong> file. These files can be found in the <strong class="source-inline">C:\Windows\Prefetch</strong> directory on a standard Windows installation. The directory will contain files with the <strong class="source-inline">.pf</strong> extension, each named after the executable it corresponds to. For instance, if you have run <strong class="source-inline">notepad.exe</strong>, you might find a corresponding <strong class="source-inline">NOTEPAD.EXE.pf</strong> file in the <span><strong class="source-inline">Prefetch</strong></span><span> directory.</span></p>
<p class="calibre3">Analyzing these prefetch files provides insights into the applications that have been run on the system, making them valuable for both performance diagnostics and forensic investigations. These files are generated based on observations made by the cache manager, which keeps track of all the files and directories an application references during its run. Consequently, these <strong class="source-inline">.pf</strong> files <a id="_idIndexMarker767" class="pcalibre1 pcalibre2 pcalibre"/>become invaluable containers of historical<a id="_idIndexMarker768" class="pcalibre1 pcalibre2 pcalibre"/> data regarding <span>application execution.</span></p>
<p class="calibre3">Forensic importance of <span>prefetch files:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Execution history</strong>: One of the most significant pieces of information that’s extracted from prefetch files is the historical data on application execution. The <strong class="source-inline">.pf</strong> file records both the<a id="_idIndexMarker769" class="pcalibre1 pcalibre2 pcalibre"/> initial execution date and the last executed date for the respective application. These timestamps are crucial during forensic investigations as they can help trace back when a potentially malicious application was first introduced and subsequently run on <span>a system.</span></li>
<li class="calibre13"><strong class="bold">Correlation with file metadata</strong>: The date of creation and modification of the <strong class="source-inline">.pf</strong> file itself can also provide forensic clues. While the creation date often aligns with the first execution of the application, the modification date typically corresponds with the last execution date. By comparing these dates, investigators can ascertain the consistency and frequency of an <span>application’s usage.</span></li>
</ul>
<p class="calibre3">One of the most popular open source tools for prefetch analysis is <strong class="bold">PECmd</strong>, which is written and maintained by Eric Zimmerman. This tool <a id="_idIndexMarker770" class="pcalibre1 pcalibre2 pcalibre"/>parses prefetch files and provides detailed output, including file paths, timestamps, run counts, and more. Another common (but licensed) tool to parse prefetch files is <span>Magnet AXIOM.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">You can download PECmd and find its usage details <span>at </span><a href="https://github.com/EricZimmerman/PECmd" class="pcalibre1 pcalibre2 pcalibre"><span>https://github.com/EricZimmerman/PECmd</span></a><span>.</span></p>
<p class="calibre3">Imagine a scenario where a suspicious file named <strong class="source-inline">malicious.exe</strong> was executed on a Windows-based virtual machine instance that is being hosted on an organization’s cloud tenant. Upon retrieving the corresponding prefetch file (perhaps from one of the triage tools we discussed earlier), <strong class="source-inline">MALICIOUS.EXE.pf</strong>, and analyzing it with PECmd, the output might resemble<a id="_idIndexMarker771" class="pcalibre1 pcalibre2 pcalibre"/> something <span>like this:</span></p>
<pre class="console">&gt; PECmd.exe -f C:\Users\Mansoor\Downloads\MALICIOUS.EXE.pf
Processing C:\Users\Mansoor\Downloads\MALICIOUS.EXE.pf
---------------------------------
Source File: C:\Users\Mansoor\Downloads\MALICIOUS.EXE.pf
---------------------------------
Executable: C:\Users\Mansoor\Downloads\MALICIOUS.EXE
Run Count: 3
Volume Info:
    Volume Path: \\?\Volume{abcd1234-efgh-5678-ijkl-1234567890ab}\
    Creation Date: 2023-09-15 15:34:21 UTC
    Serial Number: 3A2B1C4D
Directories accessed:
    C:\Users\Mansoor\Downloads\
    C:\Windows\System32\
    C:\Temp\
Files accessed:
    C:\Users\Mansoor\Downloads\MALICIOUS.EXE
    C:\Windows\System32\somefile.dll
    C:\Temp\tempfile.tmp
Last Run Time: 2023-10-24 12:23:45 UTC
Trace Chains (Last 8 executions):
    1. 2023-10-24 12:23:45 UTC
    2. 2023-10-23 10:20:30 UTC
    3. 2023-10-22 14:15:15 UTC</pre>
<p class="calibre3">The output provided by PECmd after analyzing a prefetch file such as <strong class="source-inline">MALICIOUS.EXE.pf</strong> is a rich source of forensic data. PECmd decodes the information stored within the <a id="_idIndexMarker772" class="pcalibre1 pcalibre2 pcalibre"/>prefetch file and presents it in a human-readable format, which includes a timestamp of the first and last time the application was run, the total number of times it was <a id="_idIndexMarker773" class="pcalibre1 pcalibre2 pcalibre"/>executed, and the files that were accessed <span>during execution.</span></p>
<p class="calibre3">Here are some attacker TTPs to look out for when analyzing <span>prefetch output:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Time stamping</strong>: Prefetch files contain timestamps indicating the last time a particular application was run. This can help investigators correlate application execution times with other events on <span>the system.</span></li>
<li class="calibre13"><strong class="bold">Application frequency</strong>: By examining the run count within a prefetch file, analysts can determine how often an application is executed. Unusual frequencies can signal anomalous or <span>malicious activity.</span></li>
<li class="calibre13"><strong class="bold">Volume information</strong>: Prefetch files also store details about the volume from which an application was executed. This can be useful to trace back to potentially malicious external devices <span>or volumes.</span></li>
<li class="calibre13"><strong class="bold">Application source path</strong>: Identifying where an application was executed (for example, from a USB device or a specific directory) can help in piecing together an attacker’s movement or actions on <span>a host.</span></li>
<li class="calibre13"><strong class="bold">File and directory references</strong>: Prefetch files list other files and directories that were accessed during the application’s startup. This can highlight any dependent or associated files, which might also be malicious <span>or compromised.</span></li>
</ul>
<p class="calibre3">Prefetch files, though designed as a performance optimization feature, have cemented themselves as indispensable <a id="_idIndexMarker774" class="pcalibre1 pcalibre2 pcalibre"/>artifacts for <span>incident responders.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h2 id="_idParaDest-169" class="calibre10"><a id="_idTextAnchor182" class="pcalibre1 pcalibre2 pcalibre"/>AmCache analysis</h2>
<p class="calibre3">AmCache, akin to prefetch, is a forensic artifact unique to Windows systems, particularly Windows 8 and <a id="_idIndexMarker775" class="pcalibre1 pcalibre2 pcalibre"/>above. The <strong class="source-inline">AmCache.hve</strong> file is a Windows registry hive that primarily serves the Windows Application Experience program, a feature aimed at ensuring software compatibility. Typically located at <strong class="source-inline">C:\Windows\AppCompat\Programs\Amcache.hve</strong>, this hive logs detailed metadata about executed applications, as well as information about connected hardware such as USB <a id="_idIndexMarker776" class="pcalibre1 pcalibre2 pcalibre"/>devices. While its primary function is software compatibility, the rich data it holds makes it an indispensable tool in <span>forensic investigations.</span></p>
<p class="calibre3">Here's its <span>forensic importance:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Binary metadata</strong>: AmCache contains comprehensive metadata about executed binaries, such as the file path, last modification time, creation time, SHA-1 hash, and more. This helps forensic analysts trace the origin and history of executable files on <span>the system.</span></li>
<li class="calibre13"><strong class="bold">Hardware footprints</strong>: The hive also maintains records of plugged-in hardware devices, potentially allowing investigators to trace the insertion of malicious USB devices or <span>external storage.</span></li>
<li class="calibre13"><strong class="bold">Correlation with execution</strong>: By analyzing AmCache, forensic experts can correlate binary metadata with execution traces from other artifacts, offering a cohesive timeline of <span>system activities.</span></li>
</ul>
<p class="calibre3">One of the go-to tools for AmCache parsing is AmcacheParser, which is also part of Eric Zimmerman’s suite of forensic tools. Like PECmd, it’s open source and offers thorough parsing of the <strong class="source-inline">AmCache.hve</strong> file. Another licensed tool that offers robust AmCache parsing capabilities is <span>Magnet AXIOM.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">You can download AmcacheParser and find its usage details <span>at </span><a href="https://github.com/EricZimmerman/AmcacheParser" class="pcalibre1 pcalibre2 pcalibre"><span>https://github.com/EricZimmerman/AmcacheParser</span></a><span>.</span></p>
<p class="calibre3">Imagine the execution of a malicious file named <strong class="source-inline">malicious_mansoor.exe</strong> on a Windows virtual machine<a id="_idIndexMarker777" class="pcalibre1 pcalibre2 pcalibre"/> hosted on a cloud. On obtaining the <strong class="source-inline">AmCache.hve</strong> file and parsing it with AmcacheParser, the output might look something <span>like this:</span></p>
<pre class="console">&gt; &gt; AmcacheParser.exe -f C:\Users\Mansoor\Downloads\Amcache.hve
Processing C:\Users\Mansoor\Downloads\Amcache.hve
---------------------------------
Source File: C:\Users\Mansoor\Downloads\malicious_mansoor.exe
SHA-1: a1b2c3d4e5f67890a1b2c3d4e5f67890a1b2c3d4
File Created: 2023-09-14 12:01:12 UTC
File Last Modified: 2023-09-15 13:05:10 UTC
Run Count: 2
Associated Files:
    C:\Windows\System32\somefile.dll
    C:\Temp\tempfile.tmp
---------------------------------</pre>
<p class="calibre3">Here are some key TTPs<a id="_idIndexMarker778" class="pcalibre1 pcalibre2 pcalibre"/> to look for when <span>analyzing AmCache:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Binary hashes</strong>: SHA-1 hashes in AmCache provide an opportunity to match known malicious hashes from threat <span>intelligence feeds</span></li>
<li class="calibre13"><strong class="bold">File paths</strong>: Unusual or suspicious file paths, especially ones located in temporary or uncommon directories, can hint toward <span>malicious activities</span></li>
<li class="calibre13"><strong class="bold">File creation and modification</strong>: Timestamps can be correlated with other system events to map out an <span>attacker’s actions</span></li>
<li class="calibre13"><strong class="bold">Associated files</strong>: Like Prefetch, AmCache also provides references to files related to an executable, assisting in mapping out potentially <span>malicious dependencies</span></li>
</ul>
<p class="calibre3">AmCache hive, although <a id="_idIndexMarker779" class="pcalibre1 pcalibre2 pcalibre"/>created for compatibility, holds significant forensic potential. Alongside Prefetch, AmCache has proven its worth as a goldmine of information for incident response and <span>digital</span><span><a id="_idIndexMarker780" class="pcalibre1 pcalibre2 pcalibre"/></span><span> forensics.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h2 id="_idParaDest-170" class="calibre10"><a id="_idTextAnchor183" class="pcalibre1 pcalibre2 pcalibre"/>ShimCache analysis</h2>
<p class="calibre3">ShimCache, formally known as <a id="_idIndexMarker781" class="pcalibre1 pcalibre2 pcalibre"/>Application Compatibility Cache, is a component of the Windows operating <a id="_idIndexMarker782" class="pcalibre1 pcalibre2 pcalibre"/>system that’s designed to allow backward compatibility for applications designed for older versions of Windows. When Windows executes a program, it checks ShimCache to determine whether the application requires any “shims” or compatibility fixes to run correctly. ShimCache, in doing so, maintains a list of executables that have been run on the system, making it an invaluable resource for digital forensic analysts. The ShimCache information is stored within the Windows registry at <span><strong class="source-inline">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatibility\AppCompatCache</strong></span><span>.</span></p>
<p class="calibre3">Here's its <span>forensic importance:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Execution history</strong>: ShimCache maintains a list of the most recently executed applications, aiding forensic analysts in tracing which executables ran on the system. This list includes the file path, last modification time, and <span>file size.</span></li>
<li class="calibre13"><strong class="bold">Persistence mechanism detection</strong>: Malware often leverages various persistence mechanisms. Observing recurring entries in ShimCache for uncommon or suspicious paths can hint toward such <span>persistence mechanisms.</span></li>
<li class="calibre13"><strong class="bold">Correlation with other artifacts</strong>: Like AmCache, data from ShimCache can be cross-referenced with other forensic artifacts to provide a holistic view of the system’s execution history and <span>potential incidents.</span></li>
</ul>
<p class="calibre3">A popular tool for extracting and parsing ShimCache entries is ShimCacheParser, also part of Eric Zimmerman’s suite of forensic tools. It provides a structured output of the ShimCache entries, facilitating quick <span>forensic analysis.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">You can download ShimCacheParser and find its usage details <span>at </span><a href="https://github.com/mandiant/ShimCacheParser" class="pcalibre1 pcalibre2 pcalibre"><span>https://github.com/mandiant/ShimCacheParser</span></a><span>.</span></p>
<p class="calibre3">Consider a scenario<a id="_idIndexMarker783" class="pcalibre1 pcalibre2 pcalibre"/> where a malicious file named <strong class="source-inline">malicious_mansoor.exe</strong> is found on a Windows system. By extracting the ShimCache data and analyzing it using ShimCacheParser, the <a id="_idIndexMarker784" class="pcalibre1 pcalibre2 pcalibre"/>output might resemble <span>the following:</span></p>
<pre class="console">&gt; ShimCacheParser.exe -f SYSTEM
Processing SYSTEM hive...
---------------------------------
Source File: C:\Users\Mansoor\Downloads\malicious_mansoor.exe
File Last Modified: 2023-09-15 13:05:10 UTC
File Size: 24576 bytes
Execution Flag: Executed
---------------------------------</pre>
<p class="calibre3">Based on this output, incident responders and forensic experts could say with high confidence that the malicious file was executed and at what point the malicious binary, <strong class="source-inline">malicious_mansoor.exe</strong>, may have been created or last changed on <span>the filesystem.</span></p>
<p class="calibre3">Here are some key TTPs to look for when <span>analyzing ShimCache:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">File paths</strong>: The presence of executables from uncommon or suspicious directories in ShimCache is often a <span>red flag.</span></li>
<li class="calibre13"><strong class="bold">Execution flag</strong>: While ShimCache logs executables, not all are necessarily executed. The execution flag distinguishes between mere presence and <span>actual execution.</span></li>
<li class="calibre13"><strong class="bold">File modification time</strong>: Anomalies in file modification times, especially if they correlate with known intrusion events, can be <span>of significance.</span></li>
<li class="calibre13"><strong class="bold">File size and attributes</strong>: Any deviations in file size or attributes from known good baselines can hint at potential tampering or <span>malicious replacements.</span></li>
</ul>
<p class="calibre3">ShimCache, which <a id="_idIndexMarker785" class="pcalibre1 pcalibre2 pcalibre"/>was designed for application compatibility, has evolved into an essential forensic artifact. Paired with other artifacts such as Prefetch and AmCache, ShimCache offers <a id="_idIndexMarker786" class="pcalibre1 pcalibre2 pcalibre"/>invaluable insights into system activities, aiding in thorough incident response <span>and investigations.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h2 id="_idParaDest-171" class="calibre10"><a id="_idTextAnchor184" class="pcalibre1 pcalibre2 pcalibre"/>Windows Event Logs</h2>
<p class="calibre3">Windows Event Logs is a<a id="_idIndexMarker787" class="pcalibre1 pcalibre2 pcalibre"/> centralized system logging facility, inherent to<a id="_idIndexMarker788" class="pcalibre1 pcalibre2 pcalibre"/> Microsoft Windows systems. It provides detailed records of systems, security, applications, and other events. Whether it’s tracking user activity, diagnosing system issues, monitoring security incidents, or ensuring regulatory compliance, Event Logs play a <span>crucial role.</span></p>
<p class="calibre3">Here is <span>the location:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Windows </strong><span><strong class="bold">servers</strong></span><span>: </span><span><strong class="source-inline">C:\Windows\System32\winevt\Logs</strong></span></li>
<li class="calibre13"><strong class="bold">Windows 10 and Windows </strong><span><strong class="bold">11</strong></span><span>: </span><span><strong class="source-inline">C:\Windows\System32\winevt\Logs</strong></span></li>
</ul>
<p class="calibre3">Here are some important Windows <span>Event Logs:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Security logs</strong>: Capture security-related events such as logons, logoffs, object access, account management, <span>and more</span></li>
<li class="calibre13"><strong class="bold">System logs</strong>: Reflect system components’ activities, including drivers and services, capturing alerts on system failures, resource depletion, or other <span>system-wide occurrences</span></li>
<li class="calibre13"><strong class="bold">Application logs</strong>: Register application events, errors, warnings, and informational messages from installed applications <span>and services</span></li>
<li class="calibre13"><strong class="bold">PowerShell logs</strong>: Specifically record activities related to PowerShell commands, scripts, <span>and modules</span></li>
<li class="calibre13"><strong class="bold">Terminal services (RDP)</strong>: Pertain to <strong class="bold">Remote Desktop Protocol</strong> (<strong class="bold">RDP</strong>) sessions, capturing login successes and failures, disconnections, and other <span>RDP-specific happenings</span></li>
</ul>
<p class="calibre3">Here's the <a id="_idIndexMarker789" class="pcalibre1 pcalibre2 pcalibre"/><span>forensic importance:</span></p>

<ul class="calibre12">
<li class="calibre13"><span><strong class="bold">Security logs</strong></span><span>:</span><ul class="calibre17"><li class="calibre13"><strong class="bold">Account logins</strong>: Reveal when an account <span>was authenticated</span><ul class="calibre17"><li class="calibre13"><strong class="bold">Event ID 4624</strong>: A <span>successful logon</span></li><li class="calibre13"><strong class="bold">Event ID 4625</strong>: An account failed to <span>log in</span></li></ul></li><li class="calibre13"><strong class="bold">Account management</strong>: Show when user accounts or groups are created, changed, <span>or deleted:</span><ul class="calibre17"><li class="calibre13"><strong class="bold">Event ID 4720</strong>: A user account <span>was created</span></li></ul></li><li class="calibre13"><strong class="bold">Privilege use</strong>: Indicate the use of <span>special privileges</span><ul class="calibre17"><li class="calibre13"><strong class="bold">Event ID 4672</strong>: Special privileges assigned to a <span>new logon</span></li></ul></li><li class="calibre13"><strong class="bold">Object access</strong>: Detail when specific objects (files, directories) <span>were accessed</span><ul class="calibre17"><li class="calibre13"><strong class="bold">Event ID 4663</strong>: An attempt was made to access <span>an object</span></li></ul></li></ul></li>
<li class="calibre13"><strong class="bold">Terminal </strong><span><strong class="bold">services (RDP)</strong></span><span>:</span><ul class="calibre17"><li class="calibre13"><strong class="bold">Event ID 4778</strong>: A session was reconnected to a <span>window station</span></li><li class="calibre13"><strong class="bold">Event ID 4779</strong>: A session<a id="_idIndexMarker790" class="pcalibre1 pcalibre2 pcalibre"/> was disconnected from a <span>window station</span></li></ul></li>
<li class="calibre13"><span><strong class="bold">PowerShell logs</strong></span><span>:</span><ul class="calibre17"><li class="calibre13"><strong class="bold">Event ID 4103</strong>: Indicate that a PowerShell command or script block <span>was executed</span></li></ul></li>
<li class="calibre13"><span><strong class="bold">Lateral movement</strong></span><span>:</span><ul class="calibre17"><li class="calibre13"><strong class="bold">Event ID 5140</strong>: A network share <span>was accessed</span></li><li class="calibre13"><strong class="bold">Event ID 5145</strong>: A network share object was checked to see whether an object can be granted the <span>desired access</span></li></ul></li>
<li class="calibre13"><strong class="bold">Persistence via </strong><span><strong class="bold">scheduled tasks</strong></span><span>:</span><ul class="calibre17"><li class="calibre13"><strong class="bold">Event ID 4698</strong>: A scheduled task <span>was created</span></li></ul></li>
<li class="calibre13"><span><strong class="bold">Process/code execution</strong></span><span>:</span><ul class="calibre17"><li class="calibre13"><strong class="bold">Event ID 4688</strong>: A new process has <span>been created</span></li></ul></li>
</ul>
<p class="calibre3">To analyze Event Logs, you can use<a id="_idIndexMarker791" class="pcalibre1 pcalibre2 pcalibre"/> evtxECmd, an open source tool by Eric Zimmerman that provides extensive<a id="_idIndexMarker792" class="pcalibre1 pcalibre2 pcalibre"/> <span>parsing capabilities.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">You can download evtxECmd and find its usage details <span>at </span><a href="https://github.com/EricZimmerman/evtx" class="pcalibre1 pcalibre2 pcalibre"><span>https://github.com/EricZimmerman/evtx</span></a><span>.</span></p>
<p class="calibre3">Here’s a quick example of how you might determine which accounts have logged in to <span>a host:</span></p>
<pre class="console">&gt; evtxECmd.exe -f Security.evtx --csv out.csv
---------------------------------</pre>
<p class="calibre3">The output will be a CSV file with parsed Security Event Logs and columns corresponding to <span>the fields:</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer154"><img alt="Figure 9.2 – Example of parsed security Event Logs (out.csv)" src="../images/00005.jpeg" class="calibre157"/></div>
</div>
<p class="img---caption" lang="en-US">Figure 9.2 – Example of parsed security Event Logs (out.csv)</p>
<p class="calibre3">Here are some key TTPs to look for when analyzing Windows <span>Event Logs:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Account enumeration</strong>: A high volume of failed login attempts, especially with various usernames, can<a id="_idIndexMarker793" class="pcalibre1 pcalibre2 pcalibre"/> indicate account enumeration attempts. Look for multiple events with event <span>ID 4625.</span></li>
<li class="calibre13"><strong class="bold">Suspicious RDP activity</strong>: Frequent remote logins, especially during odd hours, can signal malicious activity. Event ID 4778 and event ID 4779 <span>can assist.</span></li>
<li class="calibre13"><strong class="bold">Lateral movement</strong>: A surge in network share access logs from unfamiliar systems may indicate lateral movement. Focus on event ID 5140 and event <span>ID 5145.</span></li>
<li class="calibre13"><strong class="bold">Unusual PowerShell execution</strong>: The execution of unexpected or rarely used PowerShell commands, tracked via event ID 4103, can hint at potential <span>malicious activity.</span></li>
<li class="calibre13"><strong class="bold">Task scheduling for persistence</strong>: Event ID 4698 indicates task scheduling. If a task is scheduled repeatedly, especially from unfamiliar sources or at high frequencies, it can signal a <span>persistence mechanism.</span></li>
<li class="calibre13"><strong class="bold">Code execution outside norms</strong>: Anomalies in process creation events, especially from uncommon directories or unknown binaries, can be a red flag. Use event ID 4688 <span>for this.</span></li>
</ul>
<p class="calibre3">Windows Event <a id="_idIndexMarker794" class="pcalibre1 pcalibre2 pcalibre"/>Logs are incredibly rich data sources that can provide a detailed view of nearly all activities on a system. Coupled with the right tools and an understanding of key events and indicators, they’re indispensable in any serious forensic investigation or <span>incident response.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h2 id="_idParaDest-172" class="calibre10"><a id="_idTextAnchor185" class="pcalibre1 pcalibre2 pcalibre"/>Analyzing memory dumps</h2>
<p class="calibre3">Memory dump<a id="_idIndexMarker795" class="pcalibre1 pcalibre2 pcalibre"/> forensics involves analyzing a snapshot of a system’s<a id="_idIndexMarker796" class="pcalibre1 pcalibre2 pcalibre"/> volatile memory. It can reveal a treasure trove of evidence about a system’s state at the time of the snapshot, from running processes to open network connections, in-memory artifacts, and even encryption keys or malware payloads that haven’t been written <span>to disk.</span></p>
<p class="calibre3">There are three types of <span>memory dumps:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Full memory dump</strong>: Captures the<a id="_idIndexMarker797" class="pcalibre1 pcalibre2 pcalibre"/> entire contents of physical <span>memory (RAM)</span></li>
<li class="calibre13"><strong class="bold">Kernel memory dump</strong>: Contains <a id="_idIndexMarker798" class="pcalibre1 pcalibre2 pcalibre"/>only the kernel-mode <span>read/write pages</span></li>
<li class="calibre13"><strong class="bold">Small memory dump</strong>: Records the<a id="_idIndexMarker799" class="pcalibre1 pcalibre2 pcalibre"/> smallest set of useful data, making it faster to save and easier <span>to manage</span></li>
</ul>
<p class="calibre3">Typically, memory dumps are first saved to the host’s local disk, a choice driven by the speed and reliability of local storage, especially given the potentially large size of dump files. This is particularly<a id="_idIndexMarker800" class="pcalibre1 pcalibre2 pcalibre"/> relevant for full memory dumps, which capture the entire contents of physical memory (RAM) and thus are directly proportional in size to the amount of RAM in the system. For example, a system with 16 GB of RAM will result in a full memory dump of approximately the same size, necessitating substantial <span>storage space.</span></p>
<p class="calibre3">Kernel memory dumps, containing<a id="_idIndexMarker801" class="pcalibre1 pcalibre2 pcalibre"/> only kernel-mode read/write pages, are smaller as they exclude user-mode applications and processes. Their size depends on the kernel footprint, usually much less than the total RAM but still sizeable. On the other hand, small memory dumps are significantly smaller, often just a few MBs, recording only the most essential data. They are quicker to save and manage, though they offer less <span>comprehensive information.</span></p>
<p class="calibre3">Here's the <span>forensic importance:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Active processes</strong>: List all the processes running on the system, providing a real-time view of what was happening when the dump <span>was taken.</span></li>
<li class="calibre13"><strong class="bold">Network connections</strong>: Determine which remote systems the machine was <span>communicating with.</span></li>
<li class="calibre13"><strong class="bold">Loaded modules</strong>: Identify all drivers and dynamic link libraries (DLLs) loaded into memory. This can reveal injected DLLs <span>or rootkits.</span></li>
<li class="calibre13"><strong class="bold">Decrypted data</strong>: Sensitive data that might be encrypted on disk (e.g., passwords, encryption keys) can be found unencrypted <span>in memory.</span></li>
<li class="calibre13"><strong class="bold">Malware artifacts</strong>: Discover remnants of malware that might reside solely in memory and avoid being written to <span>the filesystem.</span></li>
</ul>
<p class="calibre3">Threat actors increasingly leverage techniques such as fileless malware, which operates entirely in memory, to evade traditional file-based detection methods. This makes memory forensics an essential component of incident response, especially in cases where not all evidence of<a id="_idIndexMarker802" class="pcalibre1 pcalibre2 pcalibre"/> compromise is written to the filesystem or captured in artifacts such as Prefetch, AmCache, ShimCache, and Event Logs. The importance of memory dump analysis depends on the nature of the compromise: for sophisticated attacks, especially those<a id="_idIndexMarker803" class="pcalibre1 pcalibre2 pcalibre"/> employing <strong class="bold">advanced persistent threats</strong> (<strong class="bold">APTs</strong>), memory analysis is often indispensable for uncovering the full extent of the compromise and the techniques used by the attackers. The caveat with memory forensics is that because they are run on the memory allocated by the RAM and not on the filesystem (and therefore the hard drive), they are <a id="_idIndexMarker804" class="pcalibre1 pcalibre2 pcalibre"/>cleared if the device is <span>powered off.</span></p>
<p class="calibre3">The open source tool <strong class="bold">Volatility</strong> is a popular<a id="_idIndexMarker805" class="pcalibre1 pcalibre2 pcalibre"/> choice for memory dump forensics. It offers extensive plugin support, making it adaptable for various incident <span>response tasks.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">You can download <a id="_idIndexMarker806" class="pcalibre1 pcalibre2 pcalibre"/>Volatility and find its usage details <span>at </span><a href="https://www.volatilityfoundation.org/releases" class="pcalibre1 pcalibre2 pcalibre"><span>https://www.volatilityfoundation.org/releases</span></a><span>.</span></p>
<p class="calibre3">Let’s look at a sample analysis <span>using Volatility:</span></p>

<ol class="calibre14">
<li class="calibre13">Identify the <span>image profile:</span>
<pre class="source-code"><strong class="bold">&gt; volatility -f memdump.raw imageinfo</strong></pre>
<p class="calibre3">This will suggest suitable profiles for further analysis – for example, if there are profiles for Windows <span>10 architectures.</span></p>
</li> <li class="calibre13">List <span>the processes:</span>
<pre class="source-code"><strong class="bold">&gt; volatility -f memdump.raw --profile=Win10x86 pslist</strong></pre>
<p class="calibre3">This displays active processes. Look for unusual or <span>unexpected processes.</span></p>
</li> <li class="calibre13">View <span>network connections:</span>
<pre class="source-code"><strong class="bold">&gt; volatility -f memdump.raw --profile=Win10x86 netscan</strong></pre>
<p class="calibre3">Review the established connections for any <span>suspicious activity.</span></p>
</li> </ol>
<p class="calibre3">Here are the key TTPs to look for<a id="_idIndexMarker807" class="pcalibre1 pcalibre2 pcalibre"/> when analyzing <span>memory dumps:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Process injection</strong>: Unusual child processes or unexpected parent-child process relationships can indicate <span>process injection.</span></li>
<li class="calibre13"><strong class="bold">Hidden processes</strong>: Malware often tries to hide its processes. Detecting these can point to rootkit activity or <span>evasion techniques.</span></li>
<li class="calibre13"><strong class="bold">Unexpected network connections</strong>: Look out for those, especially to known malicious IPs or unfamiliar <span>foreign addresses.</span></li>
<li class="calibre13"><strong class="bold">Hooks</strong>: Some malware types use hooks to intercept system calls. Detecting these can be indicative of rootkits or certain types <span>of spyware.</span></li>
<li class="calibre13"><strong class="bold">Strings analysis</strong>: Extracting <a id="_idIndexMarker808" class="pcalibre1 pcalibre2 pcalibre"/>and analyzing strings from a memory dump can reveal paths, commands, URLs, and other <span>malware indicators.</span></li>
<li class="calibre13"><strong class="bold">In-memory file extraction</strong>: Extracting files that exist only in memory can unveil malicious payloads that avoid the filesystem or any artifacts that were deleted from the disk but linger <span>in memory.</span></li>
</ul>
<p class="calibre3">Memory dump forensics offers unique insights that aren’t always obtainable from disk-based forensics. This form of analysis can be crucial, especially when dealing with advanced threats that use in-memory evasion or reside solely in volatile memory. Proper tools and a keen eye for anomalies make memory forensics a formidable weapon in the arsenal of every <span>incident responder.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h1 id="_idParaDest-173" class="calibre5"><a id="_idTextAnchor186" class="pcalibre1 pcalibre2 pcalibre"/>Misconfigured virtual machine instances</h1>
<p class="calibre3">One of the prevalent entry points for attackers in cloud environments is through misconfigured virtual machine<a id="_idIndexMarker809" class="pcalibre1 pcalibre2 pcalibre"/> instances. The beauty of the cloud is how rapid the deployment of VMs can be. However, the downside of this is that configurations may be overlooked or improperly set. Such oversights grant threat actors unintended access or provide them with information to further their intrusions. Let’s look at some <span>common misconfigurations.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h2 id="_idParaDest-174" class="calibre10"><a id="_idTextAnchor187" class="pcalibre1 pcalibre2 pcalibre"/>Unnecessary ports left open</h2>
<p class="calibre3">Open ports function as communication endpoints for virtual machines. Each port allows a specific type of communication, such as HTTP traffic on port <strong class="source-inline">80</strong>. However, leaving unused or unnecessary ports open expands the potential attack surface. An attacker can exploit open ports by identifying vulnerabilities associated with the services listening on these ports. It’s essential to ensure that only required ports are open <span>and accessible.</span></p>
<p class="calibre3">Here are some indicators to <span>look for:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Host </strong><span><strong class="bold">level (Windows)</strong></span><span>:</span><ul class="calibre17"><li class="calibre13">Windows event ID 5156 (Windows Filtering Platform has permitted a connection) can be monitored to detect allowed <span>network connections</span></li><li class="calibre13">Windows event ID 5157 (Windows Filtering Platform has blocked a connection) can alert to blocked <span>connection attempts</span></li></ul></li>
<li class="calibre13"><span><strong class="bold">CSP</strong></span><span>:</span><ul class="calibre17"><li class="calibre13"><strong class="bold">AWS</strong>: VPC Flow Logs, as discussed previously, can be used to observe the traffic that is reaching the <span>virtual machine</span></li><li class="calibre13"><strong class="bold">Azure</strong>: NSG Flow Logs, as discussed previously, can offer insights into network traffic targeting the <span>virtual machines</span></li></ul></li>
</ul>
</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h2 id="_idParaDest-175" class="calibre10"><a id="_idTextAnchor188" class="pcalibre1 pcalibre2 pcalibre"/>Default credentials left unchanged</h2>
<p class="calibre3">Virtual machines often<a id="_idIndexMarker810" class="pcalibre1 pcalibre2 pcalibre"/> come with default administrator credentials for initial setup and access. While this is convenient for deployment, leaving these default credentials unchanged poses a significant security risk. Attackers are well aware of default credentials for many systems and can easily gain unauthorized access if they <span>aren’t updated.</span></p>
<p class="calibre3">Here’s an indicator to <span>look for:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Host level (Windows)</strong>: Windows event ID 4625 (an account failed to log on) can be monitored to detect and respond to failed <span>login attempts.</span></li>
</ul>
</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h2 id="_idParaDest-176" class="calibre10"><a id="_idTextAnchor189" class="pcalibre1 pcalibre2 pcalibre"/>Outdated or unpatched software</h2>
<p class="calibre3">Regularly updating and patching software and operating systems is a fundamental security practice. Over time, vulnerabilities in software are discovered, and patches are released to address them. Running outdated or unpatched software exposes the virtual machine to known vulnerabilities, creating opportunities for exploitation by attackers who target <span>these weaknesses.</span></p>
<p class="calibre3">Here are some indicators to <span>look for:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Host </strong><span><strong class="bold">level (Windows)</strong></span><span>:</span><ul class="calibre17"><li class="calibre13">Windows event ID 4375 (Windows Installer updated an installed product) can provide insights into patch installations and <span>software updates</span></li><li class="calibre13">Software inventories and/or vulnerability scans using tools such <span>as Nessus</span></li></ul></li>
<li class="calibre13"><span><strong class="bold">CSP</strong></span><span>:</span><ul class="calibre17"><li class="calibre13"><strong class="bold">AWS</strong>: AWS Systems Manager Patch Manager can be utilized for automated patching based on <span>set policies.</span></li><li class="calibre13"><strong class="bold">Azure</strong>: Azure Security Center highlights unpatched virtual machines and recommends relevant <span>security patches.</span></li><li class="calibre13"><strong class="bold">GCP:</strong> GCP’s operating system patch management service, Patch, allows for the scheduling and automation of patch deployment across virtual machine instances in Google Cloud. It provides features for patch compliance reporting and<a id="_idIndexMarker811" class="pcalibre1 pcalibre2 pcalibre"/> configuration of patch rollout schedules, ensuring that virtual machines are updated with the latest <span>security patches.</span></li></ul></li>
</ul>
</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h2 id="_idParaDest-177" class="calibre10"><a id="_idTextAnchor190" class="pcalibre1 pcalibre2 pcalibre"/>Publicly exposed sensitive data (or metadata)</h2>
<p class="calibre3">Data exposure is a critical issue, especially when sensitive or personal data is involved. Whether due to incorrect access controls, oversight, or misconfigured settings, public exposure of sensitive data can lead to data breaches, reputational damage, and potential regulatory repercussions. Ensuring strict access controls and regular audits is imperative to prevent unintentional data exposure. Let’s take a <span>closer look:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Host </strong><span><strong class="bold">level (Windows)</strong></span><span>:</span><ul class="calibre17"><li class="calibre13">Windows event ID 4663 (an attempt was made to access an object) can be monitored to detect unusual or unexpected access attempts to <span>sensitive files</span></li><li class="calibre13">Application logs at the software <span>application level</span></li></ul></li>
<li class="calibre13"><span><strong class="bold">CSP</strong></span><span>:</span><ul class="calibre17"><li class="calibre13"><strong class="bold">AWS</strong>: Amazon has additional services that are designed to discover, classify, and safeguard sensitive data within AWS S3 – for example, <span>Amazon Macie.</span></li><li class="calibre13"><strong class="bold">Azure</strong>: Azure storage logging through Azure Monitor helps monitor and analyze requests made to storage resources, ensuring only <span>authorized access.</span></li><li class="calibre13"><strong class="bold">GCP</strong>: GCP’s Sensitive Data Protection suite of services helps in discovering and classifying sensitive data across GCP services. Google Cloud Storage also offers detailed logging and monitoring capabilities through Cloud Audit Logs, allowing requests to storage resources to be tracked <span>and analyzed.</span></li></ul></li>
</ul>
<p class="calibre3">By understanding these<a id="_idIndexMarker812" class="pcalibre1 pcalibre2 pcalibre"/> areas of misconfiguration and by actively monitoring for the associated indicators, organizations can greatly enhance their virtual machine security posture in <span>the cloud.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h1 id="_idParaDest-178" class="calibre5"><a id="_idTextAnchor191" class="pcalibre1 pcalibre2 pcalibre"/>Misconfigured storage buckets</h1>
<p class="calibre3">Misconfigured storage buckets have emerged as a significant vulnerability in cloud environments. Cloud storage solutions, such as Amazon’s S3 buckets or Azure Blob Storage, are often set up <a id="_idIndexMarker813" class="pcalibre1 pcalibre2 pcalibre"/>with ease and speed in mind. However, without rigorous security configurations, they can inadvertently become publicly accessible or easily breached. Such misconfigurations expose sensitive data, leading to potential data leaks and compromising organizational integrity. Let’s look at some common misconfigurations that may allow <span>unauthorized access.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h2 id="_idParaDest-179" class="calibre10"><a id="_idTextAnchor192" class="pcalibre1 pcalibre2 pcalibre"/>Public permissions</h2>
<p class="calibre3">Storage resources are typically created with a default private setting, ensuring that only properly authenticated and authorized <a id="_idIndexMarker814" class="pcalibre1 pcalibre2 pcalibre"/>entities can access the stored data. However, sometimes, these permissions are altered, either for convenience or by mistake, leading to unintentional <span>public exposure.</span></p>
<p class="calibre3">Here are some indicators to <span>look for:</span></p>

<ul class="calibre12">
<li class="calibre13"><span><strong class="bold">AWS</strong></span><span>:</span><ul class="calibre17"><li class="calibre13">Navigate to the Amazon S3 console. Check the <strong class="bold">Access</strong> column for each bucket. If any of them are labeled as <strong class="bold">Public</strong>, then there’s <span>potential exposure.</span></li><li class="calibre13">The AWS CLI can be used <span>as follows:</span>
<pre class="source-code"><strong class="bold">   aws s3api get-bucket-acl --bucket YOUR_BUCKET_NAME</strong></pre></li></ul>
<p class="calibre3">If <strong class="source-inline">Grantee: Group</strong> has a URI of <strong class="source-inline">http://acs.amazonaws.com/groups/global/AllUsers</strong>, then the bucket has <span>public permissions.</span></p>
</li> <li class="calibre13"><span><strong class="bold">Azure</strong></span><span>:</span><ul class="calibre17"><li class="calibre13">In the Azure portal, under <strong class="bold">Blob Service</strong> | <strong class="bold">Containers</strong>, check the <strong class="bold">Public Access Level</strong> property<a id="_idIndexMarker815" class="pcalibre1 pcalibre2 pcalibre"/> of <span>each container.</span></li><li class="calibre13">We can use the Azure CLI <span>as follows:</span>
<pre class="source-code"><strong class="bold">    az storage container show --name YOUR_CONTAINER_NAME --account-name YOUR_STORAGE_ACCOUNT --query 'properties.publicAccess'</strong></pre></li></ul>
<p class="calibre3">If the output is <strong class="source-inline">Blob</strong> or <strong class="source-inline">Container</strong>, there’s <span>public accessibility.</span></p>
</li> </ul>
</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h2 id="_idParaDest-180" class="calibre10"><a id="_idTextAnchor193" class="pcalibre1 pcalibre2 pcalibre"/>Exposed API keys or credentials</h2>
<p class="calibre3">Storage buckets sometimes <a id="_idIndexMarker816" class="pcalibre1 pcalibre2 pcalibre"/>mistakenly contain sensitive files that hold API keys, credentials, or other secrets. If an attacker gains access to these, they could compromise systems or data associated with <span>those keys.</span></p>
<p class="calibre3">Here are some indicators to <span>look for:</span></p>

<ul class="calibre12">
<li class="calibre13"><span><strong class="bold">AWS</strong></span><span>:</span><ul class="calibre17"><li class="calibre13">Look for files with names such as <strong class="source-inline">*.pem</strong>, <strong class="source-inline">*.json</strong>, <strong class="source-inline">credentials</strong>, <strong class="source-inline">keys</strong>, and so on within your <span>S3 buckets.</span></li><li class="calibre13">You can use the following AWS CLI sample to list all the files in <span>a bucket:</span>
<pre class="source-code"><strong class="bold">   aws s3 ls s3://YOUR_BUCKET_NAME/ --recursive</strong></pre></li></ul></li> <li class="calibre13"><span><strong class="bold">Azure</strong></span><span>:</span><ul class="calibre17"><li class="calibre13">Search within blob containers for files with extensions or names similar to <strong class="source-inline">*.pfx</strong>, <strong class="source-inline">*.json</strong>, <strong class="source-inline">credentials</strong>, <strong class="source-inline">keys</strong>, and <span>so on</span></li><li class="calibre13">You can use the <a id="_idIndexMarker817" class="pcalibre1 pcalibre2 pcalibre"/>following Azure CLI sample to list blobs in <span>a container:</span>
<pre class="source-code"><strong class="bold">   az storage blob list --container-name YOUR_CONTAINER_NAME --account-name YOUR_STORAGE_ACCOUNT --output table</strong></pre></li></ul></li> </ul>
</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h2 id="_idParaDest-181" class="calibre10"><a id="_idTextAnchor194" class="pcalibre1 pcalibre2 pcalibre"/>Improper use of IAM policies</h2>
<p class="calibre3">IAM controls who or what can <a id="_idIndexMarker818" class="pcalibre1 pcalibre2 pcalibre"/>perform actions on specific resources. Improper IAM configurations could give users or roles more access than they need, violating the principle of <span>least privilege.</span></p>
<p class="calibre3">Here are some indicators to <span>look for:</span></p>

<ul class="calibre12">
<li class="calibre13"><span><strong class="bold">AWS</strong></span><span>:</span><ul class="calibre17"><li class="calibre13">Review IAM policies attached to users, groups, and roles. In particular, scrutinize any policy allowing <strong class="source-inline">s3:*</strong> actions <span>on </span><span><strong class="source-inline">s3:::YOUR_BUCKET_NAME/*</strong></span><span>.</span></li><li class="calibre13"><a id="_idTextAnchor195" class="pcalibre1 pcalibre2 pcalibre"/>You can use the following AWS CLI sample to list policies for <span>a user:</span>
<pre class="source-code"><strong class="bold">   aws iam list-attached-user-policies --user-name YOUR_USERNAME</strong></pre></li></ul></li> <li class="calibre13"><span><strong class="bold">Azure</strong></span><span>:</span><ul class="calibre17"><li class="calibre13">Review <strong class="bold">role-based access control</strong> (<strong class="bold">RBAC</strong>) assignments on the storage account. Ensure there are <a id="_idIndexMarker819" class="pcalibre1 pcalibre2 pcalibre"/>no overly permissive roles such as Owner or Contributor assigned to identities that don’t <span>need them.</span></li><li class="calibre13">You can use the following Azure CLI sample to list role assignments for a <span>storage account:</span>
<pre class="source-code"><strong class="bold">   az role assignment list --assignee YOUR_OBJECT_ID --scope /subscriptions/YOUR_SUBSCRIPTION_ID/resourceGroups/YOUR_RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/YOUR_STORAGE_ACCOUNT</strong></pre></li></ul></li> </ul>
<p class="calibre3">By regularly reviewing <a id="_idIndexMarker820" class="pcalibre1 pcalibre2 pcalibre"/>and ensuring the correct configurations of storage buckets and associated permissions, organizations can reduce the risk of data exposure and <span>potential compromises.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h1 id="_idParaDest-182" class="calibre5"><a id="_idTextAnchor196" class="pcalibre1 pcalibre2 pcalibre"/>Cloud administrator portal breach</h1>
<p class="calibre3">Gaining access to the cloud <a id="_idIndexMarker821" class="pcalibre1 pcalibre2 pcalibre"/>administrator portal is akin to handing over the keys to the entire cloud kingdom. An attacker with such access can not only view sensitive data but can manipulate configurations, delete crucial resources, and potentially incur huge costs by spawning large amounts of resources. Let’s take a closer look at what attacks can <span>be performed:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Brute-force attacks</strong>: Attackers use software to try as many combinations as possible to <span>gain access</span>
<p class="calibre3"><strong class="bold">Indicator</strong>: Multiple failed login attempts from the same IP address in a <span>short period</span></p>
</li>
<li class="calibre13"><strong class="bold">Credential stuffing</strong>: Attackers use previously breached usernames <span>and passwords</span>
<p class="calibre3"><strong class="bold">Indicator</strong>: Login attempts with multiple usernames from the same <span>IP address</span></p>
</li>
<li class="calibre13"><strong class="bold">Phishing attacks</strong>: Attackers deceive users into providing their <span>login credentials</span>
<p class="calibre3"><strong class="bold">Indicator</strong>: Users accessing cloud portals from unfamiliar referrer URLs or logging in from <span>unfamiliar locations</span></p>
</li>
<li class="calibre13"><strong class="bold">Token theft</strong>: Attackers steal authentication tokens or <span>session cookies.</span>
<p class="calibre3"><strong class="bold">Indicator</strong>: Unusual user agent strings or unexpected locations paired with familiar <span>user accounts</span></p>
</li>
</ul>
<p class="calibre3"><span>AWS detections:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">CloudTrail</strong>: AWS CloudTrail <a id="_idIndexMarker822" class="pcalibre1 pcalibre2 pcalibre"/>provides the event history of your AWS account activity. Look for <span>the following:</span><ul class="calibre17"><li class="calibre13"><strong class="source-inline">eventName</strong> such as <strong class="source-inline">ConsoleLogin</strong> paired with <strong class="source-inline">errorMessage</strong> such as <strong class="source-inline">Failed authentication</strong> for <span>failed logins</span></li><li class="calibre13">Multiple <strong class="source-inline">sourceIPAddresses</strong> for the same <strong class="source-inline">userIdentity</strong> in a short period might suggest <span>suspicious activity</span></li><li class="calibre13">AWS management console sign-in URL redirection, which can be an indicator of <span>phishing attempts</span></li></ul></li>
<li class="calibre13"><strong class="bold">GuardDuty</strong>: This is a threat detection service. Check for findings such as <strong class="source-inline">UnauthorizedAccess:IAMUser</strong>/<strong class="source-inline">ConsoleLogin</strong>, which indicates suspicious <span>console logins.</span></li>
</ul>
<p class="calibre3"><span>Azure detections:</span></p>

<ul class="calibre12">
<li class="calibre13"><strong class="bold">Azure activity log</strong>: Provides incident responders with insight into operations that were performed on resources. Search for <span>the following:</span><ul class="calibre17"><li class="calibre13">Activities with a status of <strong class="bold">Failed</strong> linked with <span><strong class="bold">Sign-in</strong></span><span> operations</span></li><li class="calibre13">Unusual IP addresses or regions associated with <span>successful sign-ins</span></li></ul></li>
<li class="calibre13"><strong class="bold">Azure AD sign-ins</strong>: This provides incident responders with access to the sign-in activity within the tenant. Look for <span>the following:</span><ul class="calibre17"><li class="calibre13">Multiple failed <span>sign-in attempts</span></li><li class="calibre13">Sign-in attempts from unfamiliar locations or <span>unusual devices</span></li></ul></li>
</ul>
<p class="calibre3">By understanding the TTPs and regularly monitoring the relevant logs, incident responders and defenders can detect and potentially prevent breaches due to weak authentication in cloud environments. Even though secure multi-factor authentication has become more common, the cybersecurity landscape is fast evolving and new threats may emerge that may require incident responders to respond to complete administrator <span>portal</span><span><a id="_idIndexMarker823" class="pcalibre1 pcalibre2 pcalibre"/></span><span> takeovers.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h1 id="_idParaDest-183" class="calibre5"><a id="_idTextAnchor197" class="pcalibre1 pcalibre2 pcalibre"/>Summary</h1>
<p class="calibre3">In this chapter, you learned about the challenges and risks that come with cloud security. We discussed how cloud environments, despite their advantages, have unique security issues. From misconfigured virtual machine instances to unprotected storage buckets, we highlighted the areas where mistakes can happen and how they can be exploited <span>by attackers.</span></p>
<p class="calibre3">You’ve also gained insights into host-based forensics, diving into key indicators such as prefetch, AmCache, ShimCache, Windows Event Logs, and memory dumps. We touched on the importance of securing virtual machines, covering open ports, default credentials, and outdated software. Storage bucket configurations and their potential pitfalls were also discussed. Lastly, we delved into the crucial topic of authentication, emphasizing the serious outcomes of a cloud administrator <span>portal breach.</span></p>
<p class="calibre3">As we transition to the next chapter on cloud evidence acquisition, we’ll focus on collecting evidence in <span>cloud environments.</span></p>

</div>
</div>


<div id="sbo-rt-content" class="calibre1">
<div id="_idContainer155" class="calibre2">
<h1 id="_idParaDest-184" class="calibre5"><a id="_idTextAnchor198" class="pcalibre1 pcalibre2 pcalibre"/>Further reading</h1>
<p class="calibre3">The MITRE ATT&amp;CK matrix for cloud-based <span>techniques: </span><a href="https://attack.mitre.org/matrices/enterprise/cloud/" class="pcalibre1 pcalibre2 pcalibre"><span>https://attack.mitre.org/matrices/enterprise/cloud/</span></a><span>.</span></p>
</div>
</div>
</body></html>