<html><head></head><body><div class="chapter" title="Chapter&#xA0;10.&#xA0;Browser and E-mail Investigation"><div class="titlepage"><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Browser and E-mail Investigation</h1></div></div></div><p>The Internet and World Wide Web is the main way to search and view data and information nowadays. Browsers are the most common tools to do this. So, investigating browsers is important when an analyst tries to investigate a user's activity to profile this user. This isn't an easy task because of the huge number of browsers in the market nowadays and the different artifacts structure in each browser. In this chapter, we will highlight three of the most used browsers: Internet Explorer, Firefox, and Chrome.</p><p>E-mail is still the main way to communicate among many people in the digital world, especially in the corporate environment. This chapter will cover the different formats of e-mail clients' archives, and explain how to read e-mails from these archives for analysis or tracing senders.</p><div class="section" title="Browser investigation"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec59"/>Browser investigation</h1></div></div></div><p>Tricking a user into visiting a malicious link and downloading a malicious executable is one of most used techniques by offenders to infect users' machines. Analyzing the browsing activities of the victim can identify the first infection vector and how it worked. Also, in case of analyzing a criminal machine, browsing through the history would help profile the user and clarify their intentions by identifying the types of websites that they usually visit and the contents of their downloaded files.</p><p>Analyzing browser activities requires that the investigator understand the different artifacts of the browser with their locations and the data structure of each one. From this, we can see why it is tricky to conduct in-depth browser forensics. There are many browsers that are currently on the market, and a single user can be using more than one browser.</p><p>In this section, we will explain different browser's artifacts and look at how to extract all these artifacts from the local browser files.</p></div></div>
<div class="section" title="Microsoft Internet Explorer"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec60"/>Microsoft Internet Explorer</h1></div></div></div><p>Microsoft Internet Explorer aka IE or MSIE is one of the first internet browsers on the market. It comes by default with the Windows operating system. Version 1 was released in 1995, and the latest version at the time of writing this book is version 11. Between version 1 and version 11 and between the different versions of Windows, the artifacts of the MSIE have been reformed.</p><p>Also, starting from Windows Vista the directory structure and artifacts' locations have been changed in the filesystem. So, there are two factors that control the Internet Explorer analysis process:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The version of the installed Internet Explorer</li><li class="listitem" style="list-style-type: disc">The version of the running Windows operating system</li></ul></div><div class="section" title="History files"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec89"/>History files</h2></div></div></div><p>Using browsing history, the investigator can profile system users and track their activities to narrow the investigation process. Windows keeps the browsing history for 20 days by default, which can be edited from the program itself or from the registry.</p><p>The investigator can use this piece of information to see whether the user recently cleared their browsing history or the history that the investigator found is the maximum history record that can be found in the system. The number of days to keep the history records of MSIE can be found under a value named <code class="literal">DaysToKeep</code> in the software hive under <code class="literal">\Microsoft\Windows\CurrentVersion\Internet Settings\Url</code>.</p><p>The location of History files differ from one Windows version to another, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Before Windows Vista, the History file called <code class="literal">History.IE5</code> in <code class="literal">C:\Documents and Settings\&lt;Username&gt;\Local Settings\History.IE5</code></li><li class="listitem" style="list-style-type: disc">In Windows Vista and Windows 7, the locations changed but it uses the same file structure <code class="literal">History.IE5</code>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Local\Microsoft\Windows\History\History.IE5</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Local\Microsoft\Windows\History\Low\History.IE5</code></li></ul></div><p>
</p></li><li class="listitem" style="list-style-type: disc">In Windows 8, Windows 8.1, and Windows 10, the location and the structure changed: <code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Local\Microsoft\Windows\WebCache\WebCacheV#.dat</code></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note14"/>Note</h3><p>Starting from MSIE Version 7 under Windows Vista and then Windows 7, MSIE runs in protected mode to improve security. This protected mode is turned on by default, and it can be turned off by the user. It runs the MSIE with low privilege, which makes any malicious software that is installed by MSIE during browsing run with the same low privilege, which doesn't allow the malware to access and manipulate sensitive areas in the operating system, such as system files or registry keys. All the activities of the MSIE in protected mode in Windows Vista or Windows 7 are located under the <code class="literal">Low</code> folder: <code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Local\Microsoft\Windows\History\Low\History.IE5</code>.</p></div></div><div class="section" title="History.IE5"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec14"/>History.IE5</h3></div></div></div><p>This was used by MSIE from Version 5 to Version 9 to store browsing history. On a live system, browsing to this location will display different folders indicating different periods of browsing. Each folder contains links to the visited websites. The user can reopen these websites from this location:</p><div class="mediaobject"><img src="graphics/image_10_001.jpg" alt="History.IE5"/><div class="caption"><p>History on a live system</p></div></div><p>Now, let's try to open the same location with the command line. We will list the files under the <code class="literal">content.IE5</code> directory using the <code class="literal">dir</code> command line:</p><div class="mediaobject"><img src="graphics/image_10_002.jpg" alt="History.IE5"/><div class="caption"><p>Listing the contents of History using the dir command</p></div></div><p>We can see that there is a different structure with only one file named <code class="literal">index.dat</code>. However, if we tried to list the directory structure by the <code class="literal">dir</code> command with an <code class="literal">/a</code> switch to list all directories, we will get different results, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/image_10_003.jpg" alt="History.IE5"/><div class="caption"><p>The dir command with an /a switch</p></div></div><p>We can see two new directories with names that start with <code class="literal">MSHist01</code>. These two folders represent the two folders in the preceding screenshot. The rest of the name represents the period of time that each folder contains of browsing history with the following structure:</p><p><span class="emphasis"><em>The constant </em></span>
<code class="literal">MSHist01</code>
<span class="emphasis"><em>, four digits for the start year, two digits for the start month, two digits for the start day, four digits for the end year, two digits for the end month, and two digits for the end day</em></span></p><p>So, these two files represent the following browsing history:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The first file shows the dates from 16-2-2015 to 23-2-2015, which indicates that this is a weekly history</li><li class="listitem" style="list-style-type: disc">The second file indicates a daily history for February 28, 2015.</li></ul></div><p>In Linux, if we tried to open the same <code class="literal">History</code> directory, we would see all the details using the <code class="literal">ls</code> command:</p><div class="mediaobject"><img src="graphics/image_10_004.jpg" alt="History.IE5"/><div class="caption"><p>Listing the History contents with the ls command in Linux</p></div></div><p>So, from this short listing, we can see that there are three different types of <code class="literal">index.dat</code> files, which can be summarized, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Main <code class="literal">index.dat</code>, which is located directly under <code class="literal">History.IE5</code></li><li class="listitem" style="list-style-type: disc">Weekly <code class="literal">index.dat</code>, which is located under the <code class="literal">weekly</code> folder</li><li class="listitem" style="list-style-type: disc">Daily <code class="literal">index.dat</code> file, which is located under the <code class="literal">daily</code> folder</li></ul></div><p>Each index file contains entries about the visited websites. Each entry starts with a URL as a signature. Each entry contains the website title, URL, username, number of hits, and two timestamps—one at offset 8, and the second one at offset 16 from the start of each entry. Each timestamp is 32 bits or 8 bytes long:</p><div class="mediaobject"><img src="graphics/image_10_005.jpg" alt="History.IE5"/><div class="caption"><p>Hex dump of the weekly index.dat file</p></div></div><p>Knowing the timezone of the machine is a very critical piece of information for the analysis process, but you must also know how each artifact in Windows is storing its timestampsâeither in UTC or local time. In <code class="literal">History.IE5</code>, there are three different <code class="literal">index.dat</code> files, each file stores timestamps in a different way:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><tbody><tr><td>
<p>Type of <code class="literal">index.dat</code> file</p>
</td><td>
<p>First timestamp at offset 8</p>
</td><td>
<p>Second timestamp at offset 16</p>
</td></tr><tr><td>
<p>Main</p>
</td><td>
<p>Last access (UTC)</p>
</td><td>
<p>Last access (UTC)</p>
</td></tr><tr><td>
<p>Daily</p>
</td><td>
<p>Last access (local time)</p>
</td><td>
<p>Last access (UTC)</p>
</td></tr><tr><td>
<p>Weekly</p>
</td><td>
<p>Last access (local time)</p>
</td><td>
<p>Creation time of the <code class="literal">index.dat</code> file (UTC)</p>
</td></tr></tbody></table></div><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Different timestamps for different index.dat files</em></span></p></blockquote></div><p>The timestamp can be converted to a human readable format using the <code class="literal">DCode.exe</code> tool (<a class="ulink" href="http://www.digital-detective.net/digital-forensic-software/free-tools/">http://www.digital-detective.net/digital-forensic-software/free-tools/</a>):</p><div class="mediaobject"><img src="graphics/image_10_006.jpg" alt="History.IE5"/><div class="caption"><p>The first timestamp in weekly index.dat decoded using the DCode.exe tool</p></div></div><p>The first timestamp of the weekly <code class="literal">index.dat</code> entry shows the date on which it was last accessed in local time. So, this page was last accessed on <span class="strong"><strong>Thu, 19 February 2015 13:47:22 UTC</strong></span>, considering that the machine's timezone was UTC+2.</p><p>In the same way, the second timestamp is <span class="strong"><strong>
<span class="strong"><strong>Sat, 28 February 2015 20:39:24</strong></span>
</strong></span>, which is the creation date of the weekly <code class="literal">index.dat</code> file itself in UTC.</p><p>In case we don't know the timezone of the machine, the difference in time between the first and the second timestamp in the same entry in the daily <code class="literal">index.dat</code> file is the difference between the UTC and the local time of the machine.</p></div><div class="section" title="IEHistoryView"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec15"/>IEHistoryView</h3></div></div></div><p>IEHistoryView (<a class="ulink" href="http://www.nirsoft.net/utils/iehv.html">http://www.nirsoft.net/utils/iehv.html</a>) can open the <code class="literal">history</code> file and parse it from live system or within the Wine environment in Linux with the History folder. It can parse history up to MSIE Version 9:</p><div class="mediaobject"><img src="graphics/image_10_007.jpg" alt="IEHistoryView"/><div class="caption"><p>The IEHistoryView tool (index.dat parser)</p></div></div></div><div class="section" title="BrowsingHistoryView"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec16"/>BrowsingHistoryView</h3></div></div></div><p>BrowsingHistoryView (<a class="ulink" href="http://nirsoft.net/utils/browsing_history_view.html">http://nirsoft.net/utils/browsing_history_view.html</a>) is another program that can parse all versions of the MSIE, and it has two versions for 32-bit and 64-bit systems. Also, it can work on a live system and in a postmortem analysis by providing the program with the webcache directory location. It also can parse the history of different other browsers:</p><div class="mediaobject"><img src="graphics/image_10_008.jpg" alt="BrowsingHistoryView"/><div class="caption"><p>BrowsingHistoryView custom analysis</p></div></div></div><div class="section" title="MiTeC Internet History browser"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec17"/>MiTeC Internet History browser</h3></div></div></div><p>MiTeC Internet History browser is free software from MiTeC (<a class="ulink" href="http://www.mitec.cz/ihb.html">http://www.mitec.cz/ihb.html</a>). This works on all MSIE versions and on other browsers as well. It parses the machine and displays the results of different browsers in the same output:</p><div class="mediaobject"><img src="graphics/image_10_009.jpg" alt="MiTeC Internet History browser"/><div class="caption"><p>MiTeC IHB output (three different browsers) on Windows 8.1</p></div></div></div></div><div class="section" title="Cache"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec90"/>Cache</h2></div></div></div><p>When the user visits Internet pages, these pages will be cached to the system in order to speed up browsing. For example, if the user pressed the back button in the browser, then the browser will fetch the page from the local system instead of requesting it again from the remote server. From the forensics perspective, this is useful to find a way to rebuild the contents of the pages that a user has been visiting. Cached data allow us to do this.</p><p>The cached data location differs from one version of Windows to another, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Before Windows Vista, the cache file was called <code class="literal">Content.IE5</code> and was located at <code class="literal">&lt;SystemPartition&gt;\Documents and Settings\&lt;Username&gt;\Local Settings\Temporary Internet Files\Content.IE5</code></li><li class="listitem" style="list-style-type: disc">In Windows Vista, Windows 7, and Windows 8:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Local\Microsoft\Windows\Temporary Internet Files\Content.IE5</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Local\Microsoft\Windows\Temporary Internet Files\Low\Content.IE5</code></li></ul></div><p>
</p></li><li class="listitem" style="list-style-type: disc">In Windows 8 or with the beginning of MSIE V10.0, the cache is combined with the <code class="literal">WebCacheV#.dat</code> file, but the old locations still exist with only a file with size of 0 bytes named <code class="literal">container.dat</code>:<div class="mediaobject"><img src="graphics/image_10_010.jpg" alt="Cache"/><div class="caption"><p>Content.IE5 for MSIE Version 11 running on Windows 7</p></div></div></li><li class="listitem" style="list-style-type: disc">In Windows 8.1, the <code class="literal">WebCacheV#.dat</code> file is still also used by the operating system to save a cache, but the old location has been changed to the <code class="literal">INetCache</code> directory starting from MSIE V11.0:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Local\Microsoft\Windows\INetCache\IE</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Local\Microsoft\Windows\INetCache\Low\IE</code></li></ul></div></li></ul></div><p>The following screenshot shows the new cache location in Windows 8.1:</p><div class="mediaobject"><img src="graphics/image_10_011.jpg" alt="Cache"/><div class="caption"><p>Windows 8.1 cache location</p></div></div><div class="section" title="Content.IE5"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec18"/>Content.IE5</h3></div></div></div><p>The <code class="literal">Content.IE5</code> folder was used starting from MSIE5 and it contains randomly named folders that contain the actual data of the visited pages. The <code class="literal">index.dat</code> file, located in the Content.IE5 folder, contains the metadata of each cached file. This file tracks the cached contents and identifies which files are located under the sub-directories.</p><p>It contains the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The original address with the HTTP header returned from the request</li><li class="listitem" style="list-style-type: disc">The location of the file cached for this URL</li><li class="listitem" style="list-style-type: disc">The type of cache record, that is, URL and LEAK for normal record, REDR for redirected pages, and HASH to index the contents of the file:<div class="mediaobject"><img src="graphics/image_10_012.jpg" alt="Content.IE5"/><div class="caption"><p>A sample URL entry in index.dat file</p></div></div></li></ul></div><p>Along with this information, there are some timestamps stored in the <code class="literal">index.dat</code> file as well.</p></div><div class="section" title="IECacheView"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec19"/>IECacheView</h3></div></div></div><p>The IECacheView program from <a class="ulink" href="http://www.nirsoft.com">http://www.nirsoft.com</a> can parse the cache information on a live Windows system. In case of live analysis, it will detect the right location of the cached information. However, in a postmortem analysis, it should be provided with the location of the cached data:</p><div class="mediaobject"><img src="graphics/image_10_013.jpg" alt="IECacheView"/><div class="caption"><p>IECacheView parsing cached data of MSIE V8 on Windows 7</p></div></div><p>This program can do many things to each entry in the context menu, such as viewing the actual code of the page, which will be useful in identifying malicious redirection in the page with iframe.</p></div><div class="section" title="Msiecf parser (Plaso framework)"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec20"/>Msiecf parser (Plaso framework)</h3></div></div></div><p>We will highlight the Msiecf parser or the MSIE Cache File parser from Plaso framework, which we used in <a class="link" href="ch05.html" title="Chapter 5. Timeline">Chapter 5</a>, <span class="emphasis"><em>Timeline</em></span>, which parses the cache file from the system partition from the forensics image or backup and includes all the results in the storage file created by the log2timeline tool.</p><p>We can create the storage file for this parser, which will take little time as compared to the creation of a complete storage file by, for example, Win7 parser. In this case, we need to mount the image and point to the user profile location in the mounted image:</p><div class="mediaobject"><img src="graphics/image_10_014.jpg" alt="Msiecf parser (Plaso framework)"/><div class="caption"><p>Msiecf Parser from Plaso framework</p></div></div><p>Then, we can use the <code class="literal">psort.py</code> tool to filter the created storage file as before.</p></div></div><div class="section" title="Cookies"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec91"/>Cookies</h2></div></div></div><p>Cookies are used by the remote site to track the user activities on the site. The remote site adds some information to a single file called a cookie. This information differs from one site to another.</p><p>For example, a user uses an online shopping site, starts adding items to their cart, and browses between different sections on the site without losing previously added items and without signing in to the site. One way to do this is by adding cookies to the user's machine.</p><p>There are two different types of cookies:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Session cookies</strong></span>: These are stored only in the memory of the running machine. This type can be investigated during memory forensics.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Persistent cookies</strong></span>: These will be stored to the local filesystem, and this type of cookie is what we are interested in this section.</li></ul></div><p>Like history and cache, the location of the cookies in the machine differs between different versions, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Before Windows Vista: <code class="literal">&lt;SystemPartition&gt;\Documents and Settings\&lt;Username&gt;\Cookies</code></li><li class="listitem" style="list-style-type: disc">In Windows Vista, Windows 7, and Windows 8:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Roaming\Microsoft\Windows\Cookies</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Roaming\Microsoft\Windows\Cookies\Low</code></li></ul></div><p>
</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note15"/>Note</h3><p>Starting with Windows Vista, Microsoft made some changes to the user profile folder structure and operations in the operating system to increase security. One improvement was to make more use of the roaming profile, which allows users to access machines in the same domain with their profile data. During this remote access some data, including the cookies of the user browsing, is stored locally in the roaming directory and not in the remote machine.</p></div></div></li><li class="listitem" style="list-style-type: disc">In Windows 8.1:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Local\Microsoft\Windows\INetCookies</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Local\Microsoft\Windows\INetCookies\Low</code></li></ul></div><p>
</p></li></ul></div><div class="section" title="IECookiesView"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec21"/>IECookiesView</h3></div></div></div><p>IECookiesView is a program (<a class="ulink" href="http://www.nirsoft.net/utils/internet_explorer_cookies_view.html">http://www.nirsoft.net/utils/internet_explorer_cookies_view.html</a>) that directly detects the location of the cookies in a live system, and it can be provided with the location of the cookies extracted from a forensic image in a postmortem analysis:</p><div class="mediaobject"><img src="graphics/image_10_015.jpg" alt="IECookiesView"/><div class="caption"><p>IECookiesView on live Windows 7 running MSIE V8</p></div></div><p>The output of the IECookiesView contains the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The website this cookie was created for</li><li class="listitem" style="list-style-type: disc">The number of visits to this website (number of hits)</li><li class="listitem" style="list-style-type: disc">Timestamps for the cookies stored in UTC</li><li class="listitem" style="list-style-type: disc">The user who accessed the URL, which can be seen mentioned as part of the filename in the following pattern: <code class="literal">&lt;UserName&gt;@&lt;SiteURL&gt;</code></li></ul></div></div><div class="section" title="Favorites"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec22"/>Favorites</h3></div></div></div><p>Favorites are some websites that are stored by the user for future use. These favorites can help in identifying and profiling user activities. The location of the favorites changed after Windows Vista as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Before Windows Vista: <code class="literal">&lt;SystemPartition&gt;\Documents and Settings\&lt;Username&gt;\Favorites</code></li><li class="listitem" style="list-style-type: disc">After Windows Vista: <code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\Favorites</code></li></ul></div></div><div class="section" title="FavoritesView"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec23"/>FavoritesView</h3></div></div></div><p>FavoritesView is another program from Nirsoft (<a class="ulink" href="http://www.nirsoft.net/utils/faview.html">http://www.nirsoft.net/utils/faview.html</a>) that parses the bookmarks of Mozilla Firefox and Netscape in the same window. In some cases and if the program is running under live system, it won't open the correct location of the favorites or bookmarks, so the investigator needs to open the correct locations:</p><div class="mediaobject"><img src="graphics/image_10_016.jpg" alt="FavoritesView"/><div class="caption"><p>FavoritesView on Windows 8.1</p></div></div></div></div><div class="section" title="Session restore"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec92"/>Session restore</h2></div></div></div><p>Starting from MSIE V8.0 Microsoft implemented a recovery mode to recover the opened tabs if MSIE crashed:</p><div class="mediaobject"><img src="graphics/image_10_017.jpg" alt="Session restore"/><div class="caption"><p>Crash recovery message of MSIE</p></div></div><p>Each opened tab has a file describing the pages opened with this tab. The location that contains data differs from one Windows version to another, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Before Windows Vista and with MSIE V8: <code class="literal">&lt;SystemPartition&gt;\Documents and Settings\&lt;Username&gt;\ Local Settings\Internet Explorer\Recovery</code></li><li class="listitem" style="list-style-type: disc">Windows Vista, Windows 7, Windows 8, and Windows 8.1: <code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Local\Microsoft\Internet Explorer\Recovery</code></li></ul></div><p>This will provide great help to the investigator, especially if the history was turned off. Each file is an OLE-structured storage file with the signature of <code class="literal">0xD0CF11E0A1B11AE1</code>. This type of file needs a special parser.</p><div class="section" title="MiTeC SSV"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec24"/>MiTeC SSV</h3></div></div></div><p>MiTeC Structured Storage Viewer, from <a class="ulink" href="http://www.mitec.cz/ssv.html">http://www.mitec.cz/ssv.html</a>, can read the structured storage format and parse it.</p><p>By opening one of the last active files in the recovery directory by the SSV, we can find some timestamps of the file itself:</p><div class="mediaobject"><img src="graphics/image_10_018.jpg" alt="MiTeC SSV"/><div class="caption"><p>Timestamps in SSV</p></div></div><p>The creation time indicates the time when the session was ended as long as the file was found under the last active folder. If we investigate the active folder, the time will indicate when the tab was opened:</p><div class="mediaobject"><img src="graphics/image_10_019.jpg" alt="MiTeC SSV"/><div class="caption"><p>An example of the last active sessions of MSIE</p></div></div><p>In the previous figure, two pages were opened in this tab. We are now interested in two files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">|KjjaqfajN2c0uzgv1l4qy5nfWe</code>: This contains the last opened URL in the tab</li><li class="listitem" style="list-style-type: disc"><code class="literal">TL#</code>: This is the page that opened in the tab. Instead of the # sign, there will be a number, which indicates the order of the tab in the session</li></ul></div><p>Each TL# page has the page title, page URL, and the referring site if there is one.</p></div><div class="section" title="Inprivate mode"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec25"/>Inprivate mode</h3></div></div></div><p><span class="strong"><strong>Inprivate</strong></span> or <span class="strong"><strong>Incognito</strong></span> modes are in almost all browsers nowadays. In the Inprivate mode, no artifacts are saved to the hard drive. All the artifacts are in memory, including the session cookies. Memory forensics can provide good results in such cases. This is another reason why we need to capture the memory of a running system and not shut it down.</p><p>The session recovery files during the Inprivate mode are created in the same location but deleted after closing the session. With MSIE Inprivate mode, recovering these files can provide some information about the visited sites during the Inprivate sessions. Carving the unallocated space for the OLE file header can be enough to recover these files.</p></div></div><div class="section" title="WebCacheV#.dat"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec93"/>WebCacheV#.dat</h2></div></div></div><p>MSIE Version 10 was released with Windows 8. Starting from this version, a relatively new artifact was introduced, the <code class="literal">WebcacheV#.dat</code> file. <code class="literal">WebcacheV#.dat</code> is a single file that contains many browser data, that is, history, cache, and cookies together. Instead of the # in the file name, there is a two digit number, this number may differ from one system to another, but there will be only one file with this name at <code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Local\Microsoft\Windows\WebCache\</code>:</p><div class="mediaobject"><img src="graphics/image_10_020.jpg" alt="WebCacheV#.dat"/><div class="caption"><p>WebCacheV#.dat in Windows 8.1</p></div></div><p>This file is an <span class="strong"><strong>Extensible Storage Engine</strong></span> (<span class="strong"><strong>ESE</strong></span>) database file or EDB. This type of database is used in many Microsoft applications, such as Windows search, Active directory, and Windows Mail.</p><p>Although this file contains many browser artifacts combined, the old locations of the browser artifacts still have the old files, but they are unused (we will explain this later).</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note16"/>Note</h3><p>Most of the artifacts won't be extracted from a live system because they are already in use by the operating system. They can be extracted from the forensic image. Otherwise, we can use programs, such as <span class="strong"><strong>FTK imager</strong></span>, if we have the suitable privilege to dump these files from the live system as discussed earlier.</p></div></div><p>As it is an ESE database, the <code class="literal">WebcacheV#.dat</code> file can be tested to see whether it is corrupted with the Windows utility, <code class="literal">Esentutl</code>:</p><div class="mediaobject"><img src="graphics/image_10_021.jpg" alt="WebCacheV#.dat"/><div class="caption"><p>The Esentutl utility to test the WebCacheV01.dat file</p></div></div><div class="section" title="ESEDatabaseView"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec26"/>ESEDatabaseView</h3></div></div></div><p>ESEDatabaseView from Nirsoft can be used to open the <code class="literal">.dat</code> file. Once opened, we can find many containers (tables) in the database. We can list all the containers in the containers table:</p><div class="mediaobject"><img src="graphics/image_10_022.jpg" alt="ESEDatabaseView"/><div class="caption"><p>The list of containers in the WebCacheV01.dat file</p></div></div><p>We can see all the artifacts that are located in the <code class="literal">WebCacheV#.dat</code> file, such as the highlighted history data in the following screenshot:</p><div class="mediaobject"><img src="graphics/image_10_023.jpg" alt="ESEDatabaseView"/><div class="caption"><p>The history containers within the WebCacheV01.dat file (cropped image)</p></div></div><p>Then, using the container ID we can list the table or the container which contains the actual data. For example, container 1 contains the <code class="literal">History.IE5</code> data:</p><div class="mediaobject"><img src="graphics/image_10_024.jpg" alt="ESEDatabaseView"/><div class="caption"><p>The History.IE5 container in the WebCacheV01.dat file (cropped image)</p></div></div></div></div></div>
<div class="section" title="Firefox"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec61"/>Firefox</h1></div></div></div><p>Firefox is a widely-used browser that started in 2004 and has kept developing since. Starting from version 3, it started to use the SQLite format to store the usage artifacts except for the cache, and since this version the location of these artifacts is the same.</p><p>The location of the cache is at the following places:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Before Windows Vista: <code class="literal">&lt;SystemPartition&gt;\Documents and Settings\&lt;Username&gt;\Local Settings\Application Data\Mozilla\Firefox\Profiles\&lt;profile folder&gt;</code></li><li class="listitem" style="list-style-type: disc">Since Windows Vista: <code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Local\Mozilla\Firefox\Profiles\&lt;profile folder&gt;</code></li></ul></div><p>The rest of the artifacts are at the following locations:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Before Windows Vista: <code class="literal">&lt;SystemPartition&gt;\Documents and Settings\&lt;Username&gt;\Application Data\Mozilla\Firefox\Profiles\&lt;profile folder&gt;</code></li><li class="listitem" style="list-style-type: disc">Since Windows Vista: <code class="literal">&lt;SystemPartition&gt;\Users\&lt;Username&gt;\AppData\Roaming\Mozilla\Firefox\Profiles\&lt;profile folder&gt;</code></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note17"/>Note</h3><p>The <code class="literal">&lt;profile folder&gt;</code> folder consists of <code class="literal">&lt;RandomText&gt;.default</code>, such as <code class="literal">918159wp.default</code>.</p></div></div><div class="section" title="Places.sqlite"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec94"/>Places.sqlite</h2></div></div></div><p><code class="literal">Places.sqlite</code> contains the browsing history of the Firefox browser. It contains a lot of information including the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">URL</li><li class="listitem" style="list-style-type: disc">First visit date/time</li><li class="listitem" style="list-style-type: disc">Last visit date/time</li><li class="listitem" style="list-style-type: disc">Visit count</li><li class="listitem" style="list-style-type: disc">Referrer</li><li class="listitem" style="list-style-type: disc">Title of the visited page</li><li class="listitem" style="list-style-type: disc">Visit type, which includes the following:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Clicked link</li><li class="listitem" style="list-style-type: disc">Typed URL</li><li class="listitem" style="list-style-type: disc">Redirected</li><li class="listitem" style="list-style-type: disc">Opened from bookmarks</li></ul></div><p>
</p></li></ul></div><div class="section" title="MozillaHistoryView"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec27"/>MozillaHistoryView</h3></div></div></div><p>To parse Firefox history, we can use MozillaHistoryView (<a class="ulink" href="http://www.nirsoft.net/utils/mozilla_history_view.html">http://www.nirsoft.net/utils/mozilla_history_view.html</a>). This usually runs on a live system and automatically detects the location of the profiles in the running system, or it provides the SQLite database location:</p><div class="mediaobject"><img src="graphics/image_10_025.jpg" alt="MozillaHistoryView"/><div class="caption"><p>The MozillaHistoryView options</p></div></div></div></div><div class="section" title="Cookies.sqlite"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec95"/>Cookies.sqlite</h2></div></div></div><p><code class="literal">Cookies.sqlite</code> contains the browsing cookies of Firefox. It stores the following information:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Remote website</li><li class="listitem" style="list-style-type: disc">Cookie name</li><li class="listitem" style="list-style-type: disc">Creation time</li><li class="listitem" style="list-style-type: disc">Last accessed time</li><li class="listitem" style="list-style-type: disc">Connection typeâeither secure or not secure</li><li class="listitem" style="list-style-type: disc">Stored data from the website</li></ul></div><div class="section" title="MozillaCookiesView"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec28"/>MozillaCookiesView</h3></div></div></div><p>To parse the Firefox Cookies, we can use MozillaCookiesView from <a class="ulink" href="http://www.nirsoft.net/utils/mzcv.html">http://www.nirsoft.net/utils/mzcv.html</a>. It parses and lists the cookies in the running system or in the profile directories that are pointed to:</p><div class="mediaobject"><img src="graphics/image_10_026.jpg" alt="MozillaCookiesView"/><div class="caption"><p>MozillaCookiesView</p></div></div></div></div><div class="section" title="Cache"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec96"/>Cache</h2></div></div></div><p>The Firefox cache format is the same for all versions. Its location hasn't changed from one version to another. It contains the following information about the cached files in the system:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Name</li><li class="listitem" style="list-style-type: disc">Type</li><li class="listitem" style="list-style-type: disc">Source URL of the download</li><li class="listitem" style="list-style-type: disc">Size</li><li class="listitem" style="list-style-type: disc">Timestamps (last modification, last request, and expiration time)</li><li class="listitem" style="list-style-type: disc">Count (how many times this file was used from the cached data)</li></ul></div><div class="section" title="MozillaCacheView"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec29"/>MozillaCacheView</h3></div></div></div><p>MozillaCacheView (<a class="ulink" href="http://www.nirsoft.net/utils/mozilla_cache_viewer.html">http://www.nirsoft.net/utils/mozilla_cache_viewer.html</a>) can parse and view the cached data of Firefox. It can also export any file from the cached data for examination:</p><div class="mediaobject"><img src="graphics/image_10_027.jpg" alt="MozillaCacheView"/><div class="caption"><p>MozillaCacheView</p></div></div></div></div></div>
<div class="section" title="Other browsers"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec62"/>Other browsers</h1></div></div></div><p>From the previous analysis of MSIE and Firefox, we can understand how it is a challenge for digital forensics investigators to conduct browser forensics because of the huge number of browsers on the market and the difference in storing their browsing artifacts in the system. Nirsoft.net contains many other tools to parse different browsers at <a class="ulink" href="http://www.nirsoft.net/web_browser_tools.html">http://www.nirsoft.net/web_browser_tools.html</a> for Google Chrome, Opera, and Safari.</p></div>
<div class="section" title="E-mail investigation"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec63"/>E-mail investigation</h1></div></div></div><p>E-mail is one of the most-used methods of communication nowadays, especially in corporate environments. Sending, receiving, or reading e-mails leaves traces in the electronic devices. These traces could help in analyzing cases of targeted attacks, blackmail, espionage, information leakage, and harassment. Traces of e-mail differ according to the way of using the e-mail account, either by webmail or an installed e-mail client.</p><p>In webmail, browser investigation and memory forensics could help in retrieving some e-mail data and even in some cases recover access credentials for the e-mail account. In this section, we will discuss the Outlook e-mail client artifacts on the machine.</p><div class="section" title="Outlook PST file"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec97"/>Outlook PST file</h2></div></div></div><p>There are many e-mail clients on the market. Outlook from Microsoft is one of the most-used clients. Outlook stores all the messages, contacts, and calendar in a <span class="strong"><strong>Personal File Folder</strong></span> (<span class="strong"><strong>PFF</strong></span>) file. One of the PFFs is the <span class="strong"><strong>Personal Storage Table</strong></span> (<span class="strong"><strong>PST</strong></span>) file and is saved by default in the following location:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">My Documents\Outlook Files</code> in Windows XP</li><li class="listitem" style="list-style-type: disc"><code class="literal">Documents\Outlook Files</code> starting from Windows Vista</li></ul></div><p>Users can archive e-mails to their machine and free their space on the mail server. The archived e-mails will be stored in the PST file as well. The archived PST file won't be connected to the server and won't be associated to the user account. It will only be available on the user's local computer and won't be available on any other devices associated with the user and synced with their account, unless the user copies the archived PST file to another device.</p><p>The archived file locations are, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;SystemPartition&gt;\Documents and Settings\&lt;username&gt;\Local Settings\Application Data\Microsoft\Outlook</code> in Windows XP</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;SystemPartition&gt;\Users\&lt;username&gt;\AppData\Local\Microsoft\Outlook</code> starting from Windows Vista</li></ul></div><p>A PST file can be imported to Outlook, but it won't be uploaded to the server. It will be only available on the local running client.</p></div><div class="section" title="Outlook OST files"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec98"/>Outlook OST files</h2></div></div></div><p>Another PFF file is the <span class="strong"><strong>Offline Storage Table</strong></span> (<span class="strong"><strong>OST</strong></span>) file. It is mostly used with the Microsoft exchange server account. It allows the user to create, edit, or delete messages on the local computer without connecting to the server; and once the connection is established, the client syncs with the server and updates all the new changes made by the user to make both copies on the server and the client the same.</p><p>The OST file can be located at the following locations:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;SystemPartition&gt;\Documents and Settings\&lt;username&gt;\Local Settings\Application Data\Microsoft\Outlook</code> in Windows XP</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;SystemPartition&gt;\Users\&lt;username&gt;\AppData\Local\Microsoft\Outlook</code> starting from Windows Vista.</li></ul></div><p>Unlike the PST files, OST can't be imported to Outlook; it needs to be converted to the PST file format first. Different commercial tools can make this conversion.</p></div><div class="section" title="EML and MSG files"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec99"/>EML and MSG files</h2></div></div></div><p>An EML file contains single messages saved by the user. The EML file is a plain text file that contains the message details, including the header, body, and attachments. An EML file can be opened with Outlook or any compatible e-mail clients. Also, there are some EML viewers.</p><p>Another format for saved e-mails is the MSG format. MSG is a binary format and can be treated as a compound file for analysis with a compound file parser, such as the <span class="strong"><strong>Libolecf</strong></span> by Joachim Metz:</p><div class="mediaobject"><img src="graphics/image_10_028.jpg" alt="EML and MSG files"/><div class="caption"><p>Libolecf against an MSG file</p></div></div></div><div class="section" title="DBX (Outlook Express)"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec100"/>DBX (Outlook Express)</h2></div></div></div><p>Outlook Express was used before Windows Vista, and then was replaced with Microsoft Outlook. Outlook Express uses DBX files as the message storage. A DBX file is stored at <code class="literal">&lt;SystemPartition&gt;\Documents and Settings\&lt;username&gt;\Local Settings\Application Data\Identities\&lt;Identity number&gt;\Microsoft\Outlook Express</code>. The Outlook Express folder has the following files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Folder.DBX</code>: This is the master file in Outlook Express. It contains the tree structure of the folders in the mail. There is a different DBX file for each folder in the mail structure, including <code class="literal">Inbox.DBX</code>, <code class="literal">SentItems.DBX</code>, and <code class="literal">Drafts.DBX</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Cleanup.log</code>: This is used to log the cleanup operations in the deleted files. Outlook Express creates a log for the last archive. During archiving, Outlook Express actually cleans up deleted items. In normal behavior, it just marks an item as deleted and keeps it in the DBX file.</li></ul></div></div><div class="section" title="PFF Analysis (libpff)"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec101"/>PFF Analysis (libpff)</h2></div></div></div><p>Library libpff (<a class="ulink" href="https://github.com/libyal/libpff/">https://github.com/libyal/libpff/</a>) is a cross-platform library to open and parse the PFF files. This library has two tools: <code class="literal">pffinfo</code> and <code class="literal">pffexport</code>.</p><p>Let's try to investigate an OST file retrieved from the forensic image of Windows 7. First, let's find information about the OST file using <code class="literal">pffinfo</code>:</p><div class="mediaobject"><img src="graphics/image_10_029.jpg" alt="PFF Analysis (libpff)"/><div class="caption"><p>Getting information from the OST file</p></div></div><p>Now, we know that there is no encryption on the OST file, so let's export the data from the file:</p><div class="mediaobject"><img src="graphics/image_10_030.jpg" alt="PFF Analysis (libpff)"/><div class="caption"><p>Exporting the data from the OST file</p></div></div><p>A new folder, <code class="literal">&lt;OSTfilename&gt;.export</code>, will be created under the working directory. In our case, it will be <code class="literal">test.ost.export</code>. As there are many items in the OST file, we created the <code class="literal">log.txt</code> file to log all these exported items, and then we can filter the log file and locate the items of interest. In our case, if we are interested in e-mails only, we can <code class="literal">grep</code> the <code class="literal">log.txt</code> file for e-mail:</p><div class="mediaobject"><img src="graphics/image_10_031.jpg" alt="PFF Analysis (libpff)"/><div class="caption"><p>E-mails in the OST file</p></div></div><p>So, there are some e-mails in different folders, such as Deleted Items and Inbox. In case we are interested in the received e-mails, which could contain malicious links or attachments that deceived the user to infect the machine, we can check the e-mails in the Inbox folder.</p><p>In the created export folder, we will find the same folder structure in the OST. We can navigate to one message location and view the contents of this message's folder, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/image_10_032.jpg" alt="PFF Analysis (libpff)"/><div class="caption"><p>The contents of each message</p></div></div><p>We will find different files for each message, including the message header and the message body itself. Using the header, we can track the sender. The message body will help us check for malicious or phishing links. If the message has an attachment, another directory with the attached files will be found under the message directory. The attachment could be malicious.</p></div><div class="section" title="Other tools"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec102"/>Other tools</h2></div></div></div><p>There are many tools used to read and parse different e-mail files. Some of these of tools can run on a live system for live analysis.</p><p>Some of these tools are, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">MiTeC mail viewer for Microsoft Outlook Express 4, 5, and 6 message database [<code class="literal">*.idx</code>/<code class="literal">*.mbx</code>/<code class="literal">*.dbx</code>], Windows Vista Mail/Windows Live Mail, and Mozilla Thunderbird message databases as well as standalone EML files. You can download this from <a class="ulink" href="http://www.mitec.cz/mailview.html">http://www.mitec.cz/mailview.html</a>.</li><li class="listitem" style="list-style-type: disc">Different tools from <a class="ulink" href="http://www.freeviewer.org">http://www.freeviewer.org</a> to view PST, OST, EML, and DBX files:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">PST File Viewer</li><li class="listitem" style="list-style-type: disc">OST File Viewer</li><li class="listitem" style="list-style-type: disc">EML File Viewer</li><li class="listitem" style="list-style-type: disc">Outlook DBX Viewer</li></ul></div><p>
</p></li><li class="listitem" style="list-style-type: disc">Different tools from <a class="ulink" href="http://www.nucleustechnologies.com">http://www.nucleustechnologies.com</a> to view PST, OST, and EML files:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Kernel PST viewer</li><li class="listitem" style="list-style-type: disc">Kernel OST viewer</li><li class="listitem" style="list-style-type: disc">Kernel EML Viewer</li></ul></div><p>
</p></li></ul></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec64"/>Summary</h1></div></div></div><p>In this chapter, we discussed the importance of browser analysis, browser artifacts, and how to find and parse these artifacts in different browsers. Then, we learned about parsing PFF files for Microsoft Outlook and different e-mail files, such as MSG and EML.</p><p>In the next chapter, we will go through Windows memory analysis and show you how it is not optional anymore to perform memory forensics.</p></div></body></html>