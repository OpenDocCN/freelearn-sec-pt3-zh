<html><head></head><body>
		<div><h1 id="_idParaDest-273"><em class="italic"><a id="_idTextAnchor287"/>Chapter 12</em>: Mastering Web App Security</h1>
			<p><em class="italic">"Web applications are everywhere, attackers nowadays invest a lot of energy in understanding their attack surface and exploiting their vulnerabilities. We, on the other hand, need to do exactly the same." </em></p>
			<p><em class="italic"> – Cristian Rodríguez, Offensive Security Certified Professional (OSCP) | Offensive Security Web Expert (OSWE)</em></p>
			<p>Indeed, we must protect our web applications, and that is why we created a super exciting chapter in which you will acquire all the knowledge needed to master the skills of securing web applications. First, we will start by showing you how much information others may know about your site or web application and the importance of obfuscating all that public information.</p>
			<p>Then, it will be time to get into more technical stuff, and we will introduce you to one of the most common attacks for web applications: <strong class="bold">Cross-Site Scripting</strong> (<strong class="bold">XSS</strong>). After that, the rest of the chapter will be very techy and hands-on.</p>
			<p>We will start with a step-by-step guide to install two must-have cybersecurity tools, shown here: </p>
			<ul>
				<li><strong class="bold">Damn Vulnerable Web Application</strong> (<strong class="bold">DVWA</strong>)</li>
				<li>Burp Suite</li>
			</ul>
			<p>DVWA is a great tool that gives you a safe virtual environment in which you can test and even become familiar with several vulnerabilities on web applications.</p>
			<p>On the other hand, Burp Suite is an excellent tool to test a given web application in real time.</p>
			<p>Once we have both tools configured, we will then do a lab to show you how to test a web application against the following two types of attacks:</p>
			<ul>
				<li>A <strong class="bold">Structured Query Language</strong> (<strong class="bold">SQL</strong>) injection attack</li>
				<li>A brute-force attack </li>
			</ul>
			<p>As a summary, here are the main topics that we will cover in this chapter:</p>
			<ul>
				<li>Gathering intelligence about your site/web application</li>
				<li>Leveraging DVWA</li>
				<li>Overviewing the most common attacks on web applications</li>
				<li>Using Burp Suite</li>
				<li>SQL injection attack on DVWA</li>
				<li>Brute-forcing web applications' passwords</li>
			</ul>
			<h1 id="_idParaDest-274"><a id="_idTextAnchor288"/>Technical requirements </h1>
			<p>To fully leverage the content of this chapter, it is recommended to have installed a <strong class="bold">Virtual Machine</strong> (<strong class="bold">VM</strong>) with Kali Linux to properly follow the labs.</p>
			<p>We will also use two tools, DVWA and Burp Suite, but we will cover how to install and configure them, so no worries about that.</p>
			<h1 id="_idParaDest-275"><a id="_idTextAnchor289"/>Gathering intelligence about your site/web application</h1>
			<p>The very <a id="_idIndexMarker1221"/>first step when securing your web resources (website, web applications, <strong class="bold">Application Programming Interface</strong> (<strong class="bold">API</strong>), and so on) is to determine what kind of information<a id="_idIndexMarker1222"/> is easily and freely available about them on the internet. If you wonder why you should do this, the response is very simple: because this is what attackers do first!</p>
			<p>And believe it or not, there are thousands of web resources exposing sensitive data such as <em class="italic">passwords</em>, <em class="italic">database users</em>, <em class="italic">sensitive documents</em>, and so on.</p>
			<h2 id="_idParaDest-276"><a id="_idTextAnchor290"/>Importance of public data gathering</h2>
			<p>Now, let's <a id="_idIndexMarker1223"/>start by understanding the key aspects that highlight the importance of this activity (and why you must invest time and resources doing it), as follows:</p>
			<ul>
				<li>Public information can be used on a targeted social engineering attack (phishing, vishing, impersonation, and so on).</li>
				<li>Usernames can be used to execute targeted password attacks (dictionary attacks, brute-force attacks, and so on).</li>
				<li>Server<a id="_idIndexMarker1224"/> names and <strong class="bold">Internet Protocol</strong> (<strong class="bold">IP</strong>) addresses can be <a id="_idIndexMarker1225"/>used to execute targeted <strong class="bold">Denial-of-Service</strong> (<strong class="bold">DOS</strong>) attacks.</li>
				<li>Public information can be used by attackers to create better dictionary attacks.</li>
			</ul>
			<p>Now, let's see how to crawl the internet to discover how much information about your sites is <a id="_idIndexMarker1226"/>publicly available.</p>
			<h2 id="_idParaDest-277"><a id="_idTextAnchor291"/>Open Source Intelligence</h2>
			<p><strong class="bold">Open Source Intelligence</strong> (<strong class="bold">OSINT</strong>) is<a id="_idIndexMarker1227"/> about gathering intelligence or information from public (open) resources such as the internet. This term was normally used by intelligence services but is now very common in the cybersecurity area.</p>
			<p>In fact, there is a very good<a id="_idIndexMarker1228"/> framework (<a href="https://osintframework.com/">https://osintframework.com/</a>) that includes several resources available for you to gather all types of data from the internet, and next, we will see the most relevant tools that you can use for this data gathering.</p>
			<h3>DNS lookup</h3>
			<p>These tools <a id="_idIndexMarker1229"/>allow you to <a id="_idIndexMarker1230"/>gather <strong class="bold">Domain Name System</strong> (<strong class="bold">DNS</strong>) information about your web resources. Therefore, it is highly recommended to check your sites to see what others know about them.</p>
			<p>A good example <a id="_idIndexMarker1231"/>is the site <a href="https://spyse.com/tools/dns-lookup">https://spyse.com/tools/dns-lookup</a>, which gives you more than just DNS information, such as the following:</p>
			<ul>
				<li>DNS<a id="_idIndexMarker1232"/> records (<strong class="bold">Mail Exchange</strong> (<strong class="bold">MX</strong>), <strong class="bold">Address</strong> (<strong class="bold">A</strong>), name server)</li>
				<li>DNS history</li>
				<li>The<a id="_idIndexMarker1233"/> technology <a id="_idIndexMarker1234"/>used (<strong class="bold">operating system (OS)</strong>, <strong class="bold">Internet Information Services</strong> (<strong class="bold">IIS</strong>), libraries, fonts, <strong class="bold">Content Management System</strong> (<strong class="bold">CMS</strong>), and <a id="_idIndexMarker1235"/>so <a id="_idIndexMarker1236"/>on)</li>
				<li>Subdomains</li>
				<li>Other <a id="_idIndexMarker1237"/>data (<strong class="bold">HyperText Transfer Protocol</strong> (<strong class="bold">HTTP</strong>) headers, <strong class="bold">Cascading Style Sheets</strong> (<strong class="bold">CSS</strong>), links, <strong class="bold">JavaScript</strong> (<strong class="bold">JS</strong>))</li>
				<li>Certificate<a id="_idIndexMarker1238"/> information (<strong class="bold">Secure Sockets Layer</strong>, or <strong class="bold">SSL</strong>)</li>
				<li>Verified email addresses</li>
			</ul>
			<p>Depending on your business, some of this information <em class="italic">must</em> be obfuscated as it may represent a <a id="_idIndexMarker1239"/>security or privacy risk.</p>
			<p>The page presented in the following screenshot also shows a security score based on vulnerabilities <a id="_idIndexMarker1240"/>found from <strong class="bold">Common Vulnerabilities and Exposures</strong> (<strong class="bold">CVE</strong>): </p>
			<div><div><img src="img/Figure_12.1_B16290.jpg" alt="Figure 12.1 – Vulnerabilities view from spyse.com&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.1 – Vulnerabilities view from spyse.com</p>
			<p>As you may have already inferred, these types of pages are also a good source of information to<a id="_idIndexMarker1241"/> evaluate the security of your hosting provider.</p>
			<h3>WHOIS records</h3>
			<p>These records <a id="_idIndexMarker1242"/>show information related to the owner of a given domain. The main risk here is that having those records associated with a single person may make that person a big target for cybercriminals.</p>
			<p>For example, if an attacker can see the email address of the owner of the domain of a big corporation, then the attacker can use that information to perform a plurality of attacks over that person, such as the following:</p>
			<ul>
				<li>Social engineering attacks</li>
				<li>Brute-force attacks</li>
				<li>Impersonation attacks</li>
				<li>Searching email on known data breaches to gather credentials</li>
			</ul>
			<p>To prevent those attacks, companies can pay an extra fee to the domain registrant to <em class="italic">hide</em> those records as a privacy measure, as seen in the following screenshot:</p>
			<div><div><img src="img/Figure_12.2_B16290.jpg" alt="Figure 12.2 – WHOIS output of private versus normal domain&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.2 – WHOIS output of private versus normal domain</p>
			<p>Notice in the preceding screenshot that the registrant information has been obfuscated for security and privacy. </p>
			<h2 id="_idParaDest-278"><a id="_idTextAnchor292"/>Hosting information</h2>
			<p>Another <a id="_idIndexMarker1243"/>piece of information that you may want to check is about shared hosting environments. For example, pages such as <a href="https://www.domainiq.com">https://www.domainiq.com</a> give you a list of all the domains hosted on a given server or subnet. </p>
			<p>This information can be used in two ways, as outlined next: </p>
			<ul>
				<li>Firstly, it can be used by you to determine the server reputation if you are using a shared hosting environment. </li>
				<li>Secondly, this can also represent a privacy issue as it may disclose private information about the ownership of the company. For example, you may have two companies registered under different corporations because you don't want the public to associate with them, but having both domains hosted on the same server may give away a clue about the real ownership of both companies.</li>
			</ul>
			<p>The following screenshot shows a list of domains hosted on the same server:</p>
			<div><div><img src="img/Figure_12.3_B16290.jpg" alt="Figure 12.3 – Output showing a list of domains hosted on the same server&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.3 – Output showing a list of domains hosted on the same server</p>
			<p>As a side note, this information may also be useful if you are using a third-party shared hosting environment to determine whether your site is at risk of being banned (blacklisted) due to a bad page hosted on the same server (which may impact the availability of your email server).</p>
			<h3>Web-scraping tools</h3>
			<p>There are <a id="_idIndexMarker1244"/>also some tools designed to gather all public information from a given domain.</p>
			<p>You can leverage these tools to determine how much information can be <em class="italic">harvested</em> from your site or web application to ensure that your private data remains confidential.</p>
			<p>Some examples of web-scraping tools are listed here:</p>
			<ul>
				<li><a href="https://webscraper.io">https://webscraper.io</a>: A popular<a id="_idIndexMarker1245"/> browser extension that allows you to gather all public information from a given site.</li>
				<li><a href="https://www.scraperapi.com/">https://www.scraperapi.com/</a>: This site provides users with an API to perform web scraping.</li>
				<li><a href="https://www.scraping-bot.io/">https://www.scraping-bot.io/</a>: A user-friendly system to scrape web pages.</li>
			</ul>
			<p>As seen in the following screenshot, most scraper systems will output several types of documents, including <code>.html</code>, <code>.doc</code>, <code>.pdf</code>, <code>.xls</code>, and so on:</p>
			<p class="figure-caption"> </p>
			<div><div><img src="img/Figure_12.4_B16290.jpg" alt="Figure 12.4 – Web scraping&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.4 – Web scraping</p>
			<p><em class="italic">Remember that you should only do web scraping on your own servers as this may be illegal in some countries.</em></p>
			<h3>Preventing web scraping</h3>
			<p>There are also some steps that you can take to prevent others from using web scraping against your web resources. Some of the most effective ones are listed here:</p>
			<ul>
				<li>Implement <a id="_idIndexMarker1246"/>a <strong class="bold">Web Application Firewall</strong> (<strong class="bold">WAF</strong>).</li>
				<li>Use <a id="_idIndexMarker1247"/>antibot systems (such as the <strong class="bold">Completely Automated Public Turing test to tell Computers and Humans Apart</strong> (<strong class="bold">CAPTCHA</strong>).</li>
				<li>Request <em class="italic">user registration</em> to access downloads and other information.</li>
				<li>Use <em class="italic">blacklists</em> of IPs, servers, domains, and so on.</li>
				<li>Use advanced systems such as <em class="italic">browsing fingerprinting</em> to detect potential bots.</li>
				<li>Use <em class="italic">honeypots</em> to identify attackers that want to scrap your site (and block them).</li>
			</ul>
			<p>Those tips may help protect you against some automated scraping tools, but your system may still be vulnerable to web scraping. That is why we focused the beginning of this chapter on making sure that no sensitive information is externally available so that if someone<a id="_idIndexMarker1248"/> does web scraping, they will not collect any sensitive data from our web systems.</p>
			<h2 id="_idParaDest-279"><a id="_idTextAnchor293"/>Checking data exposure with Google hacking (dorks)</h2>
			<p>I know<a id="_idIndexMarker1249"/> that many people hate<a id="_idIndexMarker1250"/> this to be <a id="_idIndexMarker1251"/>called <strong class="bold">hacking</strong> (mainly because this does not require any technical skill); however, a lot of people call Google dorks Google hacking, so I decided to keep that name in the title just to create some attention.</p>
			<p><strong class="bold">Google dorks</strong> are based <a id="_idIndexMarker1252"/>on the utilization of some search commands and parameters to harvest the internet for some private files and information in a more targeted way.</p>
			<p>As mentioned before, this is not a tool created by Google to <em class="italic">hack</em>; instead, it is about leveraging this search engine to find some sensitive information that was not properly secured and therefore exposed on the internet.</p>
			<p>Let's review some Google dorks that you can use to ensure you are not exposed on the internet. You can see an example here:</p>
			<pre>site:yoursite.com filetype:xls intext"phone" </pre>
			<p>Check whether there is any <code>.xls</code> file on your site that contains phone numbers. You can improve it by changing the <code>phone</code> keyword for any other attribute that you want to search and the file type for <code>.pdf</code>, <code>.doc</code>, and so on. Here's a code example to show you how to do this:</p>
			<pre>site:yoursite.com filetype:sql "# dumping data for table" "`PASSWORD` varchar" </pre>
			<p>Search for open databases in your web resource with the word <code>password</code>.</p>
			<p>As seen in the following screenshot, you need to carefully review the results of these dorks to<a id="_idIndexMarker1253"/> see whether the results show just<a id="_idIndexMarker1254"/> basic data (such as variable names) or more sensitive data (such as plain text passwords):</p>
			<p class="figure-caption"> </p>
			<div><div><img src="img/Figure_12.5_B16290.jpg" alt="Figure 12.5 – Google dork output&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.5 – Google dork output</p>
			<p>Even if this sounds incredible, there are times when you may even find passwords in a <code>.txt</code> file, as illustrated in the following code example:</p>
			<pre>site:yoursite.com intitle:"index of" "Index of /" password.txt </pre>
			<p>The code shown in the preceding example will search for misplaced files (such as a <code>.txt</code> file with usernames or passwords).</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">Here, you can find more than 6,000 Google dorks that you can modify based on your needs. Some are specific to particular web services, so they may be really useful for you: <a href="https://www.exploit-db.com/google-hacking-database">https://www.exploit-db.com/google-hacking-database</a>.</p>
			<p>There is also another way to prevent outsiders from using these Google dorks against your web systems by modifying the <code>robots.txt</code> file in your server, as follows:</p>
			<ul>
				<li>Prevent<a id="_idIndexMarker1255"/> indexing from Google <a id="_idIndexMarker1256"/>by running the following code: <pre>User-agent: Googlebot
Disallow: /</pre></li>
				<li>Prevent Google from indexing a specific file type by running the following code:<pre>User-agent: Googlebot
Disallow: /*.sql$</pre></li>
				<li>Prevent indexing of a given folder by running the following code:<pre>User-agent: Googlebot
Disallow: /directoryName/</pre></li>
				<li>Prevent indexing from other search engines by running the following code:<pre>User-agent: *
Disallow: /</pre></li>
			</ul>
			<p>All these are very basic (but feasible) attacks, but now you have learned how to set up the basics of web security, it's time to move on to the next step and learn about the most common attacks on web applications.</p>
			<h1 id="_idParaDest-280"><a id="_idTextAnchor294"/>Leveraging DVWA</h1>
			<p>Before moving on <a id="_idIndexMarker1257"/>with the rest of the chapter, you need to know this great tool that will help you to better understand the vulnerabilities on web applications.</p>
			<p><em class="italic">But also, we are going to use this platform to show you how you can test your web application against the most common attacks, such as the following:</em></p>
			<ul>
				<li>Brute-force attacks </li>
				<li>SQL injection attacks </li>
			</ul>
			<p>Additionally, this lightweight and easy-to-install system has a lot of cool features such as the following:</p>
			<ul>
				<li>A platform to explore several web application vulnerabilities in a safe environment</li>
				<li>A great tool to create videos or real-time demos to raise awareness about those vulnerabilities</li>
				<li>A test environment to determine the impact of attacks on web applications</li>
				<li>A sandbox environment to test remediation actions</li>
			</ul>
			<p>As mentioned, I strongly suggest you <em class="italic">install the DVWA on a VM</em> so that you can execute the labs that we will see in the upcoming section of this chapter, to see <em class="italic">how to test your web applications against real attacks and the importance of applying at least basic security hardening in your web applications.</em> </p>
			<h2 id="_idParaDest-281"><a id="_idTextAnchor295"/>Installing DVWA on Kali Linux</h2>
			<p>It is <a id="_idIndexMarker1258"/>not <a id="_idIndexMarker1259"/>easy to find clear (step-by-step) instructions to install DVWA on the latest version of Kali Linux; therefore, to save you some time (and headaches), I created a super-easy-to-follow guide to help you <em class="italic">install DVWA on Kali Linux in just 14 steps</em>. Here's how you do it:</p>
			<ol>
				<li>Navigate to the <code>html</code> folder, as follows:<pre><strong class="bold">cd /var/www/html</strong></pre></li>
				<li>Clone the <code>git</code> repository, like this:<pre><strong class="bold">sudo git clone https://github.com/digininja/DVWA.git</strong></pre></li>
				<li>Change permissions over the <code>installation</code> folder, as follows:<pre><strong class="bold">sudo chmod -R 777 DVWA</strong></pre></li>
				<li>Navigate to the <code>config</code> file in the <code>installation</code> folder, as follows:<pre><strong class="bold">cd DVWA/config</strong></pre></li>
				<li>Copy the <code>config</code> file and rename it, as follows:<pre><strong class="bold">cp config.inc.php.dist config.inc.php</strong></pre></li>
				<li>Open the <code>config</code> file to see the database credentials and modify the password to <a id="_idIndexMarker1260"/>something <a id="_idIndexMarker1261"/>easier to type (in the following example, I changed the password to <code>pass</code>):<pre><code>config</code> file, including all database information:</p><div><img src="img/Figure_12.6_B16290.jpg" alt="Figure 12.6 – DVWA database user configuration&#13;&#10;"/></div><p class="figure-caption">Figure 12.6 – DVWA database user configuration</p></li>
				<li>Install <code>mariadb</code> by running the following commands:<pre><strong class="bold">sudo apt-get update</strong>
<strong class="bold">sudo apt-get -y install apache2 mariadb-server php php-mysqli php-gd libapache2-mod-php</strong></pre></li>
				<li>Start the database by running the following command:<pre><strong class="bold">sudo service mysql start</strong></pre></li>
				<li>Log in to the database (the password is blank, so just hit <em class="italic">Enter</em> when asked), as follows:<pre><strong class="bold">sudo mysql -u root -p</strong></pre></li>
				<li>Now, we <a id="_idIndexMarker1262"/>need<a id="_idIndexMarker1263"/> to create a user in the database. In this case, we need to use the same username and password that we just created in the <code>config</code> file (see <em class="italic">Figure 12.7</em>). Here's the code you'll need:<pre>create user 'user'@'127.0.0.1' identified by 'pass';</pre></li>
				<li>Now, we need to grant all privileges to the user on the database, like this:<pre>grant all privileges on dvwa.* to 'user'@'127.0.0.1' identified by 'pass';</pre><p class="callout-heading">Tip</p><p class="callout">Notice that since we are working on the database, those commands need to end with a semicolon (<code>;</code>).</p></li>
				<li>Now, the result of those two operations on the database should look like this:<div><img src="img/Figure_12.7_B16290.jpg" alt="Figure 12.7 – Successful creation of the user on the database&#13;&#10;"/></div><p class="figure-caption">Figure 12.7 – Successful creation of the user on the database</p></li>
				<li>Now is <a id="_idIndexMarker1264"/>the <a id="_idIndexMarker1265"/>time to navigate to the <code>apache2</code> directory to configure our Apache server, as follows:<pre><strong class="bold">cd /etc/php/7.3/apache2</strong></pre></li>
				<li>Now, let's modify the <code>php.ini</code> file to ensure the following parameters are on: <code>allow_url_fopen</code> and <code>allow_url_include</code>, as shown in <em class="italic">Figure 12.9</em>, and to do that we will use <code>mousepad</code>, as follows:<pre><code>fopen</code> wrappers to modify these values, as illustrated in the following screenshot:</p><div><img src="img/Figure_12.8_B16290.jpg" alt="Figure 12.8 – Apache server parameters &#13;&#10;"/></div><p class="figure-caption">Figure 12.8 – Apache server parameters </p></li>
				<li>Now, it <a id="_idIndexMarker1266"/>is <a id="_idIndexMarker1267"/>time to start the Apache server. You can do this by running the following command:<pre><code>127.0.0.1/DVWA/</code>.</p><p>Congratulations!! If you can see the same as shown in the following screenshot, then it means that you successfully installed DVWA:</p></li>
			</ol>
			<div><div><img src="img/Figure_12.9_B16290.jpg" alt="Figure 12.9 – DVWA configuration page&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.9 – DVWA configuration page</p>
			<p>Oh, but wait—there<a id="_idIndexMarker1268"/> is still one <a id="_idIndexMarker1269"/>more step. Scroll down and click on <strong class="bold">Create/Reset Database</strong>. This will create a database for you and after a few seconds, you will be directed to a login screen, as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_12.10_B16290.jpg" alt="Figure 12.10 – DVWA login screen&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.10 – DVWA login screen</p>
			<p>Now, just enter the following credentials to log in:</p>
			<ul>
				<li><code>admin</code></li>
				<li><code>password</code></li>
			</ul>
			<p>As seen in the following screenshot, there are a lot of interesting vulnerabilities that you can test and<a id="_idIndexMarker1270"/> experiment<a id="_idIndexMarker1271"/> with, such as <strong class="bold">Brute Force</strong>, <strong class="bold">Command Injection</strong>, <strong class="bold">File Inclusion</strong>, <strong class="bold">SQL Injection</strong>, and more:</p>
			<div><div><img src="img/Figure_12.11_B16290.jpg" alt="Figure 12.11 – DVWA web interface&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.11 – DVWA web interface</p>
			<p>One very interesting attack is the famous XSS attack, which we will review in depth in the following section.</p>
			<h1 id="_idParaDest-282"><a id="_idTextAnchor296"/>Overviewing the most common attacks on web applications</h1>
			<p>Now is the <a id="_idIndexMarker1272"/>time to talk about the <em class="italic">most common attacks</em> against web applications that you may face and, of course, all the methods, techniques, and tools that you can use to protect your systems against them.</p>
			<h2 id="_idParaDest-283"><a id="_idTextAnchor297"/>Exploring XSS attacks</h2>
			<p>The logic<a id="_idIndexMarker1273"/> behind this type of attack is <a id="_idIndexMarker1274"/>very simple: <em class="italic">to leverage some JavaScript or HTML to execute some code on your web application</em>. </p>
			<p>To better understand these types of attacks, let's look at one of the most common types of XSS attacks: <strong class="bold">the hijacking of user sessions</strong>.</p>
			<h3>Hijacking a user session</h3>
			<p>Here, the <a id="_idIndexMarker1275"/>attacker will try to inject malicious code into a web application that can be used to exfiltrate the session cookie that will be used to impersonate the victim. </p>
			<p>To better illustrate this attack, let's see an example based on a web application used to rent houses, as follows:</p>
			<ol>
				<li value="1">The attacker will log in to the vulnerable site and create an entry to advertise the renting of a house <em class="italic">but</em> inside the description of the field (in which a normal person will describe the goodies of the house for rent), the attacker will embed malicious code aimed at gathering the user's session cookie and sending it to their server.</li>
				<li>When another user opens that <em class="italic">hacked</em> advertisement to rent a house, the malicious JavaScript will be executed and the victim's session cookie will be copied and sent to the attacker. </li>
				<li>Now, the attacker can impersonate the victim by using the stolen session cookie to identify themself as the victim on the system, as shown in the following screenshot:</li>
			</ol>
			<div><div><img src="img/Figure_12.12_B16290.jpg" alt="Figure 12.12 – Session hijacking via XSS&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.12 – Session hijacking via XSS</p>
			<p>Now, let's see <a id="_idIndexMarker1276"/>how you can prevent this attack. You could do the following:</p>
			<ul>
				<li>Set <code>php.ini</code> directives, as follows:<pre>session.use_only_cookies = 1 -&gt; for using only cookie based session ids
session.use_trans_sid = 0 -&gt; disable showing PHPSESSID in browser url</pre></li>
				<li>Use <code>session_regenerate_id()</code> every time you provide any important data (this will delete the old session number and generate a new one).</li>
				<li>Save in <code>$_SESSION</code> some fingerprinting about the user (such as IP address, browser-agent, and so on). Then, you can correlate that every time the cookie is received and if there is a mismatch, then you know something is not good.</li>
				<li>Use an <em class="italic">SSL certificate</em> to encrypt your data in transit.</li>
				<li>Educate your users to <em class="italic">always log out</em> instead of just closing the browser when using your web applications.</li>
				<li>Use <code>timeout</code> to <em class="italic">kill idle sessions</em> (expire sessions).</li>
				<li>Keep session <strong class="bold">Identifiers</strong> (<strong class="bold">IDs</strong>) out of the <strong class="bold">Uniform Resource Locator</strong> (<strong class="bold">URL</strong>).</li>
				<li><em class="italic">Avoid reuse of session IDs</em> for authentication.</li>
				<li>Flag session <em class="italic">ID cookies</em> as <code>HTTPOnly</code>.</li>
				<li><em class="italic">Request reauthentication</em> when accessing a sensitive resource in your web application.</li>
			</ul>
			<p>It is also important to highlight that there are many other known XSS attacks, such as the following:</p>
			<ul>
				<li>Execution of unauthorized activities</li>
				<li>Phishing</li>
				<li>Capturing keystrokes</li>
				<li>Capturing sensitive information</li>
			</ul>
			<p>Now, let's <a id="_idIndexMarker1277"/>overview some additional tips that you can leverage to better protect your web applications against XSS attacks.</p>
			<h3>Additional mitigation steps against XSS attacks</h3>
			<p>Here is <a id="_idIndexMarker1278"/>a list of some best practices that can be used to reduce the risk of being impacted by an XSS attack:</p>
			<ul>
				<li>Keep your web application <em class="italic">up to date</em> with security updates.</li>
				<li><em class="italic">Sanitize</em> inputs.</li>
				<li><em class="italic">Restrict</em> JavaScript entries on input fields (input validation).</li>
				<li><em class="italic">Ensure</em> that all third-party modules of your web application are also up to date.</li>
				<li>Regularly <em class="italic">check the CVE site</em> to determine whether any of your systems are impacted by a newly discovered XSS vulnerability: <a href="https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=xss">https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=xss</a>.</li>
			</ul>
			<p>Now, let's<a id="_idIndexMarker1279"/> talk about one of the best tools used to test vulnerabilities on web applications: <strong class="bold">Burp Suite</strong>!</p>
			<h1 id="_idParaDest-284"><a id="_idTextAnchor298"/>Using Burp Suite</h1>
			<p><strong class="bold">Burp Suite</strong> is a<a id="_idIndexMarker1280"/> great platform that allows us to look for vulnerabilities in our web applications. In fact, if you have web applications, <em class="italic">you must have</em> at least one person trained to use Burp Suite to test the security of your web applications.</p>
			<p><em class="italic">But don't worry if you don't have any experience with this tool—this section is for you!</em></p>
			<p>Here, you will learn how to set up Burp Suite to be ready for the next sections, in which you will see how to use Burp Suite and DVWA to test a web application against two very common attacks: SQL injection and brute-force attacks.</p>
			<h2 id="_idParaDest-285"><a id="_idTextAnchor299"/>Burp Suite versions</h2>
			<p>Let's start <a id="_idIndexMarker1281"/>by talking about the three main versions of the tool (but to make it easier, we will separate it into two—the free and the paid versions).</p>
			<h3>Professional and Enterprise editions</h3>
			<p>These <a id="_idIndexMarker1282"/>versions<a id="_idIndexMarker1283"/> come with more advanced tools, plus you can leverage them during your web application testing. Additionally, they also come with automation settings, which may be essential for large companies or corporations.</p>
			<h3>Community edition</h3>
			<p>This is a <a id="_idIndexMarker1284"/>basic version of the tool that is included on Kali Linux by default.</p>
			<p>With this version, you can perform many tests with the limitation that tests cannot be automated (they all have to be manually executed) but that is good enough for medium-to-small companies.</p>
			<p>But that is enough theory, so, if you want to know more about the details of each version and its price, visit their site at <a href="https://portswigger.net/burp">https://portswigger.net/burp</a>.</p>
			<p>Now, let's briefly explore the interface of the <strong class="bold">Community version</strong> of Burp Suite on <strong class="bold">Kali Linux</strong> before we jump into some real case scenarios so that you can execute yourself some of the most common testing operations for web applications, including SQL injections and brute-force attacks; but first, let's get familiar with the tool.</p>
			<h2 id="_idParaDest-286"><a id="_idTextAnchor300"/>Setting up Burp Suite on Kali</h2>
			<p>To<a id="_idIndexMarker1285"/> execute<a id="_idIndexMarker1286"/> Burp Suite on Kali, just open the command line and type the following command: </p>
			<pre>burpsuite</pre>
			<p>If it is the first time you have used Burp Suite, you need to read and accept the terms, and then you will be able to see the interface of Burp Suite.</p>
			<p><em class="italic">Wait</em>—did you <a id="_idIndexMarker1287"/>get an error about the <strong class="bold">Java Runtime Environment </strong>(<strong class="bold">JRE</strong>)?</p>
			<p>No worries—this is a known error when you launch Burp Community for the first time, and it is related to the version of the JRE installed on your OS, as seen in the following screenshot. Anyway, in this case, you can just bypass the message to launch Burp:</p>
			<div><div><img src="img/Figure_12.13_B16290.jpg" alt="Figure 12.13 – JRE error when executing Burp Suite &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.13 – JRE error when executing Burp Suite </p>
			<p>On<a id="_idIndexMarker1288"/> the <a id="_idIndexMarker1289"/>free version, the only available option is to select <strong class="bold">Temporary Project</strong>, so let's click there and then select <a id="_idIndexMarker1290"/>default options to finally access the main <strong class="bold">Graphical User Interface</strong> (<strong class="bold">GUI</strong>).</p>
			<p><em class="italic">Congratulations!</em> Now, you should be able to see the main interface of Burp Suite Community, as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_12.14_B16290.jpg" alt="Figure 12.14 – Burp Suite Community edition&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.14 – Burp Suite Community edition</p>
			<p>You have the environment ready to start doing some testing, so let's move on to see how <a id="_idIndexMarker1291"/>you <a id="_idIndexMarker1292"/>can use <strong class="bold">Burp Suite and DVWA</strong> to test your web applications against SQL injection attacks.</p>
			<h1 id="_idParaDest-287"><a id="_idTextAnchor301"/>SQL injection attack on DVWA</h1>
			<p>For this<a id="_idIndexMarker1293"/> demo, we<a id="_idIndexMarker1294"/> will use Kali Linux, plus the two tools that we just set up: Burp Suite Community edition and DVWA.</p>
			<p class="callout-heading"><strong class="bold">Tip:</strong></p>
			<p class="callout">If you reboot the machine, you need to start the services required for DVWA again and restart your browser using the following commands: </p>
			<p class="callout"><strong class="bold">sudo service apache2 start</strong></p>
			<p class="callout"><strong class="bold">sudo service mysql start</strong></p>
			<p>One of the cool features of DVWA is that you can customize the difficulty of the attack (they call them security levels). Here is a quick explanation about each of them:</p>
			<ul>
				<li><strong class="bold">Low</strong>: The computer is super vulnerable, and it has no security measures at all.</li>
				<li><strong class="bold">Medium</strong>: Intended to be a simulation of a web application without good security practices.</li>
				<li><strong class="bold">High</strong>: This is an extension of the previous level, in which exploitations may be harder to achieve.</li>
				<li><strong class="bold">Impossible</strong>: This is a simulation of a machine with all the best practices applied.</li>
			</ul>
			<p>In the<a id="_idIndexMarker1295"/> case <a id="_idIndexMarker1296"/>of SQL attacks, the <strong class="bold">Low</strong> security level shows you a text field in which you can easily input a direct SQL injection, as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_12.15_B16290.jpg" alt="Figure 12.15 – DVWA low security level: SQL injection&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.15 – DVWA low security level: SQL injection</p>
			<p>However, for our example, we will take it to the next level and we will use the <strong class="bold">Medium</strong> security level in which, instead of a simple text field, we will only see a drop-down menu.</p>
			<p>Therefore, to accomplish this security test, we are going to need an extra tool to inject the SQL, and here is where you will take advantage of a new friend: Burp Suite.</p>
			<p>Now, let's see step-by-step instructions to perform this super cool security test of SQL injection, as follows:</p>
			<ol>
				<li value="1">Open Burp Suite and create a temporary project using Burp defaults.</li>
				<li>From the main top menu, select <strong class="bold">Proxy</strong>, and from the submenu, select <strong class="bold">Intercept</strong>.</li>
				<li>Then, select the <strong class="bold">Lunch Burp Browser</strong> option.</li>
				<li>Using the Burp browser, open DVWA and go to the left menu and click on <code> </code><strong class="bold">Security</strong>, then on the dropdown, select <strong class="bold">Medium</strong> and click on <strong class="bold">Submit</strong>, as shown<a id="_idIndexMarker1297"/> in <a id="_idIndexMarker1298"/>the following screenshot:<div><img src="img/Figure_12.16_B16290.jpg" alt="Figure 12.16 – Changing the security level in DVWA&#13;&#10;"/></div><p class="figure-caption">Figure 12.16 – Changing the security level in DVWA</p></li>
				<li>Now, go to <strong class="bold">SQL Injection</strong> on the left menu, and there, you should see a drop-down menu with a <strong class="bold">Submit</strong> button, as shown in the following screenshot:<div><img src="img/Figure_12.17_B16290.jpg" alt="Figure 12.17 – SQL injection on the medium security level&#13;&#10;"/></div><p class="figure-caption">Figure 12.17 – SQL injection on the medium security level</p></li>
				<li>Go back<a id="_idIndexMarker1299"/> to<a id="_idIndexMarker1300"/> Burp Suite and click on <strong class="bold">Intercept is off</strong> to turn it on, as seen in the following screenshot:<div><img src="img/Figure_12.18_B16290.jpg" alt="Figure 12.18 – Turning on Intercept in Burp Suite&#13;&#10;"/></div><p class="figure-caption">Figure 12.18 – Turning on Intercept in Burp Suite</p></li>
				<li>Go back to <strong class="bold">DVWA</strong> and click on <strong class="bold">Submit</strong> (as seen in <em class="italic">Figure 12.17</em>).</li>
				<li>If you go back to Burp Suite, you should be able to see the intercepted data, as shown in the following screenshot:<div><img src="img/Figure_12.19_B16290.jpg" alt="Figure 12.19 – Data captured by Burp Suite&#13;&#10;"/></div><p class="figure-caption">Figure 12.19 – Data captured by Burp Suite</p></li>
				<li>As seen <a id="_idIndexMarker1301"/>at <a id="_idIndexMarker1302"/>the end of <em class="italic">Figure 12.19</em>, the value that we selected on the dropdown was sent as <code>id=1</code>, so let's play around with that number to see how secure this web application is.</li>
				<li>Let's change the value of <code>id</code> from <code>1</code> to <code>2</code> on Burp Suite and then click on <strong class="bold">Forward</strong> to see what happens.</li>
				<li>If you go back to <strong class="bold">DVWA</strong>, you will see that the dropdown is still showing <strong class="bold">User ID 1</strong>; however, the information of <strong class="bold">User ID 2</strong> is being displayed. This means that Burp Suite was able to successfully inject a new value without even touching the web page, as illustrated in the following screenshot:<div><img src="img/Figure_12.20_B16290.jpg" alt="Figure 12.20 – User ID changed from Burp Suite&#13;&#10;"/></div><p class="figure-caption">Figure 12.20 – User ID changed from Burp Suite</p></li>
				<li>But that <a id="_idIndexMarker1303"/>was<a id="_idIndexMarker1304"/> just a test. Now that we see that we can inject data, let's try to do a <em class="italic">real SQL injection</em>. To do this, let's change the value of <strong class="bold">User ID</strong> to see what we can achieve with different values. To achieve this, let's go back to Burp Suite and make sure that <strong class="bold">Intercept</strong> is ON and then click again on <strong class="bold">Submit</strong> on <strong class="bold">DVWA</strong> to get the data again on Burp Suite.</li>
				<li>Now, Burp Suite<code>1</code> to <code>1 OR 1=1#</code> and click on <strong class="bold">Forward</strong>.</li>
				<li>As you can see in the following screenshot, the web page in <strong class="bold">DVWA</strong> is now displaying the information from <em class="italic">all</em> five users at the same time, even when there is no option to do that. This means that <em class="italic">we just discovered a security flaw</em>! Here it is:<div><img src="img/Figure_12.21_B16290.jpg" alt="Figure 12.21 – Showing data that should not be displayed in a web application&#13;&#10;"/></div><p class="figure-caption">Figure 12.21 – Showing data that should not be displayed in a web application</p></li>
				<li>Click <a id="_idIndexMarker1305"/>on <code>ID</code> to the following:<pre>1 OR 1=1 UNION SELECT NULL,TABLE_NAME FROM INFORMATION_SCHEMA.TABLES#</pre></li>
				<li>Now, if you go back to <strong class="bold">DVWA</strong>, you will see that this time, we obtained a lot more information, <em class="italic">including the table names</em>. This is a very serious security vulnerability because an attacker can obtain very sensitive data from our web application. <em class="italic">Now, we just discovered a more serious vulnerability that jeopardizes the confidentiality of the information</em>, as illustrated in the following screenshot:<div><img src="img/Figure_12.22_B16290.jpg" alt="Figure 12.22 – Database information leaked from a web application&#13;&#10;"/></div><p class="figure-caption">Figure 12.22 – Database information leaked from a web application</p></li>
				<li>With<a id="_idIndexMarker1307"/> this<a id="_idIndexMarker1308"/> information, we can test whether we can retrieve even more sensitive data from this web application, so let's try with the following command:<pre>1 OR 1=1 UNION SELECT USER,PASSWORD FROM users#</pre></li>
			</ol>
			<p>If you go back to <strong class="bold">DVWA</strong>, you should be able to see all password hashes displayed, as seen in the following screenshot:</p>
			<div><div><img src="img/Figure_12.23_B16290.jpg" alt="Figure 12.23 – Hashed passwords leaked from a web application&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.23 – Hashed passwords leaked from a web application</p>
			<p>Now, let's<a id="_idIndexMarker1309"/> see <a id="_idIndexMarker1310"/>a common error that you may face when executing this lab.</p>
			<h2 id="_idParaDest-288"><a id="_idTextAnchor302"/>Fixing a common error </h2>
			<p>Are you getting <a id="_idIndexMarker1311"/>the same error as the one illustrated in <em class="italic">Figure 12.24</em>? If yes, don't worry—it is easy to fix. Just go to Burp Suite, select <strong class="bold">Intercept is Off</strong>, then refresh <strong class="bold">DVWA</strong> and everything should be good again.</p>
			<p>Also, remember that <em class="italic">those values are case-sensitive</em>, so make sure you use the correct case to avoid errors, as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_12.24_B16290.jpg" alt="Figure 12.24 – DVWA error&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.24 – DVWA error</p>
			<p>Now, let's do another test in which you can see whether a web application is vulnerable to brute-force attacks.</p>
			<h1 id="_idParaDest-289"><a id="_idTextAnchor303"/>Brute forcing web applications' passwords</h1>
			<p>Here, we will <a id="_idIndexMarker1312"/>use the same two apps that we have been using, so let's go directly to the steps, as follows:</p>
			<ol>
				<li value="1">Go to Burp Suite and make sure that <strong class="bold">Intercept </strong>is OFF.</li>
				<li>Go to <strong class="bold">DVWA</strong> and select <strong class="bold">Brute force</strong> from the left menu.</li>
				<li>Type <code>admin</code> as <code>12345</code> as <strong class="bold">Password</strong> (do not click on <strong class="bold">Login</strong> yet).</li>
				<li>Go back to <strong class="bold">Burp Suite</strong> and set <strong class="bold">Intercept </strong>to ON.</li>
				<li>Now, you should be able to see all data sent, including the <strong class="bold">Username</strong> and <strong class="bold">Password</strong> values typed.</li>
				<li>Click on the button that says <strong class="bold">Action</strong> on the top menu and then select <strong class="bold">Sent to Intruder</strong>, as shown in the following screenshot:<div><img src="img/Figure_12.25_B16290.jpg" alt="Figure 12.25 – Action menu on Burp Suite&#13;&#10;"/></div><p class="figure-caption">Figure 12.25 – Action menu on Burp Suite</p></li>
				<li>Now, you should see that the <strong class="bold">Intruder</strong> menu is now highlighted in red, so go and click <a id="_idIndexMarker1313"/>on <strong class="bold">Intruder</strong> in the top menu, as shown in the following screenshot:<div><img src="img/Figure_12.26_B16290.jpg" alt="Figure 12.26 – Intruder menu&#13;&#10;"/></div><p class="figure-caption">Figure 12.26 – Intruder menu</p></li>
				<li>Go to <strong class="bold">Positions</strong> on the top menu. There, you can see the parameters or variables that we are going to use in our payloads. Normally, it identifies some by default, so in this case, let's start by clearing those values by clicking on <strong class="bold">Clear</strong>.</li>
				<li>Then, change the attack type to <code>admin</code> and click on <code>12345</code>. The result should look like this:</p><div><img src="img/Figure_12.27_B16290.jpg" alt="Figure 12.27 – Adding payload positions&#13;&#10;"/></div><p class="figure-caption">Figure 12.27 – Adding payload positions</p><p>Now that <a id="_idIndexMarker1314"/>we have added both positions, let's go to <strong class="bold">Payloads</strong> on the top menu. There, if you click on <strong class="bold">Payload Set</strong>, you should be able to see that the drop-down menu has two items. This is because we just added two payload positions, so the first is for <strong class="bold">Username</strong> and the second one is for <strong class="bold">Password</strong>, as shown in the following screenshot:</p><div><img src="img/Figure_12.28_B16290.jpg" alt="Figure 12.28 – Adding payload sets&#13;&#10;"/></div><p class="figure-caption">Figure 12.28 – Adding payload sets</p></li>
				<li>OK—let's<a id="_idIndexMarker1315"/> set <code>1</code> (<code>username</code>) and <strong class="bold">Payload type</strong> to <strong class="bold">simple list</strong>.</li>
				<li>To make this example easy, we will include just two usernames: one will be <code>admin</code> and the other one will be <code>cesar</code>. To do that, just go to <code>admin</code> plus click <code>cesar</code>.</li>
				<li>Now, let's do the same with payload set #2 (<code>password</code>). Here, we would normally use a password dictionary, but to make this easier, let's just add a few options of passwords manually. To do this, just set <code>2</code>, keep the <code>kessen</code>, <code>topolino</code>, <code>password</code>, <code>letmein</code>, <code>qwerty</code>. The result should be as shown in the following screenshot:<div><img src="img/Figure_12.29_B16290.jpg" alt="Figure 12.29 – Adding payload options (values)&#13;&#10;"/></div><p class="figure-caption">Figure 12.29 – Adding payload options (values)</p></li>
				<li>Go back <a id="_idIndexMarker1316"/>to <strong class="bold">DVWA</strong> and copy the error message that you received when you put the wrong password: <strong class="bold">Username and/or password incorrect</strong>. </li>
				<li>Go back again to <strong class="bold">Burp Suite</strong> and now select <strong class="bold">Options</strong>. There, we are going to use the error as a marker to identify when the password is found. To do that, go to <strong class="bold">Grep Match</strong> and click on <strong class="bold">Clear</strong> to erase the default values, and then paste the error message and click on <strong class="bold">Add</strong>.</li>
				<li>Now, it is time to launch the attack. To do that, simply click on the <strong class="bold">Start attack</strong> button in the top-right corner.</li>
			</ol>
			<h2 id="_idParaDest-290"><a id="_idTextAnchor304"/>Analyzing the results</h2>
			<p>As of now, you<a id="_idIndexMarker1317"/> should see a window, as seen in the next screenshot, that shows the result of the brute-force attack.</p>
			<p>As seen in our example, there is one result in which the error was not found (last column), which means that the line is the one that contains the password. In this case, the <code>password</code>:</p>
			<div><div><img src="img/Figure_12.30_B16290.jpg" alt="Figure 12.30 – Results of the brute-force attack&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 12.30 – Results of the brute-force attack</p>
			<p>Now, remember that our goal here is to use this tool to test the vulnerabilities of our web applications and then to apply the appropriate remediations until the vulnerabilities are fixed.</p>
			<p>As you have seen, these two tools are extremely powerful <em class="italic">to test your web applications</em>, so as mentioned before, a good practice is to have at least one member of the security team trained in these two tools so that web application testing can be done on an ongoing <a id="_idIndexMarker1318"/>basis to find and fix any vulnerability before an attacker can exploit them.</p>
			<h1 id="_idParaDest-291"><a id="_idTextAnchor305"/>Summary</h1>
			<p>By now, you should have mastered all the aspects of securing your web applications. In this chapter, we have learned about active and passive data gathering of your web application and the best tools and methods used to discover sensitive data about your web application on the internet. We also learned about the risk of not obfuscating some <em class="italic">public</em> information about your web application.</p>
			<p>We also learned how to install, configure, and use the best virtual environment to become familiar with the most common vulnerabilities on web applications (the DVWA platform). Additionally, we explored how to install, configure, and use the best tool to assess the security of a given web application in real time (Burp Suite). </p>
			<p>And we also experienced a real hands-on example to see how easily an attacker can take advantage of common vulnerabilities to exploit your web application.</p>
			<p>But there are many other tools to find vulnerabilities in your web application and even the entire infrastructure, so let's move to the next chapter, in which we will review the best tools used to perform vulnerability assessments like a pro!</p>
			<h1 id="_idParaDest-292"><a id="_idTextAnchor306"/>Further reading</h1>
			<ul>
				<li>Additional information about the DVWA can be found on the official Git page at the following link: <a href="https://github.com/digininja/DVWA">https://github.com/digininja/DVWA</a></li>
				<li>This page highlights some other web application attacks that you may want to review: <a href="https://owasp.org/www-project-top-ten/">https://owasp.org/www-project-top-ten/</a></li>
			</ul>
		</div>
	</body></html>